# 大华读码相机

## 大华读码相机

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.15

## 语雀迁移至飞书

## 使用中

## 前提：
在进行调试前，先仔细阅读 PGV二维码说明。
## 一、适用范围
## 1.1 适用型号
### MV-R3051MG010 （供应商已停产）
## R3138MG010
## 1.2 供电
## 24V
## 1.3 支持二维码类型
## DM12
1677652403044-c713a99a-cc51-4a1c-b9c8-ca40626f35c1.png

## 1.4 读码相机固件版本：
需确保设备固件版本在此之后，旧版本固件存在 偶尔读不到码 的情况，固件更新步骤见6.1
1699236163734-ab4afe78-75d8-45e5-a174-08736589c023.png

## 大华固件：

DH_IC-R3138MG00C_V1.001.Fix3.2.R.20250324-1667_4.4.2.bin

## 1.5 工作范围
## 100mm±20mm
## 1.6 支持的二维码
## 不带圆环的单码：
1683271568498-43e60d1b-c6d0-4b10-b4b0-c2710e164be2.png

## 大华 不支持 带圆环的单码
1699342309768-359ef875-a619-40d1-80b4-9ef0d37b0ce8.png

## 4*4二维码
1663924687393-42d0fd84-0786-4375-85c7-582a7cf7ccc7.png

## 1.7固件：
### SRC底层固件使用2.0.34以上版本版本
### 二、大华读码相机调试资源
## 读码相机 手册：

中文华睿3000系列AGV读码器R3138MG010产品单页(1).pdf

中文大华AGV读码器用户手册V0.0.9-20210224144035.pdf

## 读码相机调试上位机：

SVStudio_Setup_2.1.0_20190809.rar

### 三、读码相机连接SRC

### 3.1、读码相机线序
## 485+ 对应 485A
## 485- 对应 485B
### 485A 接 485A，485B 接 485B，不能接反
## image.png

1677653070755-f22fecc9-8f1f-408b-9418-3027d0f57663.png

1677653085797-68315503-b549-4910-95d8-522e87ed305b.png

### 3.2串口连接方式

### 一个 读码相机 只能接一路 485 ，id从0开始

## 1、如果只有一个设备，默认接【485通信3】，不论上视下视，id配0

2、如果有两个设备(注意：对于SRC2000 只能按照分路485来接，因为大华不支持写入从站地址,所以得分开，其他型号控制器可以支持自定义 485 口，但是还是要在模型文件中区分 id 序号)

id配0的 读码相机 连接【485通信3】，

### id配1的 读码相机 连接【485通信4】

### 如果区分上视下视，默认下视id配0，上视id配1

1677653103784-7c94b762-48bb-4c75-87f3-8c9a3c64b5f0.png

### 3.3 串口资源
SRC880 和 SRC800/SRC2000/SRC3000 串口配置区别

### 四、读码相机参数配置

### 4.1 SVStudio使用

 SVStudio 启动后，主界面如图所示，①为工具栏，②为设备属性栏，③为预览区，④为结果输出区。
## image.png

程序启动后，会在相机连接界面自动发现同网段内的相机设备，并显示在“设备列表”。之后，如果有新的相机接入网络，需要点击“刷新”按钮，刷新设备列表。将鼠标移至要连接的设备上，点击“连接”按钮或者双击列表项，即可连接相机。连接前，要确保设备图标为可连接状态的图标。否则，需要先修改设备 IP （在断开连接状态下才能修改 IP ）。连接成功后，设备列表中相应设备的图标变成连接中。
1677652440504-936170d3-271a-474a-821c-2b3cfcd8623d.png

连接设备后，可预览扫描界面，并进行相应的配置。
1677652462034-f13e8618-79fd-4dd6-8e2a-2dca9f01ce3c.png

## 恢复出厂设置
1677652478097-bea5cbea-3536-402b-a7e6-3f60bd52bc42.png

重新连接设备后点击【设备属性】，触发类型选择【 FreeRun 】，频率推荐设置为100，如有特殊需求可按实际配置
1677652660985-d790c6a0-ea61-41f7-996f-9543ffff44b2.png

光源控制，展开 LightControl ， LightMode 有三种模式 Off（关闭）， Always（常亮）， Flash(闪烁)。此处配置为闪烁（功耗低）， LightBrightness 可设置内置光源亮度。如图。
1677652680039-7a8a162c-d6af-4810-9ec1-ad033fe870ea.png

## 二维码相关配置
## 4*4 的二维码配置方法与单码不同
## 4*4 二维码配置方法
### 在【AGVEnable】为false情况下才能设置该参数
## a. 设置通讯方式改成【RS485】

## b.二维码类型【P+F】

## c.上报类型【Query】

### d. 【DmLenMM】 是单个码的大小

e. 【DmIntervalLenMM】 是码间隔的宽度，这两个数据 均需要按照实际填写 ，否则读码相机数据会不准，

### f.上报数据精度，x、y、angle设置如下

## g.【OffsetAngle】默认为0

h.【TagSize】按照实际填写，单码是1×1，码阵选择4×4

### 设置后 【AGVEnable】改成【true】 ，如下图

1677652697253-b06457f8-e492-451a-b323-a5eab249beef.png

1677652713837-5fc26021-a57b-401a-8739-66b65ecd9880.png

1677652737239-c578326e-5e99-4d99-a3b1-7c8f7e6ecc2b.png

### 单码配置方法，尺寸推荐，20~30mm（只针对大华）
1677652754776-5d69b7b3-f2ba-4d02-9529-624ab39d168b.png

1677652771782-e00751dd-0d57-4f50-b076-607fa159ac00.png

### SiteID配成0，即使使用两个pgv也保持配0
1699337516274-92a0c280-e84b-4f94-9113-da3a44732c28.png

## 通讯设置，波特率115200
1677652789647-74b7605b-41d1-4dc4-a6c5-95a0b0a723f1.png

## 修改曝光
### 打开图像预览窗口，可以观察到识别到二维码的清晰度
1677652808873-66b62c77-ef73-4218-a74c-61d836b9f7fe.png

在修改曝光值前，先关闭图像预览缩放，这样可以看到相机识别到的原图
把 ImageOutputControl 中的 ScaleEnable 改为 False
1677652827374-821518d0-0c7b-4b8f-b1ef-ccc06058bbfe.png

ExposureTime 需要根据现场环境条件进行配置，调节曝光和增益，根据人眼感受，使目标清晰即可，建议优先调整曝光
1677652841885-7f776c28-d56f-49bc-be92-e2ac51aa8cfd.png

相机 过曝和欠曝 ，都会导致相机的识别失败率增加，数据输出端会出现 noread 的字样，此时应该把曝光调到合理范围
1677652973254-8fe75191-d49d-4aa5-8ec3-3437e2ef1dec.png

1677652989372-373a35e6-7ec6-40fb-b086-2c3b81a6c888.png

持续观察 1 分钟，当检测时间稳定，状态无 noread 现象出现时，即可判断曝光调整合理
1677653012458-9f07d498-9521-45b4-9e82-88b11c0635a4.png

### 该参数配置为 true ，可减小数据跳变，提高识别精度
1677653031082-7e900910-c5cf-4284-82f3-1fd190243c8d.png

保存参数，保存到【用户配置1】，启动配置改成【UserSet1】，保存后重上电设备
1677653161837-b366d790-6502-49e6-9eaf-7502e1dfb3c4.png

在配置完成后需要断开读码相机的上位机连接，否则会出现读码相机数据上报延迟过大的情况 。
### 五、模型配置

## SRC2000模型配置方法

## yaw 值确定方法

## 1、rbk：3.2.9及以下

读码相机 的 yaw (r) 角，需要通过将二维码与车子平行，从 读码相机 中读取 angle 角，然后 读码相机 配置中的 yaw 即为 - angle 。

## 例如：

### a.读取二维码角度值为90°，yaw值填-90°

### b.读取二维码角度值为270°，yaw值填90°

### 2、rbk：3.3.4及以上

yaw 值填写方式同3.2.9，正确填写 yaw 值后，执行读码相机标定

## 读码相机 标定方法详见此文档：
## 《PGV 标定》
## 《PGV-里程计标定》

单位 xUnit 、 yUnit 为 读码相机 配置的坐标值，按照实际配置填写；本文档配置坐标单位为0.1mm，所以填写0.0001m
1677653125350-c104c7f3-3404-40d0-86e2-b77553d04c7b.png

### 配置完成后可在【运行状态】-【读码相机】一栏看到读码信息
1677653140273-aa2ff6ae-adc4-42a2-b874-dcecf5e1c380.png

### 六、固件烧录
### 6.1 固件烧录步骤
### 固件由大华提供，升级过程中遇到问题请联系大华解决

相机工具CamTools升级工具使用方法及注意事项.docx
### 七、FAQ
### 7.1 读码相机可以识别到二维码，但是输出的位置信息为0
阅读 PGV二维码说明 ，检查二维码类型是否符合要求。

### 7.2 相机超时
检查供电，485通信，相机参数配置是否有异常，如都无异常，相机恢复出厂设置后重新配置
## 接一个不超时，接两个报错超时：
### 检查大华的SiteID配的是不是0，参见4.7

### 7.3 二维码反光怎么办
调整相机的曝光和增益，在预览画面中观察识别到的二维码清晰无反光即可

### 7.4 读码相机和二维码相对静止时反馈的数据噪声较大、
如下图log，以角度为例，静止时反馈数据跳动频繁，且跳动范围将近2°，此时可检查是否读码相机参数配置不正确，参照 4.9-修改曝光 和 4.10
1685937708361-8560d97f-ccd4-43d6-b00e-b98b1501362b.png

### 7.5 反复配置参数后依旧无法通讯
## 确认接线是否正确，一定要仔细确认清楚
可能是某些未知的参数配错导致，需要恢复出厂设置再重新配置。恢复出厂设置参照4.7.4
### 7.6 大华相机常见问题FAQ

## 华睿AGV读码器常见问题问答.pdf
### 7.7 读码相机上位机连接
在配置完成后需要断开读码相机的上位机连接，否则会出现读码相机数据上报延迟过大的情况。
