# SRC-2000(S) 控制器电池适配说明

### SRC-2000(S) 控制器电池适配说明

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.30

## 语雀迁移至飞书

## 使用中

## V1.1

### 2024.7.4

## 修复文档中异常附件

## 使用中

## 一、适配内容
电池模拟量查询，包括电流，电压，内部温度，容量；
## 充电为正
## 放电为负
### 二、支持接口及协议
CAN ， RS485 ， RS232 （不推荐）；
注意 SRC-2000(S) 的 RS232 和 RS485 是同一个硬件接口，软件上可配置电池模型文件 type 进行切换
1678168720745-74795ecf-1d33-4d5a-8b5f-3b2f5a9593a6.png

### CAN总线电池协议(修正了除号)（力通威）.pdf
仅适配了协议中 ID 0x209 ， 0x20A ， 0x20B 的报文。 CAN 总线的波特率 250Kbps ，电池 PDO 发送频率 <10Hz （大于 100ms 一次）

## 串口电池协议1363.pdf
### （既YD/T1363.3-2005通讯行业的行业标准协议）
波特率 9600 或 115200 ，数据位 8 ，停止位 1 ，无校验位。 主机查询频率为 1Hz ，通讯超时会 2s 查询一次 。
### 三、 SRC-2000(S) 电池接口接线方法
## 1.将下面的连接线接到 SRC-2000(S) 的顶部车规端子TE35上；
1678168739360-ed708275-8140-4f30-abbe-571aa3b08098.png

1678168746599-a9f08ced-e308-4396-a7fc-bc417f1ad444.png

2. 基于 RS485 或者 RS232 的电池通讯线制作方法，选择合适的 5 条线材 压入连接器（ DT06-6S ），连接器定义如下。连接器规格详见： https://www.te.com.cn/chn-zh/product-DT06-6S.html?source=header-match

## 连接器 PIN

## 线标

## 对应线束

## DT06-6S PIN1

## 电池开关 O

## 超五类 CAT5E 网线 棕

## DT06-6S PIN2

## 485 通信 5A/232 通信 TX

## 超五类 CAT5E 网线 蓝

## DT06-6S PIN3

## DT06-6S PIN4

## 地

### 超五类 CAT5E 网线 绿 / 绿白 / 橙 / 橙白

## DT06-6S PIN5

## 485 通信 5B/232 通信 RX

## 超五类 CAT5E 网线 蓝白

## DT06-6S PIN6

## 电池开关 N

## 超五类 CAT5E 网线 棕白

### 3. 将制作好的电池通讯线连接到 SRC-2000(S) TE35 配线上的电池通讯接口上。
1678168807568-8f3f8674-a239-4e60-9162-e9be1eef09f4.png

### 4.CAN 通讯的电池连线制作方法 :
 第 2 步中的 RS485 或者 RS232 悬空不接，单独用连接器 TE DT06-2S 制作 CAN 通讯线，接入 SRC-2000(S) TE35 配线上的 CAN2 通讯接口上

## 连接器 PIN

## 线标

## 对应线束

## DT06-2S PIN1

## CAN 通信 L

## 线束②

## DT06-2S PIN2

## CAN 通信 H

## 线束 ①
### 四、基本参数
### 4.1 UART&CAN （ 1 ）
（ 对应 Roboshop 2.3.X 选项，要求： RBK 版本 3.2.6.56+& 固件版本 1.9.54+ ）

## Roboshop 选项

## 接口

## 波特率 /bps

## 协议

## 容量

## 电压

## TE 线端口

## 电池品牌

### YiHe-XZ-Protocol1363

## RS485

## 9600

## 1363

## 35Ah/50Ah

## 48V

## 电池通讯

一合 (YH-XZ13S10P/YH-XZ-13S15P)/ 凯歌 (13S17P)/ 锂平定制电池 (SBP-48V35AH01-SLEC)

### PylonTech-RB2450-Protocol1363

## RS232

## 115200

## 1363

## 50Ah

## 24V

## 电池通讯

## 派能 （ RB2450 ）

### TopBand-TB4840F-WwPrivate

## RS485

## 19200

## Modbus

## 40Ah

## 48V

## 电池通讯

## 拓邦 （ TB4840F ）

### Kingor-KGNL001-NLPrivate

## RS485

## 9600

## 30Ah

## 48V

## 电池通讯

## 凯歌 （ KGNL001 ）

### Kingor-TernaryLi-AJPrivate

## CAN

## 500K

## CAN

## 凯歌 三元锂

## JunDi-MCF-CAN

## CAN

## 250K

## CAN

## 君迪

## RuiBoTe-MCF-CAN

## CAN

## 125K

## CAN

## 瑞博特

### ZhongQi-None-CANOpen

## CAN

## 250K

## CAN

## 中汽

## Lishen-None-Private

## RS485

## 9600

## 电池通讯

## 力神

## Fuyuka-MZ-Private

## RS485

## 19200

## Modbus

## 电池通讯

## 富佑嘉捷

### LinPin-Fork-Protocol1361

## RS485

## 19200

## 1363

## 电池通讯

## 锂平（叉车带充电）

## AnJo-None-Private

## CAN

## 500K

## CAN

## 安井

## KuLi-None-Private

## RS485

## 9600

## 电池通讯

## 酷锂

## LTW-None-Private

## CAN

## 250K

## CAN

## 力通威

## HeLi-None-Private

## CAN

## 250K

## CAN

## 合力

## HuoKe-200A-Modbus

## RS485

## 9600

## 电池通讯

## 霍克

### MeiKe-LBHX4880A-Protocol

## RS232

## 9600

## 电池通讯

## 美科锰酸锂电池组

### BaiWei-Bwbm617-ProtocolA5

## RS485

## 9600

## 电池通讯

## 百维

### MeiKe485-485-Protocol

## RS485

## 19200

## 电池通讯

## 美科 485 通讯

### YiDian-None-PrivateCan

## CAN

## 250K

## CAN

## 易电（ CAN ）

## DaLi-V1-Protocol

## RS485

## 9600

## 电池通讯

## 达锂

## MS-MSPrivate

## CAN

## 250K

## CAN

## 牧星

### FuShiKang-None-Private

## RS485

## 115200

## modbus485

## 电池通讯

## 富士康

Roboshop 界面（ 对应 Roboshop 2.3.X ）：
1678177919366-1b377f9e-2494-4033-83ac-a30f32b11664.png

模型根据自身要求选择电池型号，电池电压，电池容量，百分比采集方式，串口类型，终端电阻，波特率。
### 4.2 UART&CAN （ 2 ）
（ 对应 Roboshop 2.0.8 选项，要求： RBK 版本 3.0.X& 固件版本 1.8.X ）

## Model

## Roboshop 选项

## 接口

## 波特率 /bps

## 协议

## 容量

## 电压

## TE 线端口

## 电池品牌

## 0

## none

## 无

## 无

## 无

## 无

## 无

## 无电池通讯

## 无

## 1

## M1_232_1152_PN

## RS232

## 115200

## 50Ah

## 24V

## 电池通讯

## 派能
## (RB2450-A1)

## 2

## M2_pri_485_1152

## RS485

## 115200

## Modbus

## 电池通讯

## UK

## 3

## M3_232_9600_PC

## RS232

## 9600

## 100Ah

## 48V

## 电池通讯

## 津衢

## 4

## M4_232_9600_PN

## RS232

## 9600

## 100Ah

## 24V

## 电池通讯

## 派能
## (BP24100A)

## 5

## M5_485_1920

## RS485

## 19200

## Modbus

## 电池通讯

## UK

## 6

## M6_232_1152_PN

## RS232

## 115200

## 50Ah

## 48V

## 电池通讯

## 派能
## (Extra2000)

## 7

## M7_232_9600_ZY

## RS232

## 9600

## 电池通讯

## 卓一

## 8

## M8_485_9600_KG

## RS485

## 9600

## 电池通讯

一合 (YH-XZ-13S10P/YH-XZ-13S15P)/ 凯歌 (13S17P)

## 9

## M9_CAN_Battery

## CAN

## 250K

## CAN2

## 力通威

## 10

## M10_485_1920_HB

## RS485

## 19200

## Modbus

## 电池通讯

## 拓邦

## 11

## M11_485_9600_NL

## RS485

## 9600

## 电池通讯

## 诺力

## 12

## M12_1363_232_9600

## RS232

## 9600

## 1363

## 电池通讯

## 用户扩展

## 13

## M13_1363_232_1152

## RS232

## 115200

## 1363

## 电池通讯

## 用户扩展

## 14

## M14_1363_485_9600

## RS485

## 9600

## 1363

## 电池通讯

## 用户扩展

## 15

### M15_1363_485_9600_WR

## RS485

## 9600

## 1363

## 电池通讯

## 用户扩展

## 16

## M16_1363_485_1152

## RS485

## 115200

## 1363

## 电池通讯

## 用户扩展

## 17

### M17_1363_485_1152_WR

## RS485

## 115200

## 1363

## 电池通讯

## 用户扩展

Model 15 ， 17 Roboshop 选项中的 WR （ without Resister ）是无终端电阻的意思。 绿色 为新用户可扩展选项。
Roboshop 界面（ 对应 Roboshop 2.0.8 ）：

1678177985622-10321a20-48a1-45d8-885c-d5b434e54dc5.png

### 五、报文 Demo
### 5.1 RS232 或者 RS485
波特率 9600 或者 115200 ，数据位 8 位，无校验位， 1 停止位。
## 协议版本 ： 20
## 协议地址 ： 01
需实现：获取模拟量量化后数据（ CID2 为 42H ）时的数据
1678178007835-bb4bbe73-d1d6-4c86-923d-3258d7fe9020.png

## SRC-2000(S) 控制器发送
7E 32 30 30 31 34 36 34 32 45 30 30 32 30 31 46 44 33 35 0D
## 电池回复示例：
7E 32 30 30 31 34 36 30 30 32 30 35 41 31 31 30 31 30 38 30 44 30 39 30 44 30 41 30 44 30 41 30 44 30 43 30 44 30 43 30 44 30 42 30 44 30 43 30 44 30 42 30 33 30 42 44 37 30 42 44 37 30 42 44 37 30 30 30 30 36 38 35 37 42 44 37 34 30 32 43 33 35 30 30 30 30 42 30 31 30 37 45 34 33 35 30 30 30 30 30 30 30 31 45 41 35 41 0D

1678420945932-7cadca0a-1f21-4128-8dcc-25038775d6f8.png

## normal ：30 30 （固定）
字节长度 ：例 32 30 35 41，第一个字符32保持不变， 后三个字符为有效数据（即ASCII 码表中30/35/41 对应的 ASCII 码字符分别为 0/5/A,故而转换成16进制为 0x5A）, 即0x5A = 90（16进制 0x5A 转十进制数为90）
## flag ： 31 31（固定）
## pack ： 电池包（目前只支持为1）
## m ： 电芯数
## 电压单位 ：1mV
## n ：温度传感器数量
温度单位 ：摄氏度，值为当前温度 +40℃。例如，报文温度数据为80，则真实温度为40°C。温度范围在 -40℃-120℃。
### 电流单位 ：10mA，有符号整形（ 充电为正 ）
总电量和剩余电量要求单位为 10mA*h ，并且在 uint16 类型下不会溢出 。
## 用户字段 ：30 32（固定）
电池序列号 ：demo中的电池序列号转换为十六进制为： 0107E43500000001
电池序列号由厂商 ID 和电池 ID 组成，一共 16 个字符，如 30 31 30 37 45 34 33 35 30 30 30 30 30 30 30 31 ；
第一第二字符为厂商 ID ，转成十进制为 1 ， 厂商 ID 由仙工分配，如需满足此协议请向我司申请 ID 号 ；
第三到第六字符为年份，转成十进制为 2020 ，表示 2020 年；
第七第八字符为周数，转为十进制为 53 ，表示第 53 周；
第九到第十六字符为电池 ID 号，转为十进制为 1 ；
同厂商同一年下的电池序列号从 1 开始依次递增，次年 ID 归零，重新从 1 开始递增 。

## 厂商名称

## ID

## 锂平

## 1

## 泰坦

## 2

## 秒冲

## 3

## 聚云

## 4

## 沛城

## 5

## 格林美

## 6

## 华科

## 7

## 埃尔瑞特

## 8

## 科莫

## 9

## 江淮重工

## 10

## 云杉科技

## 11

## 电池序列号显示如下 ：
1678178045964-3a6c8899-1c29-464d-8d47-f321001f5539.png

## 对电池报文解析脚本 ：
### Battery_message_analysis.exe

### 5.2 CAN
## CAN ID
1678178055602-1b26f5af-81d9-4d6d-bf2b-2788ded32d21.png

1678178059217-9cc6f3cd-57f3-4b84-9e64-0cd037347958.png

1678178066157-766fa314-adbc-4633-9847-f1db1f379107.png

1678178070590-06fed0e9-9b15-48d6-988a-6bd0a83c4941.png

1678178076904-b740f009-56a2-4542-9abe-1485dd8981a8.png

### 六、与roboshop无法通讯排查
## 以 uart 类型电池为例
### 6.1 报文解析器
## 可使用报文解析器初步验证报文正确性
### 6.1.1 解析器下载

### 报文解析器-20220112161839.zip
### 6.1.2 界面
1678178088462-10059598-97b0-4e4e-a428-802f14304092.png

### 6.1.3 操作说明
Ø  将完整报文 (7E/7e 开头 ,0D/0d 结尾 ) 填入报文输入框 , 报文中的空格和回车字符程序会自动去除 , 填入正确后电池信息会自动显示在相应的信息框内
Ø  清空键可以一键清除所有内容 , 包含输入框和显示框 , 然后就可以重新输入了
### Ø  报文未完整输入或者输入有误都会有红色字体进行提示
### 6.2 排查步骤
### 6.2.1 工具准备
## USB 转串口工具
1678178102024-1454ad8e-aabe-43c9-ab52-9e46eaaec461.png

### 串口通讯上位机，本文使用 sscom.exe

https://seer-group.coding.net/s/0ad29b13-2893-4156-a2c4-6e58e37e757f

以 485 通讯为例，确保模型文件配置正确，电池品牌选择如下
1678178110000-7149c312-e47f-4cb2-9f13-3673439739e3.png

### 6.2.2 排查流程
### 6.2.2.1 接线
仔细核对电池接线是否反向，如果是 232 通讯，电池的 Tx Rx 与控制器的 Tx Rx 交叉连接，注意地线也需要接
### 6.2.2.2 检查报文
1678178118646-5723b848-5818-4201-8dbc-00184d392011.png

用串口助手读取电池报文，按照下图的格式排版（此报文以《 SRC-2000(S) 控制器电池适配说明》中的报文 demo 为例）

1678420958133-34d655d1-442f-4997-957a-2f60caeb710a.png

## 注 ：
a.  byte 的值是否与实际报文数量一致（ byte 到校验位之间的数量， 红框内 报文）；
b.  pack = 1 ；
c.  用户字段为 30 32 ；
d.  除帧头（ 7E ）帧尾（ 0D ）外的报文一定是 30~39,41~46 之间 （ ASCII 码）
此报文除帧头 7E 和帧尾 0D 其余全是 ASCII 码数据，需要转成十六进制再转成十进制进行计算
### ASCII 码对应的十进制 0~F 值如下：
### ASCII 码： 30~39 对应十六进制： 0~9
### ASCII 码： 41~46 对应十六进制： A~F
## SOC == 剩余 mh/ 总 mh
温度：先把报文从 ASCII 码 转为 十六进制 再转为 十进制 进行计算
若报文数据 > 2000 ，温度 = （报文数据 - 2731 ） /10 ；
反之，温度 = 报文数据 - 40 ；
如上图报文示例： 30 42 44 37 == 0BD7 == 3031 ；
## ASCII 码  十六进制  十进制
温度 = （ 3031-2731 ） /10 = 30 ；
### 6.2.2.3 SRC 通讯口异常
绝大部分无法通讯是前两种导致的 ，可以用串口助手定时发送 demo 中的报文给控制器模拟电池报文，判断通讯口是否故障
## 报文 demo （有序列号版）：
7E 32 30 30 31 34 36 30 30 32 30 35 41 31 31 30 31 30 38 30 44 30 39 30 44 30 41 30 44 30 41 30 44 30 43 30 44 30 43 30 44 30 42 30 44 30 43 30 44 30 42 30 33 30 42 44 37 30 42 44 37 30 42 44 37 30 30 30 30 36 38 35 37 42 44 37 34 30 32 43 33 35 30 30 30 30 42 30 31 30 37 45 34 33 35 30 30 30 30 30 30 30 31 45 41 35 41 0D
发送报文注意选择正确的 COM 口，波特率正确，定时发送时间合理（ 1000ms 以内）
1678178137448-f4aa7362-ba41-42cf-bae0-1adabc622a49.png

### 七、模型文件
### 7.1 串口通讯
1678178110000-7149c312-e47f-4cb2-9f13-3673439739e3.png

### 7.2 CAN通讯
1680243052197-7274875f-9b05-4b57-83fa-40ed8d3b3490.png

### 八、已适配电池协议简易判断方法
### 8.1 baiwei
## 模型文件配置：
## filename.png

## baiwei电池协议文档判断标准：
## filename.png

## 报文收发demo：
## filename.png

### 8.2 嘉佰达
## SRC2000模型选择：
## filename.png

## SRC800&SRC3000选择：
## filename.png

## 嘉佰达电池协议文档判断标准：
## filename.png

### 九、FAQ
### 9.1 电池常见问题答疑：
https://shimo.im/docs/8Nk6MJdpdphzj9qL/ 《电池 FAQ 》
