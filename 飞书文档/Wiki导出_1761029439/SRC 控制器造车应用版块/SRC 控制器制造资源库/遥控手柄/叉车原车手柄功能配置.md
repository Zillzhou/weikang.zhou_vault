# 叉车原车手柄功能配置

## 叉车原车手柄功能配置

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.30

## 语雀迁移至飞书

## 使用中

## 说明
本文档针对机器人改造过程进行规范，介绍了林德系列的叉车在改造过程中出现的手柄不匹配的问题。本文档只作为原理性解释，具体的配置
## 一、叉车原车手柄控制原理及分类
## 叉车原车手柄的功能：
控制叉车前进、后退；
控制叉车舵轮进行舵角的调整；
控制叉车货叉上升、下降；
### 目前我们在叉车改造过程中所遇到的原车手柄的控制方式有两种：
控制叉车前进、后退、舵角调整、上升、下降是通过 3 个电位器接到改造后的 Curtis 驱动器上面， Curtis 驱动器根据信号的输入来控制对应叉车的动作。这种控制方式不需要根据本文档进行配置。
控制前进、后退功能是一个电位器，接到 Curtis 驱动器的对应的管脚。
控制舵角调整的是一个电位器-转向点位器，接到 Curtis 驱动器的对应管脚。
控制上升、下降功能是一个电位器，接到 Curtis 驱动器对应的管脚。
控制叉车前进、后退、货叉上升、下降的功能是通过can数据进行控制，转向是通过转向电位器输出：
控制叉车前进、后退功能是一个电位器，但是手柄内部有一个小控制器，将电压信号转换成了can数据输出。
控制叉车货叉上升、下降功能也是一个电位器，通过手柄内部的小控制器将电压信号转换成了can数据输出。
控制舵角调整是一个电位器，接到 Curtis 驱动器的 Analog 对应的管脚，会输出一组can信号，在软件内部进行处理。
### 二、使用范围
目前这个只有在林德车型的造车中，有了原车手柄，且原车手柄是通过can通信协议的，才会用到此种配置方式。
### 三、配置原理
## 重新适配后的手柄功能原理：
通过配置 Manipulators 将手柄的 can 协议放在控制器中解析得到响应行走、升降的速度数据。
转向数据通过驱动器的电位器信息转换成 can 数据的输出，控制器读到响应的数据之后转换成角度数据，发给转向驱动器。
## 手柄配置原理：
对于控制器来讲区分手自动模式的功能。
在手动功能下，控制器通过 can 协议给驱动器发送响应的控制命令，完成行走、转向、货叉升降的动作。
### 四、机器人模型配置说明
按照原车电气原理图，确定一下手柄接在哪一路 can 上面，将相应的 port 口配置成500k，注意手柄的 can 的波特率是 500K 。
按照电气原理图，看一下手自动开关接在是哪一个 DI 上面，配置 Trigger 用来触发手自动模式切换。
### 例如如果手自动开关接的是 DI0 的话：
配置一个 Trigger ，设置 source 为 DI ，将 DI 号填在下面；
设置上升沿触发外部控制模式，配置 type 为 risingEdge ；
将func配置成 switchToExternalControl 。
## 参照下图：
1661155629432-30ee4ac5-7728-4f3c-b80a-98a16d1c6117.png

这个配置包含的意思是，如果接在手自动开关上面的DI0被设置成了高电平，就会将控制器的模式切换为“手动控制模式”，但是对于1232E驱动器来讲，仍然是自动模式。
配置另外一个 Trigger ，用来将“手动模式”切换成自动模式
### 依然以手自动开关接的是 DI0 为例讲：
配置一个 Trigger ，设置 source 为 DI ，将 DI 号填在下面；
设置上升沿触发外部控制模式，配置 type 为 fallingEdge ；
将 func 配置成 switchToSRCControl 。
## 参照下图：
1661156009549-59527d7a-f07c-42fd-88ff-c5ae8f161c35.png

这个配置包含的意思是，如果接在手自动开关上面的DI0被设置成了低电平，就会将控制器的模式切换为“自动控制模式”，但是对于1232E驱动器来讲，仍然是自动模式。
## Manipulators 的配置方法
选取 Manipulators 勾选启用设备；
选择 canPort 为 port1 【按照实际can接线来配置】；
将 brand 配置成 none ；
选择 CANHandleBrand 为 LINDE-1183-CANHANDLE 。
## 参照下图：
1661155979862-0487a347-387b-4886-bb3e-c5a85dba55ed.png

### 五、异常处理
由于没有完全破解林德原车手柄的can协议，如果开机一段时间后手柄不响应实际的动作，请按一下手柄复位按钮进行手柄的重新复位。手柄重新复位后会正常工作。
