# 遥控手柄使用指南

## 遥控手柄使用指南

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.30

## 语雀迁移至飞书

## 使用中

## 适用范围
## 控制器：SRC全系列
手柄协议要求：支持Xinput协议的手柄;
手柄品牌型号：当前支持微软Xbox、雷神 G20、雷神G25、罗技 F710，其他支持 Xinput 协议的手柄暂未测试。其中，G20手柄为有线连接版本，微软Xbox、雷神G25、罗技F710为无线版本（仍需要将接收器连接在控制器上，手柄和接收器之间无线连接）。
## 安装配置说明
## RBK 3.4.5.X 及之前版本
仙工智能控制器产品支持使用XBox协议手柄控制小车，以罗技游戏手柄为例：
## 通讯模式：2.4GHz 无线
## 工作模式： 5 号电池
1700115253491-ddab7dca-cb94-46a7-bdee-662152414d39.png 

1700115266991-894ed3a1-5e4d-4b53-bbd6-1c4f2df761d2.png

## 手柄连接方式
将 USB 无线接收器插到传输线的 USB 口，传输线的 USB 口接入控制器 USB 口。此时按下手柄相应的按键，机器人便会执行相应的动作；
1700115283166-78e56714-eb06-435f-8866-9d6a2269f61a.png 

1700115279393-4af02f38-3da4-44d9-94a1-a3f125edd7d0.png

### （手柄USB线插在SRC控制器USB接口）
1700115293551-3a3ef87a-f7ba-407b-b5fc-345ff41b6cae.png

## 按键说明
## 遥控模式

## 按键

## 功能

## 备注

## 十字键

## ↑前进、↓后退、←左转、→右转

## 若控制器没有回收控制权，则按键无效

## MODE

## 十字键控制和摇杆 1 控制切换

## 摇杆2

摇杆上移 - 前进、摇杆下移 - 后退、摇杆左移 - 左平移、摇杆右移 - 右平移

## 左右平移仅对全向车有效

## 右摇杆按下

## 确认定位正确

## 若无法确认定位正确，按键无效

## 导航模式

## Y

## 暂停 / 继续导航

## A

## 导航至手柄控制的初始站点

参数为 JoystickInitPoint 。若初始站点不存在则不导航，按键无效

## X

### 导航至当前站点 LMn 的上一个站点（ LMn-1 ）

若当前不在任何一个站点则不导航，若 LMn-1 不存在则不导航，按键无效

## B

### 导航至当前站点 LMn 的下一个站点（ LMn+1 ）

若当前不在任何一个站点则不导航，若 LMn+1 不存在则不导航，按键无效

## LB/RB

## 取消导航

## 相关参数
1700115372435-aafc3d2b-025e-45fd-8e8e-affd4df1ec84.png

### 3.4.6.X 及之后版本
## 手柄连接方式
## 参考2.1.1
## 版本要求
## RBK：3.4.6.XX
### Roboshop：2.4.1.149及以后版本
## 手柄按键功能配置说明
## 键位介绍
此版本手柄遥控功能仅支持通用按键（LT\LB\RT\RB\A\B\X\Y\左右摇杆\十字键），如您使用的手柄与下图按键位置不符，请确认是否支持XINPUT协议及各按键映射关系。
## image.png

## 按键功能配置表

## 按键

## 支持操作

## 是否可自定义配置

## 可使用功能

## LT

## 按下

## 否

## 激活手柄遥控（并抢占控制权）

## LB

## 长按

## 否

## 使能键

## RT

## 按下

## 否

## 关闭手柄遥控（并释放控制权）

## RB

## 单键 按下
## 单键 抬起
## 组合键 按下
## 组合键 抬起

## 是

## 按键的每个单独操作可配置以下任一功能：
## 取消导航
## 暂停/继续导航
## 导航到初始站点
## 导航到上一个站点
## 导航到下一个站点
## 设置虚拟DI

## A

## B

## X

## Y

## 左摇杆按动

## 右摇杆按动

## 左摇杆摇动

## 单键 摇动
## 组合键 摇动

## 是

## 按键的每个单独操作可配置以下任一功能：
## 全向移动/前进后退
## 前进后退左转右转

## 右摇杆摇动

## 单键 摇动
## 组合键 摇动

## 是

## 按键的每个单独操作可配置以下任一功能：
## 全向移动/前进后退
## 前进后退左转右转

## 十字键

## 单键 长按

## 是

## 前进后退左转右转

## 组合键 按下

## 是

## 按键的每个单独操作可配置以下任一功能：
## 前进后退左转右转 （长按）
速度加减：单次按动加减速度，调整精度为线速度±0.1m/s（前＋、后-）、角速度±6°/s（右+、左-）。
## 配置页面
每个按键的不同操作均设计了独立的功能设置下拉框。
1700737151050-17795003-1b4c-4d66-95db-a87c6e6043b9.png

可通过下载获取当前机器人手柄按键功能配置；配置完成后通过上传将配置结果同步至机器人。
1700736475295-412f9b4f-ee89-4633-933f-84be741a14af.png

注意：下载、上传需在机器人控制权无人抢占的情况下操作，如手柄已抢占控制权，请先释放控制权。
## 虚拟DI使用
## 正常使用：作为常规DI使用
触发trigger：在trigger中可执行更多任务，如设置DO、执行脚本等，详见 Trigger
1700734635032-8e075250-c5cd-421d-a24c-85e1b7cd6029.png

## FAQ
## XBox 手柄无法连接
先尝试在手柄接收器连接控制器的状态下尝试进行配对；
如配对成功，但Roboshop端不显示已连接手柄，则升级最新的patch安装包——联系仙工技术支持。
## 罗技F710手柄唤醒说明
F710手柄没有开关机，上电自动开启，长时间不用休眠。
唤醒：按A、B、X、Y、LB、RB、BACK、START，以及【按下】摇杆
手柄连接控制器后，若按下手柄十字键，连接无反应。
a. 按下MODE切换控制状态；
b. 请打开roboshop查看机器人控制权是否被其他设备抢占。 手柄控制机器人移动，机器人控制权处于无其他设备抢占状态，或控制权被控制器抢占状态；
c. 检查机器人是否处于急停状态，处于急停状态，按下按钮无响应。
1700115870448-dd928585-bdea-4f65-934d-bbbaf694512d.png

1700115874959-8ab6f47f-0829-4468-9952-0d9af5b569be.png

无线接收器已正确安装，但手柄开机后，手柄无法连接控制器。
a. 罗技F710：检查模式是否为X模式；
b. 雷神G25：手柄无线接收器安装在新控制器后如无法连接手柄，则需进行配对操作，配对时首先在关机状态下同时按下logo键和Y键，等待指示灯为冰蓝色快闪进入配对模式；然后按下无线接收器配对按键，开始配对；配对完成后手柄会短暂震动，手柄指示灯为冰蓝色常亮；
c. 如使用的是SRC880控制器：确认ARM-PATCH版本是否是0.6.0及以上版本。如不是则需升级驱动，请联系我司工程师，获取SRC-PATCH 0.6.0及以后版本升级包，并在Roboshop中一键升级。
### 3.4.6.XX 手柄遥控建图流程
启动建图后，手柄需抢控制权（激活手柄遥控）才可以遥控机器人，完成建图后必须先释放控制权（关闭手柄遥控），再进行地图保存工作。

插上手柄，摇动摇杆后出现“手柄摇杆回中之后，车体还在运动”的现象
出现该问题首先摇动摇杆，观察是否会出现在一个摇杆位置，车体可以停下，如果存在，则可以判断为是由于摇杆的“零位漂移”导致不能回中。可以通过调整参数“JaystickThreshold”的值（建议调大该值）来避免此情况。
## 虚拟di范围
## SRC 880：10-17
## SRC 2000：11-18
## SRC 3000：24-31
