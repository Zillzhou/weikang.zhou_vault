# 牧川 驱动器

## 牧川 驱动器

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 语雀迁移飞书

## 使用中

## 一、适用范围

本文档针对机器人改造过程进行规范，使公司产品符合行业标准，保证产品质量稳定，使技术人员在进行改造过程中有章可循。

机器人自动化改造涉及传感器众多，建议采用我司标准核心控制器线束 TE23、TE35，本文档以核心控制器标准线束为蓝本进行作业指导。
### 二、调试资源

## USB-485/232 转换器

1677573096889-8ac3ee87-bb2e-46e1-839f-4654eafbafe8.png

## 驱动器相关手册：

### CANopen协议及使用说明1.0.pdf

## JTSD6030M 说明.pdf

## 驱动器调试与参数说明-v1.1.pdf
## 驱动器配置软件：

## easyDRIVE V2.0.rar
## 打开上位机后需导入该文件后再连接

parameters_20230222 - JTMOTION.xml
### 三、改造和安装

### 3. 进行改造（底盘驱动器部分）

### 3.1.1 行走电机驱动器安装方式

## 1.驱动器需要与车体进行可靠固定，检查驱动器与对应电机的三相线（ 黄U 绿V 蓝W ）、编码器线路连接正确；
2.当机器人安装有多个驱动器(数量 ≥2)时，所有从站的 CAN_L,CAN_H 引脚直接相连即可，尽量采用串联方式接线，如图 3.1.1 所示；若驱动器仅提供一个通讯接口，无法完成驱动器的 can 线串联时，则将所有驱动器 can 线引出后把所有 can_H 压入同一德驰插筒连接器，将所有 can_L 压入同一德驰插筒连接器，接入德驰 DT06-2S 公头，最后与 TE28 中的 22、23 号线（SRC800V3 can2)相连,（ SRC800版本不同，can接口不同，需根据SRC800版本来进行接线 ）
由于部分驱动器没有提供级联接口，只能通过从总线上接引线的的方式来串联，这里引线的长度需小于 10CM.

注：在改造过程中若由于驱动器连接所需要的线束数量不足，无法实现在驱动器端进行快速串联，可采用图 3.1.2所示连接方式，但不推荐。

1677573114959-20e29b25-a207-423a-b90c-ef47270ba214.png

## 图 3.1.1  图3.1.2

为保证 can 通讯质量，需要在距离核心控制器最远的驱动器上或总线末端安装终端电阻（阻值一般是 120ohm).（注：客户可在购买驱动器时向驱动器厂商提出购买配套终端电阻）

### 3.CAN 终端电阻是否正确打开的检测方法：

关机断电，断开驱动器和控制器的 CAN 连接线（如图 4.4.1 中 Driver4 和控制器之间的位置），使用万用表电阻档测量驱动器侧的 CAN 总线上 CAN_L、CAN_H 之间电阻，电阻值为 120Ω 则正确，如图 4.4.3 所示。电阻值明显小于120Ω（如 60Ω),则说明至少有两个驱动器打开的终端电阻。

断开图 4.4.1 中 Driver1 和 Driver2 之间的连接线，使用万用表电阻档测量 Driver1 侧的 CAN 总线上 CAN_L、CAN_H 之间电阻，电阻值为 120Ω 则正确，如图 4.4.3 所示。如果电阻值明显大于 120Ω（如几 KΩ),则说明终端电阻打开的位置不在 CAN 总线末端，需要调整。

1677573159600-41da7e75-b4f8-4990-b64e-ee6985460453.png

## 图3.4.3
### 4.急停
将所有驱动器的 D1 接入驱动 24V ；将所有驱动器 DIRENT 并联后连 SRC2000急停输1+ （TE354 号线），将另一根 急停输出1- （TE355 号线）连接 0V
1680258863270-dd3572b4-516a-44b2-bbf7-09a359efdf26.png

### 四、驱动器参数配置
## 工具：
## USB-485/232 转换器
1677573192822-9dde1ab3-19f2-42b0-a594-e0cb65044405.png

## 1.使用 USB-485/232 转换器连接电脑和驱动器
1680256668355-0b1ce596-5858-48e5-b81f-998b8b0ec10e.png 

## 1.打开软件，导入参数文件
### 调试软件无需安装，找到软件可执行文件后双击“
1680257856589-eeb9be82-e391-4d84-9704-2d5030bdb40c.png 

” easyDrive.exe 图标，打开软件。
1680257842234-7ea3c0db-7a40-4369-be0d-6608ed20998f.png

在导入参数界面中，点击“导入”按钮，找到“easyDriveParamXXXX.xml”参数文件打开（注：这里需要导入该文件 ）。

parameters_20230222 - JTMOTION (1).xml
1680257880362-d8da9574-4704-4922-899c-c8d8764b8a1e.png

## 建立通信连接
在硬件通信上，驱动器和上位机之间通过 RS232/RS485 异步串行通信，走 MODBUS-RTU 协议。通信线采用 RS485 转 USB 线缆，将驱动器上 RS485 的线缆连接好，通信线另一端连接 到 PC 机的 USB 口上。
在“通信”页面中，点击“串口扫描”可以自动识别到通信线缆的 COM 口，然后点击“连 接”，可以连接到驱动器。驱动器连接上后可以看到驱动器的型号与软件版本，页面右下方可 以看到状态栏显示“ 
1680258003622-2b4005c2-ef0c-44d8-ac31-9af3410237de.png 

”状态。
1680258032573-6c42615e-d7a2-4fa3-92e9-91caa25a3f33.png

驱动器支持三种波特率 Baudrate ，分别是 9600 、 19200 和 38400 ，出厂默认是 9600bps 。

### 2.easyDRIVE 电机参数设置
## 第一步：设置电机参数
需要设置的主要有“电机类型”， “电机额定转速”， “电机额定电流”， “电机过载比率”“电机极对数（极数/2）”。根据电机手册，将这几个参数对应填入到如下红框中。填入每个参数都要按回车键。
编码器设置，以普通 2500 线增量编码器伺服电机为例，“编码器类型”选择“Inc+HALLRecoder”，“增量分辨率”填“2500”。其他参数可暂时不填，完成后点击“保存设置参数”。
1680258114991-ed7e578e-68e0-47bf-9b63-9bb64ea67c21.png

## 第二步：电机自学习
对于陌生的电机或者不知道电机参数时，并且电机动力线相序与霍尔信号未知时，可以使 用电机自学习功能来自动适配驱动与电机。
在开始电机参数自学习前，需要首先准确填写电机配置参数，并保存参数，驱动需要从新 上电，然后可以开始启动自学习功能。点击“启用自学习”按钮，自动进入自学习状态。

## 电机自学习步骤：
8) 电机需处于空载或轻载状态，负载过大会导致学习参数偏差，影响电机运行。
9) 电机编码器(含霍尔信号)与电机动力线正确接线完毕；
10)正确设置电机类型、电机额定电流、电机额定转速、编码器类型等参数并保存；
11)点击“启动自学习”，电机自动低速选择，自学习状态灯变绿；
12)等待自学习状态灯变红，自学习结束；
经过以上步骤电机参数自学习完毕，参数写入驱动后断电重启。
### 3.can通讯配置

### 根据实际配置canID与波特率，并打开can通讯
1680258344519-5bac6b20-1b20-436e-b7b5-87bba6d2e30c.png

### 3.保存电机参数并上电重启
1680258485203-d21d2919-17de-4b9c-a148-97cfe0a39481.png

### 五、机器人模型配置说明

注：这些参数需根据驱动器及选用电机及减速机的实际进行填写；

1677574035093-c727043b-3266-4241-b967-4f39db6f8919.png

注：减速比、编码器线数、电机最大转速、驱动器品牌需要根据选用的实际填写。
(适配800K测试电机：减速比15，编码器线数16384，电机最大转速3000，驱动器品牌选择Maxon-Canopen)

### 六、驱动器的功能检测

## 1.在整车组装完成未安装外壳前，请再检查一遍接线确保接线正确。

2.将车体加高，使轮子离地。开启机器人，使用网线连接机器人。使用 Roboshop 软件操作机器人让轮子转起来。 使用 CanScope 夹在 CAN 总线上检测 CAN 报文至少 1 小时，CAN 报文无错误。

### 3.让车体着地，使用 Roboshop 软件操作机器人做运动动作:向前，向后，向左，向右运动。

4.未拍急停按钮前，推动机器人，无法推动（电机使能），检查 Roboshop 中机器人状态处于“未急停”“驱动器未急停”，如图 6.1 所示；所示拍下急停按钮后，再次推动机器人，可以推动（电机使能释放），检查 Roboshop 中机器人状态处于“已急停”，“驱动器已急停”，如图 6.2 所示。

5.测试驱动器与控制器掉通讯，使用Roboshop软件操作机器人向前运动，在运动过程中拔掉驱动器与控制器连接的canH canL，此时机器人停下，机器人无法推动（电机使能）。

1677574072297-a4ea0b26-e3fd-4ab7-9784-a0e274cabe67.png

## 图 6.1

1677574248663-3c205779-deec-4a93-b8d8-b8025bbe603a.png

## 图 6.2

### 5.任务链运动老化测试 24H，查看 Robokit Log 无错误报警。

### 七、附录

### 7.1 USB CAN 卡使用方法

## 1.软件安装—安装软件 USB_CAN Tool（软件及使用手册请联系 CAN卡 厂商售后）.

2.硬件连接—准备 USB CAN 卡和连接线，将连接线 CAN_H 接到 SRC2000 外接线束 TE35 33 号线上，将连接线 CAN_L 接到 SRC2000 外接线束 TE35 32 号线上。如图 7.1.1 所示：

1677574270836-cbb75a18-c927-4edc-a794-9f2aadd8e7c4.png

## 图 7.1.1

3.打开 USB CAN tool ,选择【设备操作（O）】【启动设备（S）】,确认 CAN 参数，【波特率】为 250Kbps,选择【CAN通道号】为通道1,点击【确认】。如图 7.1.2 所示：

1677574286853-99a8221e-dca8-4191-aa75-ce3412f1762f.png

## 图 7.1.2

### 4.选择【显示（V）】，取消选择【合并相同 ID 数据(M)】，CAN 报文如图 7.1.3 所示。

1677574309180-92e8d023-530b-484d-97ff-f746884afbcc.png 

## 图 7.1.3

### 7.2 udpconsole 使用方法

udpConsole 是我司工程师用于调试 bug 开发的小工具，可以检查到固件上报的错误信息。

## 1.打开 udpconsole 工具前需用网线确保电脑与机器人的物理连接。

### 2.打开 udpconsole 进行驱动器功能测试，时刻检查 udpconsole 显示内容。

### 驱动器通讯过程中出现错误帧如图 7.2.1 所示：

1677574327745-d46c43d9-9820-4321-a779-0e4adbfe42c9.png

## 图 7.2.1

### 八、驱动器常见错误码

报警时可通过驱动器的指示灯来观察，驱动器面板上指示灯为驱动器的故障代码显示。伺
服驱动器在出现故障报警时会自动地停止马达的运转，并切断马达的使能信号。用户应该尽快
查明故障原因并排除故障。
1680258725307-f05b6187-463b-49c3-b182-9c6a08dc024a.png

1680258743324-2382b00f-9c96-4f8a-94f3-7d971075cc83.png
