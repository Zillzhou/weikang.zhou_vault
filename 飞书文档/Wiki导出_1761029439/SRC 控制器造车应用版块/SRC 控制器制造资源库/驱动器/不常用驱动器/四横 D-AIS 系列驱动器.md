# 四横 D-AIS 系列驱动器

## 四横 D-AIS 系列驱动器

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.10.29

## 初版

## 使用中

## 同步块
## @骆洲宇
## 说明

本文档针对机器人自动化改造过程进行规范，使公司产品符合行业标准，保证产品质量稳定，使技术人员在进行改造过程中有章可循。

机器人自动化改造涉及传感器众多，建议采用我司标准核心控制器线束 TE23，TE35，本文档以核心控制器标准线束为蓝本进行作业指导。

注：本文档只适用于改造参考，不可作为技术协议及其他承担责任的内容

## 一、适用范围
本技术规范适用于公司使用四横 D-AIS 系列驱动器（CANopen 通讯）进行自动化改造的研发、生产、调试的技术人员。
### 二、调试资源
在使用驱动器前请仔细阅读驱动器的使用手册，尤其是各种接插件定义，使用注意事项等。
## 驱动器手册：

## 四横报警与参数手册.pdf

## 四横端口定义.pdf
## 调试软件：

AIMtor动态调试软件V20240511国际标准版.zip
以上文件有可能因为四横驱动器的更新而变化，如有这种情况，请直接访问四横官网主页。
## 四横官网链接： 四横官网
### 三、电气接线
### 驱动器的接线方法请参考 控制器和驱动器接线方法
这里以 MCAC620-2X-YC-RC 为例展示一下四横驱动器的各种接口的布局和定义，其他型号请查看对应的驱动器手册。
### 3.1 四横驱动器命名规则及外观图
## image.png

### 图 3.1.1 型号对应电压范围/额定电压
## image.png

## 图 3.1.2

## 注 :
## 驱动器的供电电源为 24～60VDC
电缆长度尽可能短，控制 CN3 电缆不超过 3 米，反馈信号 CN4 电缆长度不超过 10 米。差分信号一定要使用双绞线，且有屏蔽层。
伺服驱动器输入电源属于二次侧供电，驱动器内部并未使用变压器等电源隔离。为了防止伺服驱动器产生交叉触电事故，请在输入电源上使用保险丝产品。
在使用电池/超级电容等供电产品，如需在驱动器供电电源上外加缓冲电阻，缓冲电阻阻值应不大于 5R，缓冲上升时间不大于 1S

### 3.2 四横驱动器各端子功能
## image.png

## image.png

## image.png

## 图 3.2.1
### 3.3 I/O 接口原理
## image.png

### 3.4 急停接线方法（不再需要）

### 新的固件已修改为协议使能，不再需要急停接线
### 四、驱动器参数配置
### 4.1 上位机连接与配置

### 需自备 RJ45 转 485 端子、USB 转 485 卡
## 连接驱动器
## 下载并安装四横调试软件：
驱动器的配置需要使用对应的调试软件，请按 调试资源 提供的链接下载安装。
使用“RJ45 转 485 转换头”＋“USB 转 485 转换器”连接驱动器与电脑
## image.png

## 图 4.1.2
给驱动器上电，打开上位机软件，进入通讯设置窗口，点击扫描串口，选择新增的串口，点击“通讯连接”。（波特率默认 57600）
## image.png

## 图 4.1.2
### 上方状态栏出现“通讯在线中”标示，则表明已经连接
img_v3_02hh_ddf3a295-2893-4331-8a0c-971c448cb7dg.jpg

## 配置 CanID 与波特率
在“通讯设置参数”列表中修改 H0C_00 与 H0C_08。
## image.png

## 图 4.2.1
## 配置控制模式
进入输入输出下参数页面，选择控制模式为 8。
该参数会在断电后失效，为了保证一直有效，需要点击“下载勾选项”，再点击“永久保存参数”，以防万一再次点击“下载勾选项”
img_v3_02hh_0717afc1-e84d-4167-a7e3-b97ef59f259g.jpg

## 图 4.3.1
## 配置急停信号

### 新的固件已修改为协议使能，不再需要 IO 急停信号
### 配置编码器一圈脉冲数（一定要做！否则速度执行不对！！！)
### 在位置控制参数中，将 H05_09 修改为 10000
## image.png

## 下载参数至驱动器
### 除了控制模式外，其他参数只要点击“下载勾选项”即可
## image.png

img_v3_02hh_5f339e6a-33d8-463c-bba0-8db9324d93eg.jpg

### 4.2 四横驱动器常见问题及解决方案
### 企业微信截图_17287196959437.png

如果报 410 错误，请检查母线触点接触是否正常。如检查没问题后还是报错，请直接联系四横厂家。
## 驱动器常见错误码
## image.png

## image.png

### 五、机器人模型配置说明

### 根据电机及减速实际情况配置行走电机参数：

## Key

## Description

## Value

## Unit

## x

## 驱动器安装的 X 坐标

## 根据实际安装位置填写

## m

## y

## 驱动器安装的 Y 坐标

## 根据实际安装位置填写

## m

## yaw

## 驱动器安装的朝向

## 根据实际安装位置填写

## 度

## canID

## 驱动器的的 CANID

## 根据驱动器上位机配置决定

## maxRPM

## 驱动器最大转速

## 根据电机参数填写

## RPM

## encoderLine

## 编码器线数

## 根据电机编码器参数填写（见下文）

## canPort

## 驱动器使用的端口

## 根据实际接线填写

## brand

## 驱动器品牌

## SiHeng-Canopen

## wheelRadius

## 轮半径

## 根据实际情况填写

## m

## reductionRatio

## 减速比

## 根据减速机构参数填写

## inverse

## 反向

## 一般左电机转向为反向，右侧为正向

注：这些参数需根据驱动器及选用电机及减速机的实际进行填写；
## image.png

## 图 5.1.1
模型文件 Encoderline＝电机轴转一圈变化的编码器数据÷4。由于先前已将修改一圈脉冲数为 10000，故除以 4 后便是 2500。

### 六、驱动器功能检测
### 6.1 驱动器桌面测试
收到驱动器并对其进行配置完成后，需要先使用 CAN 卡连接驱动器并发送报文对速度模式进行测试，CAN 卡使用方法见附录。
首先对 ID：0000 发 0100 //切换预操作状态到操作状态
帧 ID=06+站号（一般站号配置为 01，故填写 0601）
## 数据区：
### 2B 40 60 00 00 00 00 00//初始化

2F 60 60 00 03 00 00 00 //速度模式
### 23 FF 60 00 A0 00 00 00 //设置速度
### 23 83 60 00 A0 03 00 00 //设置加速度
### 23 84 60 00 A0 03 00 00 //设置减速度

### 2B 40 60 00 06 00 00 00 //准备
### 2B 40 60 00 07 00 00 00 //等使能
### 2B 40 60 00 0F 00 00 00 //使能

### 23 FF 60 00 0A 00 00 00 //设置速度（小速度无法运行）

### 2B 40 60 00 0F 00 00 00 //运行

### 2B 40 60 00 06 00 00 00 //去使能

### 2B 40 60 00 80 00 00 00 //清错
### 4B 3F 60 00 00 00 00 00 //查报错

### 40 41 60 00 00 00 00 00//状态
### 40 78 60 00 00 00 00 00//电流
### 40 64 60 00 00 00 00 00//位置

### 23 16 10 01 58 02 7F 00 //设置心跳
## 77F 发 00 //心跳
### 6.2 驱动器上机测试
在整车组装完成未安装外壳前，请再检查一遍接线确保接线正确；
将车体加高，使轮子离地。开启机器人，使用网线连接机器人。使用 Roboshop 软件操作机器人让轮子转起来。 使用 CanScope 夹在 CAN 总线上检测 CAN 报文至少 1 小时，CAN 报文无错误；
让车体着地，使用 Roboshop 软件操作机器人做运动动作：向前，向后，向左，向右运动；
未拍急停按钮前，推动机器人，无法推动（电机使能），检查 Roboshop 中机器人状态处于“未急停”“驱动器未急停”，如图 6.1 左侧图所示；所示拍下急停按钮后，再次机器人，可以推动（电机去使能），检查 Roboshop 中机器人状态处于“已急停”，“驱动器已急停”。如图 6.1 右侧图所示；
1677663188481-0a751fbe-e933-459f-baf7-bff708003d7e.png 

## 图 6.1

### 七、附录

### 7.1 USB CAN 卡使用方法
## 1.安装软件 USB_CAN Tool（软件及使用手册请联系 CAN 卡厂商售后）。

### USB_CAN+TOOLSetup(V9.12).exe
2.硬件连接—准备 USB CAN 卡和连接线，将连接线 CAN_H 接到 SRC2000 外接线束 TE35 33 号线上，将连接线 CAN_L 接到 SRC2000 外接线束 TE35 32 号线上。如图 7.2.1 所示：
## image.png

## 图 7.2.1
3.打开 USB CAN tool ，设备型号默认选择 USB-CAN 1.0，点击【设备操作（O）】-【启动设备（S）】，确认 CAN 参数，【波特率】为 250Kbps（4.1.2 中配多少就填多少），选择【CAN 通道号】为通道 1，点击【确认】。如图 7.2.2 所示：
## image.png

## 图 7.2.2
### 4.选择【显示（V）】，取消选择【合并相同 ID 数据（M）】，CAN 报文如图 7.2.3 所示。
## image.png

## 图 7.2.3
