# Oriental驱动器（BLV-R，性能不够，禁用）

### Oriental驱动器（BLV-R，性能不够，禁用）

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 语雀迁移飞书

## 使用中

## 一、适用范围

本技术规范适用于公司使用同毅驱动器进行自动化改造的研发、生产、调试的技术人员。

### 二、调试资源
## 驱动器上位机调试软件

## setup.zip
## 驱动器使用手册

### BLV系列+R型+设置连接篇说明书HP-5144.pdf
## 驱动器通讯协议

## HP-5143-2E.pdf
## 驱动器上位机调试软件
### 三、改造流程
### 3.1 进行改造（底盘驱动器部分）
参考机械设计图、电气图，驱动器需要与车体进行可靠固定，检查驱动器与对应电机的三相线、编码器线路连接正确； 
1696732918513-239ce282-6b3c-46dc-b316-f8ec4ebbd742.png

## 图3-1 驱动器端子示意图
当机器人安装有多个驱动器(数量 ≥2)时，所有从站的 CAN_L , CAN_H 引脚直接相连即可，采用串联方式接线；将 Driver4 最终引出的 CAN_H 压入一个德驰插筒连接器，同理将 CAN_L 压入一个德驰插筒连接器，接入德驰 DT06-4S 公头。最后与 T35 中的 32 , 33 号线（can1）相连；
## 注意：各型号驱动器引脚定义详见附录
1677207078449-a19151b5-65cb-49c9-a09a-f402ed5f5e67.png

## 图3-2 驱动器串联方法
为保证 CAN总线 通讯质量，需要将距离核心控制器最远的驱动器上的 外置一个120Ω 终端电阻 ，如上图3-2
1696732941517-c99c57c6-718f-4f8f-a33d-7ec0a56a25f4.png

## 图3-3
## 终端电阻是否正确打开的检测方法：
关机断电，断开驱动器和控制器的 CAN 连接线（如图 3-2中 Driver4 和控制器之间的位置），使用万用表电阻档测量驱动器侧的 CAN 总线上 CAN_L,CAN_H 之间电阻，电阻值为 120Ω 则正确，如图3-4 所示。电阻值明显小于 120Ω （如 60Ω），则说明至少有两个驱动器打开的终端电阻。
断开图 3-2 中 Driver1 和 Driver2 之间的连接线，使用万用表电阻档测量 Driver1 侧的 CAN 总线上 CAN_L , CAN_H 之间电阻，电阻值为 120Ω 则正确，如图3-4所示。如果电阻值明显大于 120Ω （如几 KΩ)，则说明终端电阻打开的位置不在 CAN 总线末端，需要调整。
1677208854779-f9b14863-c85e-4bd1-ae7f-d45ea357fa6e.png 

## 图 3-4
公司适配的国产驱动器采用控制电机是否使能的方式来实现急停与否的功能。电机是否使能可以通过控制驱动器上相应 IO 口电平高低的方式来实现；Oriental也可以通过给驱动器断电的方式实现急停。
如图 3-5 所示，将所有驱动器的CN4 IN-COM 并联后接入 DCDC 24V+ 输出；将所有驱动器 IN0 并联后连接 SRC2000 急停输出 1+ （TE354 号线），将另一根急停输出 1- （TE355 号线）连接 DCDC  24V- 输出。
1696733691394-e3d0265b-f30c-43dc-bc25-18a9d57f6661.png

### 7.该驱动器需要连接通讯电源线后才能正常工作，CN4 NET-VIN连接 24V+, CN4 NET-GND连接24V-。
### 四、驱动器配置
### 4.1 通信连接
## 线序说明
### 上位机配置通讯使用 Micro USB插口
1696987255590-986a741d-7464-4e1f-831f-c06766c33f3b.png

## 打开上位机软件
1696992322209-2499fef1-f3eb-4d27-acba-08a053064864.png

## 连接驱动器
1696990834194-6241fc39-82b2-4d90-a561-7351204d1f76.png

## 1.选择对应串口
### 2.读取驱动器当前配置
### 4.2 修改通用参数
### 4.2.1 修改canopen参数
1696989163471-50e70a81-f54d-4d1b-b2bb-c21158b4aa9a.png

选择（P3）Communication setting(Modbus/CANopen)界面
选择Canopen参数配置，配置为3，CANopen(CAN)模式
修改节点id为特定值（模型文件中配置需要对应，所有驱动器都不能一样）
## 修改波特率为 250kps
## 点击保存驱动参数

### 4.3 修改行走电机参数（行走驱动器参考该部分）
### 4.3.1 修改通讯参数
1696991765573-046acc0d-3113-4abc-b18a-f6d3a3768309.png

### 进入电机(p5)CANopen objects界面
## 关闭同步报文
## 修改心跳包为300ms
## 保存
### 4.3.2 修改使能模式
1696992084761-0c9f74e3-05d6-4a40-8305-ed8cfa3c97fc.png

进入（P8）Direct-IN function(DIN)界面
## 点击DIN0,修改触发信号为S-ON
## 保存
### 五、机器人模型文件配置说明
### 5.1 行走电机

## Key

## Description

## Value

## Unit

## x

## 驱动器安装的X坐标

## 根据实际安装位置填写

## m

## y

## 驱动器安装的Y坐标

## 根据实际安装位置填写

## m

## yaw

## 驱动器安装的朝向

## 根据实际安装位置填写

## 度

## canID

## 驱动器的的CANID

## 根据驱动器上位机配置决定

## maxRPM

## 驱动器最大转速

## 3000

## RPM

## inverse

## 逻辑反向

## encoderLine

## 编码器线数

## 9000

## canPort

## 驱动器使用的端口

## 根据实际情况填写

## uplimitDI

## 上限位DI

## -1

## downLimitDI

## 下限位DI

## -1

## ZeroDI

## 零位DI

## -1

## func

## 功能

## walk

## wheelRadius

## 轮半径，结合驱动器厂家给的机械图纸参数

### 0.08

## m

## reductionRatio

## 减速比

## minimumSpeed

## 最小执行速度

## m/s

## brand

## 驱动器品牌

### Oriental-BLV-CanOpen

### 六、驱动器功能检测方法
在整车组装完成未安装外壳前，请再检查一遍接线确保接线正确；
将车体加高，使轮子离地。开启机器人，使用网线连接机器人。使用 Roboshop 软件操作机器人让轮子转起来。 使用 CanScope 夹在 CAN 总线上检测 CAN 报文至少 1 小时，CAN 报文无错误；
让车体着地，使用 Roboshop 软件操作机器人做运动动作:向前，向后，向左，向右运动，左侧移，右侧移；
未拍急停按钮前，推动机器人，无法推动（电机使能），检查 Roboshop 中机器人状态处于“未急停”“驱动器未急停”，如图 6-1 左侧图所示；所示拍下急停按钮后，再次机器人，可以推动（电机去使能），检查 Roboshop 中机器人状态处于“已急停”，“驱动器已急停”。如图 6-1 右侧图所示；
1677209452661-dbc1d8c4-5645-4e32-b207-23f521b2f17a.png

任务链运动老化测试 24H，查看 Robokit Log 无错误报警。

### 七、常见问题
### 7.1 常见报错码
## 如下为常见报错的解决方法：
1696988601718-3ace9add-8da3-4eeb-b01e-a2dcf8ab05cb.png

1696988639384-cc9283e8-705f-4722-8d0f-74782cdbfa00.png

1696988704571-78d19471-1881-4a4d-80fe-ddaf39104a7c.png

1696988754621-894584c2-e483-432b-8db7-c8d39fb8934e.png

1696988805007-734b853a-ca7a-432b-9b9f-0f1acc274b62.png

1696988829771-7239d065-9d01-41af-bdeb-30303c6de7f6.png

## 举例：
0x800 转换成 2 进制  100000000000 ，错误标志 u1SystemErrorBits（11）位是 1，就是电机位置超差/速度超差
0x80 转换成 2 进制 10000000，错误标志 u1SystemErrorBits（7）位是 1，就是电机过载报警
0x2000 转换成 2 进制 10000000000000，u1SystemErrorBits（13）为 1，功率模块过流

### 7.2 已知问题
## 1.
