# 杰美康 MCAC620-2X-YC-RC 系列驱动器

### 杰美康 MCAC620-2X-YC-RC 系列驱动器

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.9.11

## 初版

## 使用中

## V1.5

### 2024.9.23

修改部分步骤描述；增加“固件更新”的高亮显示；根据厂商要求在驱动器名称中加入“YC”字样。

## 使用中

## V2.0

### 2024.10.29

## 增加量纲修改

## 使用中

## 说明

本文档针对机器人自动化改造过程进行规范，使公司产品符合行业标准，保证产品质量稳定，使技术人员在进行改造过程中有章可循。

机器人自动化改造涉及传感器众多，建议采用我司标准核心控制器线束 TE23，TE35，本文档以核心控制器标准线束为蓝本进行作业指导。

注：本文档只适用于改造参考，不可作为技术协议及其他承担责任的内容

## 一、适用范围
本技术规范适用于公司使用杰美康 MCAC620-2X-YC-RC 系列驱动器（CANopen 通讯）进行自动化改造的研发、生产、调试的技术人员。
### 二、调试资源
## 注 :

### 杰美康驱动器一定一定要更新仙工专用固件！！！！！！！
在使用驱动器前请仔细阅读驱动器的使用手册，尤其是各种接插件定义，使用注意事项等。
## 驱动器手册：

### MCAC620-2X-RC系列使用手册V1.0.pdf
## 调试软件：

JmcServoStepperPcControl(2.4.9).zip
固件：（该固件为2024.9.3最新固件，更新后会改变报文控制流程，仅可用于仙工控制器与驱动器的通讯）

AT32_MCAC_620_App_V10_2022_9_03.hex
以上文件有可能因为杰美康驱动器的更新而变化，如有这种情况，请直接访问杰美康官网主页。
## 杰美康官网链接： 杰美康官网
### 三、电气接线
### 驱动器的接线方法请参考 控制器和驱动器接线方法
这里以 MCAC620-2X-YC-RC 为例展示一下杰美康驱动器的各种接口的布局和定义，其他型号请查看对应的驱动器手册。
### 3.1 杰美康驱动器命名规则及外观图
## image.png

## 图 3.1.1

## 接口.PNG

## 图 3.1.2

## 注 :
## 驱动器的供电电源为 24～60VDC
电缆长度尽可能短，控制 CN3 电缆不超过 3 米，反馈信号 CN4 电缆长度不超过 10 米。差分信号一定要使用双绞线，且有屏蔽层。
伺服驱动器输入电源属于二次侧供电，驱动器内部并未使用变压器等电源隔离。为了防止伺服驱动器产生交叉触电事故，请在输入电源上使用保险丝产品。
在使用电池/超级电容等供电产品，如需在驱动器供电电源上外加缓冲电阻，缓冲电阻阻值应不大于 5R，缓冲上升时间不大于 1S

### 3.2 杰美康驱动器各端子功能

## 1.控制信号端口-CN1 端子
## 接口2.PNG

## 图 3.2.1
## image.png

### 图 3.2.2 CN1-6PIN 端子定义
## image.png

### 图 3.2.3 CN1-26PIN 端子定义
### 2.编码器通讯端口-CN2 端子
## image.png

## 图 3.2.4

### 3.驱动器电源、电机线端口
## image.png

## 图 3.2.5

### 4.CAN 通讯 CN3/4 端子
## image.png

## 图 3.2.6
### 5.驱动器 CN5 端子（用于上位机连接）

## image.png

## 图 3.2.7
### 3.3 I/O 接口原理

公共端 COM 口输入电源正，DI 口接地，当高电平输入时 DI 触发

### 3.4 急停接线方法

急停接线前需保证 CN1 端子中的 DI（一般选择 DI1）已正确配置急停功能，配置方法见 急停信号配置
假设已配置 DI1 功能为急停，且高电平有效，则将 18 号 COM 口接入电源正，16 号 DI1 接入地。当电源输入后即可触发急停。
img_v3_02e8_30d30c66-bee5-4547-a251-ad25244dda0g.jpg

### 四、驱动器参数配置
### 4.1 上位机连接与配置

如有多轴（一拖二），需将不同轴配置不同CanID。
配置前请先将驱动器恢复出厂设置。
## 连接驱动器
## 1.下载并安装杰美康调试软件：
驱动器的配置需要使用对应的调试软件，请按 调试资源 提供的链接下载安装。
### 2.使用 Type-C USB 线连接驱动器与上位机
## image.png

## 图 4.1.1
给驱动器上电，打开上位机软件连接杰美康驱动器，点击“通讯设置”
## image.png

## 图 4.1.2
### 4.选择图中三款任意一款即可（v2.8.9 版本调试软件需以此来使用软件的“试运行”功能），选择串口号并连接。
如果显示“警告”连接失败，请更改串口号或更换 type-C 线。
78008218-c1dd-432c-8e43-06a1d562915b.png

## 图 4.1.3
img_v3_02e8_9468ba2d-46e2-43e7-9bed-39d71b5bd57g.jpg

## 图 4.1.4
### 5.下方状态栏出现“在线”标示，则表明已经连接
img_v3_02e8_56a3cc36-3514-4242-8846-875b6653802g.jpg

## 配置 CanID 与波特率
在“电机及驱动器参数”列表中修改 P00-23 与 P00-24。
P00-23 既可以作为 Modbus 从站 ID 又可以作为 CanID。
当前版本的驱动器固件中 CAN 通讯波特率需通过修改 Modbus 通讯波特率实现，对照表如图 4.2.2 所示。
该方式很可能会在后续版本中优化，请以新版本手册为准。
## image.png

## 图 4.2.1
## image.png

## 图 4.2.2
## 配置控制模式
当前固件版本配置控制模式为速度模式时会产生 bug，故将控制模式选为 4-位置、速度控制模式。
img_v3_02e8_ea40f7cf-ceae-4440-acf0-50f714fb327g.jpg

## 图 4.3.1
## 配置急停信号
在 IO 参数处分别对 DI 端子设置-功能选择/逻辑选择进行配置，分别配置急停功能与高电平有效。
## image.png

## 配置速度量纲
P04-00是速度下的量纲，选2为1rps，选5为1rpm。此处选2。
## image.png

## 下载参数至驱动器
## image.png

### 4.2 通过按键设置驱动器的参数
参照文档《MCAC620-2X-RC 系列使用手册》按键步骤：
## image.png

（1）按两次 M 键后点击 ENT 进入参数列表，此时短按 ENT 可以将光标移位。
（2）按住上键，直至数字变成 23，长按 ENT 进入从站 ID 设置。（旧版本固件 modbusID 和 canID 通用） 
（3）按一下 M 键返回参数列表，选择 P0024 并进入。默认值为 36。
img_v3_02e9_62a3dda6-146e-4eae-a777-df7c5a19658g.jpg

 设置波特率，对应表格如下；位号标识 0、1、2、3 代表当前参数代码值的位号，位号排序为 3210；将 P00-24.0 设置成 5（250K），即将默认值改为 35。
## image.png

（4）按一下 M 键返回参数列表，选择 P01-01 并进入控制模式设置，如不为 4 则修改为 4（位置、速度模式）
（5）长按 ENT ，显示 FINISH，退出参数列表后显示 A-941，此时给驱动器重新上电即可让参数生效。

### 4.3 杰美康驱动器常见问题及解决方案

如显示屏上显示“88888”，则表明控制器内部错误且无法初始化，需联系杰美康
## 杰美康驱动器固件升级方法
原版的固件无法在解除急停后将速度模式控制字 6040 清空（速度模式运行指令是控制字 6040 为 0x0F，而取消急停后电机使能控制字就为 0x0F），且每次上电需发送 01 00 报文切换预操作状态，所以需要升级固件版本（为了和其他驱动器的报文统一）。
固件文件请从调试资源中下载。
注意：本固件只适用于 boot 版本 v10-2021 及以上的杰美康驱动器。boot 版本如下图所示：
c9a4b383-e388-4be1-b903-61d79f2e5e7d.jpg

## 1.进入 JMC 伺服调试上位机软件，在工具栏选择打开在线程序更新软件
## image.png

### 2.打开软件后选择端口号，添加升级固件，其余参数选择默认即可
## image.png

### 3.打开串口，第一次点击程序下载按钮，出现如下图所示即可
## image.png

### 4.再次点击打开端口按钮（点击“关闭”按钮），显示如下图所示
## image.png

### 5.再次点击“程序下载”进行电机程序写入，执行升级过程如下图所示
## image.png

### 6.程序升级完成，如下图所示
## image.png

## 驱动器常见错误码
## image.png

### 上图仅为参考，实际报警码数据位超过 7 位，以下表为准：

### 杰美康MCAC620报警码对照表.pdf
## 举例 1:
Roboshop 读到 0x274:对应驱动器报错码为 628，查表得通讯线故障。检测 Can 线是否连接正常。
Roboshop 读到 0x26c:对应驱动器报警码为 620，查表得编码器线故障。检查编码器线后将驱动器重新上电。
### 五、机器人模型配置说明

### 根据电机及减速实际情况配置行走电机参数：

## Key

## Description

## Value

## Unit

## x

## 驱动器安装的 X 坐标

## 根据实际安装位置填写

## m

## y

## 驱动器安装的 Y 坐标

## 根据实际安装位置填写

## m

## yaw

## 驱动器安装的朝向

## 根据实际安装位置填写

## 度

## canID

## 驱动器的的 CANID

## 根据驱动器上位机配置决定

## maxRPM

## 驱动器最大转速

## 根据电机参数填写

## RPM

## encoderLine

## 编码器线数

## 根据电机编码器参数填写（见下文）

## canPort

## 驱动器使用的端口

## 根据实际接线填写

## brand

## 驱动器品牌

## JMC-MCAC-Canopen

## wheelRadius

## 轮半径

## 根据实际情况填写

## m

## reductionRatio

## 减速比

## 根据减速机构参数填写

## inverse

## 反向

## 一般左电机转向为反向，右侧为正向

注：这些参数需根据驱动器及选用电机及减速机的实际进行填写；
## image.png

## 图 5.1.1
模型文件 Encoderline＝电机轴转一圈变化的编码器数据÷4。由下图可知，编码器分辨率为 17bit，即一圈 360°被分成 2 的 17 次方，故 Encoderline＝131072÷4=32768。实测一圈为 10000 脉冲数，故此处填写 2500。
## image.png

## 图 5.1.1
### 六、驱动器功能检测
### 6.1 驱动器桌面测试
收到驱动器并对其进行配置完成后，需要先使用 CAN 卡连接驱动器并发送报文对速度模式进行测试，CAN 卡使用方法见附录。
首先对 ID：0000 发 0100 //切换预操作状态到操作状态，旧版固件需发送该报文。
### 帧 ID=06+站号（一般站号配置为01，故填写0601）
## 数据区：
### 2B 40 60 00 01 00 00 00 //初始化
2B 40 60 00 03 00 00 00 //刹车（不需要）
### 2B 40 60 00 0F 00 00 00 //使能

2F 60 60 00 03 00 00 00 //速度模式

### 23 81 60 00 0A 00 00 00 //设置速度

2B 83 60 00 E8 03 00 00 //设置加速度（可省略）
2B 84 60 00 E8 03 00 00 //设置减速度（可省略）
### 2B 40 60 00 0F 00 00 00 //运行

### 2B 40 60 00 06 00 00 00 //去使能
2B 40 60 00 0F 01 00 00 //暂停运行

4B 01 10 00 00 00 00 00  //读报警，此时可人为拔掉 can 线，查看是否读到 0x274
### 2B 40 60 00 8F 00 00 00 //清错

### 6.2 驱动器上机测试
在整车组装完成未安装外壳前，请再检查一遍接线确保接线正确；
将车体加高，使轮子离地。开启机器人，使用网线连接机器人。使用 Roboshop 软件操作机器人让轮子转起来。 使用 CanScope 夹在 CAN 总线上检测 CAN 报文至少 1 小时，CAN 报文无错误；
让车体着地，使用 Roboshop 软件操作机器人做运动动作：向前，向后，向左，向右运动；
未拍急停按钮前，推动机器人，无法推动（电机使能），检查 Roboshop 中机器人状态处于“未急停”“驱动器未急停”，如图 6.1 左侧图所示；所示拍下急停按钮后，再次机器人，可以推动（电机去使能），检查 Roboshop 中机器人状态处于“已急停”，“驱动器已急停”。如图 6.1 右侧图所示；
1677663188481-0a751fbe-e933-459f-baf7-bff708003d7e.png 

## 图 6.1

### 七、附录

### 7.1 USB CAN 卡使用方法
## 1.安装软件 USB_CAN Tool（软件及使用手册请联系 CAN 卡厂商售后）。

### USB_CAN+TOOLSetup(V9.12).exe
2.硬件连接—准备 USB CAN 卡和连接线，将连接线 CAN_H 接到 SRC2000 外接线束 TE35 33 号线上，将连接线 CAN_L 接到 SRC2000 外接线束 TE35 32 号线上。如图 7.2.1 所示：
## image.png

## 图 7.2.1
3.打开 USB CAN tool ，设备型号默认选择 USB-CAN 1.0，点击【设备操作(O)】-【启动设备(S)】，确认 CAN 参数，【波特率】为 250Kbps（4.1.2中配多少就填多少），选择【CAN 通道号】为通道 1，点击【确认】。如图 7.2.2 所示：
## image.png

## 图 7.2.2
### 4.选择【显示(V)】，取消选择【合并相同 ID 数据(M)】，CAN 报文如图 7.2.3 所示。
## image.png

## 图 7.2.3
