# Nanotec N5驱动器

## Nanotec N5驱动器

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 语雀迁移飞书

## 使用中

## 说明

本文档针对机器人改造过程进行规范，使公司产品符合行业标准，保证产品质量稳定，使技术人员在进行改造过程中有章可循。

机器人自动化改造涉及传感器众多，建议采用我司核心控制器标准线束 TE23、TE35，本文档以核心控制器标准线束为蓝本进行作业指导。

Nonatec 伺服驱动器选型建议参考公司的选型指导手册。

本文档只适用于改造参考，不可作为技术协议及其他承担责任的内容。

## 一、适用范围
本技术规范适用于公司使用 Nonatec 驱动器进行自动化改造的研发、生产、调试的技术人员。
### 二、调试资源
驱动器配置的上位机软件以及驱动器与PC通信的ixxat的can卡的驱动需从官网下载：
### 三、改造和安装
## 进行改造（底盘驱动器部分）

1.驱动器需要与车体进行可靠固定，确认驱动器的电源（正负极）连接正确，确认驱动器与对应电机的动力线、编码器线连接正确。Nanotec驱动器购买时厂商配置自带线，安装时请使用Nanotec自带线。

驱动器电源，动力线，抱闸线，编码器线，CAN 上位机通讯连接总线，如图 4.3.1 所示。

**注：驱动器与对应电机之间动力线和编码器线必须一一对应对接，绝对不可交叉对应使用。* 
1677204184619-c873594a-cd80-464a-ad61-ecc7e07b2e5c.png 

## 图 4.3.1

2.当机器人安装有多个驱动器(数量 ≥2)时，所有从站的 CAN_L、CAN_H 引脚直接相连即可，尽量采用串联方式接线，如图 4.3.3 左图所示；将 can_H 压入一个德驰插筒连接器，将 can_L 压入一个德驰插筒连接器，接入德驰 DT06-2S 公头。最后与 TE35 中的 32、33 号线（can1）相连；

注：在改造过程中若由于驱动器连接所需要的线束数量不足，无法实现在驱动器端进行快速串联，可采用 4.3.3 右图所示连接方式，但不推荐。

1677204269265-110d2bf2-1e67-4eb2-8c2b-d56a17a95df9.png

## 图 4.3.2

3.为保证 can 通讯质量，需要在距离核心控制器最远的驱动器上安装 120Ω 终端电阻，如在图 4.3.3 中将 Driver1 驱动器上终端电阻通过拨盘打开；

注：客户可在购买驱动器时向驱动器厂商提出购买配套终端电阻。

### 4.终端电阻是否正确打开的检测方法：

关机断电,断开驱动器和控制器的 CAN 连接线（如图 4.3.3 中 Driver4 和控制器之间的位置），使用万用表电阻档测量驱动器侧的 CAN 总线上 CAN_L,CAN_H 之间电阻，电阻值为 120Ω 则正确，如图  4.3.5 所示。电阻值明显小于 120Ω（如 60Ω)，则说明至少有两个驱动器打开的终端电阻。

断开图 4.3.3 中 Driver1 和 Driver2 之间的连接线，使用万用表电阻档测量 Driver1 侧的 CAN 总线上 CAN_L,CAN_H 之间电阻，电阻值为 120Ω 则正确，如图 4.3.3 所示。如果电阻值明显大于 120Ω（如几 KΩ)，则说明终端电阻打开的位置不在 CAN 总线末端，需要调整。

1677204296558-5bd4aed3-bd12-4c35-82c1-bdfefc988702.png

## 图 4.3.3

### 5.驱动器急停实现

### 方式1：采取驱动器断电的方式实现整车急停——不推荐

本次采用的 Nonatec 驱动器需采取拍下急停开关对驱动器断电的方式来实现整机急停功能；基于以上思路需要利用急停开关的另一路常闭触点控制为驱动器供电的继电器通断电的方式来实现；

1677204321390-f45c9277-f115-4106-a7c7-6b9d8eab9e09.png

 图 4.3.4 （注：此图驱动器 CAN  线未采用推荐接法）

Nonatec 驱动器如图 4.3.4 所示，将继电器控制线圈电路、急停开关的其中一路常闭触点串接入核心控制器 T23 的 20 号线与 9 号线，形成完整回路；将继电器的控制电路串接入电池为驱动器供电的线路中，如上图红框圈选的区域；

方式 2：采取协议急停：我们在Nonatec的驱动中实现了协议急停，对于Nonatec驱动器我们推荐使用协议急停（急停选择方式见第五章模型文件的配置）。

### 四、驱动器配置
注：本教程是按照1.1.0版本进行配置如果需要参考本教程，请尽量采用1.1.0版本的软件。
硬件连接——电脑与驱动器建立通讯链接 。
安装上述can盒的驱动以及安装配置软件 Plug & Drive Studio 1.1.0，双击 Plug & Drive Studio 1.1.0 快捷方式打开 Plug & Drive Studio 1.1.0，点击home主页，点击Connect Controller，打开通信连接配置页面，选择CANopen，然后点击Next 如图 4.4.1 所示：
1677204504842-e132b5a9-d0a8-48e0-b45f-1f0d30ad43a5.png

## 图4.4.1

CANopen的波特率以及ID配置如下，确认选择IXXAT 的can适配器，Baud rate设置为1MBd（Nonatec 的驱动器初始化的波特率为1MBd），Node ID选1（Nonatec 的驱动器Node ID 默认为1或127，在波特率为1Mbd的情况下，可以用过Scan扫描节点ID），然后点击Check conection 如果正常，即可点击Finish完成连接。

1677204520821-2397bbee-100a-45d8-a29b-fb1b417c8ebd.png

## 图4.4.2

注：如果驱动器的波特率和ID已经进行过个人配置，可以根据个人设置进行配置，如果无法获知这些信息，可以考虑去Nanatec官网下载Plug & Drive Studio 2.05版本，其上图设置页面可以选择扫描驱动器的波特率和ID。

初始化电机参数，本步骤可以在整体配置完成，可以正常通信，但是电机运转不正常时设置。（本文采用的是NanoTec品牌的WD16050系列的电机，国内没有，如需使用，需要国外购买）。先确认一下参数是否正确（这些参数为本文电机参数，需要根据自己的电机图纸设置）
1677204539997-0e88fc01-1111-40df-a13c-26c29a52f8d0.png 

## 2030；电机极对数
## 2031；峰值电流
## 203b:01;额定电流

## 进行电机诊断
1677204557613-5f2a40c2-cf4f-4f04-841a-52e04a2d875f.png 

## 查看诊断结果
1677204573770-5fd465e1-63dd-4682-85a7-30e61e30022f.png 

修改波特率为我们控制器设定的波特率。
先调节Nonatec 驱动器上拨码盘，把S1拨到8，S2拨成0，拨码盘的位置见下图（如果无法看清刻度，可以卸下驱动器外壳）
1677205785914-35c91974-3e01-408f-a2ed-f13d06e10e6f.png 

## 图4.4.3

点击Object dictionary ，点击2步骤的加载刷新，读取2300，若2300=1将2300=0【关闭内部程序】，然后按下图3步骤修改波特率为133（即为250kbd），修改4步骤的CAN ID为合适值（通常需要分别给驱动器给予不同的 can ID，一般双轮差动机器人，将左边的驱动器编号为 ID 1,右侧驱动器编号为 ID 2）

1677205813262-c02c5ee5-2b87-46a4-b711-a12e1a16472f.png

## 图4.4.4

点击more ，选择Console，点击0k，打开控制台，步骤图如下：

1677205837310-51f05d56-7161-485e-91ec-7a323ae27b08.png

## 图4.4.5

在上步打开的控制台中输入保存指令1010：01=1702257011和1010:02=1702257011即可.

1677205858910-60d25498-1d55-4319-8450-dbc289f941f5.png

## 图4.4.6

在home页断开连接，重启驱动器，按如上步骤重设波特率为250kbd，Node ID为你设置的值，重新连接，测验参数是否修改成功。

保持拨码盘指数不变。
波特率低于1Mbd会触发一个警告，可不做处理（为上位机软件bug），此时Check conection 为灰色不可点击状态，直接点击finish完成配置即可。

设置相应的心跳参数如下图4.4.7，将100C修改为01F4,100D修改为01

1677205880277-f50c4e82-b3c8-4cbe-9e70-47249935ee21.png

## 图4.4.7

## 设置操作模式为速度模式如图4.4.8
1677205994279-6a74683d-5f0f-4184-8d77-2c533facae1f.png 

## 图4.4.8
保存修改的参数，重启驱动器即可以用我们的控制器进行通信控制。
1677206036401-61581fd4-64e0-4457-9213-07d19a2ccb74.png 

## 图4.4.9
注：如果有参数在对象字典中输入，经过刷新后发现参数自动回复到默认值，则可以考虑在控制台输入相关指令：主索引：自索引=值（如上图的6060:00=2，值如果是16进制则需要在16进制前面加上0x）
自动抱闸功能的配置：针对本款电机带有刹车功能，且刹车功能通过驱动器设置，将3202 bit2置1，开启刹车自动控制功能
## 检查3202数值，查看Bit2是否置1
1677206267246-151350e5-3838-442e-a919-0cf54c24b68d.png 

恢复默认参数，按下图所示顺序依次输入相关指令，如果出现下图红色错误，请多次输入相同指令即可，最后重启驱动器即可。
1677206285030-061113c4-8eb9-4826-87b9-26889e34409e.png 

注：依次输入1011:01=1684107116等指令，如果出现多次输入指令都失败，可以关闭软件和断开can卡和pc的连线，再次重新连接（如果有指令执行成功注意，canID和波特率是否恢复到默认值）

如果在采用以上步骤配置驱动器参数确没能正确驱动，可以利用该方法重置驱动器的相关参数，再次配置，确保所有参数于本文档相同。

重置完参数后，一定按照本文档重新初始化电机。

注意：如果发现自己的ID和波特率都无误确无法连接，则可以关闭软件，断开can盒和PC的连线，再次连接，打开软件，尝试连接，这是 Plug & Drive Studio 1.1.0 软件的BUG。

### 五、机器人模型配置说明

### 根据电机及减速实际情况配置行走电机参数：

Roboshop  版本是 2.1.X（固件版本为 1.9.0 及以上），请参考机器人模型图 5.1,图5.2 ，图5.3所示：

注：这些参数需根据驱动器及选用电机及减速机的实际进行填写。

1677206338303-b149fba0-80ce-49a4-a6fa-27925d760045.png

## 图5.1

1677206352218-2f8c8150-3c6d-403c-a5fa-cc8945164513.png

## 图5.2

1677206367888-b6878dfe-478f-42de-b392-0d2d16f3c0c8.png

## 图5.3

注：减速比、编码器线数、电机最大转速、驱动器品牌需要根据选用的实际填写。

### 六、驱动器的功能检测

## 1.在整车组装完成未安装外壳前，请再检查一遍接线确保接线正确。

2.将车体加高，使轮子离地。开启机器人，使用网线连接机器人。使用 Roboshop 软件操作机器人让轮子转起来。 使用 CanScope 夹在 CAN 总线上检测 CAN 报文至少 1 小时，CAN 报文无错误。

### 3.让车体着地，使用 Roboshop 软件操作机器人做运动动作:向前，向后，向左，向右运动。

4.未拍急停按钮前，推动机器人，无法推动（电机使能），检查 Roboshop 中机器人状态处于“未急停”“驱动器未急停”，如图 6.1 所示；所示拍下急停按钮后，再次推动机器人，可以推动（电机使能释放），检查 Roboshop 中机器人状态处于“已急停”，“驱动器已急停”，如图 6.2 所示。

1677206396985-5fcd8d66-cf3c-458d-b5f3-34a4d1850bdf.png

## 图 6.1

1677206410063-c4834774-ad47-4daa-8563-f45f2bc32f31.png

## 图 6.2

### 5.任务链运动老化测试 24H，查看 Robokit Log 无错误报警。

### 七、附录

### 7.1 致远 CAN Scope 使用方法

## 1.软件安装--安装 CAN Scope 配套软件 CANScope。（软件及使用手册请联系致远厂商售后）.

2.硬件连接--参考 CAN Scope 使用手册接好电源，USB 调试线，插上 CAN Port 板,将 CAN_H 接到 SRC2000 外接线束 TE35 33 号线上，将 CAN_L 接到 SRC2000 外接线束 TE35 32 号线上 USB 调试线插在电脑上。

3.打开软件 CANScope，选择【Port板】，取消【启用终端电阻】，选择【报文】，配置【波特率】为 250Kbps，取消【总线应答】，选择【开启】，CAN 报文实时如图 7.1.1 所示。

1677206458155-b12f0184-c43b-4da9-91bb-52981c096c85.png

## 图 7.1.1

### 4.选择【状态】【错误】，检查是否有错误报文。如图 7.1.2 所示。

1677206473377-c6f1fcca-4ca2-4bc1-bb48-8cbd37a381bf.png

## 图7.1.2

### 7.2 USB CAN 卡使用方法

## 1.软件安装—安装软件 USB_CAN Tool（软件及使用手册请联系 CAN 卡厂商售后）.

2.硬件连接—准备 USB CAN 卡和连接线，将连接线 CAN_H 接到 RC2000 外接线束 TE35 33 号线上，将连接线 CAN_L 接到 SRC2000 外接线束 TE35 32 号线上。 如图 7.2.1 所示。

1677206490586-72e9f604-ec40-4ef5-b0f1-33578d105341.png

## 图 7.2.1

3.打开 USB CAN tool ,选择【设备操作（O）】【启动设备（S）】,确认 CAN 参数，【波特率】为 250Kbps,选择【CAN 通道号】为通道 1,点击【确认】。如图 7.2.2 所示：

1677206507006-ccb39464-c04b-4fc0-af7e-6f6b0b969604.png

## 图 7.2.2

### 4.选择【显示（V）】，取消选择【合并相同 ID 数据(M)】，CAN 报文如图 7.2.3 所示：

1677206524651-a0313dd6-9769-405d-a729-4c246fc2a61b.png

## 图 7.2.3

### 7.3 udpconsole 使用方法

udpConsole 是我司工程师用于调试 bug 开发的小工具，可以检查到固件上报的错误信息。

## 1.打开 udpconsole 工具前需用网线确保电脑与机器人的物理连接。

### 2.打开 udpconsole，进行驱动器功能测试，时刻检查 udpconsole 显示内容。

### 驱动器通讯过程中出现错误帧如图 7.3.1 所示：

1677206544430-40ae1c74-012a-478f-84ca-181d996be799.png

## 图 7.3.1

### 八、驱动器常见错误码

## 错误码

## 错误描述

## 0x2300

## 控制器输出处的电流太大

## 0x3100

## 控制器输入处的过电压/过电压

## 0x4200

## 控制器输入处的过电压/过电压

## 0x6010

## 看门狗错误，软件重置

## 0x6320

## 必须设置额定电流

## 0x7113

## 警告：镇流器电阻器热过载

## 0x7121

## 电机堵塞

## 0x7600

### 警告：非易失性内存已满或损坏；重新启动控制器以进行清理工作

## 0x8130

## 看门狗（心跳）打开失败
