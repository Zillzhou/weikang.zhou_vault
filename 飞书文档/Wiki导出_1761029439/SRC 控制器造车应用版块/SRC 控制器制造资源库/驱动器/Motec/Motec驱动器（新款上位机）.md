# Motec驱动器（新款上位机）

## Motec驱动器（新款上位机）

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 语雀迁移飞书

## 使用中

## 说明
本文档针对机器人改造过程进行规范，使公司产品符合行业标准，保证产品质量稳定，使技术人员在进行改造过程中有章可循。

机器人自动化改造涉及传感器众多，建议采用我司核心控制器标准线束 TE23、TE35，本文档以核心控制器标准线束为蓝本进行作业指导。

MOTEC 伺服驱动器选型建议参考公司的选型指导手册。

本文档只适用于改造参考，不可作为技术协议及其他承担责任的内容。
## 一、适用范围

本技术规范适用于公司使用 MOTEC 驱动器进行自动化改造的研发、生产、调试的技术人员。
### 二、调试资源
### 三、改造流程
## 进行改造（底盘驱动器部分）
1.驱动器需要与车体进行可靠固定，确认驱动器的电源（正负极）连接正确，确认驱动器与对应电机的动力线、编码器线连接正确。MOTEC 驱动器购买时厂商配置自带线，安装时请使用MOTEC 自带线。

左边驱动器电源，动力线，编码器线，急停线，CAN 上位机通讯连接总线，CAN 通讯连接线，状态灯，电源灯如图 4.3.1 所示。
2c3c3531-8aef-4cd6-91ce-1d2502a85a06.png

## 图 4.3.1

注：驱动器与对应电机之间动力线和编码器线必须一一对应对接，绝对不可交叉对应使用。

2.当机器人安装有多个驱动器(数量 ≥2)时，所有从站的 CAN_L、CAN_H 引脚直接相连即可，尽量采用串联方式接线，如图 4.3.3 左图所示；将 can_H 压入一个德驰插筒连接器，将 can_L 压入一个德驰插筒连接器，接入德驰 DT06-2S 公头。最后与 TE35 中的 32、33 号线（can1）相连；

注：在改造过程中若由于驱动器连接所需要的线束数量不足，无法实现在驱动器端进行快速串联，可采用 4.3.3 右图所示连接方式，但不推荐。
c7bad651-fece-4a0f-9ab9-ec97f07206c9.png

## 图 4.3.3

3.为保证 can 通讯质量，需要在距离核心控制器最远的驱动器上安装 120Ω 终端电阻，如在图 4.3.3 中将 Driver1 驱动器上终端电阻通过拨盘打开；

注：客户可在购买驱动器时向驱动器厂商提出购买配套终端电阻。

### 4.终端电阻是否正确打开的检测方法：

关机断电,断开驱动器和控制器的 CAN 连接线（如图 4.3.3 中 Driver4 和控制器之间的位置），使用万用表电阻档测量驱动器侧的 CAN 总线上 CAN_L,CAN_H 之间电阻，电阻值为 120Ω 则正确，如图  4.3.5 所示。电阻值明显小于 120Ω（如 60Ω)，则说明至少有两个驱动器打开的终端电阻。

断开图 4.3.3 中 Driver1 和 Driver2 之间的连接线，使用万用表电阻档测量 Driver1 侧的 CAN 总线上 CAN_L,CAN_H 之间电阻，电阻值为 120Ω 则正确，如图 4.3.5 所示。如果电阻值明显大于 120Ω（如几 KΩ)，则说明终端电阻打开的位置不在 CAN 总线末端，需要调整。
2ff19985-299d-43ab-81d4-de8b29859f4e.png

## 图 4.3.4

### 5.驱动器急停实现

### 方式1：采取驱动器断电的方式实现整车急停——不推荐

本次采用的 MOTEC 驱动器需采取拍下急停开关对驱动器断电的方式来实现整机急停功能；基于以上思路需要利用急停开关的另一路常闭触点控制为驱动器供电的继电器通断电的方式来实现；
18abd5e1-118d-4b65-ac72-c5e1bc5d60fc.png

 图 4.3.5 （注：此图驱动器 CAN  线未采用推荐接法）

MOTEC 驱动器如图 4.3.5 所示，将继电器控制线圈电路、急停开关的其中一路常闭触点串接入核心控制器 T23 的 20 号线与 9 号线，形成完整回路；将继电器的控制电路串接入电池为驱动器供电的线路中，如上图红框圈选的区域；

方式 2：采取控制驱动器 IO 实现去使能方式实现急停——推荐

将驱动器的 CN3 接口上 COM+ Pin(13)连接 DCDC 24V+ 输出；将驱动器的 CN3 接口上 Input1 Pin(10)连接 SRC2000 控制器上急停输出 1+（T35 中的 5 号线），将另一根急停输出 1-（T35 中的 4 号线）连接 DCDC 24V- 输出，接线说明如图 4.3.6 所示：
e9f6c5a2-d5ba-4ccd-8295-2d729591a5ec.png

## 图 4.3.6

### 6.电机抱闸线处理方式

如需要实现抱闸的功能，抱闸电源接口，抱闸专用输出接口如图 4.3.2 所示，将电源接口外接一个24V的电源，将break+，和break-抱闸专用输出端口和电机的抱闸接口相接。
480dbdb5-b408-4fbb-9fef-eeef8a3f10b8.png

Motec驱动器不支持零速抱闸，因此急停模式需要配置为IO急停或者断电急停，机器人模型配置见第五章。  图 4.3.7

### 四、驱动器配置

## 一：必配选项

MOTEC 驱动器配置软件 MotionStudio 及软件使用手册请联系驱动器厂商官方售后。

1.硬件连接—电脑与驱动器建立通讯链接。 准备 MOTEC 驱动器专用 USB 串口调试线，将 USB 连接电脑，另一头 MD8 连接驱动器 CN4 或者 CN5 接口上。

2.安装配置软件 MotionStudio，双击 MotionStudio 快捷方式打开 MotionStudio，选择【通讯】打开通讯设置，确认选择 COM 口，点击【联机】连接驱动器，如图 4.4.1 所示：
ba8778b4-69a5-4bff-81f1-284115cc2f2d.png

注：起始地址和终止地址和你设置的can ID有关，即该范围需包括您设定的can ID（默认为1）

## 图 4.4.1

### 3.【can 波特率】将驱动器 can 波特率更改为 250KHz，如图 4.4.2 所示：
896c44c5-c08a-4a1f-89b9-d2cba5eea938.png

## 图 4.4.2

### 4.【选择 canopen 通讯协议】将驱动器通讯协议更改为 canopen 通讯协议，如图 4.4.3 所示:
2810d2dc-2ad4-4d1e-9842-a6ac8170edf6.png

## 图 4.4.3

### 5.【选择操作模式】将驱动器操作模式更改成网络指令模式，如图 4.4.4 所示:
4c956a5c-837d-435c-a838-8b2b88e90af6.png

## 图 4.4.4

### 6.【工作模式】将驱动器工作模式更改为“速度模式”，如图 4.4.5 所示:
05754ecf-94ec-4950-8404-eeae019cbcab.png

## 图 4.4.5

### 7.【驱动器地址】分别给驱动器给予不同的 can ID，一般双轮差动机器人，将左边的驱动器编号为 ID 1,右侧驱动器编号为 ID 2,如图 4.4.6 所示:
7a28c4fd-be56-4471-b9b2-e0305be40d6f.png

## 图 4.4.6

### 8.【网络模式下定义输入口作为使能信号】将网络模式下定义输入口作为使能信号的值改为 9999，如图 4.4.7 所示:
e5379233-05ee-4836-b44e-7a74027f29b1.png

## 图 4.4.7

### 9.【急停停止方式】将急停停止方式设置为电机按照预设定的减速度减速停止。如图 4.4.8 所示：
57121a73-bbc2-4ac3-8e45-8c1d916d297b.png

## 图 4.4.8

### 10.【电机使能功能输入口定义】将电机使能功能输入口定义定义为1号输入口作为电机使能输入。如图 4.4.9 所示：
d0363ed1-339e-4932-ab1b-2e23b7bf5fb1.png

## 图 4.4.9

### 11.【电机使能|释放使能】将电机使能|释放使能定义为1,电机使能。如图 4.4.10 所示：
d35b6805-5bec-4a11-8f95-589e512202cd.png

## 图 4.4.10

注：该使能设置是通过急停接口中有相关的使能线自动通过IO配置，电机正常使能后读取该参数为1，未使能则为0.

### 12.【电机使能触发电平】将电机使能触发电平定义为 0,低电平使能，如图 4.4.11 所示：
0e7470a5-0d7d-492b-a67c-a3b63bfa58cb.png

## 图 4.4.11

13.找到【电流环比例增益】，【电流环积分增益】，【位置环比例增益】，【位置环积分增益】, 【速度环比例增益】，【速度环积分增益】, 这部分参数视驱动器型号不同参数有所不同，建议咨询驱动器厂商技术人员设置这部分参数，并检查实际驱动器电机效果（电机抖动及使能效果）。如图4.4.12所示:
833ffe27-8a7c-46b8-8a7f-fe55a4c50f96.png

## 图 4.4.12

注： 只需配置上图所示第一组三环反馈的相关参数。

## 二 ：选配（配置抱闸相关参数设置）

## 自动抱闸与电机使能联动设置
685da191-5129-41d5-a45f-fbf1c053dff3.png

## 抱闸类型设置
1f48b393-e5e6-4c4e-b400-0d09fedd5519.png

### 五、机器人模型配置说明

### 根据电机及减速实际情况配置行走电机参数：

Roboshop 版本是 2.0.X（固件版本为 1.8.49 及以下），请参考机器人模型图 5.1 所示；Roboshop  版本是 2.1.X（固件版本为 1.9.0 及以上），请参考机器人模型图 5.2 所示：

注：这些参数需根据驱动器及选用电机及减速机的实际进行填写。
a71a2607-7766-4331-9588-5e3a9dd7562a.png

## 图 5.1  图 5.2

注：减速比、编码器线数、电机最大转速、驱动器品牌需要根据选用的实际填写。

Roboshop软件中机器人模型配置抱闸方式（ Motec驱动器不支持零速抱闸，因此急停模式需要配置为IO急停或者断电急停 ）见下图：

f193669d-bd2f-4be8-ae95-d16f0e249c12.png

e6fb0f5e-c82d-40cc-83e2-eae99537171a.png

### 六、驱动器的功能检测

## 1.在整车组装完成未安装外壳前，请再检查一遍接线确保接线正确。

2.将车体加高，使轮子离地。开启机器人，使用网线连接机器人。使用 Roboshop 软件操作机器人让轮子转起来。 使用 CanScope 夹在 CAN 总线上检测 CAN 报文至少 1 小时，CAN 报文无错误。

### 3.让车体着地，使用 Roboshop 软件操作机器人做运动动作:向前，向后，向左，向右运动。

4.未拍急停按钮前，推动机器人，无法推动（电机使能），检查 Roboshop 中机器人状态处于“未急停”“驱动器未急停”，如图 6.1 所示；所示拍下急停按钮后，再次推动机器人，可以推动（电机使能释放），检查 Roboshop 中机器人状态处于“已急停”，“驱动器已急停”，如图 6.2 所示。
2f6e3255-9321-4e47-8fbc-1a438ee8d619.png

## 图 6.1
29bce4ca-0400-4370-adea-228e929776b4.png

## 图 6.2

### 5.任务链运动老化测试 24H，查看 Robokit Log 无错误报警。

### 七、附录

### 7.1 致远 CAN Scope 使用方法

## 1.软件安装--安装 CAN Scope 配套软件 CANScope。（软件及使用手册请联系致远厂商售后）.

2.硬件连接--参考 CAN Scope 使用手册接好电源，USB 调试线，插上 CAN Port 板,将 CAN_H 接到 SRC2000 外接线束 TE35 33 号线上，将 CAN_L 接到 SRC2000 外接线束 TE35 32 号线上 USB 调试线插在电脑上。

3.打开软件 CANScope，选择【Port板】，取消【启用终端电阻】，选择【报文】，配置【波特率】为 250Kbps，取消【总线应答】，选择【开启】，CAN 报文实时如图 7.1.1 所示。

d2d9719f-f403-44e4-9850-3da4ca4ae628.png

## 图 7.1.1

### 4.选择【状态】【错误】，检查是否有错误报文。如图 7.1.2 所示。
bdfdec97-e814-4103-b428-f22d249d516b.png

## 图 7.1.2

### 7.2 USB CAN 卡使用方法

## 1.软件安装—安装软件 USB_CAN Tool（软件及使用手册请联系 CAN 卡厂商售后）.

2.硬件连接—准备 USB CAN 卡和连接线，将连接线 CAN_H 接到 RC2000 外接线束 TE35 33 号线上，将连接线 CAN_L 接到 SRC2000 外接线束 TE35 32 号线上。 如图 7.2.1 所示。
e1b2464e-56d3-4fdb-9b74-189406f3fb73.png

## 图 7.2.1

3.打开 USB CAN tool ,选择【设备操作（O）】【启动设备（S）】,确认 CAN 参数，【波特率】为 250Kbps,选择【CAN 通道号】为通道 1,点击【确认】。如图 7.2.2 所示：
9a9c91b6-5010-453c-975c-52c40d420f66.png

## 图 7.2.2

### 4.选择【显示（V）】，取消选择【合并相同 ID 数据(M)】，CAN 报文如图 7.2.3 所示：
773b8634-aca6-4ee8-8fa4-edecacc12b31.png

## 图 7.2.3

### 7.3 udpconsole 使用方法

udpConsole 是我司工程师用于调试 bug 开发的小工具，可以检查到固件上报的错误信息。

## 1.打开 udpconsole 工具前需用网线确保电脑与机器人的物理连接。

### 2.打开 udpconsole，进行驱动器功能测试，时刻检查 udpconsole 显示内容。

### 驱动器通讯过程中出现错误帧如图 7.3.1 所示：
60a0afc8-d9ec-4ef4-801b-9d8728fe3baf.png

## 图 7.3.1

### 八、驱动器常见错误码

f4bc997a-e326-45da-9961-4ac5ee1d8ea7.png

d41a069a-168a-4146-a6c1-1acf415f6aa3.png
