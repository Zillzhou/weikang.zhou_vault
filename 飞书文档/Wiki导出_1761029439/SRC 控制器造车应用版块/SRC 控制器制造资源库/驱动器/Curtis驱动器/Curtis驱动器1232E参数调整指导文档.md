# Curtis驱动器1232E参数调整指导文档

### Curtis驱动器1232E参数调整指导文档

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 语雀迁移飞书

## 使用中

## 一、适用范围
本文适用于 Curtis-1232E 调试与配置。
### 二、调试资源
## 调试软件：

柯蒂斯软件_1314-4402 PC Programming Station (OEM) (2).zip
## 调试工具：
## 1309 USB 数据线接
1653543567351-9ebe6fa8-4012-4551-a000-a7100a35c3b3.png

### 三、接线与改造
按照实际的项目的电机原理图进行接线。
### 四、驱动器配置
相关Curtis驱动器按照此步骤进行驱动器配置。
## 注意：
## curtis 一般有两个调试口：
### 行走电机：1298 或者 1232（根据不同的驱动器）
## 转向电机：1220C
### 在烧写和整定的时候，烧写线要连接到对应的烧写口上面
## 相关参数的含义：
### 《1232EACos20新版_manual.pdf》
《curtis 科蒂斯-1220--电动转向助力控制器说明书.pdf》
## 注意：
在修改参数的时候，如果对于某一个参数含义有异议，可以先查阅一下Curtis 1232E的参数说明文档。
## 连接行走驱动器和转向驱动器的方法：
### 打开 1314 上位机软件，点击连接按钮
1657781821427-39e57de2-2813-4792-8d81-0f99e4d80b12.png

连接行走驱动器正常的情况： Model Number 显示1232的型号
1657781902774-640dae34-f5b1-401f-9f69-356cf2e408cd.png

### 4.1 行走驱动器1232E参数设置
### 4.1.1 修改低电量模式参数
### BDI Lockout Enable 设置成 off
### BDI Lockout Level 设置成 0%
将 Low BDI Mode 下面的参数 Max Speed Low BDI 改成驱动器 motor 中 Max Speed 的大小
例如：驱动器中最大的转向速度是 4000rpm ,如图 4.1.1：
1657792944137-19189341-0b56-4343-b742-535b33de27ec.png

## 图 4.1.1
### 例如：有的驱动器中最大的转向速度是 2000rpm
BDI Alam Level 设置为0；
BDI Lockout Level 参数设置为0；
Max Speed in Low BDI 设置为可以设置为 Max speed 的值；如图 4.1.2：
## M
1653561980030-e1c3436e-68c3-4ccb-8d5c-e22abe1468c9.png

## 注意：
Low BDI 模式下的 speed 配置为 Max Speed 的值
### BDI Lockout Level 改为 0%
### 如果有 BDI Alarm Level 也改成 0%
## 作用：
### 此处不要在低电量限速，会影响到运动的精度和响应的性能

### 4.1.2 修改行走跟随性能相关参数
0-Speed Mode Express 下 kp 、 ki 值的设置，
1657775327204-aac5e4c7-6d30-4717-8e51-dbe6a41ec64e.png 

## 图 4.1.3
## 注意：
若是发现跟随性能不好，可以尝试增大 KP 的值【可以按照 Kp 50% Ki 50% 】

## 车型

## Kp

## Ki

## rebote-CDD14

## 35%

## 35%

## rebote-CDD20

## 50%

## 50%
若是发现车辆在停止启动的时候 出现抖动 的现象，可以尝试 减小Kp 的值， 增大KI 的值
## 切记：
如果 rebote-CDD 车型使用 kp 30% Ki 30% 参数组合会出现：车辆阻挡后启动车辆抖动的情况，现 将 Kp 值改为20%
### rebote-CDD14 的 Kp 最大不要超过40%
### rebote-CDD20 的 Kp 最大不要超过50%
### 4.1.3 修改电流限制
### 将此处的电流的限制放开,如图 4.1.4：
1657775825888-9a046bb9-9771-475f-ac9a-fa8ae5e1b5f0.png

## 图 4.1.4
### 4.1.4 修改比例阀电流值
## 注意：
### 合力 CDD 系列车型-未使用比例阀，此项不用修改
### 【注意：合力-CDD-未使用比例阀，此项不用修改】
## 比例阀相关的参数解释：
1653561980674-4dca6b3d-7e10-4802-83e6-291adff64f21.png

## 图 4.1.5
在制定协议的时候，规定下降的是 0~255 对应的下降比例阀的最大开度
## 注意：
0~255对应了比例阀的 PD min Current ~ PD Max Current
### PD max Current 的值是流过比例阀的最大电流
【瑞博特 CDD14 】 SP08-20 型号的比例阀的电流范围是 0.2~ 0.63A（大致），根据比例阀的电气特性图，将 瑞博特 1232E 驱动器的 PD max Current 可以调整为 0.7A，如图 4.1.6
1653561980610-18ed8d84-30d6-4cc6-a2f0-9c2c71060bcf.png

## 图 4.1.6

### 4.1.5 修改电磁抱闸响应时间
Position Hold Setting Time 修改为 300ms
### Brake Set Time 修改为 200ms
### Torque Release Time 修改为100ms
## 参数如下图 4.1.7 ：
1657776663615-dccb00e8-1888-4fee-bd25-5c099ad25eef.png

## 图 4.1.7
### 4.1.6 检查can总线波特率
### 检查 can 波特率设置是否正确，如图 4.1.8：
### Baud Rate 设置为 1 （250K）
1657776919004-95d93866-36f4-4b92-906f-afa1573c2724.png

## 图 4.1.8
### 4.1.7 修改全局的最大加速度和最大减速度
此项参数用来缓解车辆到点过冲的问题，可以调整在整个运动过程中的最大加速度和最大减速度。
## 参数位置如下图4.1.9：
1657777147424-82d89aba-eb7b-4b67-a464-34bde17aad6c.png

## 图 4.1.9
## 此项参数按照不同车型进行调节：

## 车型

## Max Speed Accel

## Max Speed Decel

### robshop 参数配置 maxDec 的范围

## rebote-CDD14

## 2 seconds

## 2 seconds

### 0.15 ~ 1.5

## rebote-CDD20

### 0.1 seconds

### 0.1 seconds

### 0.15 ~ 1.5

## 注意：
如果 Max Speed Accel 和 Max Speed Decel 设置的值太小（加速度和减速度较大），叉车在小速度启停的时候会出现抖动的现象，此时需要将这两个参数设置的大一些。
若车型不在表格中的车型，车型比较大的可将此两项参数设置为 0.1 、0.1；车型较小的车可将此参数设置为2 、2；
### 4.1.8 修改LOS模式相关参数
由实际问题得出：如果在驱动器触发电机堵转或者行走电机编码器错误的时候，此时出现 Throttle Command 为 0和 Motor RPM 为 0，就会进入到 Curtis 的 LOS 模式， LOS 为限制操作模式。在此模式下，如果下发了前进使能的信号，就会出现车辆的按照 LOS Max Speed 设置的速度值前进，不响应驱动器下发的速度。
### 故需要修改LOS模式,如图4.1.10:
LOS Upon Encoder Fault 设置为 off
### LOS Max Speed 设置为 100rpm
### LOS Max Current 设置为 100A
1657791846832-f1394963-80f0-4cb5-817d-b3907b32d0c9.png

## 图 4.1.9
### 4.1.9 修改编码器报错持续时间
### Fault stall time 设置为 1s
1657791929307-c87b8959-6e1d-4f3b-ba71-5315b65fcb77.png

### 4.2 转向驱动器 1220C 参数设置
### 正常连接之后出现的界面，证明连接1220C正常：
1657781784010-3ceb0b44-45ee-427d-bf0a-d140130fb4f6.png

## 注意：
在修改参数之前要确认客户的转向电机的转向角度是 ±90° 还是 ±120° ！！！！！！！
需要将 1309 模块接到 1220C 对应的接口，修改参数!!
### 在检查这部分内容的时候一定要确认相关的电机的参数为正确的！
### 4.2.1 修改角度映射相关参数
### 若是 ±120°，设置方法按照下图 4.2.1 ：
1657779662412-601d2120-bf8c-474f-af36-e3d736600e41.png

## 图4.2.1

## 注意：
在此处的值，对应于不同的电机，但是P3 Input的值会影响转向0位的精度。
若是 ±90° ，需注意下面的 Left stop （deg）保持-90°、 Right stop （deg）的值保持90°。只关注 p3 Input 、 p3output （deg）和 p4 input 、 p4output （deg）需要将 1309 模块接到 1220C 对应的接口，修改参数。
### 4.2.2 检查转向电机的编码器线数
## 注意：
在检查这部分内容的时候一定要确认相关的转向电机的编码器线数为正确的！
## 瑞博特相关车型及转向电机编码器信息：

## 瑞博特车型

## CDD14

## CDD20

## CBD20-S

## CPD15-T

## CQD14

## 转向电机编码器线数

## 256

## 256

## 256

## 256

## 256

## 备注

## 设置参数的方法如下图 4.2.2 :
1657780314537-97e64ddd-91e1-4fa0-bf48-1c2f9ccc5e0c.png

## 图4.2.2
### 4.2.3 检查转向机构减速比设置正确
## 注意：
在检查这部分内容的时候一定要确认 减速比与车型的机械参数计算的减速比相匹配 ！
在填写减速比的时候一定要核实叉车上面安装的减速机的减速比多少!!!!!!!!!

如果减速机的减速比为 23.9 ，请按照下面这个表格进行填写
## 瑞博特相关车型及减速比信息：

## rebote车型

## CDD14

## CDD20

## CBD20-S

## CPD15-T

## CQD14

## 减速机的减速比

## 2 3.9

## 2 3.9

## 2 3.9

## 2 3.9

## 2 3.9

## 齿轮比

## 1 30 / 18

## 1 44/18

## 1 44/18

## 1 44/18

## 1 44/18

## 总 减速比

### 172.6

### 191.2

### 191.2

### 191.2

### 191.2

## 备注

## 减速比 = 减速机的减速比 * 齿轮比

如果减速机的减速比为 24.975 ，请按照下面这个表格进行填写
## 瑞博特相关车型及减速比信息：

## rebote车型

## CDD14

## CDD20

## CBD20-S

## CPD15-T

## CQD14

## 减速机的减速比

## 2 4.975

## 2 4.975

## 2 4.975

## 2 4.975

## 2 4.975

## 齿轮比

## 1 30 / 18

## 1 44/18

## 1 44/18

## 1 44/18

## 1 44/18

## 总 减速比

### 180.375

### 199.8

### 199.8

### 199.8

### 199.8

## 备注

## 减速比 = 减速机的减速比 * 齿轮比

## 参数位置如下图:
1657780644463-e4b381d4-8d1a-4766-9e8f-0252892151dd.png

## 图4.2.3

### 4.2.4 调节回零的速度和时间
## 注意：
### 设置此参数之前,请确定零位开关能够正常触发
建议将 Homing Speed 修改的小一些为 10% ， Homing Timeout 时间设置为 20s ，这样可能回0的时间可能长一些，但是精度会高一些。
我们建议客户的舵角电机能够转向 ±120° ，若是达不到 120° ，在转向的过程中有可能会出现误差，此一点需要明确！！！
选择范围是 ±120° 之后， homing direction mode 才能选择0~3
## 参数修改的位置如下图 4.2.4 :
1657780984598-cc83765e-676c-4339-a0a5-7726abfc9596.png

## 图4.2.4

### 4.2.5 检查转向驱动器的波特率
使用 1309 模块连接 Curtis1232E 上面检查 can 波特率设置是否正确，
### 将 Baud Rate 设置为1 （250K）
## 参数修改的位置参照图 4.2.5 ：
1657781356585-2102a1ec-8650-4e79-9e0e-438bb3a80f7a.png

## 图4.2.5
### 4.2.6 调节舵角跟随性和超调效果的验证方法
谨慎修改：不同叉车类型的响应的性能是不同的，是按照不同的叉车进行的操作 
### 将 Position Kp 设置为 100%
### 将 Velocity Kp 设置为 30%
### 将 Velocity Ki 设置为 6.5%
1657782119393-2408108c-56ef-4b6f-adf4-e387ff6c8203.png

## 图4.2.6
修改步骤 1 相关的值，到 roboshop 界面上面进行验证
## 操作转动舵角90°
1657782433543-f840a405-d767-44ff-9b94-210c01c4e714.png

注意观察：下图中角度反馈的数值，最大的数值为多少？记录相关的数值

1657782440713-bd80c00c-1057-474f-ab22-92abe2a2af9a.png

### 重复步骤 2 ，直到找到一组数据跟随性好，超调量好的数据
## 完成记录表格

## Position Kp

## Velocity Kp

## Velocity Ki

## 超调最大角度

## 1

## 67

### 17.9

### 7.9

### 90.9

## 2

## 100

## 30

## 8

### 90.5

## 3

## 70

## 30

## 8

### 91.1

## 4

## 70

## 50

## 8

### 90.7

## 5

## 70

## 50

## 10

### 90.5

## 6

## 70

## 70

## 10

### 90.5

## 7

## ······

## 8

## 100

## 30

## 15

## 90

重复步骤3，直到找到一组数据跟随性好，超调量好的数据，我们一般重复几组数据完成相关的参数的确定。
我们默认的参数是 Position Kp 100% Velocity Kp 30% Velocity Ki 6.5% ， 但是要 注意不同叉车的相关的参数不相同的要根据实际的车体进行测试和验证。
## 注意：
我们默认的参数是 Position Kp 100% Velocity Kp 30% Velocity Ki 6.5% ， 但是要 注意不同叉车的相关的参数不相同的要根据实际的车体进行测试和验证。
## 调整更随性好，超调量好的方法：
（1）先将KI值设置成 15% ，通过 roboshop 发送角度，观察超调情况，若有超调将ki设置为 20% ，观察超调情况，若无超调现象，进行第（2）步。
（2）将ki设置为 15% 时，未出现超调现象，，则将 ki 值设置成 5% ，观察超调情况，若有超调现象可将 ki 调大，若没有，可继续将ki调小。
（3）采取二分法调试，找到 ki 最合适的值。
## 注意：
不同叉车的相关的参数不相同的要根据实际的车体进行测试和验证。
如果叉车的转向角度达不到±120°，可采用其他的角度检验参数的超调性。
若是发现车辆转向时角度跟随性能超调较大，可以适当减小 position kp 的值。

### 4.3 相关修改的参数参照附件表格
 https://seer-group.coding.net/s/8285d162-dedf-4c18-be8e-a72790af92d2
### 4.4 转向电机的测试方法补充
根据 4.2.3 的测试方法，得出一个较好的 position Kp 、 Velocity Kp 、 Velocity Ki 组合后，通过 roboshop 分别下发 -90°、90°、0°、45°、-45°，5 个角度，观察 roboshop 的返回角度

## 序号

## 初始角度

## 结束角度

## Roboshop 返回角度

## 角度误差

## 1

## 0

## 45

## 2

## 45

## 0

## 3

## 0

## 90

## 4

## 90

## 0

## 5

## 0

## -45

## 6

## -45

## 0

## 7

## 0

## -90

## 8

## -90

## 0

若都能达到，则通过。若不能达到，
检查转向电机配置中的角度 Map 映射是否正确，参照 4.2.1
### 部分角度能够达到，部分角度达不到，怀疑1220C 有问题
若所有的角度都达不到，检查 1220C 的参数，核实编码器线数和减速比
## 注意：
转向的时候，从 0° 转到 90°，发现转角到 90.1° 或者 89.8°，误差 0.1~0.3 度，考虑编码器的问题。
转向的时候，0° 正常，90° 正常，但是例如转到 45° 的时候，返回的角度确实 53°（误差大于 1°）
## 可能会有 3 部分的原因：
## 模型文件配置的问题
## 1220C 文件的 map 映射的问题
## 1220C 坏了
