# Curtis 1298驱动器

## Curtis 1298驱动器

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 语雀迁移飞书

## 使用中

## 一、使用范围
本文适用于 Curtis-1298、Curtis-1232 器调试与配置。
## 二 、调试资源
## 调试软件：

柯蒂斯软件_1314-4402 PC Programming Station (OEM).zip
## 烧写的文件：
《rebote-CRUTIS 烧写文件》 （Curtis 1298 方案已经弃用）
## 烧写官方文档：
### 《交流控制器程序下载说明（cn）.pdf》
## 烧写工具：
## 1309 USB 数据线接
1653543567351-9ebe6fa8-4012-4551-a000-a7100a35c3b3.png

### 三、烧录与调试
### 3.1 Curtis-1298 驱动器程序烧录及参数调整
## 1、烧写步骤
如下介绍基于 LindeL14 叉车平台适配 Curtis-1298 协议的驱动器的参数烧写的步骤：**
## 1.1 调试前准备工作：
## 1.1.1 安装 1314-4402 PC Programming Station (OEM)到电脑
## 链接地址：

柯蒂斯软件_1314-4402 PC Programming Station (OEM) (1).zip
烧写的文件： 《rebote-CRUTIS 烧写文件》 （Curtis 1298 方案已经弃用）
注意：林德系列车型可采用 林德-L14-1298 烧写文件 中的文件
瑞搏特系列车型可采用 瑞搏特系列-1298 烧写文件 中的文件
## 1.1.2 连接烧写线到驱动器调试接口：
如下图 1.1 所示 ：驱动器上电，调试口连接行走电机，打开上位机软件
1653561974145-41353f66-1d07-4ecc-8854-bffa6702e51d.png

烧写官方文档：  《交流控制器程序下载说明（cn）.pdf》
## 注意：
## curtis 一般有两个调试口：
### 行走电机：1298 或者 1232（根据不同的驱动器）
## 转向电机：1220C
### 在烧写和整定的时候，烧写线要连接到对应的烧写口上面
## 1.2 连接行走电机驱动器
打开电源，打开上位机软件连接行走电机驱动器，如下图 1.2 所示：
1653561974490-6ded9519-2a9e-4a80-8765-c88b4198f973.png

1653561974201-acf929bd-07cb-4907-9e5d-6aa7c6ca0083.png

## 1.3 烧写行走电机驱动器
## 注意：
烧写瑞搏特和林德车型的 1298 驱动器的时候，都要先烧写SEER_L14_REBOTE_T_1298_OS12_200612_12_0_P101_V102_1.exe 完成后再按照车型系列将烧写文件中的 cpf 文件烧写进去。
## 文件说明：
SEER_L14_REBOTE_T_1298_OS12_200612_12_0_P101_V102_1 . exe  : curtis固件文件
SEER_L14_1298_2020_0823  : 适用于林德-L14 的 1298 驱动器
SEER_L14_1220C-2201_004535  : 适用于林德-L14 的 1220C 驱动器
SEER_REBOTE_T_1298_20200706  ：适用于瑞搏特的 1298 驱动器
SEER_REBOTE_1220C-2201_005964  ：适用于瑞搏特的 1220C 驱动器
1.3.1 双击 SEER_L14_REBOTE_T_1298_OS12_200612_12_0_P101_V102_1，开始进行烧写 .exe 文件(如图 1.3.1)
1653561974415-03789c81-b8b1-4f7c-930e-5f79bee18403.png

## 打开之后的界面，如图 1.3.2：
1653561974254-f50785d6-cd8c-47ec-93c5-48ee9a8477f9.png

1.3.2 选择 Com口-》选择 Defaults-》选择 updata both user and OS defaults-》点击 flash，如图 1.3.3：
1653561974923-ffc38025-2487-430f-a03a-f139fd21f915.png

## 1.3.3 点击 Flash,进行烧写，如图 1.3.4：
1653561975269-9239862a-2d6d-4332-b7ee-4442f74c9460.png

## 1.3.4 看到下面 Download OK，则烧写完成，如图 1.3.5：
1653561975018-1db24151-9944-491d-a24d-e2b9e079c93f.png

## 1.3.5 选择 Defaults-》选择 updata both user and OS defaults，如图 1.3.6：
1653561975118-06627704-80ef-4452-a4be-1b6950dc037c.png

## 1.3.6 将驱动器进行断电重启
## 1.4 烧写转向电机驱动器
## 1.4.1 双击 1220C-2201_004535
1653561975311-f3d348be-376d-4f04-9081-e658fdadbf4b.png

## 1.4.2 选择 OK，如图1.4.2：
1653561975570-885f38ac-7692-4a82-8d79-c81f2a4b236a.png

## 1.4.3 点击烧写按钮，依次选择 ok，yes，如图 1.4.3-图 1.4.5：
1653561975715-f509a3ce-1c30-4b09-ad21-8ca971b9d75b.png

1653561976326-e4865a12-d412-43ce-87ed-1d84fd8ff79a.png

1653561975887-5afba5db-7cdc-439e-90f8-94469c18073f.png

## 1.4.4 等待烧写，图 1.4.6：
1653561976096-5ca9d611-8700-47ca-9603-1e231fc6014e.png

## 1.4.5 按照提示关闭驱动器，图 1.4.7：
1653561976605-46192b40-0903-484f-8412-bac4aeb9ecff.png

## 1.4.6 等待 5s，按照提示打开驱动器，图 1.4.8：
1653561977070-60be8a42-ff1b-4e3c-97fa-4d6006fbffc1.png

## 1.4.7 等待烧写完成，没有错误和警告，如图 1.4.9：
1653561976588-4d6d32b7-261a-4436-88c8-89d046a3189f.png

## 1.5 烧写 1298 的参数
## 打开 1298 相关的文件
1653561976738-dc83885d-5dbd-490b-be84-c1d883e0256c.png

## 烧写步骤同 1.4
### 2、整定电机的步骤
注意：在整定电机之前要仔细检查驱动器有没有报错，图 2.1.1：
1653561977188-5fd21714-9250-4214-921e-02265b5d0104.png

## 若是发现有报错，请查阅：

### 1232+1298故障信息查询表-中文版.pdf

## 瑞搏特叉车调试典型问题.docx

### 2.1 整定行走电机
烧写SEER_L14_REBOTE_T_1298_OS12_200612_12_0_P101_V102_1.exe 然后整定电机参数
### 2.1.1 参数的设置按照 《OEM交流控制器用户手册20110402》
### 2.1.2 匹配的步骤按照，可参照 《电机匹配》
注意：参照《电机匹配》文档中的步骤 2 滑差确定、步骤 3 继续确定不需要做。可按照下面初步自动匹配来整定行走电机。
## （1）初步自动匹配
## <1> 初步设定
### ① 基本设定控制器参数，KSI 开关闭合时主接触器吸合
## ② 驱动轮离地
## ③ 驱动轮要能自由转动
## ④ 清除历史故障
## （2）开始测试
 注：在执行这里要着重注意看 1298 和 1220c 有没有报错，特别是关系主接触器相关的。
<1> 编程菜单中：Program/Motor Control Turning/Motor Characterization Tests/Test Enable to 1， 此时会听到主接触吸合的声音。
<2> Motor Control Turning/Motor Characterization Tests/Test Throttle to +1
## 此时，电机会转动
如果轮子向后转，令/ Test Throttle 为 0，等电机停转后重新设置 Test Throttle 为 -1
### <3> 电机自动测试完成之后主接触器会断开
## （3）判断测试是否成功，如图2.1.2
<1> 主接触器断开后进入当前故障菜单：Fault/current fault
<2> 如果只有一个故障，Parameter Change Fault ，说明测试成功
<3>此时关掉，重新开启 KSI 后，主接触器应能吸合，电机初步测试完成。
如果编码器不是：32,48,64,80,， 控制器不能自动识别，需手工设置
1653561977499-183707f0-69ed-4e10-af41-41c3cc242643.png

1653561977279-291ad464-be9e-4494-8eff-edb904c818b4.png

### 2.2 检查转向电机
 烧写 1220C-2201-004535，然后检查修改编码器的参数
 注意：在检查这部分内容的时候一定要确认相关的电机的参数为正确的！
 （1）将 Encoder Steps 的值设置正确【针对瑞搏特的为 256.0】，如图 2.2.1
1653561977671-a8aa8b51-6efc-4601-a7c9-277f6a811821.png

（2）调整减速比设置正确，【针对瑞搏特为 172.6】，如图 2.2.2：
1653561977712-338a5dad-19f1-4d6d-8cbc-a03c92ad5514.png

（3）修改 swap encoder direction 为 off，如图 2.2.3：
1653561978058-92a4f267-f000-4151-ba57-1f26c1c80e55.png

### （4）修改 Homing speed 为 10%
### Homing timeout 为 20s
## 注意：
## 1. 若是舵轮找不到零位，首先检查零位传感器是不是安装到位
### 2. 林德、瑞搏特、卓一、合力参数的模板所在的文件夹：
### 《curtis 烧写文件及各种车型参数配置的模板》
### 3、模拟量手柄参数整定
 注意：此步骤主要针对有手柄的叉车，若是没有手柄，直接跳过此步骤
## （1）点击连接按钮
1653561978086-ae99954a-73be-4a41-90f4-8ba1d5a552ff.png

## （2）会出现的界面：
1653561978338-6111c26e-8923-43be-a352-d8277f77b05a.png

### 整定参数分为 3 种参数，分别是前进和后退、起升下降、转向
### 3.1 前进和后退
### 【对应的是手柄上面的前进和后退的操作开关】
## 分为两步：
### 3.1.1 监控叉车的参数
 （1）在上位机软件中，Monitor->Input->Throttle Pot 中找到 3 个位置： 中位，记录电压值，如图 3.1.1：
1653561978417-bf269dc8-8b71-47fe-b0d5-0208289113f1.png

 （2） 将开关打至前进最大的限位，并记录电压值，如图 3.1.2：
1653561978596-25621a79-57bb-4948-b137-296a275d99b5.png

### （3） 将开关打至后退最大的限位，并且记录电压值
1653561978722-4e0ce826-3b2e-41c8-b230-73cfc24833c4.png

### 3.1.2 根据叉车的参数进行配置
对照 Parameter->Program->Throttle，查看相应的参数是否和第一步检测的值相同，若不同，则进行修改成第一步中记录的值。，如图 3.1.4：
1653561978692-7417e7b5-0fe2-4769-a599-8f80668376c6.png

## 下面关于起升下降、转向的参数整定同上
### 3.2 起升下降
在上位机软件中 Monitor->Inputs->Pot2Raw
### 3.2.1 监控叉车的参数
 （1）将手柄上面起升下降的拨片位于中间位置，记录电压值，如图 3.2.1：
1653561979026-09d938ff-e389-4eec-993c-7f2adb5477b8.png

 （2）将起升下降的拨片拨到降货叉的最大的限位，记录电压值，如图 3.2.2：
1653561979152-619b900d-7fd1-4958-ab84-e21bb6ed9828.png

（3）将起升下降拨片拨到升货叉的最大限位，记录电压值 ，如图 3.2.3：
1653561979298-7faa39bb-b931-4af3-b0ad-77e082b4f5e1.png

### 3.2.2 根据叉车的参数进行配置
对照 Parameters->Program->HYD Setup，查看相应的参数是否和第一步检测的值相同，若不同，则进行修改成第一步中记录的值。
### 3.3 转向参数
### 3.3.1 监控叉车的参数
### （1）将手柄处于 0 位，进行 0 位位置的标定：
将烧写线插到转向电机的调试口上面，按照上面的方法打开上位机软件 Monitor->Command Input，如下图 3.3.1 所示，SteerCommand 处于 0% 的时候代表车辆处于 0 位
1653561979328-93a7a36c-3a4c-4de3-9d47-944dbfeef46f.png

此时不要转动手柄，将烧写线重新接到行走电机上面，打开上位机软件在上位机软件中 Monitor->Inputs->Analog 1 代表的是转型的参数，如图 3.3.2
## 记录 0 位位置的电压值
1653561979330-4e0d0975-e640-423b-ab3c-73a66a5d148d.png

### （2）将手柄转至左限位最大处，记录电压值,如图 3.3.3
1653561979662-ad8836d8-45ea-4274-9dc6-f02e6b091ac3.png

（3）将手柄转到右限位最大值处，记录电压值 Z，如图 3.3.4：
1653561979774-21ee4f2a-e03b-42dc-8f8a-29171216a6af.png

### 3.3.2 根据叉车的参数进行配置
Parameters->Program->Steer Setup，查看相应的参数是否和第一步检测的值相同，若不同，则进行修改成第一步中记录的值。如图 3.3.5：
1653561979815-09aa33ae-a1c9-46d6-989a-0c1471c7c70c.png

其他的参数的整定都在用户手册《OEM 交流控制器用户手册 20110402》里面有体现，其他参数的设置可以参照上述文档。
链接地址： 《OEM 交流控制器用户手册 20110402.pdf》
### 4、叉车精度调试

## 针对的问题：
## （1）叉车跟随性不好
## （2）叉车到位精度不高

## 解决的方法：
### （1）调试修改 curtis 相关的参数
## 相关参数的含义：
### 《1232EACos20新版_manual.pdf》
 《curtis 科蒂斯-1220--电动转向助力控制器说明书.pdf》
注意：修改参数时，应该注意电机整定产生的参数，可以直接按照下面 4.1 和 4.2 进行操作
## 相关参数请看表格：
## 《行走电机参数-比较》
## 《转向电机参数 - 比较》
### 4.1 行走电机的参数的设定
### 4.1.1 修改低电量模式参数
### （1）BDI Lockout Level 改成 0%
（2）将 Low BDI Mode 下面的参数 Max Speed Low BDI 改成驱动器 motor 下的 Max Speed 的大小
例如：驱动器中最大的转向速度是 4000rpm,如图 4.1.1：
1653561979986-71bd72a2-0c2d-4e45-a083-d1d0206cf924.png

例如：驱动器中最大的转向速度是 2000rpm，有的驱动器中含有
## BDI Alam Level
BDI Lockout Level参数可以按照这个参数来设定，如图 4.1.2：
1653561980030-e1c3436e-68c3-4ccb-8d5c-e22abe1468c9.png

Max Speed Low BDI 改成最大值 4000rpm，同时把 BDI Lockout Level 改为 0%
### 如果有 BDI Alarm Level 也改成 0%
### 注意此处不要在低电量限速，会影响到运动的精度和响应的性能
### 4.1.2 修改行走跟随性能相关参数
（1）0-Speed Mode Express 下 kp、ki 值的设置
1653561980411-c04d79ad-a0c1-408d-a1fe-7af3d9aa8160.png 

## 或者发现启动和停止发生抖动的现象
1653561980371-e656455c-372f-49c6-846b-e53996a30c36.png

## 注意：
（1） 若是发现跟随性能不好，可以尝试增大 KP 的值【可以将 Kp 设置成 50%，ki 50%】
（2） 若是发现车辆在停止启动的时候出现抖动的现象，可以尝试增大 KI 的值。
切记：由于 rebote-CDD 车型使用 kp 30% Ki 30% 参数组合会出现：车辆阻挡后启动车辆抖动的情况，现将 Kp 值该为 20%
### 4.1.3 修改电流限制
### 将此处的电流的限制放开,如图 4.1.5：
1653561980464-bff6c5ce-8f95-4859-81c0-dbdec1b1d45a.png

### 4.1.4 PD max Current 参数设定
1653561980674-4dca6b3d-7e10-4802-83e6-291adff64f21.png

在制定协议的时候，规定下降的是 0~255 对应的下降比例阀的最大开度，
【注意：林德 1298 协议为 0~1000，这里会影响到下发速度的精确性】0~255 对应了比例阀的 PD min Current~ PD Max Current。 PD max Current 的值是流过比例阀的电流。
【瑞博特 CDD14】SP08-20 型号的比例阀的电流范围是 0.2~ 0.63A（大致）
注意：检查林德 L14-1298 方案的 PD max Current 是 0.6A
 瑞博特 1232E 驱动器的 PD max Current 可以调整为 0.7A
1653561980610-18ed8d84-30d6-4cc6-a2f0-9c2c71060bcf.png

### 4.2 转向电机的参数的设定
我们在修改参数之前要确认客户的转向电机的转向角度是 ±90° 还是 ±120°！！！！！！！
### 4.2.1 修改角度映射相关参数
 若是 ±90°，需注意下面的 Left stop（deg）保持 -90°、Right stop（deg）的值保持 90°。只关注 p3 Input、p3output（deg）和 p4 input 、p4output（deg）
**注意此处的值，对应于不同的电机，但是 P3 Input 的值会影响转向 0 位的精度。如图 4.2.1
1653561980962-5add2d00-c9a8-4269-96ac-f122ca2141b9.png

### 4.2.2 调节回零的速度和时间
建议将 Homing Speed 修改的小一些为 10%，Homing Timeout 时间设置为 20s，这样可能回 0 的时间可能长一些，但是精度会高一些。，如图 4.2.2
我们建议客户的舵角电机能够转向 ±120°，若是达不到 120°，在转向的过程中有可能会出现误差，此一点需要明确！！！选择范围是 ±120°之后，homing direction mode 才能选择 0~3
1653561980964-12f7871c-f02b-4e86-ab69-ef46bc07fde3.png

### 4.2.3 调节 1220C 转向电机跟随性和超调效果的验证方法
谨慎修改：不同叉车类型的响应的性能是不同的，是按照不同的叉车进行的操作
### （1）打开 1314 上位机软件，点击连接按钮
1653561981010-bf80a408-9b91-41b1-9124-4466dc4046cf.png

## 如图 4.2.3：
1653561981331-d0f2dd14-70d5-4495-ab86-8dbc63331a96.png

（2）连接好之后打开 paramters-》program-》Motor Control Turning ，如图 4.2.4
1653561981381-e2366a4a-5685-47f3-be15-69679f802d50.png

## 修改 position Kp
## 修改 Velocity Kp
## 修改 Velocity Ki
### （3）修改相关的值，到 roboshop 界面上面进行验证
### 例如：操作转动舵角 90°，如图 4.2.5：
1653561981312-1452a347-996b-402e-b312-0df35ddb1e41.png

注意观察：下图中角度反馈的数值，最大的数值为多少？记录相关的数值 ，如图 4.2.6：
1653561981360-c55eeb49-c823-4f44-9fc2-c0a8aa7f03cb.png

（4）  重复第 3、4 步，直到找到一组数据跟随性好，超调量好的数据
## 完成记录表格

## Position KP

## Velocity KP

## Velocity Ki

## 超调最大角度

## 1

## 67

### 17.9

### 7.9

### 90.9

## 2

## 100

## 30

## 8

### 90.5

## 3

## 70

## 30

## 8

### 90.5

## 4

## 70

## 30

## 8

### 91.1

## 5

## 70

## 50

## 10

### 90.5

## 6

## 70

## 70

## 10

### 90.5

## 7

...

## 8

## 100

## 30

## 15

## 90

（5）重复第 4 步，直到找到一组数据跟随性好，超调量好的数据，我们一般重复几组数据完成相关的参数的确定 。
我们默认的参数是  Position Kp 100% Velocity Kp 30% Velocity Ki 15% ，
但是要 注意不同叉车的相关的参数不相同的要根据实际的车体进行测试和验证。
（为了保证减少舵角的超调！！！！！ 将上面的 Velocity Ki 设置成 15%）
## 注意：
（1）不同叉车的相关的参数不相同的要根据实际的车体进行测试和验证
（2）如果叉车的转向角度达不到 ±120°，可采用其他的角度检验参数的超调性。
（3）若是发现车辆转向时角度跟随性能超调较大，可以适当减小 position kp 的值
### 4.3 相关修改的参数参照附件表格
 https://seer-group.coding.net/s/8285d162-dedf-4c18-be8e-a72790af92d2
### 4.4 转向电机的测试方法补充
（1）根据 4.2.3 的测试方法，得出一个较好的 position Kp、Velocity Kp、Velocity Ki 组合后，通过 roboshop 分别下发 -90°、90°、0°、45°、-45°，5 个角度，观察 roboshop 的返回角度

## 序号

## 初始角度

## 结束角度

## Roboshop 返回角度

## 角度误差

## 1

## 0

## 45

## 2

## 45

## 0

## 3

## 0

## 90

## 4

## 90

## 0

## 5

## 0

## -45

## 6

## -45

## 0

## 7

## 0

## -90

## 8

## -90

## 0

（2）若都能达到，则通过。若不能达到，
<1> 检查转向电机配置中的角度Map映射是否正确，参照 4.2.1
<2> 部分角度能够达到，部分角度达不到，怀疑1220C 有问题
<3> 若所有的角度都达不到，检查 1220C 的参数，核实编码器线数和减速比
## 注意：以下说明
<1> 转向的时候，从 0° 转到 90°，发现转角到 90.1° 或者 89.8°，误差 0.1~0.3 度，考虑编码器的问题。
<2> 转向的时候，0° 正常，90° 正常，但是例如转到 45° 的时候，返回的角度确实 53°（误差大于 1°）
## 可能会有 3 部分的原因：
## ①模型文件配置的问题
### ②1220C 文件的 map 映射的问题
## ③1220C 坏了
