# 林德LAB驱动器适配说明

## 林德LAB驱动器适配说明

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.07.09

## 新建文档

## 使用中

## @潘俊
## 适用范围
本文适用于Linde（林德）使用LAB驱动器的叉车。
## 针对读者：机器人交付工程师，测试工程师
文档目的：记录LAB驱动器测试过程中遇到的问题以及相应的解决办法，为后续LAB驱动器的适配提供便利。
## 车体环境说明
本次车体为供应商【宇峰】提供的Linde（林德） L16车体，具体的控制器参数如下
## 控制器型号：SRC-2000
## RBK版本：v3.4.6.17 或以上
### Roboshop版本：v2.4.1.174 或以上

注：需要确保RBK版本在3.4.6.17或以上，才能保证控制器能适配LAB驱动器
       Roboshop版本需要保证在v2.4.1.170或以上才能连接当前rbk版本的控制器
## Model 文件配置说明
## Motor部分的参数说明如下：

## Key

## Description

## Value

## Unit

## x

## 驱动器安装的X坐标

## 根据实际安装位置填写

## m

## y

## 驱动器安装的Y坐标

## 根据实际安装位置填写

## m

## yaw

## 驱动器安装的朝向

## 根据实际安装位置填写

## 度

## canID

## 驱动器的的CANID

## 根据驱动器上位机配置决定

## maxRPM

## 驱动器最大转速

## 根据电机参数填写

## RPM

## encoderLine

## 编码器线数

## 根据电机编码器参数填写

## canPort

## 驱动器使用的端口

## 根据实际接线填写

## brand

## 驱动器品牌

### Linde-Lab-AWG-CANOpen

## wheelRadius

## 轮半径

## 根据实际情况填写

## m

## reductionRatio

## 减速比

## 根据减速机构参数填写

## inverse

## 反向

## 一般左电机转向为方向

注：减速比、编码器线数、电机最大转速、驱动器品牌需要根据选用的实际填写； 编码器线数可以通过驱动器调试软件查看电机编码器参数配置
## 配置XY坐标（L16车体为例）
由于采用的是Linde（林德） L16车体进行测试，该车体为舵轮偏置的车型，具体的坐标如下：
f94b2e4a-eac4-40ff-9220-1cb6d413806e.png

但是由于本方案的控制逻辑是我们发给LAB数据来控制叉车舵角，在LAB里下发角度和反馈角度，都是虚拟中心轮角度，不需要我们转成偏置轮角度，可参考coding：
https://seer-group.coding.net/p/test_center/bug-tracking/issues/3396/detail
所以在LAB方案下，机器人模型中的Motor位置配置为【居中】即可，此时Y坐标为0，只需要考虑X坐标，为了保证车体的旋转中心，X坐标的值应该是下图OA的长度
## image.png

## 配置电机参数（L16车体为例）
下图是Linde（林德）提供的L16车体的电机参数，可以根据下图进行机器人模型文件中的Motor配置
470e33e8-eba9-4831-96b4-544d1bd7a40b.png

## 叉车标定
## 确认固件
需要确认控制器固件版本为SRC2000_2.1.113.sc2.bin或以上

### SRC2000_2.1.113.sc2.bin
## 标定步骤
可以根据单舵轮叉车半自动标定3.4.6.12方法来进行舵轮和激光的标定。
## L16车的标定过程可参考coding：
https://seer-group.coding.net/p/test_center/bug-tracking/issues/3360/detail
## 确保车体的重复到位精度
## LAB需要开启PI算法功能
### 该功能需要联系Linde（林德）的售后过来修改

### Linde Flasher 刷写说明.pdf

## PI算法打开流程.xlsx
## 可以开启MPC功能
### 需要将rbk版本更新至v3.4.6.1802（或以上)
在Roboshop中修改控制器参数：LQRMode = true，MPC_DELAY = 100， MPC_Q_ANGEL_2 = 0.3，MPC_PENA_DIST = 2, MPC_PENA_ANGLE = 50, MPC_PENA = 50
修改参数后，车体的MPC功能启动，重复到位精度良好，可参考coding：
https://seer-group.coding.net/p/test_center/assignments/issues/3363/detail
## 额外说明
## 固件重启导致的电机报错
### 报错场景：标定步骤结束、更新固件、更新RBK整包后等情况下
## 报错内容：S378、T226、S208
原因：由于Linde（林德）叉车的CRC校验严格，不允许错乱和断联，但是我们控制器固件重启时，stm32协议层会从头开始发送报文，且重启过程中不发送报文；这将触发林德叉车对AGW的通讯校验异常，导致电机处于告警状态。
### 解决办法：拧动钥匙开关断电重启后可消除LAB的报错
### 企业微信截图_17140143292769(2).png

## 叉车无法移动
### 报错场景：叉车刚开机、重启电机后等情况下
## 报错内容：T442
原因：由于Linde（林德）叉车的安全设置，需要在开机后进行身份认证，认证通过后才能移动叉车。
解决办法：将车体附带的身份卡在【③刷卡】位置识别一下即可（此时左侧的状态指示灯会由红色改为绿色）。
## LAB驱动器报错码
LAB驱动器报错码如下，若报错码不在文档范围内，需要联系Linde（林德）的售后人员进行咨询。
## 林德故障码
