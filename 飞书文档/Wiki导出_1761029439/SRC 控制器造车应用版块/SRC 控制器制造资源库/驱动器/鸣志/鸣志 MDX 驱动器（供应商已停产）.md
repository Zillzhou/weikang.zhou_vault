# 鸣志 MDX 驱动器（供应商已停产）

## 鸣志 MDX 驱动器（供应商已停产）

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 该型号已停产，不能做新的造车选型推荐

## 已弃用

## 说明

本文档针对机器人改造过程进行规范，使公司产品符合行业标准，保证产品质量稳定，使技术人员在进行改造过程中有章可循。

机器人自动化改造涉及传感器众多，建议采用我司标准核心控制器线束 TE23、TE35，本文档以核心控制器标准线束为蓝本进行作业指导。

鸣志伺服驱动器选型建议参考公司的 SRC2000 选型指导手册。

本文档只适用于改造参考，不可作为技术协议及其他承担责任的内容。
## 一、适用范围

本技术规范适用于公司使用鸣志驱动器进行自动化改造的研发、生产、调试的技术人员。
### 二、调试资源

## 200W 固件如下：

MDX 107f(d) IP20 20201103 for XianZhi.elf.E

## 400W 固件如下：

MDX 108b(f) IP20 20190422 for XianZhi.elf_400W.E

## IP65 200W 固件如下：

MDX 108b(f) IP65 20191128 for XianZhi.elf.E
### 三、改造和安装
## 进行改造（底盘驱动器部分）

## 1.驱动器需要与车体进行可靠固定。

2.当机器人安装有多个驱动器(数量 ≥2)时，所有从站的 CAN_L,CAN_H 引脚直接相连即可，采用串联方式接线，如图 4.3.1 所示；将 Driver4 最终引出的 can_H 压入一个德驰插筒连接器，同理将 can_L 压入一个德驰插筒连接器，接入德驰 DT06-4S 公头。最后与 T35 中的 32,33 号线（can1）相连；

1677571807746-b6d2e279-f176-4187-a635-f69f07d2defa.png

## 图 3.3.1

3.为保证 can 通讯质量，需要将距离核心控制器最远的驱动器上的 120Ω 终端电阻打开，如上图4.3.1 中安装 Driver1 驱动器上终端电阻；其他 Driver2,3,4 的终端电阻关闭，安装终端电阻如图 4.3.2 所示；

1677571823195-cf4a9ca6-8d99-4804-bfd4-fc41845a527d.png

## 图3.3.2

### 4.终端电阻是否正确打开的检测方法：

关机断电,断开驱动器和控制器的 CAN 连接线（如图 4.3.1 中 Driver4 和控制器之间的位置），使用万用表电阻档测量驱动器侧的 CAN 总线上 CAN_L,CAN_H 之间电阻，电阻值为 120Ω 则正确，如图 4.3.3 所示。电阻值明显小于 120Ω（如 60Ω），则说明至少有两个驱动器打开的终端电阻。

断开图 4.3.1 中 Driver1 和 Driver2 之间的连接线，使用万用表电阻档测量 Driver1 侧的 CAN 总线上 CAN_L,CAN_H 之间电阻，电阻值为 120Ω 则正确，如图 4.3.3 所示。如果电阻值明显大于 120Ω（如几 KΩ)，则说明终端电阻打开的位置不在 CAN 总线末端，需要调整。

1677571838887-8cf197cb-3dbc-418e-a080-eaf696721fc8.png

## 图 3.3.3

5.公司适配的鸣志驱动器采用控制电机是否使能的方式来实现急停与否的功能。电机是否使能可以通过控制驱动器上相应 IO 口电平高低的方式来实现（目前适配 IO 口 x5 作为电机使能信号，高电平是驱动器自提供的 +5V）；

1677571859588-0496983a-2592-42fc-8308-0c51cdaa21f4.png

## 图 3.3.4

### 四、驱动器配置

### 4.1 鸣志电机 DSP 固件烧录方法

## 1.在主界面中选择 232 在本机的正确 Com 端口，232 另侧插入驱动器 COM1，在工具下拉菜单中选择固件下载。

1677571879832-f03a9271-064c-4443-b5e8-848895e9a3ed.png

### 2.在固件下载界面中选择固件文件加载后，右侧 Rev. 将显示版本信息，可以验证版本是否正确。

## 200W 固件如下：

MDX 107f(d) IP20 20201103 for XianZhi.elf.E

## 400W 固件如下：

MDX 108b(f) IP20 20190422 for XianZhi.elf_400W.E

## IP65 200W 固件如下：

MDX 108b(f) IP65 20191128 for XianZhi.elf.E

1677571901470-9cac601e-739e-49cb-ab74-343360084960.png

### 3.在 udpconsole 中输入 reset,给驱动器重新上电，等待 3 秒钟。

### 4.点击下载，等待进度条完成。重新给驱动器上电，即完成DSP固件的更新。

### 5.完成驱动器 DSP 固件的更新后，需要对驱动器重新初始化，关闭 Artemis 软件，打开 SCL Utility 软件。

### SCL Utility2.6.31.rar

### 6.选择 ii 相应的 Com,重上电驱动器，测试 Devices Detected 窗口会有型号出现则表示连接成功。

1677571923107-98038131-fa78-47aa-aae8-3e4c8049b92e.png

### 7.在 Command 窗口中输入 RF1234 回车，SA 回车即可完成初始化。

### 8.此后需要重新设置所有参数，包括通信参数，PID 参数及其他参数。

### 4.2 鸣志电机 ARM 固件烧录方法（CANopen）

## 1.关闭 RBK（robodpro 最好也关掉）。

### 2.打开 udpconsole,输入 reset,保证 can 总线上没有数据，但是挂有 120ohm 的电阻。

3.将 USB 转 232 模块连接至电机驱动器，打开 artemis,在 udpconsole 中输入 reset 重启电机驱动器，当有界面跳出时点击“是”，可以看到以下界面。

### Artemis-Setup-1.0.19.0410.rar

### 4.将 ID 设为 1,波特率设为 1Mbps,然后下载到驱动器，这一步详细请看鸣志电机调试方法。

1677571943513-bd8a091d-3d98-4010-963d-f57c698eb391.png

### 5.拔掉 USB 转 232 ,在 udpconsole 中输入 reset,重启电机。

1677571961113-bc00c37b-3ba4-4e02-a2f3-c88335eaec4a.png

### 6.将 kvaser 连接至电机上的 com1,将 120 欧姆电阻小插件插入 com2。

7.打开 CANopen Firmware Download ，选择 kvaser。NodeID 选择 1 ,这里波特率实际是固定的，也就是 1Mbps ,选择固件，点击 open,最后点击 start ,按照提示下载固件。

CANopen Firmware Downloader Setup 1.0.16.1103.rar

## 当前ARM固件为

AMA_K10_CANopen MDX 213i(20210914) for XIANZHI.hex

1677571977629-b58dcd6d-4daf-47eb-afc7-5b8fe58c4743.png

### 8.最后，请参考鸣志电机调试方法，将电机 CANopen ID 改为相应的值，电机波特率改到 250Kbps。

### 4.3 鸣志电机通信参数配置

先不要急着给电机上电，请检查电源线是否连接良好，急停线是否按规定连接，我在调试接线的时候发现急停线容易松，尽可能选用合适粗细的线材。

检查完了之后将做好的调试线连接到电机 com1 上，打开软件可以看到如下界面，可以正式开始调试。

## 1.选择正确的 com 口。

1677572013861-4ed80a12-ed0e-4d8f-8369-754729416182.png

电机上电，这时请注意，上传命令只有在电机上电的时候有效，所以在上电的时候要快速电机下图中的“是”。

1677572029725-e7c7a63d-7651-4b76-9750-73841a8a247d.png

这时你就能够看到电机当前的基本参数了，我们只要操作几个基本命令就好了操作顺序如下：

设置为 CANopen 协议；
设置 ID、一般我们差动车右轮 ID 为 1，左轮 ID 为 2;
设置波特率，我们统一设置为 250k；
勾选不适用位置误差报警阈值；
点击下载到驱动器按钮，等待下载完成后重启驱动器。 
1677572049495-e0a27385-6e42-422e-9c9d-649da69a468b.png 

1677572067031-7bae52f0-2ac9-4060-8a14-04fc2b672110.png

这里由于电机和驱动一体化设计的原因，调试过程少了很多步骤，当前文档仅支持200w的驱动器。

### 4.4 鸣志电机读取 ARM 及 DSP 版本

## 1.通过 kvaser 连接（注意 120 欧姆电阻），打开 Canopen test tool 工具。

### CANopen Test Tool.zip

### 2.波特率可以根据设置的进行修改，ID 也是如此。

### 3.点击 Open 即可收到报文，同时如图会显示 ARM 版本及 DSP 版本。

1677572096221-8df5930c-5168-4b99-8701-4766510bb483.png

### 4.5 鸣志 200w 电机参数配置

首先按调试方法将 artemis 连接到驱动器上，然后在绿色的框中输入以下指令。

1677572120046-ce7f06c7-c785-4f2f-ad0c-726a80dadd93.png

### 指令1：VI100      //速度环积分调整

### 指令2：VP12000    //速度环比例调

### 指令3：KI10      //位置环比例调整

## 指令4：JM2     //速度模式

### 指令5：ZV0.3     //零速阈值

### 指令6：ZF5000    //速度滤波

### 指令7：PD20        //修改电机到位编码器阈值

### 指令8：PE800      //修改电机到位时间

指令9：LV200         //修改电机低电压报错阈值

## 指令10：PM2     //上电状态

### 指令11：SA         //保存数据

### 指令12：RE         //重启驱动器

## 断开 USB 转 232

### 4.6 鸣志 400w 电机参数配置

首先按调试方法将 artemis 连接到驱动器上，然后在绿色的框中输入以下指令

1677572170668-196de589-f2bc-49a2-b437-9b6f684cf671.png

### 指令1：VI120      //速度环积分调整

### 指令2：VP32767   //速度环比例调整

## 指令3：JM2     //速度模式

### 指令4：ZV0.3     //零速阈值

## 指令5：ZF5000   //速度滤波

### 指令6：KI10   //PID积分调整

### 指令7：EG32000   //电子齿轮调整

### 指令8：PD20        //修改电机到位编码器阈值

### 指令9：PE800      //修改电机到位时间

指令10：LV200         //修改电机低电压报错阈值

## 指令11：PM2   //上电状态

### 指令12：SA         //保存数据

### 指令13：RE         //重启驱动器

## 断开 USB 转 232

### 4.4.7 鸣志 IP65 200w 电机参数配置

首先按调试方法将 artemis 连接到驱动器上，然后在绿色的框中输入以下指令:

1677572200032-ab4a6796-c733-4fa0-a18d-e44a86e4f7f6.png

### 指令1：VI100      //速度环积分调整

### 指令2：VP12000    //速度环比例调整

### 指令3：KI10      //位置环比例调整

## 指令4：JM2     //速度模式

### 指令5：ZV0.3     //零速阈值

### 指令6：ZF5000    //速度滤波

### 指令7：EG10000   //电子齿轮调整

指令8：PD20         //修改电机到位编码器阈值

### 指令9：PE800      //修改电机到位时间

指令10：LV200         //修改电机低电压报错阈值

## 指令11：PM2     //上电状态

### 指令12：SA         //保存数据

### 指令13：RE         //重启驱动器

## 断开 USB 转 232

注：IP65 200W 电机是磁编，电子齿轮调整默认 10000，机器人模型里驱动器的编码器线数为 2500。

### 五、机器人模型配置说明

### 根据电机及减速实际情况配置行走电机参数：

注：这些参数需根据驱动器及选用电机及减速机的实际进行填写；

1677572224223-8bfa2049-8809-456c-b5e9-5ea8691cb136.png

## 图 5.1

注：减速比、编码器线数、电机最大转速、驱动器品牌需要根据选用的实际填写。

鸣志 200w 电机编码器线数：1024；

鸣志 IP65 200W 电机编码器线数：2500；

鸣志 400w 电机编码器线数：8000。

### 六、驱动器的功能检测

## 1.在整车组装完成未安装外壳前，请再检查一遍接线确保接线正确。

2.将车体加高，使轮子离地。开启机器人，使用网线连接机器人。使用 Roboshop 软件操作机器人让轮子转起来。 使用 CanScope 夹在 CAN 总线上检测 CAN 报文至少 1 小时，CAN 报文无错误。

### 3.让车体着地，使用 Roboshop 软件操作机器人做运动动作:向前，向后，向左，向右运动。

4.未拍急停按钮前，推动机器人，无法推动（电机使能），检查 Roboshop 中机器人状态处于“未急停”“驱动器未急停”，如图 6.1 所示；所示拍下急停按钮后，再次推动机器人，可以推动（电机使能释放），检查 Roboshop 中机器人状态处于“已急停”，“驱动器已急停”，如图 6.2 所示。

1677572241353-be77be24-16ef-40ba-88ab-e686778db50b.png

## 图 6.1

1677572260180-91c69fe4-82a5-403c-af84-54207c1c16f1.png

## 图 6.2

### 5.任务链运动老化测试 24H，查看 Robokit Log 无错误报警。

### 七、附录

### 7.1 致远 CAN Scope 使用方法

## 1.软件安装--安装 CAN Scope 配套软件 CANScope。（软件及使用手册请联系致远厂商售后）.

2.硬件连接--参考 CAN Scope 使用手册接好电源，USB 调试线，插上 CAN Port 板,将 CAN_H 接到 SRC2000 外接线束 TE35 33 号线上，将 CAN_L 接到 SRC2000 外接线束 TE35 32 号线上 USB 调试线插在电脑上。

3.打开软件 CANScope，选择【Port 板】，取消【启用终端电阻】，选择【报文】，配置【波特率】为 250Kbps,取消【总线应答】，选择【开启】，CAN 报文实时如图 7.1.1所示。

1677572278768-4289aea4-9072-4d5c-93d3-31a9d7febe5f.png

## 图 7.1.1

### 4.选择【状态】【错误】，检查是否有错误报文。如图 7.1.2所示：

1677572298661-1ef82fe4-591d-4b78-9cc5-4e0c7d55ae5b.png

## 图 7.1.2

### 7.2 USB CAN 卡使用方法

## 1.软件安装—安装软件 USB_CAN Tool（软件及使用手册请联系 CAN 卡厂商售后）.

2.硬件连接—准备 USB CAN 卡和连接线，将连接线 CAN_H 接到 SRC2000 外接线束 TE35 33 号线上，将连接线 CAN_L 接到 SRC2000 外接线束 TE35 32 号线上。如图 7.2.1 所示。

1677572312143-e41ca8ec-d261-4272-a447-c74c8c0b086e.png

## 图 7.2.1

3.打开USB CAN tool ,选择【设备操作（O）】【启动设备（S）】,确认CAN参数，【波特率】为250Kbps,选择【CAN通道号】为通道1,点击【确认】。如图 7.2.2所示

1677572324227-7a314509-e0b8-47ad-a09a-713e7b3286de.png

## 图 7.2.2

### 4.选择【显示（V）】，取消选择【合并相同 ID 数据(M)】，CAN 报文如图 7.2.3 所示。

1677572353889-da878f70-136f-4502-ad76-b99ed721e58d.png

## 图 7.2.3

### 7.3 udpconsole 使用方法

udpConsole 是我司工程师用于调试 bug 开发的小工具，可以检查到固件上报的错误信息。

## 1.打开 udpconsole 工具前需用网线确保电脑与机器人的物理连接。

### 2.打开 udpconsole，进行驱动器功能测试，时刻检查 udpconsole 显示内容。

### 驱动器通讯过程中出现错误帧如图 7.3.1 所示：

1677572376716-0318c159-569e-4609-a917-ead73885ed26.png

## 图 7.3.1

### 八、驱动器常见错误码

## 举例：

## 1.0x8040，为 low voltage，应该为驱动器参数中的低电压参数未修改。

### 2.0x8080，为 over current

### 3.0x8，为 over temp 过温。

### 4.0x6310 是 2000+4000+0200+0100+0010 这个组合

1677572404252-f9229023-2d07-4709-b508-640b08f99808.png
