# 鸣志 MBDV 驱动器

## 鸣志 MBDV 驱动器

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 语雀迁移飞书

## 使用中

## 说明

本文档针对机器人自动化改造过程进行规范，使公司产品符合行业标准，保证产品质量稳定，使技术人员在进行改造过程中有章可循。

机器人自动化改造涉及传感器众多，建议采用我司标准核心控制器线束TE23,TE35,本文档以核心控制器标准线束为蓝本进行作业指导。

该文档适用鸣志MBDV系列伺服驱动器，具体选型建议参考公司的选型指导手册。

注：本文档只适用于改造参考，不可作为技术协议及其他承担责任的内容。

## 一、适用范围

本技术规范适用于公司使用鸣志MBDV-520AC系列驱动器进行自动化改造的研发、生产、调试的技术人员。
### 二、调试资源

## 驱动器相关手册：

CANopen UserManual_CN202111.pdf
## 驱动器配置软件：

### Luna-Setup-2.1.21.0820.zip
## 三 、改造和安装
### 3.1类Kiva顶升部分DI使用规范

### 3.3.1 接线说明

## 顶升部分 DI 使用规范

## 序号

## DI

## 功能

## SRC 线号

## 1

## DI2

## 顶升下限位开关信号

## T23   6 号线

## 2

## DI5

## 顶升上限位开关信号

## T23   7 号线

## 3

## DI6

## 旋转零位信号

## T23   5 号线

注1:在顶升车上这三个DI不能作为其他其他用途；

注2：确保这三个传感器的均为NPN型，发出的信号能被SRC核心控制器检测到。

### 3.2 进行改造（底盘驱动器部分）

### 3.4.1 行走电机驱动器安装方式

## 1.驱动器需要与车体进行可靠固定，检查驱动器与对应电机的三相线、编码器线路连接正确；

2.当机器人安装有多个驱动器(数量≥2)时，所有从站的CAN_L,CAN_H引脚直接相连即可，尽量采用串联方式接线，如图4.4.1所示；若驱动器仅提供一个通讯接口，无法完成驱动器的can 线串联时，则将所有驱动器can线引出后把所有can_H压入同一德驰插筒连接器，将所有can_L压入同一德驰插筒连接器，接入德驰DT06-2S公头，最后与TE35中的32、33号线（can1)相连.

由于部分驱动器没有提供级联接口，只能通过从总线上接引线的的方式来串联，这里引线的长度需小于10CM.

注：在改造过程中若由于驱动器连接所需要的线束数量不足，无法实现在驱动器端进行快速串联，可采用图 4.4.2 所示连接方式，但不推荐。

1677659494081-b8285249-fc73-4acb-ae91-031dbd7a29d2.png

## 图3.4.1  图3.4.2

为保证can通讯质量，需要在距离核心控制器最远的驱动器上或总线末端安装终端电阻（阻值一般是120ohm).（注：客户可在购买驱动器时向驱动器厂商提出购买配套终端电阻）

### 3.CAN终端电阻是否正确打开的检测方法：

关机断电，断开驱动器和控制器的CAN连接线（如图4.4.1中Driver4和控制器之间的位置），使用万用表电阻档测量驱动器侧的CAN总线上CAN_L、CAN_H之间电阻，电阻值为120Ω则正确，如图4.4.3所示。电阻值明显小于120Ω（如60Ω),则说明至少有两个驱动器打开的终端电阻。

断开图4.4.1中Driver1和Driver2之间的连接线，使用万用表电阻档测量Driver1侧的CAN总线上CAN_L、CAN_H之间电阻，电阻值为120Ω则正确，如图4.4.3所示。如果电阻值明显大于120Ω（如几KΩ),则说明终端电阻打开的位置不在CAN总线末端，需要调整。

1677659511129-4f4135f8-3013-42c8-958a-fa44195cdffb.png

## 图3.4.3

4.鸣志MBDV驱动器STO（急停）接线图如图 4.4.4 所示，将所有驱动器的 SF1+、SF2+并联后接入DCDC 24V+ 输出；将所有驱动器的SF1-、SF2-并联后连接 SRC2000 急停输出 1+(TE35 4 号线），将另一根急停输出 1-（TE35 5 号线）连接 DCDC 24V- 输出 ; STO接线说明见附录。

1677659527468-eaab1ccd-1020-49c5-acff-89e8aecf726f.png

## 图3.4.4

注：TE35 的 4 号和 5 号线标无正负之分，为一组干触点，在实际接线中可以不用区分其正负。

### 5.抱闸接口，如果需要使用到驱动器上的抱闸输出口控制电机抱闸，必须给驱动器辅助电源（AUX）供24V电，这样抱闸输出口才会正确输出电压

1677659547138-56350d4b-90a6-4db3-9dc5-6c34e410aef9.png

### 四、 驱动器参数配置

### 4.1 驱动器调试

### 4.1.1 工具：

## mini-USB 数据传输线

1677659566190-5429b86c-1463-42c4-9ddc-cf913580a103.png

## 驱动器相关手册：

CANopen UserManual_CN202111 (1).pdf
### 4.1.2 连接上位机，上传当前参数

1677659583278-4031e642-0bc1-46b7-9184-fb77665c13cf.png

1677659599442-eaf43249-b1b6-437a-b740-70a02aaa3bfa.png

### 4.1.3 基本参数：修改ID、波特率、配置看门狗触发时间和触发行为

### 如果支持拨码配置ID，拨码配置优先级高于软件设置

1677659615023-49353700-f5d3-4102-a6d3-71c874f7431a.png

### 4.1.4 减速停车：“AM值”对应【通用】-【伺服刹车减速度】，如无特殊需求，使用默认值即可；如果需要用到该功能，请根据现场情况合理配置该参数，

1677659637301-130ae1b9-84d3-4725-ad1f-42e00f4e9e8d.png

### 4.1.5 动态刹车：鸣志MBDV提供“动态刹车”功能，启用动态刹车可以使电机更快速停车，以下配置为参考，可以根据现场需求设置

1677659951530-7039db71-7aba-4bfd-9b03-165f7e56e1b5.png

### 4.1.6 急停功能：配置急停功能

1677659970383-9a75238c-517a-4e9b-bf08-12936d087cfe.png

### 4.1.7 设置抱闸逻辑：使能解闸，去使能抱闸

1677659989282-0047b041-ea1a-47ea-92d5-ee18c209bd21.png

4.1.8 电机转一圈脉冲数（count值）配置，默认10000，模型文件【encoderLine】配置参数是电机转一圈脉冲数除4，如下图encoderLine = 10000/4 = 2500；如果驱动器该处参数修改，模型文件配置参数需要对应修改

1677660012384-15c935dd-beed-45ae-9d9e-056263b85662.png

1677660027553-477740ad-cb54-43d7-b797-2d4237beb524.png

4.1.9 保存参数： “Luna”软件版本是1.1.21.0528（包括以前版本），修改完参数需要发送“SA6“令才能保存修改的参数，输入”SA6”按回车，如果是1.1.21.0528以后版本，忽略该步骤，版本判断方法如图4.5.5.1

1677660044658-0adaa8b5-534c-4663-b219-e9d87faae02d.png

## 图4.5.5.1

1677660064277-7659164a-7bbf-4bf3-9670-35e0d79e15a8.png

## 图4.5.5.2

1677660083823-f5b6d9a4-48e9-4e00-9c7a-4f5a07a5cbbb.png

### 4.1.10 以上参数重启后生效；重启后再次读取一下对应参数2，防止修改失败

### 4.2 驱动器固件烧写

### 4.2.1更新准备

## 1 调试线：

## mini-USB

1677660101207-ba8fa849-2332-4ca8-ae14-f153388c327c.png

## 2 使用软件：

Luna-Setup-2.1.21.0820 (1).zip
### 4.2.2 更新步骤：

## 1、连接软件

使用mini-USB链接驱动器和电脑，打开软件，找到固件下载

1677660116745-d0c4955d-a331-46fa-b1af-2146191c9776.png

### 2、开始下载固件

1677660132054-9ddaf75e-1388-46cf-91e7-abeb39aa8e3e.png

### 3、完成升级

## 升级完成后给驱动器重上电

### 六、 FAQ

### 6.1 ID无法修改：

检查是否是拨码设置了ID，拨码优先级高于软件设置，如果想使用软件配置，请将拨码开关ID部分全部拨到off

### 6.2 看门狗报错无法消除
先排查通信是否正常，如果驱动器通信正常，且无法消除看门狗报错，检查看门狗配置，把触发选型勾选为【同步报文】，其余【RPDO】都取消勾选
1677660150459-1e3f2527-4d2e-4fab-a5a8-15183495dad3.png

## 七 、 附录

## 7 .1 通讯端子引脚分布及定义

1677660165847-e8cafcb0-35e4-4aad-91e8-0851b6d24f18.png

## 7 .2 STO（急停）线序

1677660181416-2efd8b2d-eb74-4367-84bf-8711a4150b0f.png

## 7 .3 驱动器拨码开关使用方法

## 以MBDV-520AC驱动器为例：

SW1、SW2、SW3设置ID，支持设置1~7，如果需要以上的设置，请将这三个拨码全部拨到off后使用软件设置ID

### SW4设置波特率，拨到off，使用软件设置波特率

### SW5设置终端电阻，拨到ON启用终端电阻

1677660202533-691da55f-6c98-46c1-a7bb-0b3d47527e83.png

### 7.4 USB CAN 卡使用方法

软件安装—安装软件USB_CAN Tool（软件及使用手册请联系CAN卡厂商售后）。
硬件连接—准备USB CAN卡和连接线，将连接线CAN_H接到SRC2000 外接线束TE35 33号线上，将连接线CAN_L接到SRC2000 外接线束TE35 32号线上。如图8.3.1所示。

1677660219617-adf73654-e566-4771-a3f1-3eba73559f7a.png

## 图 7.4.1

打开USB CAN tool ,选择【设备操作（O）】【启动设备（S）】,确认CAN参数，【波特率】为250Kbps,选择【CAN通道号】为通道1,点击【确认】。如图8.3.2所示：

1677660237321-17aa90f4-dead-4ec4-a8bb-4b8b35451798.png

## 图 7.4.2

选择【显示（V）】，取消选择【合并相同ID数据(M)】，CAN报文如图8.3.3所示。

1677660254798-9a1301b0-2571-4a12-9de2-b44483a8ec7d.png

## 图 7.4.3

## 八 、驱动器常见错误码

### 8.1 错误码
## 方式一：
1687141997844-3660f2d3-36f4-48de-99e5-5aab847b6059.png

1687142013850-836b2ad3-9d2c-4a0d-aa3a-a5afc3b55789.png

1687142034123-dcfb6f29-c98c-4bdb-b51d-7e0fd4ac2660.png

1687142058424-77ba8b17-e571-43bb-b22c-c6e7da7002e9.png

1687142067384-a6fee6ab-c99a-475a-b933-fd1a64d3e705.png

1687142074902-5678869c-0d25-4f88-9ce9-1aad9e3e377d.png

## 方式二
将错误码转换为二进制， 最右边为0位 ，当某一位被置1时，表示驱动器处于当前位定义的状态
例如：错误码为：0x8000000，转换为二进制为：1000 0000 0000 0000 0000 0000 0000，对应27位置1，查表可知，对应错误状态为 总线看门狗触发，可同时存在多种错误状态
1677660944061-6fd875f2-5cdc-4e82-9b1a-d620cbd8ab0f.png
