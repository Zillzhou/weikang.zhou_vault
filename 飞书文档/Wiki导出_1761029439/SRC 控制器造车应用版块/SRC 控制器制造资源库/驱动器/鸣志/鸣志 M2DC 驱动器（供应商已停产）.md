# 鸣志 M2DC 驱动器（供应商已停产）

## 鸣志 M2DC 驱动器（供应商已停产）

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 该型号已停产，不能做新的造车选型推荐

## 已弃用

## 一、说明
本文档针对机器人改造过程进行规范，使公司产品符合行业标准，保证产品质量稳定，使技术人员在进行改造过程中有章可循。

机器人自动化改造涉及传感器众多，建议采用我司标准核心控制器线束 TE23、TE35，本文档以核心控制器标准线束为蓝本进行作业指导。

鸣志 M2DC 伺服驱动器选型建议参考公司的 SRC2000 选型指导手册。

本文档只适用于改造参考，不可作为技术协议及其他承担责任的内容。
### 二、适用范围

本技术规范适用于公司使用鸣志 M2DC 驱动器进行自动化改造的研发、生产、调试的技术人员。
### 三、调试资源

### 四、改造流程
## 进行改造（底盘驱动器部分）
## 1.驱动器需要与车体进行可靠固定。

2.当机器人安装有多个驱动器(数量 ≥2)时，所有从站的 CAN_L,CAN_H 引脚直接相连即可，采用串联方式接线，如图 4.3.1 所示；将 Driver4 最终引出的 can_H 压入一个德驰插筒连接器，同理将 can_L 压入一个德驰插筒连接器，接入德驰 DT06-4S 公头。最后与 T35 中的 32,33 号线（can1）相连；
a9d0738e-8d6b-49ff-816b-28fe97a277ba.png

## 图 4.3.1

3.为保证 can 通讯质量，需要将距离核心控制器最远的驱动器上的 120Ω 终端电阻打开，如上图4.3.1 中安装 Driver1 驱动器上终端电阻；其他 Driver2,3,4 的终端电阻关闭。

### 4.终端电阻是否正确打开的检测方法：

关机断电,断开驱动器和控制器的 CAN 连接线（如图 4.3.1 中 Driver4 和控制器之间的位置），使用万用表电阻档测量驱动器侧的 CAN 总线上 CAN_L,CAN_H 之间电阻，电阻值为 120Ω 则正确，如图 4.3.2 所示。电阻值明显小于 120Ω（如 60Ω），则说明至少有两个驱动器打开的终端电阻。

断开图 4.3.1 中 Driver1 和 Driver2 之间的连接线，使用万用表电阻档测量 Driver1 侧的 CAN 总线上 CAN_L,CAN_H 之间电阻，电阻值为 120Ω 则正确，如图 4.3.2 所示。如果电阻值明显大于 120Ω（如几 KΩ)，则说明终端电阻打开的位置不在 CAN 总线末端，需要调整。
2f761e87-896b-451e-a64a-f82a24c12fe2.jpg

## 图 4.3.2

### 5.SRC 2000 采用控制电机是否使能的方式来实现急停与否功能。电机是否使能可以通过控制驱动器上相应 STO 口通断高低电平的方式来实现；

驱动器的急停接线，TE35 线束【4】急停输出 1- 接入 24V，将两驱动器 J8 接头的 STO1+、STO2+ 接在一起与 TE35 线束【5】急停输出 1+ 连接起来，两驱动器 J8 接头的 STO1-、STO2- 接在一起与控制器的地相连，如图 4.3.3 是驱动器 STO 连接示例。 
2f86854d-b3d0-47f6-ae0d-0e422d705517.png

## 图 4.3.3

7.驱动器的抱闸接线，外接 24V 电源接入外部继电器和二极管，驱动器 CN2 接口上 Y2+、Y2- 作为开关量串联接入，外部继电器输出端外接 24V 电源输出接到电机的刹车器上。如图 4.3.4 是驱动器抱闸连接示例。

注意：伺服电机的刹车器仅能作为电机在未使能或者断电状态下保持机构位置用，切勿做为减速时制动用，否则会损坏电机。
c8a81ccf-e91f-48ac-8f93-34251cd5ea81.png

## 图 4.3.4

### 4.4 驱动器配置

### 4.4.1 鸣志 M2DC 电机 ARM 固件烧录方法（CANopen）

## 1.关闭 RBK（robodpro 最好也关掉）。

### 2.打开 udpconsole,输入 reset，保证 can 总线上没有数据，但是挂有 120ohm 的电阻。

3.使用 USB-mini 线连接驱动器，打开 M Servo Suite，正确选择端口，在 udpconsole 中输入 reset 重启电机驱动器，当有界面跳出时点击“是”，可以看到以下界面。

鸣志-M-Servo-Suite-Setup-1.0.20.0810.zip
e9560738-e68e-4641-adfa-b281acf02dd2.png

### 4.将 ID 设为 1,波特率设为 1Mbps，然后下载到驱动器。

### 5.拔掉 USB-mini，在 udpconsole 中输入 reset，重启电机。
d372b0c4-f5ae-4eaf-83d4-bc9d5a562be5.png

### 6.将 kvaser 连接至电机上的 can 口,将 120 欧姆电阻接入 另一个can 口；kvaser 的 2 口接 can_L，7 口接 can_H。

### kvaser_drivers_setup.rar

7.打开 CANopen Firmware Download ，选择 kvaser。NodeID 选择 1 ,这里波特率实际是固定的，也就是 1Mbps ,选择固件，点击 open,最后点击 start ,按照提示下载固件。

CANopen Firmware Downloader Setup 1.0.16.1103.rar

## 当前固件为

K10_CANopen M2_M2DC 212b 202109060850.hex

8.严格按照下图执行，需注意 canID 为1 ，点【start】，出现第一个弹窗时，给驱动器重上电，在看到驱动器灯亮之后，快速点击两个弹窗的【yes】，进度条读完即可
7aa8c88b-d95a-4655-9f86-49ee219ee6fc.png

### 二、鸣志 M2DC 电机通信参数配置

## 1.使用 USB-mini 连接驱动器，选择正确的 com 口。
a21259fd-6aac-4f00-95ca-c257242034bf.png

电机上电，这时请注意，上传命令只有在电机上电的时候有效，所以在上电的时候要快速电机下图中的“是”。
b4ccef02-425b-404c-a592-88e7e85a57ca.png

这时就能看到电机当前的基本参数了，我们只要操作几个基本命令就好了操作顺序如下：

先选择使用的电机型号；
设置 ID、一般我们差动车右轮 ID 为 1，左轮 ID 为 2；
设置波特率，我们统一设置为 250k；
勾选不适用位置误差报警阈值，不使用加速度平滑因子；
点击下载到驱动器按钮，等待下载完成后重启驱动器。
583b66ee-5a32-46b4-a1e4-98e92a558c5e.png

注意，配置电机后需要【下载到驱动器】，完成后重启驱动器，重新用上位机连接，否则会一直报霍尔错误
48dda9ae-86c2-4cad-94c9-06b029c6eb38.png

注意插上驱动器自带的 STO 接插件，如果有报错，排除错误原因，清楚报警历史，再点【伺服未就绪】，使能驱动器
117288c1-7ea3-4d34-8bdb-a3815e02e853.png

整定驱动器，整定之前，保证抱闸解开，电机可以安全运作，选择【参数整定】，【自动整定】，点【开始】，弹窗点【是】，此时电机开始周期性转动，等待进度条读完，下载到驱动器，重启驱动器，即可完成配置
60414709-4aba-4094-89a3-fdffaf00a61f.png

### 五、机器人模型配置说明

### 根据电机及减速实际情况配置行走电机参数：

注：这些参数需根据驱动器及选用电机及减速机的实际进行填写；
371c1778-1621-4fb1-b00f-8b16a2ca3f6f.png

## 图 5.1

注：减速比、编码器线数、电机最大转速、驱动器品牌需要根据选用的实际填写。

### 六、驱动器的功能检测

## 1.在整车组装完成未安装外壳前，请再检查一遍接线确保接线正确。

2.将车体加高，使轮子离地。开启机器人，使用网线连接机器人。使用 Roboshop 软件操作机器人让轮子转起来。 使用 CanScope 夹在 CAN 总线上检测 CAN 报文至少 1 小时，CAN 报文无错误。

### 3.让车体着地，使用 Roboshop 软件操作机器人做运动动作:向前，向后，向左，向右运动。

4.未拍急停按钮前，推动机器人，无法推动（电机使能），检查 Roboshop 中机器人状态处于“未急停”“驱动器未急停”，如图 6.1 所示；所示拍下急停按钮后，再次推动机器人，可以推动（电机使能释放），检查 Roboshop 中机器人状态处于“已急停”，“驱动器已急停”，如图 6.2 所示。
2f6e3255-9321-4e47-8fbc-1a438ee8d619.png

## 图 6.1
29bce4ca-0400-4370-adea-228e929776b4.png

## 图 6.2

### 5.任务链运动老化测试 24H，查看 Robokit Log 无错误报警。

### 七、附录

### 7.1 致远 CAN Scope 使用方法

## 1.软件安装--安装 CAN Scope 配套软件 CANScope。（软件及使用手册请联系致远厂商售后）

2.硬件连接--参考 CAN Scope 使用手册接好电源，USB 调试线，插上 CAN Port 板，将 CAN_H 接到 SRC2000 外接线束 TE35 33 号线上，将 CAN_L 接到 SRC2000 外接线束 TE35 32 号线上 USB 调试线插在电脑上。

3.打开软件 CANScope，选择【Port板】，取消【启用终端电阻】，选择【报文】，配置【波特率】为 250Kbps，取消【总线应答】，选择【开启】，CAN 报文实时如图 7.1.1 所示。
d2d9719f-f403-44e4-9850-3da4ca4ae628.png

## 图 7.1.1

### 4.选择【状态】【错误】，检查是否有错误报文。如图 7.1.2所示。
bdfdec97-e814-4103-b428-f22d249d516b.png

## 图 7.1.2

### 7.2 USB CAN 卡使用方法

## 1.软件安装—安装软件 USB_CAN Tool（软件及使用手册请联系 CAN 卡厂商售后）.

2.硬件连接—准备USB CAN卡和连接线，将连接线CAN_H接到SRC2000 外接线束TE35 33号线上，将连接线CAN_L接到SRC2000 外接线束TE35 32号线上. 如图7.2.1所示。
e1b2464e-56d3-4fdb-9b74-189406f3fb73.png

## 图 7.2.1

3.打开 USB CAN tool ,选择【设备操作（O）】【启动设备（S）】,确认CAN 参数，【波特率】为250Kbps,选择【CAN 通道号】为通道 1,点击【确认】。如图 7.2.2 所示
9a9c91b6-5010-453c-975c-52c40d420f66.png

## 图 7.2.2

### 4.选择【显示（V）】，取消选择【合并相同 ID 数据(M)】，CAN 报文如图 7.2.3 所示。
773b8634-aca6-4ee8-8fa4-edecacc12b31.png

## 图 7.2.3

### 7.3 udpconsole 使用方法

udpConsole 是我司工程师用于调试 bug 开发的小工具，可以检查到固件上报的错误信息。

## 1.打开 udpconsole 工具前需用网线确保电脑与机器人的物理连接。

### 2.打开 udpconsole，进行驱动器功能测试，时刻检查 udpconsole 显示内容。

### 驱动器通讯过程中出现错误帧如图 7.3.1 所示：
60a0afc8-d9ec-4ef4-801b-9d8728fe3baf.png

## 图 7.3.1

### 八、驱动器常见错误码

## 举例：

## 1.0x8040，为 low voltage，应该为驱动器参数中的低电压参数未修改。

### 2.0x8080，为 over current

### 3.0x8，为 over temp 过温。

### 4.0x6310 是 2000+4000+0200+0100+0010 这个组合
2f05eae0-996b-4524-a7b2-684298836ed4.png
