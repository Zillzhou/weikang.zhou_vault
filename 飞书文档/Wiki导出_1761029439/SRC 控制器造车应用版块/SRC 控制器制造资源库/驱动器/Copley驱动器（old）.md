# Copley驱动器（old）

## Copley驱动器（old）

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 语雀迁移飞书

## 使用中

### 5.2.1 Copley 驱动器配置方式作业指导书

## 说明

本文档针对机器人自动化改造过程进行规范，使公司产品符合行业标准，保证产品质量稳定，使技术人员在进行改造过程中有章可循。

机器人自动化改造涉及传感器众多，建议采用我司标准核心控制器线束 TE23、TE35，本文档以核心控制器标准线束为蓝本进行作业指导。

## 一、适用范围

本技术规范适用于公司进行机器人自动化改造的研发、生产、调试的技术人员。
### 二、调试资源

### 三、改造流程
## 进行改造（底盘驱动器部分）

## 1.驱动器需要与车体进行可靠固定，检查驱动器与对应电机的三相线、编码器线路连接正确；

2.当机器人安装有多个驱动器(数量 ≥2)时，所有从站的 CAN_L，CAN_H 引脚直接相连即可，采用串联方式接线，如图 4.3.1 所示；将 can_H 压入一个德驰插筒连接器，将 can_L 压入一个德驰插筒连接器，接入德驰 DT06-2S 公头。最后与 TE35 中的 32，33 号线（can1）相连；

1677577666385-9c39ffb8-4c7f-4b20-b974-671ed3793651.png

## 图 4.3.1

3.为保证 can 通讯质量，需要将距离核心控制器最远的驱动器上的 120Ω 终端电阻打开，如在图 4.3.1 中将 Driver1 驱动器上终端电阻通过拨盘打开；

### 4.SRC2000 采用控制电机是否使能的方式来实现急停与否功能。电机是否使能可以通过控制 Copley 驱动器上相应 IO 口通断高低电平的方式来实现；

5.Copley 驱动器的使能信号由 J3 接头的【IN1(Enable)】4 号线控制，通过软件将 IN1 配置成“AMP Enables-LO Enables With Clear Faults”(低电平输入将使能驱动器)，并且将 IN1 配置成“Pull up +5V”(内部上拉 +5V)，此时使驱动器使能的低电平信号可由 J3 接头的【Signal Gnd】15 号线提供，如图 4.3.2、图 4.3.3 所示。

1677577694594-e97482e1-7145-48d2-9251-935c4b4eb3d3.png

1677577715466-1520e57d-04f5-450a-ad55-be725c8813c9.png

## 图 4.3.3

6.将两驱动器 J3 接头的【IN1 Enable】4 号线引出后压入同一德驰插筒连接器；将两驱动器的【Signal】15 号线引出后压入同一德驰针筒连机器；最终将两针筒连接器插入 DT06-2S 德驰母头，最后将此母头与 TE35 线束中插有【4】急停输出 1-、【5】急停输出 1+ 的德驰公头相连；

### 7.至此 Copley 驱动器安装及急停处理结束，为发挥驱动器最佳性能在电电机装配完减速机及车轮后，需要对驱动器进行一次调试,接线图如图 4.3.4 所示。
1677577731252-c3655233-00b3-4159-8d52-73c4870a8ce6.png 

## 图4.3.4

### 四、 驱动器配置
### 4.1调试准备

1.下载并安装 Copley 专用调试软件 CME2 http://www.copleycontrols.com/Motion/Products/Software/index.html ；
### 2.建议使用 RS232 通讯方式，实现调试电脑与驱动器的通讯。建议使用 USB-232 转换器，参考 Copley J6 制作连接线，如图 4.1.1 所示；
1677577748115-51ce811d-b46a-4569-a4f4-68e10827542c.png 

1677577766400-9f283b85-9fd3-4984-ab70-5574b4462b3a.png

## 图 4.1.1
### 3.将驱动器上电后，双击 CME2 软件图标，此时软件将将提醒“键盘上的 F12 键可以用做驱动器去使能用途”，直接点击【OK】即可，如图 4.1.2 所示：
1677577781958-14ba6fd9-4b68-43ff-a6da-6272e90fe72e.png 

## 图 4.1.2

4.选择软件连接方式，【Tools】-【Communications Wizard】-【Serial Ports】-选择连接驱动器的 com 口-【Next】,如图 4.1.3、图 4.1.4 所示:
1677577800616-58eab227-af2c-4b30-a21f-a0fe267839a3.png 

1677577816994-9a4785ce-977e-4d9c-84a5-9dd6f607cf01.png

## 图 4.1.3
1677577846976-26c2dd8a-53d2-465e-8557-1177ab36a906.png

## 图 4.1.4
### 5.此时将看到软件调试，如图 4.1.5 所示，各图标含义如图 4.1.6 所示:
1677577868159-4b2ee898-1410-43ee-b491-60e7816e3799.png 

## 图 4.1.5
1677577887743-7b2d4994-69ab-4090-b21c-7a4e0f24bfbe.png

## 图 4.1.6

### 6.配置电机类型，电机工具栏上图标，然后点击【Change Settings】,如图 4.1.7 所示:
1677577905614-f49c3044-3e2b-4253-a19e-7942c7e1a113.png

## 图 4.1.7

### 7.设则电机类型，根据需要进行设置，如图 4.1.8 所示。注意：我们一般选用无刷旋转电机.
1677577921795-42d01530-bf7b-470d-895f-b63c9c01cf9b.png

## 图4.1.8

8.设置反馈选项，注意霍尔类型设置 None,MotorFeedback 设置成 Primary Incremental,Load Feedback 设置成 None，如图4.1.9所示:
1677577943261-094dc140-180d-4275-ba77-b24b88e1b9b8.png

## 图 4.1.9

### 9.设置电机工作模式，将【Operating Mode】设置为 Positoin，将【Command Source】设置为 CAN，如图 4.1.10 所示：
1677577965619-3fd36009-ee7a-4d9f-8fbc-499087211eec.png

## 图 4.1.10

10.其他项选择，将【Commutation Mode】设置为 Sinusoidal,另一项 Multi-mode Port 对应图 4.1.11 中的 Multi-mode Port，由于我们并未使用 Multi-mode Port 信号源，所以在此选项可随意选择，如图 4.1.11 所示：
1677578003972-38684865-7ec1-47fe-9432-eae8e4d6abcf.png

## 图4.1.11

11.配置电机参数，电机界面上的【Motor/Feedback】,唤出 Motor/Feedback-Rotary Motor 对话框，按照图示顺序将进行操作。如图 4.1.12所示：
注：4.1.13, 4.1.14, 4.1.15 参数中均可在电机设计图纸中找到。
1677578020826-c604779c-161b-4fe8-be59-76dfab8b8b5b.png

## 图 4.1.12
1677578036664-6f250e88-ea92-4456-ac6c-b39bb65d3932.png

## 图 4.1.13
1677578056024-431508d2-57b2-497a-a387-2a1bd074d4a6.png

## 图 4.1.14
1677578070979-7b4d596f-9aea-4c11-9bbe-bb27e2f57f50.png

## 图 4.1.15
13.调整电机三相与霍尔——点击图 4.1.16 中数字 1 圈中的自动换向工具，唤出 Auto Phase 中的【Motor Direction Setup】对话框，如图 4.1.16 所示：
1677578088825-c149f923-436d-4647-8cf9-e538b68b76d1.png

## 图 4.1.16
14.面对电机轮，顺时针旋转轮子，确保【Motor Actual Position】中数值大于 500，如图 4.1.16 所示；然后点击【Next】选项唤出【Auto Phase】对话框，如图 4.1.17 所示；
1677578429490-430e8276-1b9b-49d9-8497-7d0cdb4c3698.png

## 图 4.1.17
15.点击图 4.1.17 中数字 3 标注的【start】选项，此时电机将会轻微转动，注意此时在此步骤前确保机器人已经被架空，轮子可以自由转动；待【Next】选项变黑（进入可用状态）后点击【Next】选项，唤出【Phase Count Test】对话框，如图 4.1.18 所示；
1677578444356-0ed7b7d8-edf2-4aa9-8279-c65200f6ff1d.png

## 图 4.1.18
16.点击图 4.1.18 中数字 5 标记的【Start】,此时驱动器将进行自动相位检测，如图 4.1.19 所示； 注意：如果步骤 4.1.16 与 4.1.17 与步骤做的好，则不必点击【Skip】按钮，将会出现图 4.1.20 的对话框，此时点击【Next】,此时软件将进入【Hall Wiring Setup】界面；
1677578461426-87e3e90b-a005-4328-abe8-0f1999c9f533.png

## 图 4.1.19
1677578478714-c6a10c50-8d8a-483a-9ac5-177a27930a27.png

## 图 4.1.20

17.点击图 4.1.20 中数字 8 标注的【Start】,此时观察 Hall States 将出现亮暗变化，最后点击数字 9 标注的【Next】完成 Auto Phase 调试；
### 18.整定电流环，点击图 4.1.21 中的【I loop】，唤出 Current Loop 对话框；
1677578495152-5508f839-8991-4f41-842d-69c88ea1fe77.png

## 图 4.1.21

19.将 Current Loop 对话框中的 Cp(比例参数)、Ci(积分参数)参数全部调整成 0，然后点击【Auto Tune】按钮开始整定，如图 4.1.22 所示；
1677578515190-e3c26107-b29a-4017-92b5-a84e3531c09c.png

## 图 4.1.22

20.整定好的参数中选择 Medium 选项并将保存选项勾选【Save Cp and Ci to Flash】最后点击【ok】,至此电流环调试结束，如图 4.4.23 所示；
1677578532720-834e1b89-042c-4815-9bbf-1dd0119f9001.png

## 图 4.1.23

### 21.速度环参数调整，点击图 4.4.24 中的【V loop】，唤出 Velocity Loop 对话框;
1677578550141-9e5f7282-4d6d-4d0c-9c12-709d6a9863f2.png

## 图 4.1.24

22.将 Velocity Loop 对话框中 Vel.Limit 值更改至电机额定最大转速，若对电机刚度要求不高则保持默认 Vp\Vi 即可，若对其要求较高，则进入步骤 4.1 手动调整速度环参数。

### 4.2 手动调整驱动器参数
## 1.手动调整速度环—首先进入【V Loop】界面，将最大速度调整至额定最大转速，然后再点击屏幕上的示波器按钮，打开示波器，如图 4.2.1所示：
1677578567515-fbca1b5a-27ef-4789-a1cd-53587b334795.png

## 图 4.2.1

注：Vel.Limit: 调整至额定最大转速，而非电机最高转速。
2.在示波器界面将左面的【Apply TO】定义为 Velocity(速速)，将【Function】定义为Square Wave，将【CH1】选择 Commanded Velocity，【CH2】选择 Actual Motor Velocity ,【CH3】选择 Actual Current。将 Trigger Setup 选择 Immediate Trigger，如图 4.2.2 所示：
1677578590073-0fe27fca-fe5a-4a7c-918a-8dbc56afd01e.png

## 图 4.2.2

### 3.点击示波器界面的【Gains】界面，将 Vp 与 Vi 值均调成 0，最后点击【Start】选项，如图 4.2.3 所示：
1677578610656-7c7e43af-f0cb-4e20-a6f1-a198016bc992.png

## 图 4.2.3
4.然后逐渐增加 Vp 的值，直至 current 曲线在不再收敛，在发散的边缘，即为 Vp 的可设置的最大值，取这个值的 80% 设为 Vp 的值，然后逐渐增加 Vi 的值，至超调量为 10%-15%，然后 stop 保存参数到 flash；
### 5.参数调整结束后，点击框选图标，将全部参数下载至驱动器，如图 42.4 所示；
1677578628640-1a3ea848-2eb4-4a38-bce9-ea905cad95d7.png

## 图 4.2.4
### 4.3 设置驱动器 can 通讯波特率及 CAN ID
1.将驱动器 can 通讯的波特率调整为 250kbit/s；点击【Amplifier】-【Network Configuration】，选择 can 通讯方式，将 BitRate 调整为250Kbit/s,
2.【Address Configration】勾选为【Use Programmed Value】，在【Programmed Value】写入相应数值（左面电机为 1，右侧电机为 2），最后点击【Save & Reset】，如图 4.3.1 所示。
1677578646192-361461f2-26b3-453f-a12e-bac0a43a4e53.png

## 图 4.3.1
### 4.4 调整驱动器报错设置
1.点击驱动器调试界面的【Configure Faults】按钮，唤出【Fault Configuration】对话框，勾选掉【Follwing Error】选项；
2.根据实际情况可选择勾选掉【Over Current(latched)】选项，最后点击【OK】退出对话框，点击菜单栏下载按钮将驱动器所有参数下载至驱动，如图 4.4.1 所示； 
1677578665202-661c9f0b-fad7-48b1-8785-a33a20044b17.png 

## 图 4.4.1

### 4.5 转向电机的配置
### 如果是要配置转向电机，还需要增加如下设置：
1.左右限位 DI 的接线：除了上述 4.2.4 提到的急停线路的接线，需要再接左右限位 DI。根据限位 DI 的规格要求将左右限位 DI 的电源棕色线(正极)接 Pdo(24V)或者端子排（24V 或者 48V)，电源线中蓝色线(负极)接 GND。左限位 DI 黑色线(NPN 输出)接驱动器 J3 接口上的【IN2】GP 5 号线上，右限位 DI 黑色线((NPN 输出)接驱动器 J3 接口上的【IN3】GP 6 号线上。如图 4.5.1 所示：
2.左右限位 DI 的软件参数配置：打开 CME 软件点击主界面上的“Input/Output”选项，如图 4.8.2所示，将 IN2 配置成“POS Limit-HI Inhibits "，将 IN3 配置成"NEG Limit-HI Inhibits ”，如图 4.5.3 所示。
检查方法：可以通过点动移动转向电机转向到左右限位传感器检查左右限位 DI 是否有效。如图 4.5.4 所示，从 CME 主界面打开“控制面板”，打勾“Enable Jog”，不断点击“Move NEG”，可以看到转向电机缓慢向右点动转向到右限位传感器，触发“Negative Limit:”状态更新为“Active”。同样方式不断点击“Move POS”，可以看到转向电机缓慢向左点动转向到左限位传感器，触发“Postive Limit:"状态更新为“Active”。如图 45.5 所示，转向电机转到右限位传感器时“Postive Limit:"状态更新为“Active”。
1677578681260-e27d3450-dcb9-4a3c-bdca-912ce445e7fc.png

## 图 4.5.1
1677578811891-7d78dd55-17e9-4a28-8f25-105daa751822.png

## 图 4.5.2
1677578825211-16e6f987-784d-4464-bd3d-93d1bdcdd88b.png

## 图 4.5.3
1677578845579-90a917a5-cc0d-4fa6-9f7f-04de096c75a2.png

## 图 4.5.4
1677579289720-723b529e-907b-46d3-bce7-37893803726a.png

## 图 4.5.5
3.原点配置： 点击主界面上的 Home 选项，如图 4.5.6 所示,打开 Home 界面，将"Method"改成“Limit Switch"，将“Offset”改成“0 counts”,将“Direction of Motion"改成“Negative",点击“Home",可以看到对应转向电机顺时针转动直至触发负限位，弹出"Homing Complete"的弹出框，点击“确认”关闭弹出框，原点配置完成。点击"Save"保存设置，如图 4.5.7.点击"Exit"退出 Home 界面。
1677579306379-a1efb5ba-13c4-40f0-bad7-57c41b438777.png

## 图 4.5.6
1677579321482-09b51d61-4612-4694-9657-037322ea0d79.png

## 图 4.5.7
至此 copley 驱动器调试结束，对驱动器进行断电重启保证参数发挥作用.
### 五、Copley 驱动器参数技术调整 (适配地牛)

5.1 本标题仅针对当前公司地牛使用的 Copley 驱动器及 DMKE 60M-01930C5-E 电机的调试参数进行规范，保证地牛驱动器调试质量，使驱动器参数调整有章可循；本标题需要与本文档 1-4 标题配套使用。
### 5.2 调整流程如下：
地牛状态确认；
## 1.1 确认驱动器 、电机已经可靠机械固定、正确完成接线；
## 1.2 确认驱动器基本设置、电机 反馈参数配置均已按照电机实际配置完成；
## 1.3 确认驱动器已经按照本文档【4.4 驱动器配置】中调整电机三相与霍尔、整定电流环 等
## 驱动器关键参数
### 2.1 驱动器电流环参数参考本文档【4.4 驱动器配置】自动整定获得；
### 2.2 将 驱动器速度环以下参数调整至下表规定的数值 ，如图 5.1 及表 5.1 所示；

## 序号

## 名称

## 值

## 1

## Vel.Limit

## 3000

## 2

## Vp

## 420

## 3

## Vi

## 180
## 表5.1
1677579338810-7dbbcc0a-9cac-4274-a6d5-39da13485b8c.png 

## 图5.1
**注意：1.除表格规定的参数外，其他参数均保持默认；
### 2.若驱动器使用速度模式，则执行完 2.2 步骤后直接进入步骤 3 （驱动器报错设置）；若驱动器使用位置模式，则继续执行步骤 2.3-2.4**
### 2.3 将 驱动器位置环以下参数调整至下表规定的数值，如图 5.2 及图 5.3 所示：
1677579355021-e9998bcd-a52d-4cda-a1ff-9765412d24b7.png 

## 图 5.2
1677579374459-082ff61a-18c2-4ffb-ba01-137d250e2b4d.png 

## 图 5.3

### 2.4 将 驱动器电流环以下参数调整至下表规定的数值，如图 5.4 所示；
注：德马克 DCPX-090/18024-E/H 电流 IC 为 24A,峰值电流 IP 为 50A。
1677579392146-8a916daf-79cd-45c7-9a3f-4d3ad1f0a286.png

## 图 5.4

## 驱动器报错设置
3.1 将驱动器【 following Error 】、【 Over Current 】勾掉，另外【 Amp Over Temperature 】及【 Motor Over Temp 】务必不要勾掉 ，如图 5.5 所示
1677579408054-cefdb5b6-5fa1-4d7a-8e1d-4026807c34d8.png

## 图 5.5
注意：除以上规定的关键参数及设置调整外，其他参数均按照本文档【4.4 驱动器配置】调整得到。
## Roboshop 运动关键参数
### 4.1 针对差动地牛运动特点 ，需要通过 Roboshop 对地牛的运动参数做如下修改，如下表 5.6 所示

## 序号

## 名称

## 值

## 1

## MaxAcc

### 0.2

## 2

## MaxDec

### 0.1

## 3

## MaxRot

## 30

## 4

## MaxRotAcc

## 10

## 5

## MaxSpeed

### 0.5

## 6

## MaxRotDec

## 5

## 7

## LoadMaxSpeed

### 0.5

## 8

## LoadMaxAcc

### 0.2

## 9

## LoadMaxDec

### 0.1

## 10

## LoadMaxRot

## 30

## 11

## LoadMaxRotAcc

## 10

## 12

## LoadMaxRotDec

## 5
## 表 5.6
### 六、Roboshop 报错码解析
（ 固件版本是 1.9.20 及以前版本 +1.9.52 及以后的版本请参考报错码解析 ） 
1677579430947-6b6b1adc-ed1f-4bcc-a21b-6fd1cafd2b2d.png 

举例：当 Roboshop 收到报警码：“0x40e002”时，如图 5.1所示，将报警码转化为二进制为“010000001110000000000010“，则通过观察，驱动器的第 1,13,14,15,22 位存在错误，对应到上表，则驱动器报错分别为：Amplifier over temperature,Trying to stop motor,Motor brake activated,PWM outputs disabled,Amplifer fault.See the fault latch for more info. 
1677579447907-905a20da-f06b-4589-b28e-bb86e1d31920.png 

## 图5.1
（ 固件版本是 1.9.20 （不含 1.9.20 版本）至1.9.52（不含1.9.52版本）请参考报错码解析 ） 
1677579465022-99fadf9b-3bb5-47e6-b06b-1dd28c99f8dd.png 

举例：当 Roboshop 收到报警码：“0x100”时，如图 5.2 所示，将报警码转化为二进制为“000100000000”，则通过观察，驱动器的第 8 位存在错误，对应到上表，则驱动器报错为："Phasing error." 
1677579485906-d99229df-f534-43e2-91a2-ea3fb77fe833.png 

## 图 5.2
## 1.1 解决错误指导
### 📎Copley-CME2手册--汉语.pdf
1677579503799-d0042a8f-1af7-4088-8a2b-150aacc2d86f.png

可参考中文手册中的8.1章节，综合情况进行解决。 
## 附录一：版本升级说明

## 序号

## 日期

## 版本

## 改动说明

## 1

### 2019.3.5

## V3.0.0

## 文档建立，内容完善，版本升级

## 2

### 2019.10.16

## V4.0.0

明确 1.9.20 及更新版本固件以后，Copley的Operating Mode 选为 Position; Command Source 选为 CAN;

## 3

### 2019.10.31

## V5.0.0

明确 1.9.20 更新版本固件以后,Copley 报错码解析变更

## 4

## 2020/03/02

## V6.0.0

## 增加了 2.10 转向电机的配置说明
## 附录二：参考数据

Copley 驱动器配置测试(位置模式，负重 500kg).xlsx
