# 科亚电子驱动器

## 科亚电子驱动器

## 版本

## 更新日期

## 更新说明

## 维护责任人

## V1.0

### 2024.4.28

## 初版编辑

## @胡波
## 一、适用范围
本文适用于科亚电子驱动器KYDAS4860-2E和KYDAS4850-1E的调试与配置。
## 二 、调试资源
## 驱动器手册：

KYDAS-LA 低压伺服驱动器使用手册（V1.9) .pdf

KYDAS-S2A低压伺服驱动器使用手册（V1.0) .pdf
### 三、接线与改造
### 3.1 固件升级
本文档描述范围内的两款科亚电子驱动器不支持STO和DI急停。科亚电子提供了支持DI急停的固件版本，以支持硬件急停，提升整车安全性。
## 固件升级指导方法参考：
## 科亚电子固件升级作业指导书
固件升级后，针对KYDAS4860-2E和KYDAS4850-1E各有不同。
### 3.1.1 KYDAS4860-2E急停
control端子引脚7/9接地，方可使能；当该引脚接高电平或悬空时，将会导致刹车。
## image.png

### 3.1.2 KYDAS4850-1E急停
control端子引脚2接地，方可使能；当该引脚接高电平或悬空时，将会导致刹车。
## image.png

### 3.2 进行改造（底盘驱动器部分）
驱动器需要与车体进行可靠固定，检查驱动器与对应电机的三相线、编码器线路连接正确；
当机器人安装有多个驱动器(数量 ≥2)时，所有从站的 CAN_L , CAN_H 引脚直接相连即可，采用串联方式接线
1677662286030-33ee0c06-b8e0-4d00-8769-9b903b08defa.png

## （图一）

将 Driver4 最终引出的 can_H 压入一个德驰插筒连接器，同理将 can_L 压入一个德驰插筒连接器，接入德驰 DT06-2S 公头。最后与 T35 中的 32,33 号线 （can1） 相连；(注意：各型号驱动器引脚定义详见附录一)
## 注：
为保证 CAN 总线通讯质量，请将 CAN_GND 接到 DCDC 输出端负极或者控制器上的接地，驱动器端总线通讯接口（X1)如下图所示。
1677662300131-f6174f0f-e9e9-42b6-9dea-646b98d81482.png

## （图二）
为保证 can 通讯质量，需要将距离核心控制器最远的驱动器上的 120Ω 终端电阻打开，将 Driver1 驱动器上终端电阻通过拨盘打开；其他 Driver2,3,4 的终端电阻关闭，打开时终端电阻开关如图 三 所示；
## image.png

## （图三）
## 终端电阻是否正确打开的检测方法：
关机断电，断开驱动器和控制器的 CAN 连接线（如图 1 中 Driver4 和控制器之间的位置），使用万用表电阻档测量驱动器侧的 CAN 总线上 CAN_L,CAN_H 之间电阻，电阻值为 120Ω 则正确，如图7 所示。电阻值明显小于 120Ω （如 60Ω），则说明至少有两个驱动器打开的终端电阻。
断开图 1 中 Driver1 和 Driver2 之间的连接线，使用万用表电阻档测量 Driver1 侧的 CAN 总线上 CAN_L , CAN_H 之间电阻，电阻值为 120Ω 则正确，如图7所示。如果电阻值明显大于 120Ω （如几 KΩ)，则说明终端电阻打开的位置不在 CAN 总线末端，需要调整。
1677662327695-54f0d151-e675-4dbe-89ed-3646ea04c780.png

## （图四）
公司适配的核心国产驱动器采用控制电机是否使能的方式来实现急停与否的功能。电机是否使能可以通过控制驱动器上相应 IO 口电平高低的方式来实现；
驱动器如图8所示，将所有驱动器的 COMI （11号脚） 并联后接入 DCDC 24V+ 输出，所有驱动器的COMO（1号脚）并联后接入DCDC24-输出；将所有驱动器 IN1（9号脚） 并联后连接 SRC2000 急停输出 1+ （TE354 号线），将另一根急停输出 1- （TE355 号线）连接 DCDC  24V- 输出；
将所有驱动器的PUL+ or 24V+并联后接入DCDC24+输出，PILL- or 24V-（10号脚）并联后接入DCDC24-输出。
1698645346454-c863c0d2-ee17-4f5a-a0ac-dd04bf74cce4.jpeg

## （图五）

### 四、驱动器配置
### 4.1 行走驱动器配置方法（速度模式）
## 参考：科亚电子驱动器上位机配置
### 五、Model 文件配置说明
## 模型中需要关注的配置如下：

## Key

## Description

## Value

## Unit

## x

## 驱动器安装的X坐标

## 根据实际安装位置填写

## m

## y

## 驱动器安装的Y坐标

## 根据实际安装位置填写

## m

## yaw

## 驱动器安装的朝向

## 根据实际安装位置填写

## 度

## canID

## 驱动器的的CANID

如果使用A电机，CANID必须配置为1；如果使用B电机，CANID必须配置为2；如果同时使用双路电机，分别配置为1和2

## maxRPM

## 驱动器最大转速

## 1500

## RPM

## encoderLine

## 编码器线数

## 根据实际情况填写

## canPort

## 驱动器使用的端口

## 根据实际情况填写

## brand

## 驱动器品牌

### Keya-4860-2E-CANOpen
### Keya-4850-1E-CANOpen

## wheelRadius

## 轮半径

## 根据实际情况填写

## m

## reductionRatio

## 减速比

## 根据实际情况填写

## KYDAS4860-2E
A电机必须配置CANID为1，B电机必须配置CANID为2.
### 六、驱动器功能检测方法
在整车组装完成未安装外壳前，请再检查一遍接线确保接线正确；
将车体加高，使轮子离地。开启机器人，使用网线连接机器人。使用 Roboshop 软件操作机器人让轮子转起来。 使用 CanScope 夹在 CAN 总线上检测 CAN 报文至少 1 小时，CAN 报文无错误；
让车体着地，使用 Roboshop 软件操作机器人做运动动作:向前，向后，向左，向右运动；
未拍急停按钮前，推动机器人，无法推动（电机使能），检查 Roboshop 中机器人状态处于“未急停”“驱动器未急停”，如图 6.1 左侧图所示；所示拍下急停按钮后，再次机器人，可以推动（电机去使能），检查 Roboshop 中机器人状态处于“已急停”，“驱动器已急停”。如图 6.1 右侧图所示；
1677663188481-0a751fbe-e933-459f-baf7-bff708003d7e.png 

## 图 6.1
任务链运动老化测试 24H ，查看 Robokit Log 无错误报警。
### 七、附录
### 7.1 致远 CAN Scope 使用方法
软件安装--安装 CAN Scope 配套软件 CANScope 。（软件及使用手册请联系致远厂商售后）。
硬件连接--参考 CAN Scope 使用手册接好电源，USB 调试线，插上 CAN Port 板,将 CAN_H 接到 SRC2000 外接线束 TE35 33 号线上，将 CAN_L 接到 SRC2000 外接线束 TE35 32 号线上。USB 调试线插在电脑上。
打开软件 CANScope ，选择【Port 板】，取消【启用终端电阻】，选择【报文】，配置【波特率】为 250Kbps ,取消【总线应答】，选择【开启】，CAN 报文实时如图 7.4.1 所示：
1677663268954-291e38ce-489f-4027-9856-ba2dc40ce17a.png

## 图 7.4.1
选择【状态】【错误】，检查是否有错误报文。如图 7.4.2 所示。
1677663284387-3b841e8b-ddc8-454b-937a-3ef429c43fd8.png

## 图 7.4.2
### 7.2 USB CAN 卡使用方法
软件安装—安装软件 USB_CAN Tool （软件及使用手册请联系CAN卡厂商售后）。
硬件连接—准备 USB CAN 卡和连接线，将连接线 CAN_H 接到 SRC2000 外接线束 TE35 33 号线上，将连接线 CAN_L 接到 SRC2000 外接线束 TE35 32 号线上。如图 7.5.1 所示：
1677663297946-d2deb605-d867-404b-9d95-46ccacc6814e.png 

## 图 7.5.1

打开 USB CAN tool ,选择【设备操作（O）】【启动设备（S）】,确认 CAN 参数，【波特率】为 250Kbps ,选择【CAN 通道号】为通道 1,点击【确认】。如图 7.5.2 所示
1677663314011-7de9aff6-8174-4a56-8e03-3b39b60ae9cc.png

## 图 7.5.2
### 4.选择【显示（V）】，取消选择【合并相同 ID 数据(M)】，CAN 报文如图 7.5.3 所示：
1677663331870-19c60412-c4a1-4a72-b5c8-971eadf2facf.png

## 图 7.5.3
### 7.3  udpconsole 使用方法
udpConsole 是我司工程师用于调试 bug 开发的小工具，可以检查到固件上报的错误信息。
打开 udpconsole 工具前需用网线确保电脑与机器人的物理连接。
打开 udpconsole ，进行驱动器功能测试，时刻检查 udpconsole 显示内容。
### 驱动器通讯过程中出现错误帧如图 7.6.1 所示：
1677663346738-3ee02f11-3de8-474e-9375-c36e600c4f2b.png

## 图 7.6.1
