# 埃斯顿驱动器

## 埃斯顿驱动器

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 语雀迁移飞书

## 使用中

## 一、说明
本文档针对机器人自动化改造过程进行规范，使公司产品符合行业标准，保证产品质量稳定，使技术人员在进行改造过程中有章可循。

机器人自动化改造涉及传感器众多，建议采用我司标准核心控制器线束TE23,TE35,本文档以核心控制器标准线束为蓝本进行作业指导。

注：本文档只适用于改造参考，不可作为技术协议及其他承担责任的内容。

### 二、适用范围
本技术规范适用于公司使用埃斯顿高压系列canopen通讯驱动器进行自动化改造的研发、生产、调试的技术人员。
### 三、调试资源

ESTUN伺服CANopen用户手册V1.04-20210224111515.pdf
## 四 、改造流程

### 4.1 类Kiva顶升部分DI使用规范

### 4.1.1 接线说明

## 顶升部分 DI 使用规范

## 序号

## DI

## 功能

## SRC 线号

## 1

## DI2

## 顶升下限位开关信号

## T23   6 号线

## 2

## DI5

## 顶升上限位开关信号

## T23   7 号线

## 3

## DI6

## 旋转零位信号

## T23   5 号线

注1:在顶升车上这三个DI不能作为其他其他用途；

注2：确保这三个传感器的均为NPN型，发出的信号能被SRC核心控制器检测到。

### 4.2 进行改造（底盘驱动器部分）

### 4.2.1 行走电机驱动器安装方式

## 1.驱动器需要与车体进行可靠固定，检查驱动器与对应电机的三相线、编码器线路连接正确；

2.当机器人安装有多个驱动器(数量≥2)时，所有从站的CAN_L,CAN_H引脚直接相连即可，尽量采用串联方式接线，如图4.4.1所示；若驱动器仅提供一个通讯接口，无法完成驱动器的can 线串联时，则将所有驱动器can线引出后把所有can_H压入同一德驰插筒连接器，将所有can_L压入同一德驰插筒连接器，接入德驰DT06-2S公头，最后与TE35中的32、33号线（can1)相连.

由于部分驱动器没有提供级联接口，只能通过从总线上接引线的的方式来串联，这里引线的长度需小于10CM.

注：在改造过程中若由于驱动器连接所需要的线束数量不足，无法实现在驱动器端进行快速串联，可采用图 4.4.2 所示连接方式，但不推荐。

1677569237874-f786956e-3f31-4704-ab59-f8cda5dde761.png

## 图4.4.1  图4.4.2

为保证can通讯质量，需要在距离核心控制器最远的驱动器上或总线末端安装终端电阻（阻值一般是120ohm).（注：客户可在购买驱动器时向驱动器厂商提出购买配套终端电阻）

### 3.CAN终端电阻是否正确打开的检测方法：

关机断电，断开驱动器和控制器的CAN连接线（如图4.4.1中Driver4和控制器之间的位置），使用万用表电阻档测量驱动器侧的CAN总线上CAN_L、CAN_H之间电阻，电阻值为120Ω则正确，如图4.4.3所示。电阻值明显小于120Ω（如60Ω),则说明至少有两个驱动器打开的终端电阻。

断开图4.4.1中Driver1和Driver2之间的连接线，使用万用表电阻档测量Driver1侧的CAN总线上CAN_L、CAN_H之间电阻，电阻值为120Ω则正确，如图4.4.3所示。如果电阻值明显大于120Ω（如几KΩ),则说明终端电阻打开的位置不在CAN总线末端，需要调整。

1677569258309-ff36360b-cc01-43bd-bfc4-ca6f57964e50.png

## 图4.4.3

### 4.5 驱动器参数配置

## 工具：

## USB-485转换器

1677569275309-589010db-6923-4b43-9cde-84637ff729ec.png

## 驱动器相关手册：

Pronet Plus 系列交流伺服用户手册 v1.05(1).pdf

## 调试准备

在驱动器首次上电之后，如果正常供电，伺服驱动器正面的面板操作器上就会出现左图所示的显示。显示内容的意思是禁止正转驱动(P-OT)，禁止反转驱动(N-OT)。

### 该驱动器canopen总线下不支持IO急停，请配置协议急停

1677569291940-e9de1b41-c027-428f-9ac8-08311bf28099.png

1677569308369-2293ed72-c2cf-43aa-a6d4-406b2a2101e2.png

之后需要对驱动器进行参数设置，驱动器手动操作区域有显示屏和按键组成。按键从左到右分别为MODE键、INC键、DEC键、ENTER键。

1677569325398-75557f55-bb35-46a6-b3fe-573476a24bf4.png

按MODE键依次会出现Pn、Un、Fn三种模式，以Pn模式为例，按INC键和DEC键可以选择该模式下的参数号，在选定参数号之后按下ENTER键就可以进入该参数。在修改参数时，先长按ENTER键等到数字右下角的闪烁之后，再按ENTER键选择对应的位数，然后按INC键和DEC键就可以进行参数修改， 在修改完成后按MODE键退出参数修改，进行下一个参数修改。

配置参数之前需要确认驱动器固件版本，目前我们仅支持埃斯顿订制版本

## 1、查看驱动器固件版本

按【MODE】键找到Fn007，按【ENTER】进入，再多次按【MODE】键可以查看完整固件版本号，截图如下，红框内参数为固件版本，务必保持一致；如果不一致，请烧写固件，步骤参照 4.7

1677569350197-8e7e40e7-4d95-4237-b442-496e230baaa7.png

### 2、电机对向操作

步骤一、驱动器在 bb（面板显示“bb”）或报警的状态下(非使能状态下)，进行对向操作

步骤二、设置正确的Pn840参数（根据不同电机型号询问驱动器厂家该位如何填写），然后断电重启

步骤三、驱动器上电后，进入参数号Fn007，然后根据INC键、DEC键、DEC键、INC键的顺序按下按键，解锁Fn014后按ENTER 键退出，然后通过按INC键、DEC键找到Fn014，按ENTERE键进入Fn014后，显示【load】 
1677569375233-ee9a6b5b-4645-4d9a-b82c-5540f854c280.png 

，长按ENTERE键保持一断时间，当【load】变成【done】 
1677569395401-1f4cba90-3528-4fd1-95e4-34ba97b369ae.png 

，正确的信息写入电机，然后 重新上电 。

步骤四、 重新上电 后，驱动器可能会报警A59(可以通过按ENTER键清除报警)，进入 Un018 查看是否为032C（确认参数是否已经写入）

步骤五、再次进入Fn007根据INC键、DEC键、DEC键、INC键的顺序按下按键，解锁Fn012后按ENTER键退出，然后通过按INC键、DEC键按找到Fn012。按Mode键，会有一串数字变化（此时电机正在对相）等到数字不变之后按一下INC键，将相位写入电机，然后按ENTER键退出， 重新上电 ，完成对向。

### 3、通过面板配置参数：

## Pn000修改为0110
### Pn700改为151（不使用485通讯控制）
### Pn006改为H0023（总线方式改为canopen）
Pn703改为H0003（can通讯波特率改为250Kbps）
Pn704是can通讯ID，行走驱动器改成1，顶升换向驱动器改成3

### 4、驱动器重上电后参数生效

### 5、需要注意的点：

can线一定按照菊花链形式接线，can地需要接，终端电阻需要加上

1677569423728-34ae6a14-4706-4abb-a044-6a33e9c7c00c.png

### 4.6 恢复驱动器参数出厂值

步骤一、按 MODE 键，选择辅助功能模式。

步骤二、按 INC 键或 DEC 键，选择恢复参数出厂值的功能号码。

1677569440585-e066b23f-0d5d-48f3-b065-817a936b8340.png

步骤三、按 ENTER 键，进入恢复参数出厂值模式。

1677569457256-e19eb444-6a3b-456a-934f-483e1ef78ff4.png

步骤四、按住 ENTER 键保持一段时间，当LOAD跳变为DONE之后，参数恢复成出厂值。

1677569472250-94d18470-8a88-482a-9979-78aff83c8ae6.png

步骤五、松开 ENTER 键，返回功能号码的显示。

1677569493678-f6fb58f0-40ee-4e16-bd9e-60df65cc96c0.png

## 注意：简码显示状态为
1677569553081-4c1bcee8-7b81-4217-8f69-d47e62caad95.png 

时，表示伺服 ON 状态，电机处于通电状态，此时无法进行恢复参数出厂值的操作。

### 4.7 升级驱动器固件
## 固件：

PX清零—PRONET_A_DSP_28374_APP_d_V601B0_GL1C1B0.zip

## 驱动器固件更新下载步骤如下：

步骤一、首先断开驱动器的电源，然后同时按住驱动器操作面板上的▲(INC键)和▼(DEC键)，直到再次接通驱动器的电源。操作面板的显示管显示为下图所示的内容。表示服驱动器已成功进入Boot模式。

1677569573249-cf33b6e4-f465-40b4-ac03-36ec6160e71d.png

步骤二、进入驱动器的Boot模式后，使用通信线缆正确连接至电脑。

### 步骤三、 打开PROG Loader程序

1677569598685-8b23d6ed-1663-4aeb-83de-3986ed4e3ac2.png

步骤四、单击“Detect”将自动检测PC机上的串口工作情况，并将其罗列出来：“Free”表示端口未被占用。

“ProNet_B101”表示端口被占用。其型号为ProNet_B101型驱动器。

1677569618249-b4243873-a9f0-4d0b-9726-62bc4906cdc9.png

## 选择所需连接的驱动器， 并单击"OK”

步骤五、单击“Please specify the BIN file”右侧的“Browse”，并在弹出的对话框中选择正确的固件升级文件，文件后缀名为“*bin”或“.ebin”

步骤六、单击 “Update Firmware”将自动执行固件升级操作界面将显示执行的进度，请耐心等待。

### 五、 FAQ

### 5.1 引脚定义

1677569644450-a3815084-e145-4604-9147-a27be9752617.png

### 六、附录

### 6.1

注 ：如果是绝对值编码器，一定要接编码器电池，否则会出现如下报错

1677569665396-4440582e-5b8d-4a13-bb33-769276d556a4.png

### 6.2常见错误排除方法参考（仅供参考，如果无法恢复，请联系驱动器厂家）

### 6.2.1A01报错

A01报错为参数破坏，指参数的“和数校验”结果异常。这种情况下通过ENTER键清除报警后，驱动器依旧无法正常工作。则需要进行恢复出厂状态并重新设置驱动器参数的参数。操作流程如下：

步骤一、按照 恢复参数出厂值的操作 的步骤，先将驱动器恢复出厂值。

步骤二、按照 驱动器参数设置 的步骤和参数值，将驱动器各项参数设置完毕。

步骤三、在设置好参数之后，重新上电启动驱动器，数显表显示为下图，则A01报错接触，驱动器恢复正常。

1677569683603-c8373dbc-f1ac-4cde-afc0-a7a75abc27f4.png

### 6.2.2. A25/26/27报错

A25/26/27报错为电机动力线 U/V/W 过流，发生报警的原因是机械卡死或电机动力线 UVW 相序接错。一般发生A25/26/27报错是因为电机三项线上电流过大，这类报错可以通过ENTER键清除，并在清楚后驱动器可以恢复正常状态 并继续进行工作。

当使用ENTER键无法清除A25/26/27报错的时候，可以给驱动器断电重启。

### 6.2.3. A45/46/47/48/51报错

A45报错为绝对值编码器多圈信息出错；

A46报错为绝对值编码器多圈溢出；

A47为电池电压低于2.5V，多圈信息已丢；

A48为电池电压低于3.1V，电池电压偏低；

A51为绝对值编码器检测到超速报警，多圈信息可能出错，造成的原因：

## （1） 未接电池或电池电压不足

（2）在电池电压正常的情况下驱动器未接电，电机因外部原因转动加速度过大

其中A45/46报错的处理为清除绝对值多圈信息及错误和清除绝对值编码器相关错误，步骤如下：

步骤一、清除绝对值多圈信息及错误，按 MODE 键，选择辅助功能模式。按 INC 键或 DEC 键，选择清除绝对值编码器相关错误的功能号码。

1677569708111-f080b708-3abc-43bc-8b86-45c967dd1882.png

## 步骤二、按下 ENTER 键显示如下

1677569724241-74586cce-6e00-4da0-9e03-eda47f17400e.png

步骤三、按下 MODE 键进行清除操作。

1677569739887-f4dceeb8-0efe-4fb0-b3d0-1affcab3ccac.png

步骤四、清除绝对值多圈信息及错误操作完成。

步骤五、清除绝对值多圈信息及错误，按 MODE 键，选择辅助功能模式。按 INC 键或 DEC 键，选择清除绝对值编码器相关错误的功能号码。

1677569756382-7e24e735-76cc-487f-9c6d-e1c457122e57.png

## 步骤六、按下 ENTER 键显示如下

1677569771507-aff9fa0a-e127-4d0e-b42b-66bf987e17e9.png

步骤七、按下 MODE 键进行清除操作。

1677569793047-ef73fe88-4df8-48db-9ecf-f57c3e8329cb.png

步骤八、清除绝对值编码器相关错误操作完成。

A47/48/51报错，需要先将驱动器编码器线上的电池进行更换，在更换完电池之后进行上述处理A45/46报错的操作步骤。完成后断电重启即可。

### 6.3 错误码查看方式：

如果报错0xFF42，只看后两位，把十六进制的42转换成十进制为66，对应下表报警就是A66

1677569815286-60e677e5-5cd6-44a4-8f86-f815c40d3c5c.png

### 6.4完整错误码

1677569834700-b1682c5f-e47b-4e07-b7c1-0279d1210a1f.png 

1677569850019-f0ca686a-095e-433c-a86b-63fe767b1d36.png 

1677569884396-20b84b9e-a8c7-4576-bcd3-5b6aa28c6221.png 

1677569910972-f9d2ccaf-73f7-4f2b-a188-dbb28354ce03.png

### 6.5通过驱动器上位机修改参数，以面板修改为准，该步骤仅做参考

## 1、使用USB-485转换器连接电脑和驱动器，打开驱动器配置软件，正确选择端口号，点击快速连接设备

1677569934312-35f77fb5-025f-464e-bb01-cf64373ef457.png 

1677569949190-71c80c40-1162-4fc7-9d70-6e09ba9fec0b.png

### 2、配置驱动器参数，选择【全部上传】，忽略【部分参数异常】的报错，Pn000参数改成0110，改完后全部下载

1677569968653-60d3e270-38cb-4978-8ba8-0d5f4400ff85.png

### 3、修改总线方式，波特率，canID，修改后【确定】，出现下载完成的提示后， 重新上电

1677569984670-af074c52-0627-4476-9fab-9851729efeec.png

### 4、点击【参数编辑】重新加载参数，如果出现【参数破坏】的报错，请联系驱动器厂家处理 ； 如果没有报错，完成配置

1677570002772-2ffb725d-1a69-4135-b298-074520fd9a65.png

### 5、驱动器重上电后参数生效，重启后检查一遍参数确保参数配置成功
