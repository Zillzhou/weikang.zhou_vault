# RoboteQ驱动器

## RoboteQ驱动器

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 语雀迁移飞书

## 使用中

## 说明
本文档针对机器人改造过程进行规范，使公司产品符合行业标准，保证产品质量稳定，使技术人员在进行改造过程中有章可循。

机器人自动化改造涉及传感器众多，建议采用我司标准核心控制器线束 TE23、TE35，本文档以核心控制器标准线束为蓝本进行作业指导。

本文档只适用于改造参考，不可作为技术协议及其他承担责任的内容。
## 一、适用范围
本技术规范适用于公司使用 RoboteQ驱动器 进行自动化改造的研发、生产、调试的技术人员。
### 二、调试资源
### 三、 驱动器配置
### 3.1 通信连接
## 9pin
1678182491058-eb553784-7de6-434c-9a45-8169e7d19384.png

## 25pin
1678182514123-40ad8316-fc66-421d-b30c-6c4af42fc02f.png

### 3.2 设置CANopen 参数
1677567425901-5e10ce81-488d-4738-815e-f93206882f2a.png 

## 不同驱动器的Node ID需要不同
1677567451556-0d1b7aaf-d548-4c9a-93d2-8152daa80e69.png

## 一拖一驱动器:
### CANOpen TPDO Send Rate：
### TPDO1 Send Rate(ms)：10
### 其他TPDO Send Rate 配置 0
### CANOpen Transmission Type:
### TPDO 1 Transmission Type :255
## 其他Type保持默认即可

## 一拖二驱动器：
### CANOpen TPDO Send Rate：
### TPDO1 Send Rate(ms)：10
### TPDO2 Send Rate(ms)：10
### 其他TPDO Send Rate 配置 0
### CANOpen Transmission Type:
### TPDO 1 Transmission Type :255
### TPDO 2 Transmission Type :255
## 其他Type保持默认即可

### 3.3 行走配置
### 3.3.1 设置行走驱动器参数
1677567470649-5869917c-0a90-4846-bfb0-5053c67a93a2.png 

电流限幅、触发电流、触发延时、触发响应和最大/小占空比：功能说明去看相关电机资料、这里使用默认参数配置
## 最大速度：为电机最大目标速度
## 加速度：电机加速时的加速度
## 减速度：电机减速时的减速度
## PI参数:见3.2

### 4.3.2设置行走pid(增量式)
## PID参数中调节:
## P:调整响应速度
## I: 调整稳定性
## D: 调整反应过冲
### 先调节P值使电机速度达到设定速度时能保持稳定
### 调节I值使电机在到底设定速度时误差尽可能小
调节D值当改变设定速度时电机能快速到达设定速度并且不会出现震荡

### 4.3.3设置编码器参数
1677567492174-6d4477e4-eb02-4e13-a443-fbbcda58045d.png 

### Pulses/Rev根据编码器分辨率设置
如果编码器和电机同轴，则填写该编码器分辨率，比如编码器1024 PPR，则填1024
如果编码器和电机不同轴，经过传动机构，且和编码器同轴的齿轮和电机轴齿轮齿比是x，那么1024/x

### 4.4 转向配置
### 4.4.1 设置舵角驱动器参数
1677567513792-3f1e6be8-1fec-4f38-9fea-829539446d7e.png 

电流限幅、触发电流、触发延时、触发响应和最大/小占空比：功能说明去看相关电机资料、这里使用默认参数配置
## 最大速度：为电机最大目标速度
## 加速度：电机加速时的加速度
## 减速度：电机减速时的减速度
## PI参数:见4.4.2

### 4.4.2 设置舵角pid
## PID参数中调节:
## P:调整响应速度
## I: 调整稳定性
## D: 调整反应过冲
### 先调节P值使舵轮能到达设定位置并保持稳定
再调节D值当改变设定位置时舵轮能快速到达设定位置并且不会出现震荡
### 最后调节I值使电机在到底设定位置时误差尽可能小

### 4.4.2 设置编码器参数
1677567534455-55e962f0-b62c-4f20-a972-4f43f6107bce.png 

### Pulses/Rev根据编码器分辨率设置
如果编码器和电机同轴，则填写该编码器分辨率，比如编码器1024 PPR，则填1024
如果编码器和电机不同轴，经过传动机构，且和编码器同轴的齿轮和电机轴齿轮齿比是x，那么1024/x

### 4.5 两个一拖二配置(一转向，一行走)

## 两个驱动器

## 驱动器1:

Motor1接行走电机，配置为 Closed Loop Speed模式

Motor2接转向电机，配置为Closed Loop Count Position模式

## 脚本:

### 一拖二转向行走-20230111.zip

## 驱动器2：

Motor1接行走电机，配置为 Closed Loop Speed模式

Motor2接转向电机，配置为Closed Loop Count Position模式

## 脚本:

### 一拖二转向行走-20230111.zip

### 4.6 两个一拖二配置(两个行走)，双顶升配置

## 四个驱动器

## 驱动器1:

Motor1接行走电机，配置为 Closed Loop Speed模式

Motor2接行走电机，配置为Closed Loop Speed模式

## 脚本:

## 驱动器2：

## 一拖二双行走.zip

Motor1接行走电机，配置为 Closed Loop Speed模式

Motor2接行走电机，配置为Closed Loop Speed模式

## 脚本:

## 一拖二双行走.zip

## 驱动器3：

Motor1接liner电机，配置为 Closed Loop Speed模式

## 脚本:

## 单线性.zip

## 驱动器4:

Motor1接liner电机，配置为 Closed Loop Speed模式

## 脚本:

## 单线性.zip

### 4.7 两个一拖二(两个转向配置)，两个单独行走驱动器

## 驱动器1:

Motor1接转向电机，配置为 Closed Loop Count Position模式

Motor2接转向电机，配置为Closed Loop Count Position模式

## 脚本:

## 一拖二双转向.zip

## 驱动器2：

Motor1接转向电机，配置为 Closed Loop Count Position模式

Motor2接转向电机，配置为Closed Loop Count Position模式

## 脚本:

## 一拖二双转向.zip

## 驱动器3：

Motor1接行走电机，配置为 Closed Loop Speed模式

## 脚本:

## 单行走.zip

## 驱动器4:

Motor1接行走电机，配置为 Closed Loop Speed模式

## 脚本:

## 单行走.zip

### 4.8 保存设置
1677567567382-66a3ae22-3a82-4665-90f0-6651c2fd9986.png

### 4.9 脚本配置
### 4.9.1 设置数字输入限位功能(用于舵角标零)
1677567584603-31353048-3c32-4cac-8c87-ce98da04fbef.png 

### 配置完成后点击Save to Controller 按钮

### 4.9.2 下载脚本代码并设置自动运行脚本
1677567601391-094dc7e1-3fff-4a88-9322-3b8daa39a9f4.png 

1677567621032-6dd2710d-4446-44e7-8c09-cfc8c582fe56.png

1677567642311-62450589-5555-45a0-814f-1045778b8215.png

### 4.9.3 调整舵轮回零位置、速度
1677567668003-edad71c7-f3c4-427d-99e7-fb2f0c38287e.png 

1677567686938-8b44a313-4b7e-49f8-b9fb-f9bdd890c135.png 

### 设置脚本自动运行和配置与canopen相关的参数

## 错误码查看
1677567710279-5f3e26e5-2021-4287-94f2-ebbf5ba96612.png

### 五、驱动器模型文件配置
### 5.1连接到SRC-2000控制器
### 5.1.1连接网线
1677567732210-339b8801-2a76-43fd-9a2c-49e3dea56e9b.png

1677567748411-4aa1bda0-7132-456a-9512-fc5810cab131.png

### 用一根网线来建立电脑与SRC2000控制器之间的连接

### 5.1.2打开Roboshop软件
1677567771169-63b40a13-db7d-4134-be81-a3266d13fb91.png

### 5.1.3 在Roboshop中添加机器人到列表中
1677567788899-b8fadee0-0f4a-48e2-b2f6-0e33e1d320e2.png

### 5.1.4 连接配置机器人
1677567808683-d9b60dcf-eb10-4e83-b8d4-103424d59f07.png

### 5.2配置模型文件
### 5.2.1拉取机器人模型文件
1677567831637-38652ad9-1d03-40a2-b0f9-a0cfa2fab3ab.png

### 5.2.2添加电机
1677567853201-ef540754-a9ac-4461-9713-c6678f2e4df9.png

### 5.2.3设置Roboshop的电机模型ID
## 模型canID设置: x1x2
x1:驱动器CANOpen Node ID，和驱动器中配置的Node ID一致
x2:驱动器上对应的输出口号，输出口1，x2=0，输出口2，x2=1
## 例如:
一拖二驱动器：电机接到CANopenNodeID为1的驱动器的输出口1上，则canID填10，输出口2上，则canID填11；
一拖一驱动器：电机接到CANopenNodeID为1的驱动器的输出口，则canID填10

## 注：
减速⽐、编码器线数、电机最⼤转速、驱动器品牌需要根据选⽤的实际填写
### 编码器线数可以通过驱动器调试软件查看电机编码器参数配置

### 5.2.5推送模型文件
1677567953828-d120e7a0-0d95-4c37-8871-d7394525dc52.png

### 六、FAQ
## 脚本中实现找原点的逻辑：
## 1. 先给一个足够超过正限位的值让转向电机转，然后检测是否正限位触发，触发了就停止，然后将该位置的编码器值设置为正前方到该限位对应的编码器脉冲数，完成找远点。
