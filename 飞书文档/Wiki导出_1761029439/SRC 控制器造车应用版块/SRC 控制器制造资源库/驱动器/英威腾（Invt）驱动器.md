# 英威腾（Invt）驱动器

## 英威腾（Invt）驱动器

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 语雀迁移飞书

## 使用中

## 说明

本文档针对机器人自动化改造过程进行规范，使公司产品符合行业标准，保证产品质量稳定，使技术人员在进行改造过程中有章可循。
该文档适用英威腾DA200交流伺服驱动器，具体选型建议参考公司的选型指导手册。

注：本文档只适用于改造参考，不可作为技术协议及其他承担责任的内容。

## 一、适用范围

本技术规范适用于公司使用英威腾DA200交流驱动器进行自动化改造的研发、生产、调试的技术人员。
### 二、调试资源

## 驱动器相关手册：

DA200交流伺服驱动器说明书V2.4_ 20200910-20230517120104.pdf

DA200交流伺服驱动器CANopen技术指南-20230517120104.pdf
## 驱动器配置软件：

DA系列通用伺服驱动器上位机调试软件ServoPlorer V4.18.rar
## 三 、改造和安装
## 供电：220V交流
### 3.1电源接线说明
1686809261574-f3132547-b2f2-4b98-9276-89da1ac8df2d.png

### 小功率段(100W~5.5kW)单相 220V 配线图 ：
1687841451928-41910f95-48b8-480b-a2ca-7b839a2a902b.png

由上图可知：L1---L1C，L3---L2C， 不同型号接法不同，实际情况请根据现场情况进行连接。
### 3.2 上位机连接和屏幕显示
## USB Micro-B数据传输线
1687842687725-6d725736-d285-4b5e-9c93-428e091db941.png

## 屏幕按键说明：

1686809613380-0b9f7f3f-271d-4b64-8922-07dcb2d14bfa.png

### 3.3 驱动器版本
1687848033933-c43d4926-9824-40c3-9dc9-75e69010da86.png

### 3.4 急停接线说明
## 急停接线示意图：
1687841877389-40c29b69-381d-4bca-8f36-fa37ff2316b9.png

线方法是CN1的2接24v电源正极，3接24v电源负极，2对应的是COM+，3对应的是DI7
## CN1端子引脚
1687842038607-1796a6aa-4834-4bb8-b05d-8b7ef536d044.png

### CN1端子引脚定义（更多请查看驱动器原文档-P57）
1687842348379-045a7ea4-6f3c-4443-91df-01a59bb8d6ce.png

## 速度模式（非舵轮）：
配置需使用【COM+】【DI7】两个端子，其中【DI7】作为【急停】使用
## 位置模式（舵轮）：
配置需使用【COM+】【DI7】【DI8】三个端子，其中【DI7】作为【急停】使用，其中【DI8】作为【回零】使用
将所有驱动器的【COM+】并联后接入24V+，将所有驱动器的【DI7】并联后接入 SRC2000 急停输出 1+(TE35 4 号线），将另一根急停输出 1-（TE35 5 号线）接入GND。
注：TE35 的 4 号和 5 号线标无正负之分，为一组干触点，在实际接线中可以不用区分其正负。
### 3.5 进行改造（底盘驱动器部分）
## 1.驱动器需要与车体进行可靠固定，检查驱动器与对应电机的三相线、编码器线路连接正确；

2.当机器人安装有多个驱动器(数量≥2)时，所有从站的CAN_L,CAN_H引脚直接相连即可，尽量采用串联方式接线，如图4.4.1所示；若驱动器仅提供一个通讯接口，无法完成驱动器的can 线串联时，则将所有驱动器can线引出后把所有can_H压入同一德驰插筒连接器，将所有can_L压入同一德驰插筒连接器，接入德驰DT06-2S公头，最后与TE35中的32、33号线（can1)相连.

由于部分驱动器没有提供级联接口，只能通过从总线上接引线的的方式来串联，这里引线的长度需小于10CM.

注：在改造过程中若由于驱动器连接所需要的线束数量不足，无法实现在驱动器端进行快速串联，可采用图 4.4.2 所示连接方式，但不推荐。

1677659494081-b8285249-fc73-4acb-ae91-031dbd7a29d2.png

为保证can通讯质量，需要在距离核心控制器最远的驱动器上或总线末端安装终端电阻（阻值一般是120ohm).（注：客户可在购买驱动器时向驱动器厂商提出购买配套终端电阻）

### 3.CAN终端电阻是否正确打开的检测方法：

关机断电，断开驱动器和控制器的CAN连接线（如图4.4.1中Driver4和控制器之间的位置），使用万用表电阻档测量驱动器侧的CAN总线上CAN_L、CAN_H之间电阻，电阻值为120Ω则正确，如图4.4.3所示。电阻值明显小于120Ω（如60Ω),则说明至少有两个驱动器打开的终端电阻。

断开图4.4.1中Driver1和Driver2之间的连接线，使用万用表电阻档测量Driver1侧的CAN总线上CAN_L、CAN_H之间电阻，电阻值为120Ω则正确，如图4.4.3所示。如果电阻值明显大于120Ω（如几KΩ),则说明终端电阻打开的位置不在CAN总线末端，需要调整。

1677659511129-4f4135f8-3013-42c8-958a-fa44195cdffb.png

### 四、 驱动器参数配置
### 4.1 速度模式(非舵轮）配置方法
## 1.1. 连接上位机
## 识别USB后可自动连接
1687843166118-b7c85d66-93eb-4fc9-a957-7e569f89c96d.png

## 1.2. 配置参数
## 控制模式
## CAN ID
## 波特率
## 点【编辑】打开参数编辑
1687860518965-b7dbfdf1-b4e1-41d3-91ac-795469329357.png

## 1.3. PDO映射
## 映射的对象字典一定要写对
1687860591900-ebcb7b7c-fe66-48a2-bb59-111a26099a68.png

## 1.4. 打开断线检测
1687849628635-42dc908f-5ec1-4ac4-a183-cc011c4d2ef8.png

## 1.5. 配置急停
急停只能配置在【开关量输入7】 ，否则可能会出现急停恢复后驱动器无法使能的问题
1687861938765-a2953225-acff-40f8-a43e-8dce2d56508c.png

点击【1】进入编辑模式，修改完参数后，依次点击【2】【3】，保存参数，然后再点击【1】退出编辑模式进入只读模式，此时可以尝试触发对应的开关量，查看触发状态是否正确。
1687862008590-e85b9fd6-9948-46ec-8454-7808cd697b15.png

### 4.2 位置模式（舵轮）配置方法
## 重复 4.1 的步骤 1~5
## 1.1. 配置限位开关
点击【1】进入编辑模式，修改完参数后，依次点击【2】【3】，保存参数，然后再点击【1】退出编辑模式进入只读模式，此时可以尝试触发对应的开关量，查看触发状态是否正确。
### 正确状态为，触发限位开关后，状态反馈由【红色】变为【绿色】
1687862964496-f4c9702d-bd13-4db9-ba14-6659cecb3e4c.png

## 1.2. 回原点配置
## 【P5.10】 回原点模式配为【22】
【P5.12】第一段速度为找零速度，该参数越大，找零速度越快，根据现场需求合理配置该参数
【P5.13】第二段速度建议设在较低值，该值过大的话可能会导致零位不准
1687863205673-74772532-1b0c-47a1-8630-51357b3a7637.png

## 直接双击该参数可进入修改模式
1687863441813-fd2d4d09-89cf-4229-9565-fffe84e9d831.png

### 4.3 结束配配置，保存参数
参数配置完成后下载参数到驱动器，然后 断电重启后参数生效 。
1687863922980-f83a11c5-8722-49a7-94ab-44b30b83a71c.png

### 五、附录
## 1. 绝对值编码器清零操作
1687320390140-806600dd-396d-4e81-af43-3f622eec4d9b.png

### 2. 错误码及对策
1686800570375-61dab441-f428-4fa1-a60e-ecf6c7ebfdb3.jpeg

错误码0x3063上报的数据十六进制，转换成二进制对应下面的数值关系是：
0x3063上报0x0A29 转换二进制2601 对应下面的Er26-1
## 0A30-2608-Er26-8
1687864023326-5d404e99-18cc-493e-8cf6-df12de3c8a77.png

1687864036029-6012ea41-298c-4400-bc49-61441d62c285.png

1687864045853-e44d7993-77b1-481a-add3-4072471ab309.png

1687864057220-a860bea9-b13d-4fcc-bc4b-333859728875.png

1687864071647-7c86181b-2776-4d24-9fd1-f3aca6e85ea4.png

1687864080450-c916588d-b238-4756-9bbe-280eb9ef71c8.png

1687864090404-52746a29-77f8-4d00-bf5b-a44d63694908.png

1687864105255-e69281cc-efd3-42c1-9809-33fe8b3d94b1.png

1687864113860-51a2c08d-9e4c-4298-9756-41888f1c26a6.png

1687864127561-2587fc8a-6eb3-437e-bf14-34962d6625b9.png

1687864134644-7d538cec-62ab-4936-a22b-660428750409.png

### 六、PDO报文配置方法和CAN工具使用（仅记录）
## 1. CAN报文配置TPDO：
定义映射时，先设置子索引禁用；再设置相应映射；然后设置映射数量
首先配置TPDO1，对应的索引是0x1800 ，映射索引是0x1A00，节点id是0x0181
1686800130456-2ade15f5-a2c7-404d-9b65-0b056dd2d84a.png

### 23 00 18 01 81 01 00 C0 停止TPDO1，1800的子索引01的最高位,置1
### 回复60 00 18 01 00 00 00 00
### 23 00 1A 00 00 00 00 00 清除0x1A00以前映射项数 设置子索引00 无映射项
### 回复60 00 1A 00 00 00 00 00
### 23 00 1A 01 20 00 6C 60 设置0x1A00 01通道，0x606C0020， 606C当前速度，20是数据长度为32位
### 回复 60 00 1A 01 00 00 00 00
### 23 00 1A 02 20 00 64 60 设置0x1A00 02通道，0x60640020，6064编码器值，20是数据长度32位
### 回复60 00 1A 02 00 00 00 00
### 23 00 1A 00 02 00 00 00 设置0x1A00 映射通道数=2
### 回复 60 00 1A 00 00 00 00 00
### 23 00 18 05 F4 01 00 00 设置0x1800 通信参数中的循环周期500ms
### 回复60 00 18 05 00 00 00 00
### 23 00 18 01 81 01 00 40 激活TPDO1，0x1800的子索引01的最高位,置0
### 回复 60 00 18 01 00 00 00 00
## 000 01 01 启动01节点
1686800206390-81b828c5-e935-4a80-98ad-f8c4bfbf771e.png

查询6041状态字，刚好对应TPDO1的前16位；电机还没转动，所以速度00；
1686800231461-ce35ec84-5d02-4fa7-a16b-939c9a1c9167.png

如果需要修改参数，先禁止驱动器使能，2b 40 60 00 00 00 00 00
然后调整到预操作状态，000 80 00（00是广播所有节点，000 80 01是设置01节点预操作）
在进行后续参数修改。
### 2. 配置错误状态查询和错误码查询：
### 6041 状态字 16bit 3063 错误码 16bit
## 配置这两个OD在TPDO3
### 23 02 18 01 81 03 00 C0 停止TPDO3，1802的子索引01的最高位,置1
### 回复60 02 18 01 00 00 00 00
### 23 02 1A 00 00 00 00 00 清除0x1A00以前映射项数 设置子索引00 无映射项
### 回复60 02 1A 00 00 00 00 00
### 23 02 1A 01 10 00 41 60 设置0x1A02 01通道，6041
### 回复 60 02 1A 01 00 00 00 00
### 23 02 1A 02 10 00 63 30 设置0x1A02 02通道，3063
### 回复 60 02 1A 01 00 00 00 00
### 23 02 1A 00 02 00 00 00 设置0x1A02 映射通道数=2
### 回复 60 02 1A 00 00 00 00 00
### 23 02 18 05 F4 01 00 00 设置0x1800 通信参数中的循环周期500ms
### 回复60 02 18 05 00 00 00 00
### 23 02 18 01 81 03 00 40 激活TPDO1，0x1800的子索引01的最高位,置0
### 回复 60 02 18 01 00 00 00 00
## 000 01 01 启动01节点
### 3. 配置RPDO：
首先配置RPDO1，对应的索引是0x1400 ，映射索引是0x1600，节点id是0x0201
### 23 00 14 01 01 02 00 80 停止RPDO1，和之前一样
### 23 00 16 00 00 00 00 00 清除RPDO1映射项
### 23 00 16 01 10 00 40 60 设置6040 16位作为第一个映射
### 23 00 16 02 20 00 FF 60 设置60FF 32位作为第二个映射
### 23 00 16 00 02 00 00 00 设置RPDO1映射项为2
### 23 00 14 05 F4 01 00 00 设置0x1400 通信参数中的循环周期500ms
### 23 00 14 01 01 02 00 00 使能RPDO1
### 201 0F 00 使能驱动器，相当于对6040设置0F
### 201 0F 00 64 00 00 00 00 使能驱动器并设置速度100r/min

以上参数重启后生效；重启后再次读取一下对应参数，防止修改失败
