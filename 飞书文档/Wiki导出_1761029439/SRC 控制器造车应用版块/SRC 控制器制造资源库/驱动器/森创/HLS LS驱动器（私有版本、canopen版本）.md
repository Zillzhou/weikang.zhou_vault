# HLS LS驱动器（私有版本、canopen版本）

### HLS LS驱动器（私有版本、canopen版本）

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 语雀迁移至飞书

## 使用中

## 说明

本文档针对机器人自动化改造过程进行规范，使公司产品符合行业标准，保证产品质量稳定，使技术人员在进行改造过程中有章可循。

机器人自动化改造涉及传感器众多，建议采用我司标准核心控制器线束TE23,TE35,本文档以核心控制器标准线束为蓝本进行作业指导。

HLS伺服驱动器选型建议参考公司的选型指导手册。

注： 本文档只适用于改造参考，不可作为技术协议及其他承担责任的内容。

## 一、适用范围

本技术规范适用于公司使用森创驱动器进行自动化改造的研发、生产、调试的技术人员。
### 二、调试资源

### 三、改造和安装
### 3.3 类Kiva顶升部分DI使用规范

### 3.3.1 接线说明

## 顶升部分 DI 使用规范

## 序号

## DI

## 功能

## SRC 线号

## 1

## DI2

## 顶升下限位开关信号

## T23   6 号线

## 2

## DI5

## 顶升上限位开关信号

## T23   7 号线

## 3

## DI6

## 旋转零位信号

## T23   5 号线

注 1: 在顶升车上这三个 DI 不能作为其他其他用途；

注 2 ： 确保这三个传感器的均为 NPN 型，发出的信号能被 SRC 核心控制器检测到 。

### 3.4 进行改造（底盘驱动器部分）

### 3.4.1 行走电机驱动器安装方式

## 1.驱动器需要与车体进行可靠固定，检查驱动器与对应电机的三相线、编码器线路连接正确；

2.当机器人安装有多个驱动器(数量≥2)时，所有从站的CAN_L,CAN_H引脚直接相连即可，尽量采用串联方式接线，如图4.4.1所示；若驱动器仅提供一个通讯接口，无法完成驱动器的can 线串联时，则将所有驱动器can线引出后把所有can_H压入同一德驰插筒连接器，将所有can_L压入同一德驰插筒连接器，接入德驰DT06-2S公头，最后与TE35中的32、33号线（can1)相连.

由于部分驱动器没有提供级联接口，只能通过从总线上接引线的的方式来串联，这里引线的长度需小于10CM.

注：在改造过程中若由于驱动器连接所需要的线束数量不足，无法实现在驱动器端进行快速串联，可采用图3.4.2所示连接方式，但不推荐。

1689324867699-464f309c-84c7-46be-948e-7cef4a387769.png

## 图3.4.1   图3.4.2**

为保证can通讯质量，需要在距离核心控制器最远的驱动器上或总线末端安装终端电阻（阻值一般是120ohm).（注：客户可在购买驱动器时向驱动器厂商提出购买配套终端电阻）

### 3.CAN终端电阻是否正确打开的检测方法：

关机断电，断开驱动器和控制器的CAN连接线（如图4.4.1中Driver4和控制器之间的位置），使用万用表电阻档测量驱动器侧的CAN总线上CAN_L、CAN_H之间电阻，电阻值为120Ω则正确，如图4.4.3所示。电阻值明显小于120Ω（如60Ω),则说明至少有两个驱动器打开的终端电阻。

断开图4.4.1中Driver1和Driver2之间的连接线，使用万用表电阻档测量Driver1侧的CAN总线上CAN_L、CAN_H之间电阻，电阻值为120Ω则正确，如图4.4.3所示。如果电阻值明显大于120Ω（如几KΩ),则说明终端电阻打开的位置不在CAN总线末端，需要调整。

1689324931943-90356d29-d200-495f-8a2e-68282c236e2f.png

## 图3.4.3

4.森创驱动器采用控制电机是否使能的方式来实现急停与否的功能。电机是否使能可以通过控制驱动器上相应IO口电平高低的方式来实现，如图4.4.4所示，将所有驱动器的COM+并联后接入DCDC 24V+ 输出；将所有驱动器IN1并联后连接SRC2000急停输出1+（TE354号线），将另一根急停输出1-（TE355号线）连接DCDC 24V-输出；（下图仅供参考，请按照实际的电气原理图进行接线相关操作）

1689324965513-6e2fc73a-5e7d-40b2-867c-764ada463aeb.png

## 图3.4.4

注：TE35 的 4 号和 5 号线标无正负之分，为一组干触点，在实际接线中可以不用区分其正负。

### 3.5 电机抱闸线处理方式

1.若采用的电机为带抱闸的电机，为实现驱动器断电后仍能推动机器人到指定地点的目标，将电机抱闸由SRC2000核心控制器直接控制，将抱闸开关外接，方便手动控制抱闸，同时保留机器人失电抱闸功能。

2.将两电机Brake+、Brake- 线分别接入T23【15】抱闸输出、T23【16】地；将T23【17】抱闸开关、T23【16】地接入短柄旋钮开关；T23的【16】地线为共用地线，最终效果如图3.5.1所示：

1689324986241-4948ee52-f642-4029-bc89-8b14331eafb3.png

## 图3.5.1

### 四、 驱动器参数配置

## 前提：

### 适用驱动器类型：一体式，一对一式，一拖二式

需要注意一拖二式驱动器配置方法，HLS一拖二驱动器采用的方式为物理上两个驱动器共用一个封装，走同一路通讯，一拖二的两个驱动器依靠节点号区分即SYNTORN 软件中的站址，两个节点互相独立需单独配置参数，修改参数后需按回车再点击下载，修改站址后重启生效

1689325005792-fbc73fc0-8636-4364-96b7-e2d90072a514.png

驱动器配置软件SYNTORN及软件使用手册请联系驱动器厂商官方售后。
## SYNTRON20191028.7z

### 4.1 私有协议配置方法

【can波特率】将驱动器can 波特率更改为250KHz,更改参数Fn_0f3值为250,如图4.6.1所示；

1689325026336-32b8ac6e-6ae0-426a-b331-7d9671ac63fa.png

## 图4.1.1

【驱动器I/O】由于我们接线使用了IN1,所以需要在I/O配置界面做出相应的配置，更改参数Fn_012值为“-1”，如图4.1.2所示；

注：若驱动器型号是无IO急停配置的，更改Fn_012值为“1”

（Fn_012：紧急停止设置：1：内部使能，0：内部关闭，-1~-8：选择数字1-8路输入）

1689325038866-19788d75-7bda-46e6-86d5-0bfc2cfadf05.png

## 图4.1.2

【工作模式】并将总线控制模式更改成“速度运行模式”，更改参数FN_000值为3;

【选择通讯模式】将驱动器工作模式更改为CAN总线控制模式，更改参数FN_003值设为2；

配置方式如图4.3所示；

1689325049095-d5c86768-cc8b-4ce4-81ff-646177b26c80.png

## 图4.1.3

【驱动器编号】分别给驱动器给予不同的 can ID,双轮差动机器人，将左边的驱动器编号为 ID 1,右侧驱动器编号为ID 2,顶升驱动器地址ID 3,旋转驱动器地址ID 4,驱动器CAN ID 明细如表3.6.1所示，配置方式如图4.1.4所示；

1689325059905-ce066133-5183-4811-9a94-812b0005f131.png

## 图 4.1.4

注：参数FN_0f4为CAN总线节点地址,修改CAN总线节点地址即修改驱动器的CAN ID,FN_0f2需要与FN_0f4 保持一致，加载参数时，左上角的站址就是FN_0f2（节点号）

## 驱动器 CAN ID 分配规范

## 序号

## 驱动器

## CAN ID

## 1

## 左驱动轮驱动器（激光视角）

## 1

## 2

## 右驱动轮驱动器（激光视角）

## 2

## 3

## 顶升驱动器

## 3

## 4

## 旋转驱动器

## 4

## 表4.1.5

【通讯超时】将驱动器通讯超时更改为“关闭”，将参数FN_1c0值设为0,如图4.16所示；

1689325073809-45856bfb-9d50-4f0d-89e6-a0bee56b44c9.png

## 图4.1.6

【配置看门狗功能】（仅支持森创驱动器LS,DM,SM系列）确认参数FN_1c0参数值为0,将参数Fn_1cb配置为1,参数Fn_1cc配置为-1,参数Fn_1cd配置为500,参数FN_1ce配置为400.如图4.1.7所示。

1689325086502-60b9c541-a558-4f59-ba8c-f15f4125572d.png

## 图4.1.7

【低速位置闭环】将参数Fn_07E配置为1,参数Fn_07F配置为1.如图4.1.8所示。

1689325097266-70c14841-171f-4955-b448-34e4105b275b.png

## 图 4.1.8

参数修改结束后，将参数下载至驱动器，然后对驱动器进行断电重启，如图3.6.9所示。

1689325108327-a66b4539-a0e7-4525-83b8-cca7fd2d03b3.png

## 图4.1.9

所有参数也可以通过txt文档进行加载，加载方式为文件>加载参数文件（*.txt），在弹出的对话框内选择需要加载的Config。加载完成之后，下载至驱动器。如图 4.1.10 所示。

1689325118948-1843faf3-d3ea-4cc3-b134-09618c312b0a.png

## 图 4.1.10

附件是参考Config文件, 非通用 。如有更改，需自行更改需要更改的Config参数。

## HLS_Config.txt

### 4.2 canopen协议配置方法

需确保驱动器版本是 20200901 ，通过Dn_7b和Dn_7c可查询版本，如果不是，联系hls更新至该版本

1689325130204-33077dc2-6656-4d69-a879-f06b4303cdf5.png

如果驱动器是canopen协议 ，配置前先恢复出厂设置；给Fn_007写入1，下载后重启生效；不同节点需要单独恢复出厂设置

1689325139538-2b14a438-cf56-4011-8fc5-6156a1e85685.png

## 配置步骤同私有协议步骤 1 ~ 9

完成上述参数配置后，需要通过CAN卡发送配置报文，设置驱动器上电 自动打开NMT ，can卡使用方法参考本文8.3章节
如图是USB_CAN_TOOL界面，ID栏为该条报文ID(上述步骤配置的驱动器ID)
## 发送ID = 0x0600 + ID
### 驱动器回复ID = 0x0580 + ID
## 以ID = 1 的驱动器为例
## 发送ID = 0x0601
## 驱动器回复ID = 0x0581
发送一条报文给驱动器， 必须收到驱动器的回复报文 ，才能判断该条报文发送成功，如果未收到回复报文，则认为报文发送失败，报文发送失败的可能原因有以下几点：
## 驱动器供电异常
## can总线接线错误
## 发送报文ID与目标驱动器ID不同
## can总线需要接终端电阻
1689325155812-6038ddaa-f730-44f3-864d-c60a488cda21.png

## 注：发送配置报文时can总线只接驱动器

### 以下配置 均以设备ID为1 的驱动器为例：

### 通过can卡发送can报文【将0x55AA写到1004h】
## 发送ID： 0x0601
### 数据内容： 2b 04 10 00 AA 55 00 00
## 驱动器回复ID ： 0x0581
## 收到驱动器的回复ID才认为完成该项配置

### 4.3 转向驱动器（舵轮）配置
### 暂无回零配置方案，建议使用转向使用绝对值编码器
增量式编码器的转向暂时没有限位回零方案可用，只有一份客户提供的堵转回零方式（参见附录8.5），但不推荐使用，客户反馈之前出现过堵转回零烧电机的情况

### 配置步骤与canopen协议的步骤完全相同
手动写入转向驱动器的执行速度和加减速度， 位置模式（行走）驱动器不需要设置该项 

## 以设备ID为1的驱动器为例

## 依次发送can数据【手动发送数据】

发送ID 0x601   23 81 60 00 E0 93 04 00 【速度设为30000】

发送ID 0x601   23 83 60 00 E0 93 04 00 【加速度设为30000】

发送ID 0x601   23 84 60 00 E0 93 04 00 【减速度设为30000】

发送ID 0x601   23 10 10 01 73  61 76 65 【保存配置】

注 ：以上每条报文发送后都需要收到驱动器回复报文方可认为参数配置成功，由于保存参数时间较长， 保存配置报文的回复会较慢，等待收到回复报文后才认为保存成功 。如未收到报文回复，则未保存成功，重复上述步骤。每个设备重复上述操作

## 设置完参数后重上电生效

### 五、机器人模型配置说明

### 5.1 根据电机及减速实际情况配置行走电机参数

Roboshop 版本是2.0.X（固件版本为1.8.X及以下），请参考机器人模型图5.1.1所示；Roboshop 版本是2.1.X（固件版本为1.9.X及以上），请参考机器人模型图5.1.2所示；

1689325172773-abbf2a15-0c19-4d79-880f-f5f416faa8d5.png

## 图5.1.1  图5.1.2

注：减速比、编码器线数、电机最大转速、驱动器品牌需要根据选用的实际填写 。

## 5 .2 . 配置顶升部分 DI 参数

### 5.2.1 Roboshop 版本是 2.0.X 及固件版本为 1.8.X 及以下

1.将一个DI拖动至车体上任意位置，将DI编号更改为6,func 配置为none,type配置为none，maxDist配置为0，如图5.2.1 所示；（DI6为旋转零位信号）

1689325185780-a58324a1-6c09-4888-8610-9b0ef8c8a346.png

## 图 5.2.1

### 2.保存并推送model文件，等待45s后,打开Roboshop中I/O配置，按照表查看DI6状态,如图5.2.2,表5.2.1所示;

1689325196419-1c592eff-3785-40c7-a959-2334a934e321.png

## 图 5.2.2

## 顶升部分 DI 状态确认表

## 序号

## 动作

## DI6 状态

## 需采取措施

## 状态一

## 手动触发 DI6

## 绿色

## 状态正常，不需要采取任何措施

## 不触发 DI6

## 红色

## 状态二

## 手动触发 DI6

## 红色

状态需要取反，勾选 4.2.1 中 inverse 选项并重新上传 model

## 不触发 DI6

## 绿色

## 状态三

## 手动触发 DI6

## 绿色

## 检查传感器是否被其他物体触发

## 不触发 DI6

## 绿色

## 状态四

## 手动触发 DI6

## 红色

## 检查传感是否存在故障或选型错误

## 不触发 DI6

## 红色

## 表 5 .2. 1

### 3.重复步骤1,2 将DI2,DI5正确配置至model文件。

### 5.2.2 Roboshop 版本是 2.1.X 及固件版本为 1.9.X 及以上

1.在机器人模型里左侧设备选型添加一个DI设备，将DI编号ID更改为6,func 配置为none,type配置为none,maxDist配置为0,如图5.2.3所示；（DI6为旋转零位信号）

1689325209007-f6a0ca33-f7d6-4b68-959a-f7878d506f88.png

## 图5.2.3

保存并推送model文件，等待45s后，打开Roboshop中I/O配置，按照表查看DI6状态,如图5.2.4,表5.2.4所示;

1689325220103-621ea9a4-2298-487d-b416-e3c7e812a0d9.png

## 图 5.2.4

## 顶升部分 DI 状态确认表

## 序号

## 动作

## DI6 状态

## 需采取措施

## 状态一

## 手动触发 DI6

## 绿色

## 状态正常，不需要采取任何措施

## 不触发 DI6

## 红色

## 状态二

## 手动触发 DI6

## 红色

状态需要取反，勾选 5.2.4 中 inverse 选项并重新上传 model

## 不触发 DI6

## 绿色

## 状态三

## 手动触发 DI6

## 绿色

## 检查传感器是否被其他物体触发

## 不触发 DI6

## 绿色

## 状态四

## 手动触发 DI6

## 红色

## 检查传感是否存在故障或选型错误

## 不触发 DI6

## 红色

## 表 5.2. 2

重复步骤1,2 将DI2,DI5正确配置至model文件。

## 5 .3 配置顶升、旋转驱动器参数
具体步骤参考 https://shimo.im/docs/dL9kBMz8b8EcYqK5/ 《类 Kiva 顶升改造指导书》，步骤2,步骤3,步骤4；

### 六、异常处理

### 6.1 森创驱动器（LS-10530D2）上电不能使能异常情况处理

这款驱动器若出现上电不能使能情况，可通过修改驱动器1004隐藏位以及1010隐藏位进行修改，具体操作步骤如下：

## 1.使用CAN卡在驱动器1004位写入2B 04 10 00 AB 55 00 00,如图6.1.1所示：

1689325233013-72a8bded-4817-4396-8af5-a75503867086.png

## 图 6.1.1

### 2.使用CAN卡在驱动器1010位写入23 10 10 02 73 61 76 65,如图6.1.2所示；

1689325242364-1ee69b52-e471-4510-87ff-bad508e40469.png

## 图6.1.2

### 6.2 其他型号驱动器修改参数不能使能情况处理**

## 1.询问供应商项目所选用的电机编号，正确填写入F0007,确认修改，将参数传入驱动器；

### 2.将F0006参数修改为1,确认修改，将参数传入驱动器，此时对启动器进行断电重启，此时驱动器参数将全部载入默认参数，如图6.2.1所示

1689325251824-23724c01-e49f-4028-8ad9-3beaf95d4476.png

## 图6.2.1

### 3.按照上文中的4.1-4.7重新配置驱动器参数，然后对驱动器断电重启。

注：Fn007为恢复出厂设置，仅需使用一次，后续就不需要再次写入“1”，否则驱动器将再次恢复出厂参数。

### 6.3 舵轮转向后无法控制回到零位

## 配置舵轮的速度以及加减速度三条报文

### 6.4 canopen协议的驱动器急停恢复后无法使能

### 联系驱动器厂家更新驱动器版本至20200901

### 七、 驱动器行走电机的功能检测

在整车组装完成未安装外壳前，请再检查一遍接线确保接线正确。
将车体架高，使轮子离地。开启机器人，使用网线连接机器人。使用Roboshop 软件操作机器人让轮子转起来。 使用CanScope夹在CAN总线上检测CAN 报文至少1小时，CAN报文无错误。
让车体着地，使用Roboshop软件操作机器人做运动动作:向前，向后，向左，向右运动未拍急停按钮前，推动机器人，无法推动（电机使能），检查Roboshop 中机器人状态处于“未急停”“驱动器未急停”，如图7.1所示；所示拍下急停按钮后，再次机器人，可以推动（电机使能释放），检查Roboshop 中机器人状态处于“已急停”，“驱动器已急停”。如图7.2所示。

1689325263109-7e9e8de9-d66b-4684-b44d-238953fe42b4.png

### 图 7.1           图 7.2

任务链运动老化测试24H，查看Robokit Log无错误报警。

### 八、附录

### 8.1 通讯端子引脚分布及定义

1689325275244-fb23d95e-27c6-4a04-9e04-dd13be347ec4.png

### 8.2 致远 CAN Scope 使用方法

软件安装--安装CAN Scope配套软件CANScope.（软件及使用手册请联系致远厂商售后）.
硬件连接--参考CAN Scope使用手册接好电源，USB 调试线，插上CAN Port板，将CAN_H接到SRC2000 外接线束TE35 33号线上，将CAN_L接到SRC2000 外接线束TE35 32号线上。USB调试线插在电脑上。
打开软件CANScope,选择【Port板】，取消【启用终端电阻】，选择【报文】，配置【波特率】为250Kbps,取消【总线应答】，选择【开启】，CAN报文实时如图8.2.1所示。

1689325292379-090a2987-68a4-4a32-bd2c-a04b101c4632.png

## 图 8.2.1

选择【状态】【错误】，检查是否有错误报文。如图8.2.4所示。

1689325308239-7e719335-2216-4a95-a563-ba7e806abf45.png

## 图 8.2.2

### 8.3 USB CAN 卡使用方法

软件安装—安装软件USB_CAN Tool（软件及使用手册请联系CAN卡厂商售后）。
硬件连接—准备USB CAN卡和连接线，将连接线CAN_H接到SRC2000 外接线束TE35 33号线上，将连接线CAN_L接到SRC2000 外接线束TE35 32号线上。如图8.3.1所示。

1689325319691-09dc4898-9414-4e1f-b687-38fdb5fca622.png

## 图 8.3. 1

打开USB CAN tool ,选择【设备操作（O）】【启动设备（S）】,确认CAN参数，【波特率】为250Kbps,选择【CAN通道号】为通道1,点击【确认】。如图8.3.2所示：

1689325328918-24087641-6875-4064-bb41-af9ac52480b4.png

## 图 8.3. 2

选择【显示（V）】，取消选择【合并相同ID数据(M)】，CAN报文如图8.3.3所示。

1689325341336-45d9ffc4-ae9c-4f8e-bc78-ee645096492b.png

## 图 8.3. 3

### 8.4  udpconsole 使用方法

udpConsole是我司工程师用于调试bug开发的小工具，可以检查到固件上报的错误信息。

打开udpconsole工具前需用网线确保电脑与机器人的物理连接。
打开udpconsole,进行驱动器功能测试，时刻检查udpconsole显示内容。

### 驱动器通讯过程中出现错误帧如图8.4.1所示：

1689325354662-8d401096-0b16-47d4-9dec-c5db6818f56f.png

## 图 8.4.1
### 8.5 HSL-CANopen协议位置模式堵转找零（未实测，不推荐，该处仅做记录）

## 舵機堵轉自主找零配置.docx

### 九、驱动器常见错误码

### 错误码转换成十进制后对应下表【数字报警代码】

例：错误码为0x0B54，转换为十进制是2900，对应【释义】为【堵转或失速】

1689325367642-fe87c2de-0df5-4298-924a-9d58d3388057.png

1689325379158-a392f8f7-50a2-4c93-a517-75d5eb20ea7e.png
