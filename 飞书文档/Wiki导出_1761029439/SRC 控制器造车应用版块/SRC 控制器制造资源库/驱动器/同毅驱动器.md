# 同毅驱动器

## 同毅驱动器

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 语雀迁移至飞书

## 使用中

## V2.0

### 2024.5.28

## 内容更新

## 使用中

## 适用范围

本技术规范适用于公司使用同毅驱动器进行自动化改造的研发、生产、调试的技术人员。

## 调试资源
## 驱动器手册：

IXL-II系列伺服驱动器用户手册7.6-20240509.pdf

### 同毅自动化舵轮及驱动器简易使用手册-240403.pdf
## 调试软件：

## 调试软件.zip
## 同毅舵轮和驱动器选型问题 ：
## 链接内容已放置在本文末尾！
( 内有绝对值编码器方案相关解答，以下配置文档针对增量编码器方案。 )
（推荐的转向方案尽量使用绝对值编码器，可以让配置更简单，问题相对较少）
## 改造流程
## 进行改造（底盘驱动器部分）
参考机械设计图、电气图，驱动器需要与车体进行可靠固定，检查驱动器与对应电机的三相线、编码器线路连接正确；
1677207011342-d1c968b2-72f5-42e2-a46d-d645f3549e64.png

## 图3-1 驱动器端子示意图
当机器人安装有多个驱动器(数量 ≥2)时，所有从站的 CAN_L , CAN_H 引脚直接相连即可，采用串联方式接线；将 Driver4 最终引出的 CAN_H 压入一个德驰插筒连接器，同理将 CAN_L 压入一个德驰插筒连接器，接入德驰 DT06-4S 公头。最后与 T35 中的 32 , 33 号线（can1）相连；
## 注意：各型号驱动器引脚定义详见附录
1677207078449-a19151b5-65cb-49c9-a09a-f402ed5f5e67.png

## 图3-2 驱动器串联方法
为保证 CAN总线 通讯质量，需要将距离核心控制器最远的驱动器上的 120Ω 终端电阻打开，如上图3-2中将 Driver1 驱动器上终端电阻通过拨盘打开；其他 Driver2 , Driver3 , Driver4 的终端电阻关闭，打开时终端电阻开关如图3-3所示；
1677208795236-8b65eb96-70f3-429b-9ca6-0c861625a640.png

## 图3-3
## 终端电阻是否正确打开的检测方法：
关机断电，断开驱动器和控制器的 CAN 连接线（如图 3-2中 Driver4 和控制器之间的位置），使用万用表电阻档测量驱动器侧的 CAN 总线上 CAN_L,CAN_H 之间电阻，电阻值为 120Ω 则正确，如图3-4 所示。电阻值明显小于 120Ω （如 60Ω），则说明至少有两个驱动器打开的终端电阻。
断开图 3-2 中 Driver1 和 Driver2 之间的连接线，使用万用表电阻档测量 Driver1 侧的 CAN 总线上 CAN_L , CAN_H 之间电阻，电阻值为 120Ω 则正确，如图3-4所示。如果电阻值明显大于 120Ω （如几 KΩ)，则说明终端电阻打开的位置不在 CAN 总线末端，需要调整。
1677208854779-f9b14863-c85e-4bd1-ae7f-d45ea357fa6e.png 

## 图 3-4
公司适配的国产驱动器采用控制电机是否使能的方式来实现急停与否的功能。电机是否使能可以通过控制驱动器上相应 IO 口电平高低的方式来实现；
同毅驱动器如图 3-5 所示，将驱动器的控制信号端子 22 号针脚（+15V_DIG）接入 1 号针脚（IO_COM+),将所有驱动器控制信号端子的 2 号针脚（USRC_DI1）并联后连接 SRC2000 急停输出 1+(TE354 号线），将所有驱动器的 20 号针脚（GND_DIG）并联后连接另一根急停输出1-（TE355 号线）连接。
如果作为转向电机的驱动器，需要接限位传感器，限位传感器电源可由驱动器提供，正极接驱动器的控制信号端子 22 号针脚（+15V_DIG），负极接驱动器的控制信号端子的 20 号针脚（GND_DIG），正方向限位传感器信号输出接驱动器的控制信号端子 14 号针脚（USRC_DI2）,负方向限位传感器信号输出接驱动器的控制信号端子 15 号针脚（USRC_DI4）。
1677208901050-354b7707-1e0e-4874-8569-6cb509629b77.png

## 图 3-5
## 电机抱闸线处理方式
### 同毅的行走电机支持抱闸，接线方式如图 3-6 所示：
1677208944630-d0c0decb-8d51-4ef8-a9cf-1925356fb02b.png 

## 图 3-6
## 驱动器配置
## 通信连接
## 线序说明
1677209016847-e8bc659d-7439-4560-8f4a-2004242a15e0.png

## 驱动器软件版本说明
1677209037581-fe42addb-79cd-4319-b002-409889855eb1.png

## 老版本固件：
### 9.1 ：代表9月1号；
### 9.829 ： 代表9月29号，8代表带485固件更新功能（BootLoader）；

## 新版本固件：
### 2203.801：代表2022年3月1号，8代表带485固件更新功能（BootLoader）；
22103.801：代表2022年3月1号，8代表带485固件更新功能（BootLoader），22后面的1代表可以MCU不同引脚数可以切换选择的功能，既P_144和P_196切换。目前还没投入生产。
### 22203.801：代表2022年3月1号，8代表带485固件更新功能（BootLoader），22后面的2代表IXL150驱动器P_144版本的固件。
### 12206.815：代表2022年6月15号，最前面的1代表通用版本，8代表带485固件更新功能（BootLoader）

## ！！！无问题的版本
1677209106441-9e3846d9-3905-499c-be1f-e3c1801feb97.png

目前可用无问题的版本需要在此版本12206.815之后（不清楚是老版本还是新版本，可以拿读到的截图问供应商。）
目前可用无问题的版本需要在此版本12206.815之后（不清楚是老版本还是新版本，可以拿读到的截图问供应商。）
目前可用无问题的版本需要在此版本12206.815之后（不清楚是老版本还是新版本，可以拿读到的截图问供应商。）

打开上位机软件 （ xml配置文件及上位机软件需要问驱动器供应商询要）

1677209140803-47a32a44-b4cb-49d6-b2d4-b54b2a0ba8be.png

## 导入xml文件：
## 打开easyDRIVER软件，弹出上图
## 选择导入准备中的xml文件
1677209155046-12fcf18f-2d4f-41f1-9e2c-9bec4d68e914.png

## 连接串口
1677209171707-0472c8d0-d648-4582-a3f4-c45c0bed15b7.png

选择RS485通信卡的串口号，点击连接，成功连接后右下方如图显示：
1677209186929-d906ae27-3559-48a9-b037-c6c2715711fd.png

## 修改通用参数
## 修改canopen参数
1677209209952-ca3c69d8-9241-495b-a995-175c2cfa07ee.png

## 选择参数
## 选择Canopen参数配置
## 修改波特率为 250kps
修改节点id为特定值（模型文件中配置需要对应，所有驱动器都不能一样）
## 将PDO数量改成 0
### 打开canopen使能开关，选择 Enable
## 点击保存驱动参数

### 修改行走电机参数（行走驱动器参考该部分）
## 修改使能及模式
1677209236126-fccb805f-0e3d-4029-9d6b-af535f39d190.png

## 进入驱动器控制参数
## 关闭内部IO使能，选择 off
### 修改控制模式选择，选择 Stdspeed loop
## 保存
## 修改速度模式参数
1677209253391-f6a4b5a8-891f-4520-b61f-67f44c511b75.png

## 选择速度控制参数
## 修改停止段KP为 20000
## 修改停止段KI为 100
## 修改低速段KP为 30000
## 修改停止段KI为 100
## 保存
## 修改电流控制参数
1677209277592-6fe7ea55-4f57-49a8-92bf-0d30ac09498a.png

## 选择电流控制参数
## 修改Iq电流KP为100
## 修改Id电流KP为100
## 保存
### 修改转向电机参数（转向驱动器参考该部分）
## 修改使能及模式
1677209295418-3624338e-4d10-487b-9a51-eaab5d6bb07b.png

## 选择驱动器系统控制参数
## 修改内部IO控制使能为off
### 修改控制模式为StdSpace loop
## 保存
## 修改电流控制参数
1677209312600-1f26a809-4be7-40b5-9ad3-9f18cdf76796.png

## 选择电流控制参数
## 修改Iq电流KP为30
## 修改Id电流KP为30
## 保存
## 修改位置控制模式参数
1677209326472-85c2a91f-0ec2-4207-8207-dd53e1555c87.png

## 选择位置控制模式
## 修改 限位模式为 2
## 注意：
此前的版本有bug，同毅驱动器软件版本需要为 20220815 后的，软件版本如何查看请看“驱动器软件版本说明”章节，在这之后都具有此功能，若发现 xml文件 无限位模式选项及软件版本早于该日期，请联系同毅进行升级
## 保存
## 设置复位参数
1677209345254-0321b774-e272-402b-8715-a1f6bf5f23c7.png

选择电机复位控制，同时将轮子转到正前方（0位位置）。
修改回零模式为1（转向电机必须安装负限位开关，和驱动器IO负限位相连）
## 修改零点偏置为00000
## 保存

## 机器人模型文件配置说明
1677209361995-f64453b5-ea03-42ec-bdcd-6cb602cb1243.png

在安装舵轮时，请将舵轮按照如图方向进行安装；若为双舵轮，请将两个舵轮都按照超前的方向进行安装，避免关于原点对称安装（该方式可行，但存在坐标系转换，理解起来比较绕。）如下模型介绍均按照以上的安装方式进行阐述：
## 行走电机

## Key

## Description

## Value

## Unit

## x

## 驱动器安装的X坐标

## 根据实际安装位置填写

## m

## y

## 驱动器安装的Y坐标

## 根据实际安装位置填写

## m

## yaw

## 驱动器安装的朝向

## 根据实际安装位置填写

## 度

## canID

## 驱动器的的CANID

## 根据驱动器上位机配置决定

## maxRPM

## 驱动器最大转速

## 3000

## RPM

## inverse

## 逻辑反向

## encoderLine

## 编码器线数

## 16384

## canPort

## 驱动器使用的端口

## 根据实际情况填写

## uplimitDI

## 上限位DI

## -1

## downLimitDI

## 下限位DI

## -1

## ZeroDI

## 零位DI

## -1

## func

## 功能

## walk

## wheelRadius

## 轮半径

## 结合驱动器厂家给的机械图纸参数进行填写

## m

## reductionRatio

## 减速比

## 结合驱动器厂家给的机械图纸参数进行填写

## minimumSpeed

## 最小执行速度

### 0.05

## m/s

## brand

## 驱动器品牌

## Tongyi-IxL-CanOpen

## 转向电机
## 编码器为增量式编码器
一般来说，我司双舵轮车使用的驱动器一般为同毅驱动器，该驱动器上位机软件参数根据我司提供的文档配置好之后，小车的标零模式为左极限标零（上位机中配置了标零模式为 1，左极限标零。参考 4.4.4 设置复位参数）。
根据舵轮的安装图纸可以看出，限位的安装角度为 ±120° ，所以根据左极限标零配置方法， maxAngle 配置为 0°，minAngle 配置为 -240° ，steerOffset 配置为 120° 。此时小车开机标零动作为，舵轮先转到负限位的位置，然后根据 steerOffset 舵角偏执转 120° 回到中间零位（理想状态，无安装误差等系统误差）。
1677209427831-ac8c4984-7f2c-4fa4-ad97-878a26e7d6f0.png

## Key

## Description

## Value

## Unit

## x

## 驱动器安装的X坐标

### 根据实际安装位置填写，需要与行走电机一致

## m

## y

## 驱动器安装的Y坐标

### 根据实际安装位置填写，需要与行走电机一致

## m

## yaw

## 驱动器安装的朝向

### 根据实际安装位置填写，需要与行走电机一致

## 度

## canID

## 驱动器的的CANID

## 根据驱动器上位机配置决定

## maxRPM

## 驱动器最大转速

## 3000

## RPM

## inverse

## 逻辑反向

## encoderLine

## 编码器线数

## 16384

## canPort

## 驱动器使用的端口

## 根据实际情况填写

## uplimitDI

## 上限位DI

## -1

## downLimitDI

## 下限位DI

## -1

## ZeroDI

## 零位DI

## -1

## func

## 功能

## steer

## Maxspped

## 最大速度

## 默认

## MaxAcc

## 最大加速度

## 默认

## MaxDec

## 最大减速机

## 默认

## MaxJerk

## 最大加加速度

## 默认

## reductionRatio

## 减速比

## 结合驱动器厂家给的机械图纸参数进行填写

## maxAngle

## 最大角度

## 0

## 度

## minAngle

最小角度，参考机械图可得舵轮最大的转向范围为240°，因标零方式固定为负限位标零，故minAngle应填-240°

## -240

## 度

## steerOffset

steerOffset为电机自身标零后的零位在车体坐标系下的角度，负限位标零时，电机自身零位在右手坐标系下为120°，故steerOffset应填120°

## 120

## 度

## steerResolution

## steerOffsetFile

## positionSpeed

## brand

## 驱动器品牌

## Tongyi-IxL-CanOpen

注意：此时配置好舵轮模型后，可以对舵轮进行单电机调试，当测试转向驱动器时，假设下发舵角为 - 2 ，舵轮才回到正前方，车体才能直走，此时需要将模型文件中 steerOffset 的值 + 2 。
## 编码器为绝对值编码器
如果使用的是绝对值编码器，如同毅的带绝对值编码器的驱动器，可以看到舵轮图纸中舵轮实际未安装限位，所以舵轮可以 360° 旋转，但在模型文件中需要对角度范围进行限定，所以 maxAngle 配置为 180° ， minAngle 配置为 -180° ，steerOffset配置为 0° 。
## 造车中心(1).jpg

## Key

## Description

## Value

## Unit

## x

## 驱动器安装的X坐标

### 根据实际安装位置填写，需要与行走电机一致

## m

## y

## 驱动器安装的Y坐标

### 根据实际安装位置填写，需要与行走电机一致

## m

## yaw

## 驱动器安装的朝向

### 根据实际安装位置填写，需要与行走电机一致

## 度

## canID

## 驱动器的的CANID

## 根据驱动器上位机配置决定

## maxRPM

## 驱动器最大转速

## 3000

## RPM

## inverse

## 逻辑反向

## encoderLine

## 编码器线数

## 16384

## canPort

## 驱动器使用的端口

## 根据实际情况填写

## uplimitDI

## 上限位DI

## -1

## downLimitDI

## 下限位DI

## -1

## ZeroDI

## 零位DI

## -1

## func

## 功能

## steer

## Maxspped

## 最大速度

## 默认

## MaxAcc

## 最大加速度

## 默认

## MaxDec

## 最大减速机

## 默认

## MaxJerk

## 最大加加速度

## 默认

## reductionRatio

## 减速比

## 结合驱动器厂家给的机械图纸参数进行填写

## maxAngle

## 最大角度

## 180

## 度

## minAngle

## 最小角度

## -180

## 度

## steerOffset

steerOffset为电机自身标零后的零位在车体坐标系下的角度

## 0

## 度

## steerResolution

## steerOffsetFile

## positionSpeed

## brand

## 驱动器品牌

## Tongyi-IxL-CanOpen

注意：此时配置好舵轮模型后，可以对舵轮进行单电机调试，当测试转向驱动器时，假设下发舵角为 - 2 ，舵轮才回到正前方，车体才能直走，此时需要将模型文件中 steerOffset 的值 + 2 。

注：如出现舵轮转至限位后无法回零的情况，可在模型文件中将舵轮进行取反操作。
## 驱动器功能检测方法
在整车组装完成未安装外壳前，请再检查一遍接线确保接线正确；
将车体加高，使轮子离地。开启机器人，使用网线连接机器人。使用 Roboshop 软件操作机器人让轮子转起来。 使用 CanScope （致远 CAN Scope 使用方法） 夹在 CAN 总线上检测 CAN 报文至少 1 小时，CAN 报文无错误；
让车体着地，使用 Roboshop 软件操作机器人做运动动作:向前，向后，向左，向右运动，左侧移，右侧移；
未拍急停按钮前，推动机器人，无法推动（电机使能），检查 Roboshop 中机器人状态处于“未急停”“驱动器未急停”，如图 6-1 左侧图所示；所示拍下急停按钮后，再次机器人，可以推动（电机去使能），检查 Roboshop 中机器人状态处于“已急停”，“驱动器已急停”。如图 6-1 右侧图所示；
1677209452661-dbc1d8c4-5645-4e32-b207-23f521b2f17a.png

任务链运动老化测试 24H，查看 Robokit Log 无错误报警。

## 常见问题
## 常见报错码
## 如下为常见报错的解决方法：

## 驱动报错及解决办法.pdf

## 故障代码

## 故障名称

## 错误标志

## 说明

## 1

## DCBUS 过压

### ulSystemErrorBits (0)

## Servo ON 检测

## 2

## DCBUS 欠压

### ulSystemErrorBits (1)

## Servo ON 检测

## 3

## 电机过流

### ulSystemErrorBits (2)

## 4

## 編码器故障

### ulSystemErrorBits (3)

## 5

## 控制电源欠压

### ulSystemErrorBits (4)

## 6

## 驱动过热

### ulSystemErrorBits (5)

## 7

## 电机过热

### ulSystemErrorBits (6）

## 8

## 电机过载报警

### ulSystemErrorBits (7)

## 9

## 霍尔信号异常

### ulSystemErrorBits (8)

## Servo ON 检测

## 10

## 編码器断线故障

### ulSystemErrorBits (9)

## Servo ON 检测

## 11

## 电机过速

### ulSystemErrorBits (10)

## 12

## 电机位置超差/速度超差

### ulSystemErrorBits (11)

## 位置/速度控制有效

## 13

## 存储参数校验错误

### ulSystemErrorBits (12)

## 14

## 功率模块过流（硬件）

### ulSystemErrorBits (13)

## 不可清除

## 15

## 电机制动错误

### ulSystemErrorBits (14)

## 16

## 编码器偏置角度搜寻错误

### ulSystemErrorBits (15)

## 17

## 电流检测基准错误

### ulSystemErrorBits (16)

## 18

## 缺相报警

### ulSystemErrorBits (17)

## 19

## 顸留

### ulSystemErrorBits (18)

## 20

## 软件开门狗复位错误

### ulSystemErrorBits (19)

## 断电重启清除

## 举例：
0x800 转换成 2 进制  100000000000 ，错误标志 u1SystemErrorBits（11）位是 1，就是电机位置超差/速度超差
0x80 转换成 2 进制 10000000，错误标志 u1SystemErrorBits（7）位是 1，就是电机过载报警
0x2000 转换成 2 进制 10000000000000，u1SystemErrorBits（13）为 1，功率模块过流

## 修改舵轮回零速度
模型文件的 brand 改成下图，然后从同毅上位机设定回零速度
## image.png

## 同毅舵轮和驱动器选型问题
## 如果作为舵轮使用，需要和同毅确认如下：
如果转向电机是增量编码器，则 需要安装左右限位 ，零位传感器可不用
如果转向电机是绝对值编码器，a中的条件随意，装车时需要在机械零位通过驱动器上位机进行编码器清零。
### 关于舵轮型号和驱动器型号以及负载是否匹配的问题：
一般功率和车体运动模型（差速、双/四舵轮）、负载、车体本身重量、减速机速比、整车电源系统（24V还是48V）都有关系，需要综合考虑，一般车体机械设计人员可给出力学参数，如单轮需要多大扭矩
最简便的方法就是咨询同毅供应商，他们对于功率搭配比较清楚。
