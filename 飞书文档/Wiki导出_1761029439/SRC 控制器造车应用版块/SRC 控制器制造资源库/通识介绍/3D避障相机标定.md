# 3D避障相机标定 

## 3D避障相机标定

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

本文档仅适用于新版rbk、roboshop，部分老版本无此功能，本文以在清洁机器人上，标定奥比中光相机为演示Demo，其余品牌避障相机标定类似。
## 奥比中光相机标定

## 1.相机标定（3Dcamera）
检查需要标定的模型文件是否启用，未启用时无法进行标定，无特殊需求时无需启用camera2相机
①在“模型文件”中打开camera，绿色为启用状态，红色为禁用状态
### ②未启用时可在对应的模型处勾选“启用设备”
## ③保存、推送后再次进去界面设备已启用
## image.png

## 1.1相机序列号标定
标定前请将机器人移至空旷的场地，标定时会出现两组相同（相机）名称的标定项目，下方红色和橙色方框所示，红色方框内为相机序列号标定项，橙色方框内相机安装位置标定项，两个项目都需完成标定。
注：待所有相机序列号标定完成后方可标定项目；未标定相机时roboshop内会有警告信息（ 3D相机 ： 奥比相机未发现匹配序列号），待标定完成后消除。
## ①抢占控制权
## ②其他——标定机器人
## image.png

### ①勾选下方需要标定的相机，多个相机时需逐一勾选
## ②点击开始标定
## ③选择相机序列号
## ④点击确定，等待完成
## image.png

注：相机序列号在相机标签查看，若重新插拔相机时需重启控制器后拉取模型文件序列号更新，并确保相机与控制器接口连接稳固。
## image.png

## 1.2相机位置标定
相机序列号标定完后，需先完成激光（laser绿色方框提示）标定后方可标定相机位置（橙色方框）
## image.png

开始标定后弹出窗口上勾选“ObsFloor”对地标定相机的高度角度，但机器人前方平视的相机（2号相机）无法使用对地的方式标定，
## ①进入标定机器人界面
## ②勾选标定项
③标定camera和camera1时选择“ObsFloor”对地标定方式，如需标定camera2需采用“ObsWall”对墙标定的方式
## ④点击确定，等待完成
## image.png

## 1.3坑洞检测
## 根据用户实际需求选择使用该功能：
## ①打开参数配置界面
## ②勾选显示更多
### ③在搜索栏中输入黄色方框中的参数名，进行参数配置
3DCameraHole——是否使用坑洞检测功能；
Hole_Depth——检查的坑洞深度，可根据实际情况进行修改
## ④点击永久修改
## image.png

## 1.4 地面坑洞检测过滤洞洞板配置
## 洞洞板地面场景示例：
## image.png

## 参数配置

## 参数名

## 作用

## 默认值

## 范围

## Hole_Point_Numner

## 坑洞数量，用于地面洞洞板过滤

## 3

## 0~100

## Hole_Radius

## 坑洞检测半径

### 0.2

## 0~10m

参数说明：在做地面坑洞检测时，如果一定范围内（Hole_Radius），坑洞超过了一定数量（Hole_Point_Numner），则认为地面是洞洞板，会过滤掉坑洞，不会触发停避障。
Hole_Radius 一般无需修改，如无法有效过滤地面洞洞板，可以修改 Hole_Point_Numner

## image.png

### 2.标定数据核验
标定完成后，进行断电重启，重新拉取模型文件，查看标定结果，核对serialNumber、Z、roll等参数是否无实际相符，如下图所示。
## image.png

如果标定结果与实际差距较大，考虑标定结果不对，需要重新标定。
serialNumber：序列号、Z：相机离地高度、roll：相机倾斜角度
由于平视相机（camera2）的标定方法特殊，可能无法标定到合理的数据，此时需根据实际高度进行手动修改。

注：标定结果=模型文件中原数值（白色部分）+补偿值（蓝色部分）
例如：①标定后Z（离地高度）的大小=0+0.770433，手动测量此相机的实际离地高度=0.77m，标定结果与实际结果在合理范围内Z标定结果合格
②roll（相机倾斜角度）=-180+37.699331≈-143，与实际相机倾斜角度相符，标定结果合格
## image.png

根据每个相机的安装角度不同，
1号相机（camera1）相机安装角度倾斜向下角度比较多，模型文件中【roll】角一般在-140°左右。将中间区域的小车模型中将相机的模型位置移到车头，方向向前。
2号相机（camera2）安装角度比较水平，模型文件中【roll】角一般在-90°左右。然后将中间区域的小车模型中将相机的模型位置移到车头，方向向前。
同样的，0号相机（camera0），模型文件中【roll】角一般在-105°左右。将中间区域的小车模型中相机的模型位置移到车尾，方向向后。
## 注：具体数据以实际安装位置为准

## image.png

## image.png

## 模型文件中相机的位置信息：
## image.png

“聚焦机器人”后，在相机可视范围内设置障碍，点击图中小车，右侧勾选“传感器点云”、勾选对应的深度相机（x）障碍物，地图检查障碍点云与实际障碍的吻合度(紫色点云数据是否无实际障碍物相机吻合)。
## image.png
