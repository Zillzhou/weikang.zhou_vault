# 如何选择一款合适的 3D 避障相机

## 如何选择一款合适的 3D 避障相机

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

## 3D 相机介绍
3D 相机可以获取真实世界尺度下的 3D 信息。如下图所示，左侧为常见的 2D RGB 图片，为 2D 相机模组所采集到的信息，每个像素点都是二维的；右侧为 3D 相机所采集到的信息，带有丰富的 depth 信息，即每个像素点都是三维的。在正常的使用中，一般通过将采集到的 depth 信息转化为点云（point cloud）来进行使用。
1652060543451-475815a8-afdb-4665-ab5c-d286b8227dd4.png

### 仙工智能推荐的常用 3D 避障相机&激光型号：

## 型号

## 测量距离（m）

## 成像原理

## 彩色分辨率

## 深度分辨率

## 通讯接口

## 用途

## 备注

## 适用场景

## Livox MID70

## 90 / 10%反射率
## 130 / 20% 反射率
## 260 / 80% 反射率

## 固态激光

## —

## —

## 网口

## 避障

## 室内室外场景均可

## Livox MID360

## 40 / 10%反射率
## 70 / 80% 反射率

## 固态激光

## —

## —

## 网口

## 避障

## 室内室外场景均可

## 奥比中光 Astra Mini S

### 0.4 ~ 2

## 结构光

## 1280 x 960
## 640 x 480
## 320 x 240

## 1280 x 1024
## 640 x 480
## 320 x 240
## 160 x 120

## USB

## 避障

### 适用室内场景，同时对黑色物体避障效果不理想

## 3D 相机成像原理
## 结构光与 编码光
结构光 3D 相机与编码光 3D 相机都是通过光源发射器投射光（通常是红外光）到物体。所投射的光是有特定图案的。这种特定的图案，可以从视觉层面进行设置，也可以从时间层面进行设置，还可以是这两个方式的结合。由于光投影的图案是既定的，所以 3D 相机的内置传感器通过识别场景中的图案就可以获取到深度信息。例如下图，如果光的既定图案是一系列条纹，当它投射到一个球上，这些条纹将会依据球的表面产生特定形变，且当球靠近光源发射器时，图案还会发生相应的改变。
1652061532787-95c3e8a6-a9d1-4c3b-9722-d50f95398a09.png

## 立体视觉
以常见的双目立体视觉为例，双目立体视觉相机内置两个传感器，可以分别得到出两组图像的信息。由于传感器之间的距离（ baseline ）是已知的，通过计算便可以得到被测对象的深度信息。双目立体视觉相机的工作原理，与人眼进行深度感知的原理类似。人的两眼分别可看见一幅图像，大脑可以计算出两眼之间的差异（视差），距离物体近的一只眼所识别出的物体移动幅度更大，而距离物体远的一只眼所识别出的移动幅度就就小一些。
1652062057853-ac213e65-98c3-4a05-8c28-9fa522137056.png

双目立体视觉相机在大多数照明条件下，甚至是户外，它都能保持良好的性能。如为其配置红外光发射器，那么即使在光照条件差的环境中，它依然能敏锐感知深度信息。双目立体视觉相机的另一个优点是，在特定场景中，相机的使用数量是没有限制的，不会出现多个编码光相机或 TOF 相机同时使用时出现的互相干扰的问题。双目立体视觉相机所能测量的距离取决于两个内置传感器之间的距离，也就是基线距离。基线距离越宽，相机可测试的距离就越远。
## ToF
ToF（ Time of Flight）的原理是 相机向目标发射脉冲光，然后根据发送到返回之间的光束飞行时间，确定物体离自身的距离，原理和激光雷达类似。 ToF 相机的缺点是，在相同空间内，其他 ToF 相机的光会对它们造成较强干扰，而且在室外强光环境下也不适用。
## 固态激光
仙工智能使用多款固态激光雷达进行识别、避障等操作，内部将固态激光雷达归类为 3D 相机。以仙工智能常用的 Livox mid-70 为例，这款固态激光雷达采用非重复式扫描，积分时间越长，采集到的点云就越密集。

## 通信方式
仙工智能主要使用以太网和 USB 两种模式通信的 3D 相机。以以太网为主，可以实现大量数据实时、高速传输，而且网口不易松动。
注意：目前我们不推荐使用 USB 的相机，主要有两方面的原因：
### USB 的相机连接容易松动，会偶发性地出现断连的情况
### 针对大数据的传输，USB 相机的速率不一定能达到要求

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## ip

## 模型文件-camera

## —

### 192.168.192.100

## —

## —

### 3.3.4.20~latest

### 相机的 ip（一般设置为 192.168.192。网段）

## port

## 模型文件-camera

## —

## 2111

## 0

## 9999

### 3.3.4.20~latest

## 端口号

## 3D 相机配置参数
为了更方便的使用 3D 相机，仙工智能提供了一系列可以配置的参数，这些参数部分在模型文件中，部分在参数配置中。通过配置这些参数，可以实现在不同场景下使用。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## 3Dcamera

## 模型文件-camera

## —

## false

## —

## —

### 3.3.4.20~latest

如果是 3D 相机，选用；2D 相机不选用。

## gain

## 模型文件-camera

## —

## 11

## 0

## 200

### 3.3.4.20~latest

图漾 FM851 使用，增益系数。

## analogGain

## 模型文件-camera

## —

## 2

## 0

## 4

### 3.3.4.20~latest

图漾 FM851 使用，虚拟增益系数。

## RGBAnalogGain

## 模型文件-camera

## —

## 2

## 0

## 4

### 3.3.4.20~latest

图漾 FM851 使用，RGB 虚拟增益系数。

## exposuretime

## 模型文件-camera

## —

## 700

## 0

## 1100

### 3.3.4.20~latest

图漾 FM851 使用，曝光时间。

## PowerDO

## 模型文件-camera

## —

## 9000

## 0

## 9999

### 3.3.4.20~latest

## PercipioID

## 模型文件-camera

## —

## 207000104153

## —

## —

### 3.3.4.20~latest

图漾相机的 ID 号，ID 号在相机外壳背面，使用图漾相机，该项必填。

### onlyForPalletDetection

## 模型文件-camera

## —

## false

## —

## —

### 3.3.4.20~latest

如果只用于检测栈板，则勾选。

## isUpside

## 模型文件-camera

## —

## true

## —

## —

### 3.3.4.20~latest

若相机正装，则勾选。

## isInArm

## 模型文件-camera

## —

## false

## —

## —

### 3.3.5.20~latest

若相机是在复合机器人的机械臂上使用，则勾选。

## isRealShow

## 模型文件-camera

## —

## false

## —

## —

### 3.3.5.20~latest

若需要实时显示相机画面，则勾选。（现阶段只支持 2D 相机，后续会开放 3D 相机的实时显示）

除了在模型文件中存在一些可配置的参数，在参数配置中也有几个参数可以配置，这些参数一般选取默认值即可，通常不需要进行修改：

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## markMaxDis

## 参数配置-camera

## m

### 0.8

## 0

## 2

### 3.3.6.1~latest

知微相机使用，最远的检测距离。

## exposureTime

## 参数配置-camera

## —

## 16000

## 0

## 100000

### 3.3.6.1~latest

知微相机使用，曝光时间。

## zhiwei gain

## 参数配置-camera

## —

## 3

## 1

## 10

### 3.3.6.1~latest

知微相机使用，增益系数。

## 外参
仙工智能规定 3D 相机的正交坐标系遵循右手定理，前方为 z 轴，右方为 x 轴，下方为 y 轴，见本章第一节中的成像示意图 。
3D 相机扫描到的障碍物的位置是以 3D 相机为坐标系中心得到的，需要将这些障碍物的坐标转换到车体的坐标系下，在这种情况下需要知道 3D 相机在车体下的安装位置以得到 3D 相机坐标系与车体坐标系的相对位置，即 3D 相机的外参。
仙工智能通过自动化标定可以得出 3D 相机的外参，这部分的原理请参考标定章节。对于 3D 相机来说，外参需要知道六个参数：

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## x

## 模型文件-camera

## m

## 0

## -99

## 99

### 3.3.4.20~latest

### 3D 相机在车体坐标系下 x 轴方向的值

## y

## 模型文件-camera

## m

## 0

## -99

## 99

### 3.3.4.20~latest

### 3D 相机在车体坐标系下 y 轴方向的值

## z

## 模型文件-camera

## m

## 0

## -99

## 99

### 3.3.4.20~latest

### 3D 相机在车体坐标系下 z 轴方向的值，该值无关紧要

## roll

## 模型文件-camera

## °

## 0

## -180

## 180

### 3.3.4.20~latest

### 3D 相机在车体坐标系下 x 轴的角度偏移值

## pitch

## 模型文件-camera

## °

## 0

## -180

## 180

### 3.3.4.20~latest

### 3D 相机在车体坐标系下 y 轴的角度偏移值

## yaw

## 模型文件-camera

## °

## 0

## -180

## 180

### 3.3.4.20~latest

### 3D 相机在车体坐标系下 z 轴的角度偏移值
