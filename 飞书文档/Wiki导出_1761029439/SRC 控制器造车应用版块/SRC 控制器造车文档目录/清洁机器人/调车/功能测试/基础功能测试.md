# 基础功能测试

## 基础功能测试

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

## 开关机测试

## image.png

## 急停测试
## image.png

## src功能激活检查
在高级配置——版本信息中查看控制器功能激活情况是否与用户授权一致，如有缺失请与仙工联系
清洁机器人常用的功能：rbK_diff、rbk_3dcamera、rbk_roaming、rbk_script、rbk_laser_loc（与用户实际选配功能为准）
## image.png

检查rdscore功能是否与用户授权权限相符，如有缺失请与仙工联系
## image.png

## 车体电量显示
### 模型文件battery查看配置信息，例下图配置时：
## 1.车体电量低于20会警告，提示低电量信息
### 2.车体电量低于15会有报错码，电量警告，无法继续执行动作
### 3.车体电量低于10，车体自动关机。
### 4.scriptName：电池通讯脚本名称
注：参数值为-1时表示不启用；
## image.png

部分通讯异常时电量可能会显示0或99请注意核验运行状态中的是否存在电池电压、电流变化
## image.png

## 扫图与重定位
检查机器人是否能够正常扫图，是否有打地情况，定位功能是否正常使用
## 地图构建与编辑

## 扫图方法.mp4
## 使用roboshop扫图：①抢占控制权
## ②点击“2D建图”
## ③点击“在线建图”
## image.png

## 在弹出的窗口，填写参数，点击确定
## image.png

通过“W、S、A、D”键控制机器人行走，将需要场景全部扫描到地图内，完成后点击右上角的“完成扫图”选项
## image.png

## 选择文件存储位置，点击“保存”
## image.png

## 点击推送地图
## image.png

检查地图，是否与实际吻合，在扫图时可能将其他移动的物体等扫到地图内，但实际这些点并不存在障碍或已移走的情况，可利用地图编辑中使用橡皮擦除去。
## image.png

地图中识别的障碍（黑色点）已移走或并不存在时需在地图中将其除去，启用编辑后使用橡皮擦工具将点云擦除，完成后保存推送即可
## ①启用编辑、
## ②在左侧工具栏点击“橡皮擦”
## ③在要去除的位置点击滑动鼠标，擦除黑点
## ④完成后点击保存、退出编辑、推送地图
## image.png

## 重定位功能
【重定位】用于使机器人获得正确的定位状态。通过指定一个比较模糊的初始定位点和方向，让机器人计算其精确的位置和方向。重定位也是使机器人能进入正确工作状态的重要一步。需保证机器人实际场景（现实生活）应roboshop地图中对应的位置一致，才能确保机器人正常工作。
## 如何判断重定位信息：
## 1.首先查看机器人在地图上的位置是否与现场实际位置、角度相同
### 2.观察激光点云数据是否与实际吻合（激光扫描的绿色点云应与实际物体的面吻合)
### 3.定位信息异常时，需使用重定位功能，更新定位信息
### 可能导致丢定位的因素：机器人重启；场景变化大；场景无特征

## image.png

确定机器人实际位置，找到地图中与其对应的位置，在这个对应的位置使用重定位功能（点击手动重定位后在地图中的位置左击一次），箭头（鼠标）拉向机器人的X轴（车头方向）左击一次等待重定位完成，若多次重定位后定位信息仍然不准确，考虑在地图是否与实际的场景变化较大，场景无特征或相似度较大，可拼接地图或重新扫图。

## 重定位功能.mp4
## 导航
按照上述步骤扫图建图后，控制机器人默认速度，最大速度来回跑10次，观察机器人有没有偏移路径或线路外的情况
## 充电测试
按照下述两种方式进行机器人充电，观察机器人充电状态，roboshop内是否显示充电状态，电压电流变化情况（输入电流是否为正值，充电按钮是否显示等）
## image.png

## 充电桩识别文件配置
### 检查充电桩识别文件配置，与截图中配置参数一致
"识别文件"——“charger”目录下——选择对应文件“amb”——更改后需保存推送
## image.png

### 红色反光条为机器人识别工作站的标志（识别文件中配置的文件）
## image.png

## 自动充电测试
## 充电点位设计
### ①手动将机器人对桩，鼠标右击小车位置，标记特殊工作站
## image.png

启用编辑，使用站点工具，在CP点前0.5m处创建“站点”LM点，
## image.png

### 点击连接线工具——直连——使用鼠标连接两点
## image.png

将CP点到LM点的线路设为倒走：点击线路，选择cp-lm，选择direction设为倒走
## image.png

②点击CP点，设置/调整站点角度（机器人到达站点后的车头方向），站点角度应与预期机器人对桩后车头方向一致，LM点同理，在CP点中勾选绑定前置点，在cp点选择识别模型文件(识别编辑中的配置的充电桩文件）
例如①步骤中标记带角度的CP点，若角度偏差较小时可修改调整角度为整数（0、90、180、-90），LM点（前置点）与其一致即可
## image.png

在充电桩位置绘制屏蔽区域：选择高级区域——点击屏蔽区域——鼠标点击绘制屏蔽区域大小——点击绘制的屏蔽区域勾选屏蔽参数
## image.png

## 最后保存-推送地图

测试路径导航至CP点观察机器人表现：将机器人移至前置点，点击“路径导航”，鼠标点击CP点位置，点击“路径导航至CPX”——机器人到达前置点识别充电桩位置，随后机器人向前对桩并根据充电桩实际位置做出（角度）调整，机器人应与充电桩贴合实现充电功能，“路径导航”至LMX点，机器人应安全倒出至前置点。
## image.png

## 充电器手动充电
### ①机器人在开机状态下直接连接充电器后开始充电
②机器人在关机状态下连接充电器后需手动打开电池的开机按钮后进行充电
### 反复给机器人充电，观察机器人充电电压、电流变化
## image.png

## 脚本功能测试
## 手动调用脚本：
在RobotshopPro连接机器人，抢占控制权，点击“机构脚本”，点击“拉取全部”使目录状态变为绿色后脚本可以正常调用
## image.png

## 加水、排污测试
脚本调用加水排污指令如下，本文使用clean_robot_2002.py脚本为例，
使用加、排水命令前先将机器人对桩，并打开D01（DO1为机器人的充电DO），机器人开始充电
将机器人对桩后①抢占控制权②点击I/O配置③打开DO1，机器人开始充电
## image.png

注：默认状态下DO1、DO4应为常闭；
## 调用脚本命令：
## ①点击要运行的脚本
## ②点击上方开始按钮
### ③在弹出窗口中勾选“operation”
④下拉复选框选择“AddWater”换水命令，
注：使用addingwater命令时加水和排污水动作会同步执行
## ⑤点击确定
通过脚本调用addingWater指令时，DO4会自动打开（DO4为加水DO），当清水箱水量到达100%时，加水指令会自动停止（即DO4会自动关闭）；当污水箱水量到达0%时会自动停止、关闭污水阀（brain_ball_valve）
### 注意若为手动打开的DO当加水完成时不会自动关闭
## image.png

运行AddWater时，点击左上角的“停止”按钮，加水和排动作会即刻停止
## image.png

## 其他脚本功能测试
按照上述步骤运行“WashStart”开始洗地命令，机器人水扒、刷盘等开始下降，随后喷水电机、刷盘电机、吸风电机开始运行工作，观察各机构的运行情况
运行“WashEnd”洗地结束命令，喷水电机、刷盘电机、吸风电机停止工作，水扒、刷盘等开始上升，观察各机构能否正常停止、复位
## image.png

也可在右侧观察各机构的运行状态，例如运行WashStart后机构开始下降并开始工作，观察①-③三个电机的输出功率是否与实际状态相符，④在右侧work_status中也可查看各机构的状态“0”未默认/升起状态，“1”为下降/工作状态。
## image.png

## 停障检测
场景介绍：在两站点间设置障碍物，路径导航至另一站点，观察机器人停障情况
## image.png

## 激光停障检测
1710232464079-03690054-4ca7-408c-9ae9-2a1b434c2866.png

### 清洁机器人在行驶过程中，前方有障碍物，会遇到以下问题：
## 1.会出现激光被阻挡的报错码；
### 2.在实时地图中显示激光阻挡；
### 3.在状态栏中显示阻挡物为激光。
### 4.当障碍物移走时，障碍物点云即可消失，警告同时消失，机器人会继续前进
### 激光阻挡：表示机器人受到障碍物阻挡（激光识别的绿色点云）
虚拟激光阻挡：在自动模式下，机器人受到地图中的黑色点的阻挡（地图中的障碍物信息数据）
## image.png

## 3D相机停障检测
1710231950254-d2915587-1e39-44f9-bfc1-ae4322985913.png

在机器人行驶过程中，前方有障碍物，3D相机会实时监测，在地图中显示障碍物实时位置，及在状态栏中显示阻挡物为深度相机阻挡，直至障碍物完全消失，才会继续运行。
当3D相机和激光同时触发阻挡时，在roboshop中会优先显示“深度相机”被阻挡的提示
## 碰撞条停障检测
用力按下碰撞条，机器人DI0亮起，触发碰撞条DI（具体DI配置以实际车体设计为准），松开碰撞条后DO恢复为红色
## image.png

路径导航过程中触发碰撞条DI，机器人应立即停止，任务取消。
