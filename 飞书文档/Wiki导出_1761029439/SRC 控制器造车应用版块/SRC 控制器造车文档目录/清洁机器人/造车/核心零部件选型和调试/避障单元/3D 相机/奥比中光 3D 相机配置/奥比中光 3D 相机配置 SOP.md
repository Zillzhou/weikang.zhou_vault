# 奥比中光 3D 相机配置 SOP

## 奥比中光 3D 相机配置 SOP

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

## 3D相机选型
### 清洁机器人使用奥比中光USB相机实现避障及坑洞检测功能
## 相机连接
## image.png

在Roboshop中，点击【模型文件】；
【模型文件】--camera--camera（id：0）；
奥比中光做避障时需要勾选【3DCamera】。然后根据相机正反装选择是否勾选【isUpside】，正装时需要勾选；
1694485369570-7713adfe-406f-4da7-bd20-717d0bd2f6a2.png

清洁机器人上一般会装3个奥比中光相机作为避障，相应的【cameralist】下拉框中会有三个设备序列号。三个相机需要配置三个模型文件，要求每个模型文件中【cameralist】选择的设备序列号不同。然后将每个相机模型文件【cameralist】中选择的设备序列号反填到【PercipioID】字段中后重新推送模型文件。
注意：多个相机时推送模型文件可能会提示ip字段不唯一，该情况下修改下相机模型文件中【ip】值即可，保证每个相机模型文件不相同即可，不需要真实ip。

奥比中光相机标定(适用于RoboshopProV2.4.1.161、RBK3.4.6.13以上版本)

## 1.3D相机功能激活
若机器人告警中出现3Dcamera未激活（中\英）字样提示时需联系仙工进行相机激活后正常使用
## 在高级配置可查看相机的激活状态：
## image.png

### 2.模型文件配置
## 检验3D相机模型文件配置
在【Camera】栏中创建相机模型，【brand】选择Orbbec-USB/Berxel-USB。
做避障时需要勾选【3DCamera】。然后根据相机正反装选择是否勾选【isUpdide】，正装时需要勾选否则不需要。
useForObstacleAvoidance是否使用避障功能
## image.png

注意：多个相机时推送模型文件可能会提示ip字段不唯一，该情况下修改下相机模型文件中【id】值即可，保证每个相机模型文件不相同即可。
不特殊要求我们一般不使用camera2相机，禁用相机模型的方法如下：
## image.png

## 位置调整

扫地机器人车头处安装了两个避障相机，车尾处一个。如下图所示，我们将车头两个相机分别标为1号、2号相机，车尾处为3号相机。
## image.png

## image.png

根据每个相机的安装角度不同，1号相机安装角度比较水平，模型文件中【roll】角一般在-90°左右。然后将中间区域的小车模型中将相机的模型位置移到车头，方向向前。 

1692695542173-42c38f74-0eab-4e39-bee3-9692fcc677a3.png

同样的，2号相机安装角度倾斜向下角度比较多，模型文件中【roll】角一般在-140°左右。然后将中间区域的小车模型中将相机的模型位置移到车头，方向向前。 

1692695728160-16f757de-869d-44d7-b046-220de0b47301.png

3号相机安装角度倾斜向下角度在1号和2号车中间，模型文件中【roll】角一般在-105°左右。然后将中间区域的小车模型中将相机的模型位置移到车尾，方向向后。 

1692695815614-4efd88fd-6d4e-4ec5-a711-9052848e3b6d.png
## 配置结果验证
配置完成后点击上传；
确定并推送至机器人控制器；
## image.png

## image.png

## 图 3.1 上传修改后的模型文件
① 返回地图与控制页面；
② 给下发机器人路径导航指令，并将障碍物放置在机器人运动路径上；
③ 如配置正确可在地图窗口看到深度相机识别到的障碍物点，如图3.1所示；
④ 也可在机器人告警窗口查看到机器人被阻挡的报错信息。
### 屏幕截图 2024-03-21 145853.png

## 深度相机障碍物显示
### 屏幕截图 2024-03-21 145906.png

## 深度相机识别到障碍物告警信息
## 参数说明
## 通信方式
仙工智能主要使用以太网和 USB 两种模式通信的 3D 相机。以以太网为主，可以实现大量数据实时、高速传输，而且网口不易松动。
注意：目前我们不推荐使用 USB 的相机，主要有两方面的原因：
### USB 的相机连接容易松动，会偶发性地出现断连的情况
### 针对大数据的传输，USB 相机的速率不一定能达到要求

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## ip

## 模型文件-camera

## —

### 192.168.192.100

## —

## —

### 3.3.4.20~latest

### 相机的ip（一般设置为192.168.192.网段）

## 参数说明

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## x

## 模型文件-basic

## m

## 0

## -99

## 99

### 3.3.4.20~latest

## 3D 相机在车体坐标系下x轴方向的值

## y

## 模型文件-basic

## m

## 0

## -99

## 99

### 3.3.4.20~latest

## 3D 相机在车体坐标系下y轴方向的值

## z

## 模型文件-basic

## m

## 0

## -99

## 99

### 3.3.4.20~latest

### 3D 相机在车体坐标系下z轴方向的值，该值无关紧要

## roll

## 模型文件-basic

## °

## 0

## -180

## 180

### 3.3.4.20~latest

### 3D 相机在车体坐标系下 x 轴的角度偏移值

## pitch

## 模型文件-basic

## °

## 0

## -180

## 180

### 3.3.4.20~latest

### 3D 相机在车体坐标系下 y 轴的角度偏移值

## yaw

## 模型文件-basic

## °

## 0

## -180

## 180

### 3.3.4.20~latest

### 3D 相机在车体坐标系下 z 轴的角度偏移值

## isUpside

## 模型文件-basic

## —

## true

## —

## —

### 3.3.4.20~latest

若相机正装，则勾选。

## maxLength:

## 模型文件-brand

## —

## true

## —

## —

### 3.3.4.20~latest

## 最大视野范围

### useForObstacleAvoidance

## 模型文件-brand

## —

## false

## —

## —

## ~latest

## 用于避障检测

## brand

## 模型文件-camera

## —

## —

## —

## —

### 3.3.5.20~latest

相机品牌，根据实际情况选择。

避障相机标定请参考 避障激光标定 、排错请参考 避障相机排错流程
## 报警码
仙工智能在使用 3D 相机的时候定义了一些报警码，以便在使用过程中出现问题通过报警码可以快速定位：
当 3D 相机没有连接上时，会触发连接失败的报错，具体如下：
## Error52250
### 提示： 3D camera disconnected
## 触发条件：
相机未上电；
相机故障；
相机 ip 或者 port 不正确；
通讯线故障。
## 解决方式：
检查相机的状态；
通讯线是否畅通；
检查 ip 和 port 是否设置正确。
当 3D 相机出现接收不到数据，会触犯断联的报错，具体如下：
## Error52251
提示： cannot receive 3d camera data
## 触发条件：
相机未上电；
相机故障；
相机 ip 或者 port 不正确；
通讯线故障。
## 解决方式：
检查相机的状态；
通讯线是否畅通、；
对于采用 UDP 传输的，需要检查 ip 和 port 是否设置正确。
