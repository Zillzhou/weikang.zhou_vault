# 富锐导航激光配置 SOP

## 富锐导航激光配置 SOP

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

仙工智能使用富锐H1型号激光雷达用作导航。

## 激光名称

## 该激光图片

## foucueRay

## image.png

## 配置前的准备工作

## 序号

## 准备事项

## 图片

## 1

## 激光雷达上位机软件
## 下载链接：

## 导航激光-富锐H100.zip

## image.png

## 2

## windows10/11 操作系统

## NA
## 激光配置
将激光雷达上电并通过网线连接到个人电脑，打开上位机软件，点击左侧“基本信息”，输入雷达 IP 地址，点击“连接”。连接雷达后，上位机会显示设备名称、设备序列号、设备版本号、MAC 地址信息。富锐H1激光默认ip为192.168.192.100，需要将个人电脑的ip修改改为同一网段。
1701055242753-09431057-4f9b-402e-bc11-26e6cbafa192.png 

连接上了之后点击参数配置-雷达权限解锁。需要配置ip和扫描频率&角分辨率。
1701055398644-2e82b842-05de-4586-9633-9c3700b74cad.png 

① 打开更改权限；
② 根据需求修改激光IP地址；
③ 根据需求修改激光的扫描频率&角分辨率；
仙工智能规定激光雷达IP需要设置为192.168.192.10x，由于H1激光出厂统一IP为192.168.192.100，网段一致，可以直接建立通讯，但是在同时使用多个激光的情况下，为了避免激光IP重复，需要修改对应的激光IP（如下图所示），点击修改并保存。
激光雷达需根据车体实际安装的数量来决定IP地址，例机器人实际只安装一个激光雷达，配置的IP地址为192.168.192.100，若安装两个，则第二个的激光雷达IP地址为192.168.192.101；
1701162420679-d7e323fa-0f45-4e5a-9a3d-9249ff777110.png 

① 点击图标；
② 根据需求修改激光的IP地址；
③ 确认修改并保存；
修改转速和角分辨率，修改为30Hz/0.1°，点击修改并保存。
1701055695545-485cba0e-e505-4153-a8e7-dc100a1d15dc.png 

① 点击图标；
② 在下拉框选择30Hz；
③ 确认修改并保存；
修改完成之后需要对激光雷达断电重启之后，设置才会生效，然后就可以在roboshop上配置使用。
## 复制并添加laser
修改设备名称；
启用设备；
1711015812370-c5b31673-ac6a-48d5-aca9-6a7ce1cb20b4.png 

### 图 2.1a 导航激光模型文件配置SOP
1711015914109-f0dba69d-7a7a-4511-87c1-e563333981e6.png

## 导航激光模型文件配置SOP
修改设备参数：根据实际配置激光雷达id、安装位置；
1703756590299-29cb57f6-2585-4d00-a832-a25bef176f44.png

## id及安装参数设置
根据实际使用情况配置激光的角分辨率step、角度范围；
选择是否正装，一般车头底部的避障激光雷达为倒装；
勾选用于定位功能useForLocalization；
1703756590299-29cb57f6-2585-4d00-a832-a25bef176f44.png

## 激光使用参数配置
配置通信接口：IP、端口，根据相机实际 IP、端口配置，但要保证不与其他设备 IP 冲突；
1703756540276-1fd6637e-3b89-4264-a30f-dfa9101319e7.png

## 通信接口配置
选择品牌：根据实际选型在品牌下拉框中选择对应的品牌和型号，如倍加福 R2000 雷达则选择 PepperlR2000-HD-TCP。并配置器最小有效距离。。
1703756516636-09da4781-50d2-48e0-afa6-c25fddc3f1d9.png

1703756524155-121912fb-1984-4d2c-bc48-b2b82cecc3ac.png

## 品牌选择
端口，端口一般为ttyUSB0。
1703735859954-2a9b3121-f373-49c8-9c74-6322288ab787.png

## 端口选择
根据实际需要配置扣除区域。
1703756590299-29cb57f6-2585-4d00-a832-a25bef176f44.png

## 配置激光扣除区域
## 配置结果验证
## 上传模型文件
配置完成后点击上传；
确定并推送至机器人控制器；
## image.png

## image.png

## 上传修改后的模型文件
返回地图与控制页面，查看是否有如下图所示的激光数据，且机器人无告警。
1711016013339-bd87572e-2f8c-41b3-8387-2abb7bbd71ca.png

## 建图验证
点击【2D建图】，选择【在线建图】；
选择重新建图；
配置建图参数；
选择是否启用反光板；
点击【确定】开始建图，建图过程中使用键盘的WASD键或软件左下角的操作按钮控制机器人在场地内移动，并确保在场地内完成闭环运动，即完成建图时返回建图开始的原点；
完成建图并保存后将地图推送至机器人；
重定位，完成建图验证。
1711016043108-7ff181f7-03ad-4ede-8c14-5ee5c475e374.png 

1711016048182-41e64e0e-0296-45e7-b954-8d6795d68bb6.png 

1711016052128-747bae99-a887-4186-9dc4-24630ab4291e.png

1711019432089-d39820f5-9bb8-4b0a-b93e-2888e70a3c49.png

1711019437472-58bca623-8bfd-4c96-bea1-ffcb7e0faea3.png

1711019442585-d3d4ffa4-ac2e-4408-bca8-6c403c3a5ece.png

1711019448156-4aba2938-aa72-4069-bb3d-21d89caf2968.png

## 参数说明
## 外参配置说明
仙工智能规定激光雷达的正交坐标系遵循右手定理，前方为 x 轴，左方为 y 轴。
1651817670006-a34a7785-6d88-47a0-b1d0-dba7fa429dd8.png

激光雷达扫描到的障碍物的位置是以激光雷达为坐标系中心得到的，需要将这些障碍物的坐标转换到车体的坐标系下，在这种情况下需要知道激光雷达在车体下的安装位置以得到激光雷达坐标系与车体坐标系的相对位置，即激光雷达的外参。
仙工智能通过自动化标定可以得出激光雷达的外参，这部分的原理请参考标定章节。对于单线激光雷达来说，外参只需要知道三个参数即可：

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## x

## 模型文件-laser

## m

## 0

## -99

## 99

### 3.3.4.20~latest

## 激光雷达在车体坐标系下x轴方向的值

## y

## 模型文件-laser

## m

## 0

## -99

## 99

### 3.3.4.20~latest

## 激光雷达在车体坐标系下y轴方向的值

## z

## 模型文件-laser

## m

## 0

## -99

## 99

### 3.3.4.20~latest

### 激光雷达在车体坐标系下z轴方向的值，该值无关紧要

## yaw

## 模型文件-laser

## m

## 0

## -180

## 180

### 3.3.4.20~latest

## 激光雷达在车体坐标系下的角度偏移值

## 定位功能
仙工智能在使用单线激光雷达时，将激光雷达分为两类，一类是避障激光，另一类是导航激光。导航激光兼顾避障、识别和定位，在产品性能上要求更高，如角分辨率、最大测距距离、频率以及抖动等多方面。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## useForLocalization

## 模型文件-laser

## —

## false

## —

## —

### 3.3.4.20~latest

### 是否用作定位的选项（勾选后表示该激光用于导航定位）

## 网口
仙工智能在选用导航激光雷达的时候会选用以太网作为接口，可以实现大量数据实时、高速传输，而且网口不易松动。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## ip

## 模型文件-laser

## —

### 192.168.192.100

## —

## —

### 3.3.4.20~latest

### 激光雷达的ip（一般设置为192.168.192.网段）

## port

## 模型文件-laser

## —

## 2111

## 0

## 9999

### 3.3.4.20~latest

## 端口号

## 串口
对于用作避障的某些激光雷达，如 Sick 的 Tim 系列，会用到串口作为控制器和激光雷达的通信。这类激光雷达通常不需要将点云的原始数据传输到控制器，激光雷达内部可以规划安全区域，当安全区域内存在障碍物的时候，上报存在障碍物的信号即可。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## Com

## 模型文件-laser

## —

## —

## —

## —

### 3.3.4.20~latest

## COM口号；配置某些避障激光

## 点云扣除功能配置说明
仙工智能另外提供了根据角度来扣除点云的功能，在支持该功能的激光雷达的配置列表下，可以看到如下几个参数：

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## useAreaRemove

## 模型文件-laser

## —

## false

## —

## —

### 3.3.5.20~latest

## 判断是否扣除该区域

## areaStartAngle

## 模型文件-laser

## double

## 0

## -180

## 180

### 3.3.5.20~latest

## 区域内的起始角度

## areaEndAngle

## 模型文件-laser

## double

## 0

## -180

## 180

### 3.3.5.20~latest

## 区域内的终止角度

## 激光验证
1710308980447-78fc7682-4773-466b-aa13-adcb0944bf24.png

（1）打开高级配置，（2）点击终端命令，（3）在命令行输入导航激光IP，（4）点击ping按钮。
上图表示激光已经正常连接，如果出现连接超时，表示网络未成功连接，需要检查网线是否插好，如果出现无法访问主机，表示激光配置错误，需要重新配置。
