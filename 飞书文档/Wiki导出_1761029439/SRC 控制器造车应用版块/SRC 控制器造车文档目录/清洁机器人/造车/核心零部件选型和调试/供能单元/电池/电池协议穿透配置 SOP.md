# 电池协议穿透配置 SOP 

## 电池协议穿透配置 SOP

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

## 前言
该款电池使用Can协议，我司SRC核心控制器支持使用Can协议与电池通讯
## 配置前的准备工作

## 序号

## 准备事项

## 图片

## 1

## 电池脚本
## 下载链接：

### btCanPass_CleanRobot.py

## image.png

## 2

## windows10/11 操作系统

## NA

## 3

## 电脑已经成功与机器人连接

## NA
## 适配说明
最新电池适配情况请参见：SRC-2000(S) 控制器电池适配说明。
## 通用脚本配置
## 1.如下图，点击“通用脚本”，将适配好的电池脚本导入到该文件夹；
## image.png

## 1.在Roboshop Pro上位机软件中，点击【通用脚本】，可在【RoboPyEditorWeb】文件夹中导入电池通讯脚本；
### 2.若脚本显示绿色的“√”则表明该脚本已经存在控制器中；
## 模型文件配置
### 3.1 在该机器人的模型文件中，找到“battery”选项，在右边的状态栏中选择“byNet2Can”，脚本名称为在通用脚本中导入的电池脚本；
## image.png

## 1.在Roboshop Pro上位机调试软件中点击【模型文件】；
### 2.模型文件的电池功能；
### 3.电池名称，点击后可在右边的状态栏显示详细的属性框口；
### 4.点击电池功能下的电池名称后可在右边的状态栏显示详细的属性框口；
## 参数说明

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## lowVoltage

## 模型文件-battery-basic

## V

## -1

## -1

## 100

### 3.3.4.20~latest

### 用于电池最低电压报警阈值，-1 默认不启用

### temperatureThreshold

## 模型文件-battery-basic

## 摄氏度

## -1

## -1

## 100

### 3.3.4.20~latest

### 温度报警限制，-1 默认不启用，单位摄氏度

## warningPercentage

## 模型文件-battery-basic

## V

## -1

## -1

## 100

### 3.3.4.20~latest

### 电池告警百分比 ， 用于指示电池低电量告警阈值

## errorPercentage

## 模型文件-battery-basic

## V

## -1

## -1

## 100

### 3.3.4.20~latest

### 电池错误百分比， 用于指示电池电量低于多少进行报错

## shutdownPercentage

## 模型文件-battery-basic

## %

## -1

## -1

## 100

### 3.3.4.20~latest

### 剩余电量低于多少百分比，执行关机命令，-1 表示不启用

## timeoutThrowError

## 模型文件-battery-basic

## s

## 0

## 0

## 9999

### 3.3.4.20~latest

## 超时报错时间，单位为 s

## shutdownStillTime

## 模型文件-battery-basic

## s

## 120

## 60

## 99999

### 3.3.4.20~latest

## shutdown 关机前维持的时间值

## quantityFilter

## 模型文件-battery-basic

## %

## 15

## 0

## 100

### 3.3.4.20~latest

## 电量滤波阈值

## chargeCounter

## 模型文件-battery-basic

## —

## 0

## 0

## 9999

### 3.3.4.20~latest

### 连续多少次判定为充电,默认为0不启用,检测计数1秒1次

## fullPercentage

## 模型文件-battery-basic

## %

## 100

## 1

## 100

### 3.3.4.20~latest

## brand

### 模型文件-battery-           brand

—————————————————————————————————

充电形式，型号适配或是协议适配，当选择 byNet2Can 时，表示当前电池使用协议进行通讯

## scriptName

### 模型文件-battery-           brand

—————————————————————————————————

当使用电池协议进行通讯的话，此处填写电池协议的脚本名称（.py后缀也需填写）

## 满电百分比

## voltage

### 模型文件-battery-voltage

## —

## 48V

## 24V
## 36V
## 48V

### 3.3.4.20~latest

## 电池电压

## capacity

### 模型文件-battery-capacity

## AH

## —

## 1

## 200

### 3.3.4.20~latest

## 电池容量

### 3.确认导入的电池脚本与模型文件中的配置无误后，点击左上角的保存并推送；
## 验证
### 4.1 配置成功后可在roboshop中看到如下界面：
## image.png

## 1. 出现绿色的激光点云，表示机器人正在开机状态并已连接此电脑；
### 2.在该界面的左下角显示机器人的实际电量，表示机器人获取到电池电量；
### 3.在运行状态中可更详细的查看电池的详细信息，如下所示：
## image.png

### 5.电池电量：控制器获取到的电池实际电量；
### 6.电池温度：控制器获取到电池内部的实际温度；
### 7.电池电压：控制器获取到的电池内部的电压；
### 8.电池电流：若显示为负电流，表示该电池处于放电状态，即正在给机器人供电，若为正电流，表示该电池处于充电状态；
## 车体电量配置
配置此参数为了机器人在长时间行驶后出现突然关机的情况，避免人为忘记手动关闭机器人设置的参数
### 5.1 在机器人Roboshop Pro上位机软件中，点击【模型文件】--battery--battery，如下图所示；
1710150448272-9ba688df-6443-46ed-a8eb-d107e4b9dc9c.png 

## 1.车体电量低于25会警告，
### 2.车体电量低于20会有报错码，
### 3.车体电量低于15，车体自动关机。
## 通信方式
### 不同品牌电池的 BMS 通信方式不同，主要有以下三种：
## CAN 通讯
## RS485 通讯
## 可通过模型文件选择通信方式：

## 参数名称

## 参数位置

## 单位

## 默认值

## 列表

## 支持版本

## type

## 模型文件-battery-type

## —

## RS485

## RS485
## CAN

### 3.3.4.20~latest

## 电池通讯方式

## baudrate

### 模型文件-battery-baudrate

## —

## —

## 见Roboshop下拉列表

### 3.3.4.20~latest

## 通信波特率，根据实际选择
