# 功能测试

## 功能测试

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

## 1 调试工艺要求
详细请参照移动机器人标准—— 通用调试工艺要求和各组件调试工艺要求
## 2 功能性测试
整车功能和性能的功能测试项具有通用性，针对顶升和全向功能会有针对项测试。
## 通用测试参考如下：
## 整车产品功能性能测试项
## 车体功能性能测试标准
### 2.1 平动
a）首先完成激光slam建图，把车体位置摆正在地图合适区域； 
b）在车体当前合适位置的地面做好标记点一，然后在标记点一的正前方3m处的地面标记好标记点二； 
c）在roboshop上通过平动功能下发3m的移动距离，速度为额定速度，实际到点后再在车体同一位置的地面做好标记点三； 
d）测量标记点三距离标记点二的距离x，x≤1cm，测试至少3次数据（里程模式测量三次）。
### 2.2 转动
a）以车体两个轮子中心点向地面垂直分别做好两个标记点； 
b）通过roboshop转动功能下发转动360°，角速度为额定角速度，旋转完成后再在以车体两个轮子中心点向地面垂直分别做好两个标记点； 
c）分别将转动前的两个标记点和转动后的两个标记点连成线，得到两条直线，取两条直线的中点，以第一个点作为参考点测量转动后的点在机器人坐标系下x、y方向的偏差，x、y方向的偏差≤10mm，测试至少3次数据。
### 2.3 额度速度
GB_T 20721《自动导引车-通用技术条件》-条款5.2.2
a）额定速度测试是指重复数次测试通过直线上（根据默认最大速度及最大加、减速度确定加速区间）速度稳定那一点起5m以上区间的时间，以测定的时间、距离为基础计算额定速度，测试重复进行3次取平均值；
b）在空载、满载、前进、后退的工况下进行测试；
c）速度V（m/s）=L/T，其中，L表示区间距离米（m），T表示区间通过时间秒（s）；
d）实测速度V与roboshop运行状态界面显示的速度进行对比；
1709807298196-5e3771de-30d5-43da-9e8c-cd4cdb76af06.png 

e） 让机器人以自身所能达到的最大旋转速度运动，观察roboshop上实际速度是否为设置的旋转速度。
### 2.4 地面适应性
### 2.4.1 地面环境适应性要求
### 移动机器人应能满足以下要求的地面上运行：
a）平面度：移动机器人运行应能通过平面度在1m²范围内不小于3mm的路面，应能实现可控的额定速度行驶；
b）坡度：移动机器人运行应能通过坡度不小于0.05的路面，应能实现可控的额定速度行驶。应能在路面坡度不小于0.01的停车点可靠停止；
c）台阶高度：移动机器人应能通过台阶高度不小于5mm的路面，应能实现可控的额定速度行驶；
d）沟槽宽度：移动机器人应能通过沟槽宽度不小于8mm的路面，应能实现可控的额定速度行驶。
### 2.4.2 测试过程
控制移动机器人前进、后退、转弯、侧移、自旋，测试移动机器人对地面起伏、坡度、台阶、沟槽宽度的适应能力。
### 2.5 负载
参照标准：T_SSITS 401《工业应用移动机器人 检测规范》
### 2.5.1 静载测试
加载1.25倍额定负载进行静态测试，测试时间15min，不得出现肉眼可见的塑性变形或破坏。
### 2.5.2 动载测试
在正常环境中，按要求加载额定负载，测试移动机器人运动控制（例如：启动、停止、急停、加减速等）、执行机构动作等。
### 2.6 顶升机构标零精度
空载状态下测量托盘顶升标零精度，以车体标准零位高度为准，测试3次顶升标零完成后车体的高度：

## 第一次顶升标零

## 第二次顶升标零

## 第三次顶升标零

## 车体高度

### 2.7 顶升机构到位精度
空载状态下测试3次顶升机构到位精度，负载状态（额定负载）下测试3次顶升机构到位精度：

## 空载

## 第一次顶升到位

## 第二次顶升到位

## 第三次顶升到位

## 顶升行程

## 负载

## 第一次顶升到位

## 第二次顶升到位

## 第三次顶升到位

## 顶升行程

### 2.8 刹车距离
### 2.8.1 避障刹车距离测试
a）保证参数ObsDecDist、load_ObsDecDist、ObsStopDist、load_ObsStopDist的值为默认值（测试结果需要标注具体数值），在空载和满载的工况下以最大速度进行测试；
b）在跑道一端摆放标准的检测障碍物，车辆在跑道上加速至最高车速并保持直至到达指示线（指示线与障碍物之间的距离为 ObsDecDist-空载/load_ObsDecDist-负载 的参数值）检测到障碍物后开始制动，待完全停止后测量制动距离（指示线距离小车的距离）；
c）测试三次，取试验结果三次中的最大值。若前进和后退速度不一致或者质量分布不均匀则前进和后退方向需分别测试。

## 空载

## ObsDecDist

## ObsStopDist

## 速度

## 刹车距离

## 前进

## 后退

## 满载

## load_ObsDecDist

## load_ObsStopDist

## 速度

## 刹车距离

## 前进

## 后退

### 2.8.2 紧急刹车距离测试
a）保证参数ObsDecDist、load_ObsDecDist值为0，参数ObsStopDist、load_ObsStopDist为默认值（测试结果需要标注具体数值），参数EmergencyStopDist需保持与ObsStopDist、load_ObsStopDist一致。在空载和满载的工况下以最大速度进行测试；
b）在跑道一端摆放标准的检测障碍物，车辆在跑道上加速至最高车速并保持直至到达指示线（指示线与障碍物之间的距离为 ObsStopDist-空载/load_ObsStopDist-负载 参数值）检测到障碍物后开始制动，待完全停止后测量制动距离（指示线距离小车的距离）；
c）测试三次，取试验结果三次中的最大值。若前进和后退速度不一致或者质量分布不均匀则前进和后退方向需分别测试。

## 空载

## ObsStopDist

## EmergencyStopDist

## 速度

## 刹车距离

## 前进

## 后退

## 满载

## load_ObsStopDist

## EmergencyStopDist

## 速度

## 刹车距离

## 前进

## 后退

### 2.9 避障距离
### 2.9.1 前后避障测试
a）保证参数ObsDecDist、load_ObsDecDist、ObsStopDist、load_ObsStopDist的值为默认值（测试结果需要标注具体数值），在空载和满载的工况下以最大速度进行测试；
b）在跑道一端摆放标准的检测障碍物，车辆在跑道上加速至最高车速并保持直至到达指示线（指示线与障碍物之间的距离为 ObsDecDist-空载/load_ObsDecDist-负载 的参数值）检测到障碍物后开始制动，待完全停止后测量避障距离（小车距离障碍物距离）；
c）测试三次，取试验结果三次中的最大值。若前进和后退速度不一致或者质量分布不均匀则前进和后退方向需分别测试。

## 空载

## ObsDecDist

## ObsStopDist

## 速度

## 避障距离

## 前进

## 后退

## 满载

## load_ObsDecDist

## load_ObsStopDist

## 速度

## 避障距离

## 前进

## 后退

### 2.9.2 侧边避障距离
## 设置车体运行路径场景如下：
a）路宽以车体运行在路径正中间为基准，左右设置可移动型障碍物，保证设置车体运行在路径中左右间距相等；
b） 路径包含直行与转弯场景；
c）车体直行运行速度为最大空载速度与满载速度；
### d）车体膨胀宽度以默认参数为准，测量以下数据：

## 空载

## 最大速度

## ObsExpansion

## DecObsExpansion

## 1.当车体运行在路径中左右间隔＜ mm时，车体被阻挡不能通行；
### 2.当车体运行在路径中左右间隔≥ mm且＜ mm时，车体可以减速通过设置的场景，而不会阻挡；
### 3.当车体运行在路径中左右间隔≥ mm时，车体能够以最大速度行驶，过程中不出现减速以及停止等现象。

## 满载

## 最大速度

## Load_ObsExpansion

### Load_DecObsExpansion

## 1.当车体运行在路径中左右间隔＜ mm时，车体被阻挡不能通行；
### 2.当车体运行在路径中左右间隔≥ mm且＜ mm时，车体可以减速通过设置的场景，而不会阻挡；
### 3.当车体运行在路径中左右间隔≥ mm时，车体能够以最大速度行驶，过程中不出现减速以及停止等现象。

### 2.10 平均重复到位精度
### 2.10.1 环境要求
a）四周有明确的墙体或者障碍物，不会导致激光看到很远的地方；
b）地面平整度要求：符合产品要求 ；
c）地面材质的要求：符合产品要求；
d）地面硬度：符合产品要求；
e）地面载荷、限高：符合该产品的要求；
f）地面不能够出现水，油污，金属颗粒等影响摩擦系数因素的地面路段；
g）静电要求：符合该产品的要求；
h）需要准备出来的测试场地面积建议至少10m*10m；
i）室内测试车辆窗户遮阳处理；
j）机器人工作环境（温度、湿度等）：符合产品要求；
k）金属粉末/盐分/可燃性气体的环境要求：符合产品要求；
l）设备的防水、防酸、防爆等级要求：符合产品要求。
### 2.10.2 前置条件
a）机器人模型配置正确；
b）机器人参数配置都是默认参数(特殊要求除外)；
c）测试区域完成扫图；
d）机器人标定项已完成；
e）检查激光视角无机器人机构干涉，测试环境无打地情况。
### 2.10.3 建图方法
## a）完成测试区域的扫图工作
## b）连接线型：高阶3阶贝塞尔曲线
c）连接线LM1->LM4, LM1->LM5, LM1->LM8 方向都是正走
d）连接线LM4->LM1, LM5->LM1, LM8->LM1 方向都是倒走
e）连接线LM2->LM1长度1m；
f）LM1原地旋转90°向下倒走，新增1个站点LM10，连接线长度1m
g）连接线LM2->LM4,LM2->LM5最小曲率半径1m
### 2.10.4 Roboshop 建图样例
1709807530754-2249f91c-87b7-421e-86d4-1e68b00c340a.png

### 2.10.5 检测方法
a）移动机器人以LM1作为起点，按照预设路径自动导航至站点LM5、LM8、LM4、LM10，到达站点后在车体某一合适位置做一固定标记点一，在站点周围地面一合适点做好标记点二，测量标记点一与标记点二的距离L；
b）空载和额定负载状态各检测5次。
### 2.10.6 计算方法
### a）计算移动机器人固定点与地面测量点的平均距离：
1709807530746-c4aadc23-0f41-4209-9d6f-0228a95c95f4.png 

## 式中
## La - 平均距离，单位为mm
## L1 - 第1次检测距离，单位为mm
## L2 - 第2次检测距离，单位为mm
## Ln - 第n次检测距离，单位为mm
## n - 检测次数
## b）计算移动机器人停位偏差值：
1709807530723-f51ee0d0-7c8c-418e-a753-eb11bc9f9f4d.png 

## 式中
### ΔLn - 第n次停位偏差值，单位为mm
## c）计算平均重复定位精度
1709807530746-428bcfc8-2129-487e-9ca0-5ce23802e252.png 

## 式中
## E - 平均重复定位精度，单位为mm
## 测试结果：

## 测试站点

## 空载平均距离La

## 空载定位精度E

## 满载平均距离La

## 满载定位精度E

## LM1

## LM5

## LM8

## LM4

## LM10

### 2.11 最大误差重复定位精度
### 2.11.1 环境要求
a）四周有明确的墙体或者障碍物，不会导致激光看到很远的地方；
b）地面平整度要求：符合产品要求 ；
c）地面材质的要求：符合产品要求；
d）地面硬度：符合产品要求；
e）地面载荷、限高：符合该产品的要求；
f）地面不能够出现水，油污，金属颗粒等影响摩擦系数因素的地面路段；
g）静电要求：符合该产品的要求；
h）需要准备出来的测试场地面积建议至少10m*10m；
i）室内测试车辆窗户遮阳处理；
j）机器人工作环境（温度、湿度等）：符合产品要求；
k）金属粉末/盐分/可燃性气体的环境要求：符合产品要求；
l）设备的防水、防酸、防爆等级要求：符合产品要求。
### 2.11.2 测试工具
### 多色打点笔、卷尺、直尺、二维码标签、红外打点器
注：如果机器人配置扫码相机，则只需要准备扫码相机对应的二维码标签。
### 2.11.3 前置条件
a）机器人模型配置正确；
b）机器人参数配置都是默认参数(特殊要求除外)；
c）测试区域完成扫图；
d）机器人标定项已完成；
e）检查激光视角无机器人机构干涉，测试环境无打地情况。
### 2.11.4 建图方法
激光建图： 移动机器人现有运动车型激光导航测试直行，倒走，左转，右转重复到点精度建图应用，如下图1所示：
a）完成测试区域的扫图工作；
b）连接线型：高阶3阶贝塞尔曲线；
c）连接线LM1->LM4, LM1->LM5, LM1->LM8 方向都是正走；
d）连接线LM4->LM1, LM5->LM1, LM8->LM1 方向都是倒走；
e）连接线LM2->LM1长度1m；
f）LM1原地旋转90°向下倒走，新增1个站点LM10，连接线长度1m；
g）连接线LM2->LM4,LM2->LM5最小曲率半径1m。
1709807867555-8c487594-751c-40d8-bb2f-503cc6f5d5f2.png 

移动机器人现有运动车型激光导航测试中间站点重复到点精度建图应用，如下图2所示：
a）建立三个站点，连接线LM15->AP16,AP16->LM17方向都是正走；
b）连接线LM16->AP15,AP17>LM16方向都是倒走；
c）连接线型：高阶3阶贝塞尔曲线；
d）两站之间的连接线长度都是1m。
1709807867492-ca82b401-561a-4d4a-bb1b-67752b474442.png 

移动机器人全向车（双舵轮、双差速、麦克纳姆轮）测试横向移动重复到点精度建图应用，如下图3所示：
a）建立站点如LM27->LM28、LM28->LM27连接线路属性holdDir都设置为0； LM29->LM30, LM30->LM29连接线路属性holdDir都设置为90；
b）连接线型：高阶3阶贝塞尔曲线；
c）两站之间的连接线长度都是1m。
1709807867504-278ce850-c38f-4356-9059-b0de5d1d0eab.png 

### 2.11.5 测量方法
a）在移动机器人里程中心点的位置安装红外打点器，若机械条件不允许，建议安装在越接近移动机器人里程中心点的位置安装打点器；
b）需要测试机器人左转弯，右转弯，直行，左倒走，右倒走，倒走，中间站点到站重复到点精度（全向车需要测试横移到站重复到点精度）；
如图1,测试的站点是LM1,LM4,LM5,LM8,LM10
### 如图2,测试的站点是AP16（正走到站，倒走到站）
### 如图3,测试的站点是LM27,LM28,LM29,LM30
### 如图4,测试的站点是LM18,LM24,LM25,LM26
c）在测试站点红外打点器下方固定纸张；
d）建立任务链，循环执行任务链，并且每个站点要建议停留10s。在机器人到站静止时快速打点。
## e）任务链规划：
以图1为例，导航顺序为：LM1->LM5->LM1->LM8->LM1->LM4->LM1->LM10
以图2为例，导航顺序为：LM15->AP16->LM17->AP16
以图3为例，导航顺序为：LM27->LM28；LM29->LM30
以图4为例，导航顺序为：LM18->LM24->LM18->LM25->LM18->LM26
f）单个站点至少打点10次，打点完成后，需要标明在机器人坐标系下机器人到站方向，收集绘制打点的精度距离（X方向，Y方向）；
g）机器人空载，满载分别测试；
h）收集提取测试时间段的测试log.
### 2.11.6 数据分析
## 手动打点测量结果确认：
a）标明手动打点或者红外打点器在机器人的位置；
b）打点精度最大误差（机器人在同一测试站点打点X方向，Y方向最远两点距离）；
## 示例：

## 测试站点

## X方向最远两点距离（mm）

## Y方向最远两点距离（mm）

## 空载

## 满载

## 空载

## 满载

## LM1

## LM4

## LM5

## LM8

## LM10

## AP16

c）标明打点X方向，Y方向最远两点距离最差的测试站点；
d）测试log分析：利用 Log分析器中工具Tools中的TargetPrecision，可以看出绝对定位精度 （站点平均值和地图站点之间的距离）和重复到点精度（每个站点X方向、Y方向以及角度的偏差）。使用此功能前需要先打开场景地图，否则 TargetPrecision 无法获得地图的点位位置。下面的截图解释了 TargetPrecision 的功能。TargetPrecision 可以获取到点的绝对精度，以及依据定位数据的获得多车的重复精度。另外，还能分析出来哪次机器人到点精度最差。
1709807867534-e3861986-becd-47f5-8832-666380a386d3.png 

1709807867866-16ac95c2-e948-4ed2-9d39-3e0173a3d9c7.png 

## 以测试站点LM1示例：

## 测试站点（LM1）

## X方向偏差

## Y方向偏差

## 角度偏差

## 1

## 2

## 3

## 4

## 5

## 6

## 7

## 8

## 9

## 10

### 2.12 噪声检测
a）测试地面要求：硬质地面，平坦光滑，无坑洼，机器人移动不产生附加噪声；
## b）测试运行条件：
## 1. 正常工作状态
### 2. 当有负载要求时，应在额定负载的状态下进行测试
### 3. 应正常运行至少3min后进行测试
### 4. 环境噪音低于30dB
c）测试方法：在距离地面高1米，水平距离0.7米的位置测试机器人工作过程中(负载最大速度1.5m/s运行)所产生的噪音≤75dB.
### 2.13 充电测试
### 2.13.1 手动充电
使用手动充电器直接连接机器人的手动充电口（航空插头），观察充电器是否显示正常电压、电流输入以及Roboshop运行监控界面是否是显示正常充电状态。
### 2.13.2 自动充电
通过Roboshop软件设置机器人自动充电任务， 使用反光板识别验证车体自动充电功能 ，观察Roboshop运行监控界面是否是显示正常充电状态（输入电流是否为正值，充电按钮是否显示等）。
### 2.14 开关机
短按1s开关机键，机器人正常开机；长按2s开关机键，机器人正常进行关机，测试至少5次以上，无异常开关机现象出现。
### 2.15 开环运动检测
手动控制（Roboshop手动控制、其他外部手动控制装置）机器人进行前后左右移动，查看机器人运动是否平稳、有无卡顿、大幅度跑偏等情况。
### 2.16 DI DO
根据车体实际I/O接线表验证各个DI、DO对应功能。
### 2.17 灯带
根据灯带逻辑确认不同状态下机器人灯带显示的颜色，是否与下图规定一致：
1709808187702-5cbedc7f-d456-46f9-a292-a010172d8d80.png

## 默认的氛围灯及显示效果为：
## 机器人出错报警：红色呼吸
## 机器人急停：暗红色闪烁
## 机器人被阻挡：粉紫色跑马灯
机器人转向中：橙黄色闪烁（根据实际数量及方向：1.向前左转、右后退，左灯带橙黄色闪烁，右灯带未点亮；2.向前右转、左后退，右灯带橙黄色闪烁，左灯带未点亮；3.原地旋转，左右灯带同时橙黄色闪烁）
## 机器人直行倒车：白色呼吸
## 机器人直行中：蓝色呼吸
## 机器人充电中：橙黄色呼吸
## 机器人低电量模式：暗红色跑马灯
机器人静止状态：显示电量，从绿色（剩余电量 100% ）至暗红色（剩余电量 10% ）渐变
### 电池类型未配置（或电池通讯出错）且机器人静止：彩虹灯带
### 2.18 老化
a）建立地图，在地图中增加正走、倒走、转向、自动充电、直线行驶、叉臂升降动作等元素；
b）加载额定负载，将机器人在此循环中持续运行24h，观察持续运行期间小车有无报错；
c）检查log，若24h 持续测试中途由于报错、故障被打断，则重新开始 24h 老化测试。
