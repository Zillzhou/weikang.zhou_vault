# 同毅舵轮总成(同毅行走驱动+同毅转向驱动)配置 SOP

### 同毅舵轮总成(同毅行走驱动+同毅转向驱动)配置 SOP

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

说明：本章舵轮驱动器配置的型号为同毅 TYD160-SM07530BA，转向部分为增量式编码器伺服电机 + 限位开关。
## 配置前的准备工作'

## 序号

## 准备事项

## 备注

## 1

## 已安装同毅驱动器调试软件的笔记本电脑
同毅上位机软件下载链接： 软件 - 上海同毅自动化技术有限公司

## 2

USB转485连接线， 
1710754322388-540c4711-7fc8-4fcc-abe9-bc8bebdfbeb9.jpeg

## 3

已正确接线和上电的驱动器，

## 4

舵轮已经正确安装在车体上。仅以同毅 TYD150 系列舵轮为示例，正确安装的标准如下：从俯视图角度看，一定要保证车体前进方向与车轮保持平行，一定要避免舵轮错位180°安装在车体上。
## image.png

正确安装方式如下图。
1710998606631-66e66fce-5f8a-4b45-8ed1-aba83554c509.png

## 此项是舵轮能正确转向的关键步骤

## 5

需要在舵轮附件贴上正方向标记线，舵轮手动找零时作为参照物，如下图所示，参照线可以标记在车体其他位置，能方便找零时参照即可。
1710999305714-d93c346d-066f-4879-8d0a-6ecdb4dfbbec.png

## 模型文件中运动学模型配置
在“模型文件”任务栏中，配置底盘模型参数。
Jn5KbZimRoPgLgxFRiecUaHYnqc.png

本车型详细参数配置如下图。
WdNZbR1rHomQxbxXZ0NcUN1dnhg.png

## 行走电机驱动器上位机配置
### 3.1 上位机连接
a）完成上位机与驱动器的连接后，查看驱动器软件版本。
## image.png

目前稳定可用无问题的版本需要在此版本12206.815之后（不清楚是老版本还是新版本，可以问供应商）
## b）打开上位机软件
1710816259147-7960a370-4aa7-4768-abbf-837592a8d71a.png

## c）选择选择导入准备中的xml文件
## image.png

## d）连接串口
## image.png

选择RS485通信卡的串口号，点击连接，成功连接后，右下方如图显示。
## image.png

### 3.2  修改CANopen参数
具体操作步骤如下图。
## image.png

在第 3 步中，修改波特率为 250 Kbps，需要注意要与模型文件中对应起来；
在第 4 步中，修改节点id为特定值，要与模型文件中的配置参数对应，在同一个CAN路下所有节点都不能一样；
在第 5 步中，将PDO数量改成 0；
在第 6 步中，打开canopen使能开关，选择 Enable。
### 3.3 修改通用参数
a）修改使能及模式，具体操作步骤如下图。
## image.png

在第 2 步中，关闭内部 IO 使能，选择 off；
在第 3 步中，修改控制模式选择方式为 Stdspeed loop。
b）修改速度模式参数，具体操作步骤如下图。
## image.png

在第 2 步中，修改停止段 KP 为 20000；
在第 3 步中，修改停止段 KI 为 100；
在第 4 步中，修改停止段 K P为 30000；
在第 5 步中，修改停止段 KI 为 100。
c）修改电流控制参数，具体操作步骤如下图。
## image.png

在第 2 步中，修改 Iq 电流 KP 为 100；
在第 3 步中，修改 Id 电流 KP 为 100。
### 转向电机驱动器上位机配置（增量式编码器电机）
### 4.1 上位机连接
## 与 2.2.1 步骤保持一致
### 4.2 修改使能及模式
具体操作步骤如下图。
## image.png

在第 2 步中，在“计算值”这一栏中将值改为 “off”；
在第 3 步中，修改控制模式为 “StdSpace loop”。
### 4.3 修改电流控制参数
具体操作步骤如下图。
## image.png

在第 2 步中，修改 Iq 电流 KP 为 30；
在第 3 步中，修改 Id 电流 KP 为 30。
### 4.4 修改位置控制模式参数
具体操作步骤如下图。
## image.png

在第 2 步中，在“计算值”这一栏中将值设置为“2”；
### 4.5 设置复位参数
具体操作步骤如下图。
## image.png

首先手动将舵轮转到正方向，与参照线保持平行，如下图。
1711005238138-2072e1b0-af5f-4840-9246-f342eac53898.png

在第 2 步中，修改回零模式为 1（转向电机必须安装负限位开关，和驱动器IO负限位相连）；
在第 3 步中，修改零点偏置为 00000。
### 4.6 修改CANopen参数
与 3.2 步骤保持一致，需要注意修改节点id为特定值，要与模型文件中的配置参数对应，在同一个CAN路下所有节点都不能一样。
### 4.7 修改通用参数
a）修改使能及模式，具体操作步骤如下图。
## image.png

在第 2 步中，关闭内部 IO 使能，选择 off；
在第 3 步中，修改控制模式选择方式为 StdSpace loop。
b）修改电流控制参数，具体操作步骤如下图。
## image.png

在第 2 步中，修改 Iq 电流 KP 为 30；
在第 3 步中，修改 Id 电流 KP 为 30。
c）修改位置控制模式参数，具体操作步骤如下图。
## image.png

在第 2 步中，修改限位模式为 2。
完成驱动器全部设置后，断电重启。
## 舵轮电机模型文件配置
### 5.1 配置前舵轮行走电机
设备名可用“front-drive”，必须勾选“启用设备”。
1709017868354-f3cce16c-29aa-4b6f-a386-f3799cdbd8f4.png

本车型详细参数配置如下。
1709809751575-fd1fb6e7-c7d5-4c81-85d2-d8ca8a0e1e7e.png

## 基本参数配置（basic）

## 参数名称

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## x

## m

## /

## /

## /

舵轮回转中心在右手坐标系下的 x 位置，如小车模型中坐标，根据实际距离填写

## y

## m

## /

## /

## /

舵轮回转中心在右手坐标系下的 y 位置，如小车模型中坐标，根据实际距离填写

## yaw

## °

## /

## /

## /

## 舵轮安装的朝向，根据实际安装位置填写

## canID

## /

## /

## /

## /

行走轮对应电机驱动器的 canID，根据驱动器上位机配置决定

## inverse

## /

## /

## /

## /

## 电机是否反向旋转，根据实际需求配置

## encoderLine

## /

## /

## /

## /

## 电机编码器线数，根据电机实际参数填写

## currentFactor

## /

## /

## /

## /

## 电机电流因数，根据实际情况填写

## upLimitDI

## /

## -1

## /

## /

上限位DI，-1代表不启用，如果启用根据上限位传感器DI填写，舵轮行走电机配置为-1

## downLimitDI

## /

## -1

## /

## /

下限位DI，-1代表不启用，如果启用根据下限位传感器DI填写，舵轮行走电机配置为-1

## zeroDI

## /

## -1

## /

## /

零位DI，-1代表不启用，如果启用根据零位传感器DI填写，舵轮行走电机配置为-1

## passive

## /

## /

## /

## /

### 是否为被动电机，不勾选代表不启用，舵轮行走电机不勾选

## brake

## /

## /

## /

## /

## 舵轮行走电机不勾选

## CAN通信配置（canPort）
本车型详细参数配置如下。
1703761670338-07277b92-61e0-4912-bf4f-819ac1963fdf.png

## 参数名称

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## canPort

## /

## /

## /

## /

port1，表示CAN的通信端口1；port2，表示CAN的通信端口2；请根据实际情况进行选择

## 功能配置（func）
本车型详细参数配置如下。
1709018254634-05e3c844-49be-434f-9966-8b22927d2b98.png

## 选择类型为 walk，需配置参数如下

## 参数名称

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## wheelRadius

## m

## /

## /

## /

### 驱动轮实际轮半径，请根据实际情况进行填写

## reductionRatio

## /

## /

## /

## /

## 驱动轮减速比，请根据实际情况进行填写

## minimumSpeed

## m/s

### 0.05

## /

## /

电机的最小启动速度的上限值，例如电机需要0.01m/s才能启动，则下发值始若小于0.01m/s时会逐渐增加到电机刚好动的值作为启动速度，但不会超过该参数。

## deltaCnt

## count

## -1

针对minimumSpeed的加速系数，系数越大，递增的速度越快，越快达到minimumSpeed上限值。一般情况下无需调节该参数，设置为 -1。

## deadDealerK

## /

## /

## /

## /

该值用于特殊情况下，若电机编码器抖动较大时，启用该参数可以解决电机数据判断为非静止的状态，一般默认设置为100。

## 通讯协议配置（brand）
本车型舵轮驱动器为同毅lxL系列，如下图。
1709025903166-e048292f-837a-48f7-ba7c-c699e43e28f3.png

详细参数配置如下。

## 参数名称

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## brand

## /

## /

## /

## /

指所配置的驱动器的型号，请根据实际情况进行勾选，其中我们支持的驱动器品牌请查看链接：
## motor

### 5.2 配置前舵轮转向电机
右击之前配置好的“front-drive”，选择“复制并添加”。
1709026830247-73426099-dae7-45ec-bc3b-cfe49736b16e.png

将新添加的电机设备名建议改为“front-steer”，必须勾选“启用设备”。
## 基本参数配置（basic）
本车型详细参数配置如下。
1709810031733-dd434d41-3800-4625-805a-42fee293add5.png

## 参数名称

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## x

## m

## /

## /

## /

舵轮回转中心在右手坐标系下的 x 位置，如小车模型中坐标，根据实际距离填写。

## y

## m

## /

## /

## /

舵轮回转中心在右手坐标系下的 y 位置，如小车模型中坐标，根据实际距离填写。

## yaw

## °

## /

## /

## /

舵轮安装的朝向，根据实际安装位置填写。

## canID

## /

## /

## /

## /

行走轮对应电机驱动器的 canID，根据驱动器上位机配置决定。

## inverse

## /

## /

## /

## /

电机是否反向旋转，根据实际需求配置。

## encoderLine

## /

## /

## /

## /

电机编码器线数，根据电机实际参数填写。

## currentFactor

## /

## /

## /

## /

电机电流因数，根据实际情况填写，可参考上面图片中的数值填写。

## upLimitDI

## /

## -1

## /

## /

上限位DI，-1代表不启用，如果启用根据上限位传感器DI填写，一般舵轮转向电机配置为-1。

## downLimitDI

## /

## -1

## /

## /

下限位DI，-1代表不启用，如果启用根据下限位传感器DI填写，一般舵轮转向电机配置为-1。

## zeroDI

## /

## -1

## /

## /

零位DI，-1代表不启用，如果启用根据零位传感器DI填写，舵轮转向电机配置为-1

## passive

## /

## /

## /

## /

是否为被动电机，不勾选代表不启用，舵轮转向电机不勾选。

## brake

## /

## /

## /

## /

一般不勾选。

## CAN通信配置（canPort）
本车型详细参数配置如下。
1703761670338-07277b92-61e0-4912-bf4f-819ac1963fdf.png

## 参数名称

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## canPort

## /

## /

## /

## /

port1，表示CAN的通信端口1；port2，表示CAN的通信端口2；请根据实际情况进行选择。

## 功能配置（func）
本车型详细参数配置如下。
1709083629482-b6b4744c-5af9-4e7d-bcc6-dca4dc2824ca.png

### 选择类型为 steer，需配置参数如下：

## 参数名称

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## maxSpeed

## °/s

## /

## /

最大速度，请根据实际情况进行填写，可参考上面图片参数设置。

## maxAcc

## °/s²

最大加速度，请根据实际情况进行填写，可参考上面图片参数设置。

## maxDec

## °/s²

最大减速度，请根据实际情况进行填写，可参考上面图片参数设置。

## maxJerk

## °/s³

最大加加速度，请根据实际情况进行填写，可参考上面图片参数设置。

## reductionRatio

## /

## /

## /

## /

减速比，请根据实际情况进行填写，需要注意此处减速比值为齿轮比乘以减速机减速比。

## maxAngle

## °

## /

## /

## /

舵轮转向的最大角度，请根据实际标零方式进行填写。标零方式可根据车体设计的舵轮安装方式自行选择。

## minAngle

## °

## /

## /

## /

舵轮转向的最小角度，请根据实际标零方式进行填写。

## steerOffset

## °

## /

## /

## /

舵轮向正前方行走时角度的偏置值，请根据实际标零方式进行填写。

## steerResolution

## °

## /

## /

## /

舵角分辨率，请根据实际情况进行填写。

## bySpeed

## °

## /

## /

## /

一般默认不勾选。

## steerOffsetFile

## /

## /

## /

## /

steerOffset值所在的文件夹，请根据实际情况进行填写，一般默认不填写。

## positionSpeed

## °/s

## /

## /

舵轮旋转的位置模式的速度，现在只能用作kinco 配做转向电机的时候，请根据实际情况进行填写，一般默认为30。

## 通讯协议配置（brand）
本车型详细参数配置如下。
1709025903166-e048292f-837a-48f7-ba7c-c699e43e28f3.png

## 参数名称

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## brand

## /

## /

## /

## /

指所配置的驱动器的型号，请根据实际情况进行勾选，其中我们支持的驱动器品牌请查看以下链接：motor

### 5.3 配置后舵轮行走电机
配置方法和步骤与前舵轮行走电机一致，请参考3.3.1章节。本车型具体参数如下图所示。
1709810325035-1aea38e3-9a95-4d03-8231-8731b2bd08c8.png

1709810369284-9d29f86f-0c1f-49b6-b315-b7468cf1aa84.png

### 5.4 配置后舵轮转向电机
配置方法和步骤与前舵轮转向电机一致，请参考 5.2 章节。具体参数如下图所示。
1709810490139-4d956a0f-db7e-4be8-b5b7-1f36d2dc9ed3.png

1709810569315-1565d095-a509-451d-81e6-e0a884e3932e.png

1709810591693-9627b02e-13e7-4834-9ae1-6878eb8e5976.png

## 配置结果验证
## 验证步骤如下：
将舵轮离地，开机后舵轮会自动标零，具体动作如下视频。

## 舵轮配置后验证视频.mp4
让车体着地，使用 Roboshop 软件中的平动功能，如下图所示，操作机器人分别向前、向后、向左、向右移动1m 距离，用卷尺测量移动距离是否为 1m；
### 企业微信截图_17113480769374.png

未拍急停按钮前，推动机器人，无法推动（电机使能），检查 Roboshop 中机器人状态处于“未急停”“驱动器未急停”，如图 6-1 左侧图所示；所示拍下急停按钮后，再次机器人，可以推动（电机去使能），检查 Roboshop 中机器人状态处于“已急停”，“驱动器已急停”。如下图右侧图所示；
## image.png
