# 调试sop

## 调试sop

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.3.15

## 初版

## 使用中

## V1.1

### 2024.4.09

## 修改编号

## 使用中

## 参数设置
## 参数设置
连接机器人后，点击【参数配置】，可进入参数设置界面，可在此页面中进行参数查询、编辑、保存、导出、默认值、参数对比等操作。
1708504078323-a6fd7b52-676e-4688-bc32-1ee2f19ebbc7.png

【显示更多】参数列表中的参数。
【搜索】输入的关键字。
【导出参数】将参数文件保存至本地。
## 【仅显示修改参数】
【刷新】参数列表。
【启用参数对比】对比两个机器人之间参数的差异。
【全选】选择参数列表内所有参数。
【恢复选中默认值】恢复选中参数的默认值。
【恢复所有默认值】恢复所有参数的默认值。
【临时修改】临时修改机器人参数。
## 【永久修改】永久修改机器人参数
机器人参数列表，显示机器人所有参数。

### TCP 端口最大连接数：TCP 端口最大连接数
## 启用参数对比
## 启用参数对比
在参数配置界面，在导入新参数文件后，支持新旧参数对比，详细可参照roboshop使用文档。
1708504926334-399fd336-fbd8-434f-8944-c35ef8e7310f.png

对比任意两台车的参数，可按下述两个步骤操作。
1708504745643-452cad26-4865-4d12-b7c4-8a848a21275d.png

## 模型文件配置方式及关键字解析
## 系统模型文件配置
在使用Roboshop进行机器人连接时，可以在标题栏中看到模型文件选项，连接成功后可以进行拉取，可以查看到当前所有支持的模型文件，每个不同的模型文件对应着机器人身上不同的部分，具体可参考 移动机器人模型
1708505652406-fb40b085-e743-4f4a-ac24-95d8dbed7523.png

## 进入机器人界面的【模型文件】页面
## 对文件的操作：
## 【拉取】：从机器人端拉取模型文件到本地
### 【推送】：从本地推送修改后的模型文件到机器人
## 【加载】：导入本地模型文件
## 【另存为】：将当前模型文件保存到本地
机器人模型类型：具体模型种类及配置参数可参考 移动机器人模型
## 中间显示当前机器人模型布局图
【属性窗口】：在属性窗口中点击【启用设备】可以开启使用该模型，并在布局图上显示。可对机器人模型参数进行具体配置
## 机器人模型关键字解析
模型文件中各关键字的解析请参照：造车部分文档，各部件sop文件中模型文件介绍。
## 模型文件配置方式
模型文件可通过两种方式进行设置。
方式一：在连接机器人后，通过roboshop—模型文件，进行每一个条目的参数设置。
1708503263625-066bce0f-13cf-4ecf-8bd1-39e0051119e4.png

方式二：通过导入同款车型配置的模型文件。在模型文件界面，点击【加载】，选中本地的模型文件，进行上传。如果有需要，上传完成后可再进行细节的修改。
1708503362666-8f4e55f2-f072-4e26-aff0-abbaad88ddd8.png

## 模型文件及识别文件配置说明
以单线导航激光+上下视读码相机配置的SJV-SW600进行手动模型文件配置说明。
## 模型文件
## 参考模板：
### 20231128184221.robot.rar
## 注意事项：
1）当模型文件中同时启用上下两个pgv， 读码相机上视和下视不可以同时配置为adjustLocalization，同时配置时，通过roboshop识别二维码建图时，优先会选择上视作为默认读码相机。想要使用下视建图， 上视pgv必须屏蔽或者作为adjust使用 。

## 识别文件
在使用Roboshop进行机器人连接时，可以在标题栏中看到识别文件选项，连接成功后可以进行拉取，可以查看到当前所有支持的识别文件，每个不同的识别文件对应着不同的识别方式和服务。
下面介绍不同的识别文件类型，默认拉取可以看到当前版本程序支持的类型。
1708506077451-08f1028d-c6a7-43a2-862b-1118915b23c7.png

## 工具栏
【Load】加载 ： 加载识别文件。
【Save all】：保存所有识别文件。
【Save As】：另存识别文件。
【Upload】：上传识别文件到机器人。
【Download】：从机器人中下载识别文件到本地。
【Undo】：撤销编辑。
【Redo】：恢复编辑。
【Help Document】：帮助文档。
【Refresh】：刷新。
### 2.目录：所有识别文件列表
### 3.模型区域
### 4.识别文件的属性窗口
## 涉及潜伏顶升车的识别文件相关如下：
## charger （充电桩）
1708506308035-9b7bcdf1-9bf6-4559-b30f-8bf7d64e9ce7.png

### 充电桩识别模型，用于自动充电，具体属性参数如下：
【Device name】：设备名称，可自定义。
【minwidth】：充电桩上反光条的最小宽度。
【maxwidth】：充电桩上反光条的最大宽度。
## [!NOTE]
机器人会同激光雷达检测宽度大于 minwidth 且小于 maxwidth 的反光条，从而确定充电桩位置
【dx】：充电极片，相对于充电桩坐标系原点，在 x 轴上的偏移量，需要手动测量。
【dy】：充电极片，相对于充电桩坐标系原点，在 y 轴上的偏移量，默认量为0。
【method_type】:识别方式，by_reflector 反光板识别   /  by_legshape 形状识别。默认为反光板。
【brand】：充电桩型号厂家，按实际选择。
## tag（二维码）
实际使用二维码时，通常将两个二维码对称贴在目标物体上，识别的位置为两个二维码的中点，因此需要指定二维码与目标物体之间的空间关系。将坐标关系描述记录在描述文件，后缀名为.tag，存放于 Robokit /resource/objects/tag/目录下，或在 Roboshop 识别文件中“tag”标签下编辑。 
1708506727260-4e735bb0-0e27-45c1-bede-c267a6630ce9.png

## 属性窗口的各个参数释义如下
【X_Dis】：二维码中心在货架坐标系中x方向的坐标；
【Y_Dis】：二维码中心在货架坐标系中y方向的坐标；
【Z_Dis】：二维码中心在货架坐标系中z方向的坐标；
【goodsWidth】：货架宽度；
【goodsLength】：货架长度；
【tagDistance】：两二维码中心的水平距离（默认在同一高度）；
【tagSize】：二维码大小；
【Tagtype】：二维码种类。
## [!NOTE]
当默认二维码对称贴于货架前端两侧时，X_Dis的值为货架长度的相反数（负值），Y_Dis的值为0， Z_Dis的值为二维码中心的离地高度。
## shelf(顶升车用货架)
因为工厂中可能存在各种各样的满足机器人钻入要求的货架，货架描述文件的后缀名为.shelf,存放于 Robokit/resources/objects/shelf/ 目录下。在Roboshop识别文件中货架标签下编辑。
1708506677948-3bb692ad-34de-437a-8dee-c4b08a653711.png

【width】：改造后，钻入方向上，两个货架腿的外侧宽度。这里的宽度，是指改造后，两块反光条的最外侧宽度。
【length】： 垂直于钻入方向的两个货架腿的最外侧宽度。
【leg_width】：反光条宽度，若选用标准 3M 汽车反光贴，即为 0.05（米）。
【align_depth】：x或者-x识别下，前置线路为“倒走”，也就是机器人钻入货架底部后，机器人坐标系 x 轴正方向与货架 x 轴正方向重合时（参考图 1货架坐标系示意图及机器人坐标系示意图），机器人停下的位置和货架前腿之间的距离，开放出来配置，主要是便于实施时候调整。
【anti_align_depth】： x或者-x识别下，前置线路为“正走”，也就是机器人钻入货架底部后，机器人坐标系 x 轴正方形和货架 x 轴正方向差 180 度（参考图 1货架坐标系示意图及机器人坐标系示意图），机器人停下的位置和货架前腿之间的距离，开放出来配置，主要是便于实施时候调整。
【y_align_depth】：y或者-y识别下，前置线路为“倒走”，也就是机器人钻入货架底部后，机器人坐标系 x 轴正方向与货架 x 轴正方向重合时（参考图 1货架坐标系示意图及机器人坐标系示意图），机器人停下的位置和货架前腿之间的距离，开放出来配置，主要是便于实施时候调整。
【y_anti_align_depth】： y或者-y识别下，前置线路为“正走”，也就是机器人钻入货架底部后，机器人坐标系 x 轴正方形和货架 x 轴正方向差 180 度（参考图 1货架坐标系示意图及机器人坐标系示意图），机器人停下的位置和货架前腿之间的距离，开放出来配置，主要是便于实施时候调整。
【rec_off_x】：表示在识别坐标 x 方向的偏移量(m)。
【rec_off_y】：表示在识别坐标 y 方向的偏移量(m) 。
【rec_off_angle】：表示在识别坐标角度偏移量(度) 识别坐标系为右手坐标系，x 轴指向识别物体外侧，即为识别表面的外法向向量。
【outer_width】：因为存在货架顶部比货架腿形成的矩形要大的情况，因此有这个参数；这个宽度的方向和参数width是同向的。
【outer_length】：因为存在货架顶部比货架腿形成的矩形要大的情况，因此有这个参数；这个长度的方向和参数 length是同向的。注意为了防止反光条的噪声，outer_length 至少需要比 length 大 5cm。
【extra_dist】：激光抠除区域的宽度。
【continue_detect】：如果不要实时识别，即普通识别钻入货架，应将continue_detect不勾选。
【side_block】：是否货架侧方有挡板。
【detect_direction】：用来指明识别朝向，detect_direction有x,y,-x,-y四个选项。
【leg_type】：货架腿类型，方形（cube）和圆柱形（cylinder）可选，暂时不起作用。
【method_type】：by_reflector 反光板识别   /  by_legshape 形状识别。
## 建图
实施和调试过程因场景不同都会涉及到建图和导航操作，可作为通用文档。
潜伏顶升车上激光装配2D激光用于导航避障，因此建图仅包含2D建图。单线激光建图
## 扫图环境要求
机器人对使用的环境是有一定要求的，下面列举了一些常见的不适合机器人运行的环境，请避免这些情况或做相应的处理。
## 环境的材质
### 以下环境材质会对机器人的建图及定位导航造成影响：
机器人的激光雷达无法正确扫描表面呈镜面反射的物体（如镜子、光滑的金属表面）。

1651914078393-f7b30bb9-436d-464d-be69-7cd5d9e9e596.png

下面两张图为激光雷达的原始数据在普通材质和镜面不锈钢面板的显示。可以看到，普通材质基本呈一个平面，而镜面不锈钢面板数据杂乱，无法看出这是一个平面。

1651914158267-626c4fd7-2d32-4f83-b487-e15d6e2fa4dc.png 

1651914167530-681aa97a-71a8-4ab4-9857-786bb464eaa9.png

机器人的激光雷达无法正确扫描透明后半透明的物体（如玻璃、部分毛玻璃等）。

1651914235923-b00286a6-b7d9-4fcd-87ca-e7185cb7dc4e.png

机器人的激光雷达无法正确扫描黑色的物体，黑色将吸收所有光线，使激光雷达的有效距离降低甚至失效。
如果遇到以上三种情况，需要在环境中的机器人激光雷达所在平面黏贴 3M 反光条，用于遮挡镜面、玻璃或黑色物体。
## 环境的轮廓
### 以下环境会对机器人的建图及定位导航造成影响：
非常空旷的环境，有较多空旷区域的范围大于激光雷达的有效距离，即机器人在这些空旷区域里几乎扫描不到有效的环境特在。
## 解决方法：使用有效距离更大的激光雷达
非常杂乱的环境，机器人无法获得良好的环境轮廓。
## 解决方法：整理环境，移除无用的物体
有较多区域极其相似的环境，机器人无法根据环境轮廓辨别位置。
### 解决方法：在环境中随机增加一些有特征的标志物
没有特征的长廊环境，长廊的两边墙面没有任何可参照物或者参照物非常有规律从而无法获得有效的特征。
### 解决方法：在环境中随机增加一些有特征的标志物
极易变化的环境，短时间内就会发生较大改变的环境将使机器人无法构建出正常的地图，或者使已构建的地图失去可参照性。
## 解决方法：避免或减少环境发生较大的变化
## 建图步骤
## 通用slam建图步骤
步骤1：确认机器人无异常后，地图主界面点击 【2D 建图】, 选择 【Slam】建图，参数保持默认即可后可开始扫图。
注:如果参数界面未弹出，则手动控制机器人行走看是否会弹出，如果依然无法弹出，则关闭 Roboshop 所在计算机防火墙，重启 Roboshop 再试一次。
其中若当前场景已确认为反光导航模式，在参数界面需要勾选【反光板】，并在反光板型号中选择当前所使用的采反光物反光板/反光柱，以及其宽度。
1708586535129-bcdc5043-6718-40ce-8885-87a7d73cf783.png

点击【确认】可进入手动扫图模式。
步骤2：通过 左下角【WASD】来操控车辆行走对所需要作业区域进行闭环式扫图。
扫图路径：扫描一圈回到起始点，最后扫出来的地图和机器人行走的路线一定要形成一个闭环。
1708581195502-4485b757-d11d-480a-a320-dbe4c3ab5d5a.png

步骤3：等待建图完成，然后点击右上角的【完成扫图】按钮，可查看整体地图样式，并对地图进行相关操作。
1708581477867-42aa508d-4d3a-4957-a756-172d8e9c353e.png 

## 步骤4：地图处理
【保存】：将建好的地图保存到本地。保存成功后会弹出对话框询问是否【打开】或【推送地图】，即可打开刚才所构建的地图且将该地图进行同步，可以直接 进行使用。此时地图构建部分已经完成。
1708582129428-f0e8acc8-52db-4777-bfa2-3ec5b7c71fa2.png

【拼接地图】：可进行多块地图拼接，主要针对大地图场景，以及部分区域建图效果差用于优化。
【优化地图】：进入地图参数设置，【确认】后可预览并进行【另存为】。
1708581974023-93b95a81-575f-4d5c-a305-c02043514d73.png

1708582006135-75eb3518-f46f-4e7c-a27e-ce0d5ba8d723.png

## 扫描rawmap建图步骤
步骤1：确认机器人无异常后，地图主界面点击 【2D 建图】, 选择 【扫描rawmap】。点击后图标变成正在扫图，此操作不触发扫图，需要再点击【2D建图】
1708582422942-f81af180-2961-431d-aaf5-ec7690183f78.png 

1708582661049-dd40518c-bba2-4fc4-98d1-a9ae210e2e96.png 

步骤2：手动控【WASD】机器人行走扫描地图。
步骤3 ：扫图完成后，点击【停止扫描】，跳转至扫图界面。
1708582779705-5ebadb0d-7628-46fd-ab45-76927895b8ac.png 

步骤4：同上述slam扫图一样，确认配置参数后，系统自动下载rawmap进行建图，进度达到100%后，进入地图处理界面，后续操作如上。
1708582905263-10d6b4e6-6267-47ff-8562-a0b0c8603b24.png 

1708582940562-4224e921-6a5b-4608-8f0a-f839fd76b6d9.png

## 加载rawmap建图步骤
通过加载本地RAWMAP进行建图。
步骤1：【地图与控制】主页，点击【加载 rawmap 】点击后进入【加载 rawmap 进行建图】界面。
1708583327117-a0df8513-b713-416c-8cdd-6e74fb5753dd.png 

1708583380273-ae2aa3d1-5d05-4c4b-b8a5-02ec1e17d268.png 

步骤2：再次点击【加载 rawmap 】，加载本地的RAWMAP文件。
1708583448473-1bfd8f37-f23b-436a-a086-07f1936afbfe.png

按照上述 SLAM实时扫图建图的 2,3,4 流程完成地图，并保存上传。
## 下载rawmap文件进行建图
下载机器人中最后一次扫图生成的 rawmap 文件用于创建地图，操作与界面与上述加载rawmap文件一致。
1708583622426-acef7f52-3dc2-49c2-95c4-fff6ccecc138.png

## 导航
前提：已完成场地反光板、反光柱、二维码等定位工具布设。（参照调试准备文档）
## 激光导航
当前已支持的激光导航方式包含 自然轮廓定位 、 NFL（特征定位） 和 反光定位 （需要建反光板地图）。
激光自然轮廓定位是当前系统模型文件配置时默认的定位方式，因此无需特殊设置，在完成硬件和软件配置后，直接进行导航点位、路线设置即可。

## 站点规划和地图编辑
在地图与控制主界面，点击【启用编辑】，进入地图编辑界面，可在此界面进行站点和路径的建立。
1708589126397-ffe962fc-c7f8-4a26-a2d0-fd7de417072f.png

1708589205368-9d5be2c0-2bae-4ec9-a43d-c08fe5320549.png 

点击左侧菜单栏【站点】后，可在右侧地图界面，按照需求新增站点。
1708592174060-ea4587b4-7908-464d-8da0-245219408bcc.png

点击左侧菜单栏【路径】后，可在右侧地图界面，按照需求连接任意站点，规划车辆移动路径。
1708592271647-8fe6d36c-9ab4-45e9-b1f0-26d52a9b28e9.png

## 线路设置
在添加特定并规划好路线后，应当先走一遍路线，确定小车的轨迹符合预期。线路设置
## 固定路径导航
## NFL（特征定位）
## 特征绘制及实施：特征定位
## 反光板定位
## 反光板定位实施
## 自由导航
## 自由导航

## 二维码导航
## 二维码区域布设：二维码
