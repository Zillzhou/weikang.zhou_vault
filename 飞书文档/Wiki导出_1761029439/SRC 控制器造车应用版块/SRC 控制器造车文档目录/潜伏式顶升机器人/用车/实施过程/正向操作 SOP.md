# 正向操作 SOP 

## 正向操作 SOP

## 版本

## 更新日期

## 更新说明

## 文档整理人

## 维护责任人

## 研发审核人

## 应用审核人

## 市场审核人

## V1.0

### 2024.2.15

## 初版编辑

## 倪敬雪

## 倪敬雪

## V1.1

### 2024.4.09

## 修改编号

## 倪敬雪

## 倪敬雪

## V1.2

### 2024.5.22

## 增加章节7识别文件描述

## 倪敬雪

## 倪敬雪

### （ 表格功能说明：需要明确文档全生命周期迭代进程 ）
正向操作 SOP 的目的是为了迅速让客户通过该文档，掌握该类型车体现场的快速部署、实施的方法，包括单机功能调试和测试、和系统 RDS 的联动和测试。
## SOP 场景及实施说明
由于是讲述车体的使用操作 SOP, 所以一定会涉及到什么样场景下的 SOP 实现，我们可以通过 如下表格的关键信息对此场景下的 SOP 实现做一定的说明，具体现场的实施可以参考该篇文档进行实施和部署
## 应用场景说明

## 场景要素序号

## 场景要素

## 场景说明

## 备注说明（可以含图示）

## 1

## 场景车辆说明

## 1.车辆地盘运行模型为 双轮差速+顶升+随动 * 1 台；
### 2.所有车体具备上/下视读码相机；

1709112214622-e913249b-1afd-447e-84d3-b35e7e77298e.png

## 2

## 场地布局说明

1.库区：场景中有两个库区，一个是库区是满物料区 * 2 个满物料库位 A 和 B；一个是满物料取货区* 2 个库位 C 和 D，需要通过 AMR 将装满在料架上的满物料从满物料区运送至 满物料取货区；
### 2.载具：满物料区域放两个料架，分别放置于满物料区域的 库位 A 和库位 B;

1708253846746-b4a6702c-9166-4082-be93-c783a955a311.png

## 采用RDScore的方式实现

## 3

## 业务场景功能实现说明

1.满物料区域的库位 A 中的料架需要使用料架识别方式进入、且需要在料架底粘贴二维码，通过上视 PGV 实现二次定位,车辆顶起物料之后将物料送往 满物料取货区库位 C，供人工进行拣选；
### 2.库位 A -> 库位 C 的满物料料架在移动过程中 需要实现随动功能，料架在 A点和 C 点相对于世界坐标系的相对角度不发生变化；
### 3.满物料区域的库位 B 中的料架需要使用 料腿轮廓识别 方式进入、,车辆顶起物料之后将物料送往 满物料取货区库位 D，供人工进行拣选；
### 4.库位 B->D 的移动过程中需要使用二维码导航方式实现，且在 D 点需要粘贴地面二维码，使用下视 二维码实现精确放置料架；

### 1）料架识别采用轮廓识别，无需对料架进行改造
### 2）顶升前采用二维码二次定位，因此需要在料架底部粘贴二维码
3）B->D 二维码导航，应提前粘贴二维码，并建二维码定位高级区域
4）因SRC-880为固定授权模式，已包含相关随动、二维码定位等功能，其他控制器造车使用时需注意授权。
1709111605228-470000e7-1ce0-4f3f-b05a-84002442f61d.png

## 补充说明：
下视 PGV 和料架识别(反光条/轮廓识别)：如果 AP 点使用二维码导航此时是不能使用料架识别的，因为在使用料架识别时候，这个时候如果料架放歪了之后，AMR 是会报"机器人找不到二维码”的报错，所以对于二维码导航和料架识别的应用场景，AP 点就不能粘贴二维码，二维码只能贴到该 AP 点库位的前置点，前置点和AP 点的导航方式也不能选二维码导航，而应该是 SLAM 自然导航的方式。
因此上述库位B处不可以使用料架腿轮廓识别，直接采用二维码定位。

## 路径设计标准
根据使用条件和现场环境，设计移动机器人的行驶路径，并确定充电系统（充电桩）、外围设备、现场操作站等的位置。应充分考虑车体尺寸、驱动方式、执行机构动作方式及运行环境条件等，确保移动机器人在运行时，与周边的物体无干涉现象发生。在路径设计中应该考虑以下因素： 
a）停靠点（PP）、充点电（CP）、动作点（AP）、途经点（LM）； 
b）操作站台、充电桩、外围设备等； 
c）运行速度； 
d）公共区域、限制区域、危险区域划分。
## 实施安全要求
## 一般要求
### 移动机器人在现场使用时应满足以下安全要求：
a）操作员正常操作和日常检查的位置或进出的区域内，不得有任何可能造车伤害的风险源；
b）危险区域和限制区域应由适用方和制造商在设计、安装和启动阶段指定，并对此类区域进行标记，由制造商在系统运行前对使用方人员进行可验证的培训；
c）障碍物和移动机器人（包括负载）之间宜保持0.5m的最小间隙，小于此间隙的所有区域应被视为危险区域或限制区域，须清晰标记；
d）应设计合理的停靠位置，足以保证移动机器人及其负载不会阻塞安全通道。
## 额外交通设施
由于人员视线受限原因可能造成风险时，应采取额外的交通管理措施（如：交通灯、道闸等），以降低风险。
## 开关机
### 以AMB-800K车体为例，开机按钮位于车尾位置：
（1） 按下②电池开关，电池启动，等待灯带点亮。
（2） 按下③SRC开关，完成开机过程。
（3）正常启动后，氛围灯变为绿色（请参阅“ 氛围灯 ”），此时机器人处于可使用状态。
1709780356619-96f37eb0-030e-4736-9e12-785d9d5c4579.png 

## 关机操作：
（1）确保机器人目前没有任务并且处于停止状态。
（2）按住③SRC开关按钮2秒后释放，等待数秒SRC开关指示灯熄灭，按下②电池开关按钮，完成关机过程。
注：若因运输、维护或修理而关机，则必须断开机器人电池空开。

## 有线及无线连接
完成开机后，需要对车辆进行检查，查看是否一切正常。 此时默认已完成现场网络配置，控制器已分配好网段。
## 有线连接
（1） 使用网线连接机器人，网线一头插在机器人控制器的连接网口上，另一头插在笔记本的以太网口上。
注意：AMR 默认 IP 地址为 192.168.192.5。
在使用连接之前，个人笔记本电脑的ip应先修改到 192.168.192.xx 网段。在笔记本【菜单】——【设置】——【以太网设置】路径，可按照步骤进行ip设置。

1684983702415-aed69d0c-24b4-4793-908c-8e7f009f8143.png 

（2） 连接上机器人后，打开 Roboshop 软件，点击右上角添加服务按钮，输入控制器默认 IP 地址：192.168.192.5 ，即可连接成功。
1709083232010-e2563b0c-1d91-477e-ba02-3d49a80bba85.png

注意：因为定制款 AMR 或者造车客户回选择内置第三方网络客户端 Moxa或者TP-LINK，所以若需配置无线 IP，需要参考制造资源库——网络设备—— Moxa配置文档 、 TP-LINK配置 文档进行配置。
## 无线连接
无线连接前，需要先确认已配置好无线，且有线连接测试过，并得到车体在当前网络下的网络ip，如192.168.4.62。步骤同上述有线连接步骤2。
1709868966963-bb2669aa-9a44-488d-9f3b-006ef43d1f8b.png

## 激光slam建图
确认机器人无异常后，可开始对所需要的作业区域进行扫图。
按照业务场景，当前为 激光和二维码混合导航 场景。实现方式为采用激光建图后，进行二维码高级区域配置 ，从而实现混合导航。
回到地图主界面点击【2D Mapping】, 选择【Slam 建图】，参数保持默认即可，然后可开始扫图。通过笔记本电脑键盘上的 "W、A、S、D" 来操控车辆行走，并对所需要的作业区域进行闭环式扫图（扫出来的地图和机器人行走的路线一定要形成一个闭环）。

## 扫图操作过程.mp4
完成扫图后，将地图保存至本地并将地图推送给机器人，机器人会根据当前激光检测到的点云数据在地图当中的匹配程度自动进行定位，完成后会弹出提示框需要人工进行确认，确保机器人实际位置在当前地图当中是正确的。如果是对的则选择【ok】，如不对需要人工使用重定位功能进行二次手动定位确认。重定位功能可以按住鼠标左键不放，然后拖动圆圈来选择定位所需要参照的范围大小，也可不选择。
1684986088892-f0cec765-1169-4e1e-84f6-d2c9d32211ec.gif

## 地图编辑及建立站点和库位
在【地图与控制】主界面，点击【启用编辑】，进入地图编辑界面，可在此界面进行站点和路径的建立。完成后即可进行路径导航测试站点和车体。
1710315429620-0e8a0709-7955-447d-97af-3c9d1833e4d8.png

本应用场景重包含A、B、C、D四个库位工作站点、四个LM前置站点和 一个充电站点。 此时充电桩默认此时已完成配置，并可以正常通讯。
1709193083500-968496a2-b27e-46cd-bd67-f01288673046.png 

1709201348815-1fdce12f-9f77-4991-a970-a4de017d31df.png

点击左侧菜单栏【站点】后，选择【工作站】，可在右侧地图界面，按照实际布设位置，放置四个工作站点A(AP1)、B(AP2)、C(AP3)、D(AP4)，在此处进行取放货 。
1710315621047-fcd4a953-b413-4ac5-b9ac-c98bc2f1f715.png

点击【站点】，在库位点识别位置放置前置站点。四个工作站点的前置站点A(LM5)、B(LM7)、C(LM6)、D(LM8) 。
1710315803871-c6d01b2f-b629-4e33-bba0-cd3d9bb07bbf.png

点击【特殊工作站】，在场景规划位置放置移动机器人充电工作站CP9。
1710315968737-a521bf93-7356-4fb8-a171-2637b827ef9b.png

建立好站点后，可通过【路径】将不同站点连接起来，可在菜单栏2处编辑路径方向和路径形状。
1710316382795-85d28e41-4fae-4f2d-b444-32a230c1cb0a.png 

站点、库位和路径都建设完成后，若和实际现场有偏差，可以通过【指针】进行调整。
1710317159359-97e187de-89c0-412d-96fe-5f5bd4128e47.png

## 二维码高级区域设置
从站点C到D采用二维码导航，因此需要对地图设置二维码高级区域。操作前提，在站点C到D区域，已布设好二维码包含二维码打印和铺贴。 此操作应在现场场景确认勘察时已完成。
## 二维码区域建图设置
步骤 1 ：确认下视扫码相机正常连接，且二维码定位区域二维码样式及粘贴符合规范。
步骤 2 ：将机器人推行至二维码上，即下视 PGV 可以识别到地面上的二维码。
步骤 3 ：在地图编辑界面，点击地图上的机器人，并点击【 PGV 二维码】>【开始识别】。
1709623997234-4652a78d-cbf3-45e6-98ac-9cc92866d8e0.png 

1709628166578-425d7d97-b464-48b2-97fc-706c17ddcfda.gif

步骤 4 ：识别出来地面上的二维码，并显示在地图上。
## 1.png

步骤 5 ：点击该二维码，修改其编号，需与地面所贴二维码保持一致。
### 2.png

### 6 ：批量生成二维码。 识别完成后，点击【停止识别】。将当前地图上传，就成功完成对二维码的标记工作。
### 3.png

注意：识别出来的二维码也需要调整至一米间距，且在一条直线上。如下图两个坐标：x 轴间距 1m， y 轴相同，角度相同。
### 4.png

### 5.png

步骤 7 ：在二维码上添加站点。注意：站点坐标即为二维码坐标，务必保持一致。
单站点： 在 Roboshop 地图编辑模式，选择站点工具，在靠近二维码的任意位置落下一个 AP 站点（其他类型站点同理）。拖动此 AP 点，当其靠近二维码时，会自动吸附至二维码上。
批量： 先框选所有的二维码，使用右键点击任意二维码，选择批量创建 LM 点，可以自动创建二维码上面所有的站点。也可以选择单个二维码右键创建单 LM 点。（此功能要求 Roboshop-2.4.1.36 版本以上才可以实现）
### 7.png

步骤 8 ：添加路径（规划路径），路径需要选择【二维码导航】。
### 8.png

步骤 9 ：在需要二维码导航的区域站点C-D之间添加【二维码区域】。 在地图编辑中，在【 区域 】->【 高级区域】 中选择 【二维码区域】 ，覆盖在需要二维码导航的地区（ TagArea 区域务必覆盖所有需要二维码导航的站点及线路 ）。
### 9.png

之后小车到达这个区域后会自动切换为二维码导航。
1698128492244-7419e737-def1-4343-8a87-65e1f262f4e1.gif

步骤 10 ：完成二维码区域布设。
二维码区域配置完成后，【保存】并【推送地】图。在激光二维码导航混合应用场景中，机器人运行到该区域后，将自动切换为二维码定位，离开该区域后，自动切换为激光定位。
## 步骤11：路径导航测试
点击【路径导航】，鼠标变成圆圈，此时可防止在某个站点上，并点击站点右侧箭头选择【导航到路径】和【执行动作】，同时支持【插入动态障碍物】。

1684986881433-641bee67-b7f9-4088-873f-fa238ef5b350.gif 

1709097934291-5078d9b0-503d-41a8-a392-3972ebcf99bc.png 

## 二维码导航注意事项
TagArea 区域务必覆盖所有需要二维码导航的站点及线路；
在.smap上保证二维码的编号与现实位置一一对应；
如果log中发现二维码的角度发生跳跃时，极大可能是二维码污损或者褶皱产生的，此时机器人的外在表现为机器人原地转圈，典型的log分析图如下图所示；
1655102851167-a7bda03a-5bdf-4cc9-a06e-36513a3e2423.png

## 库位料架识别设置
在库位 A 目标料架需要使用料架识别方式，即使用形状识别，配置只需如实填写货架腿的参数即可。
## 下图为示例：
## 图片.png

## 识别文件设置
打开Roboshop——连接机器人——菜单栏打开【识别编辑】——【全部拉取】，可以加载左侧所有识别文件目录。
1710314451301-4566be3c-85aa-40e5-9e77-b7a37e3ad7cc.png

点击 【 shelf 】，可在图上标号区域2 查看当前货架的规格尺寸和示意图，在属性窗口根据实际货架的尺寸配置。货架描述文件的后缀名为.shelf，存放于 Robokit/resources/objects/shelf/ 目录下。在Roboshop识别文件中货架标签下编辑。
1710315183276-7d77dc48-83d4-4d70-a945-118bf35cb9ab.png 

## 参数定义说明
### 111.PNG

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## rec_off_x

## 识别文件-shelf

## m

## 0

## -99

## 99

## ~latest

## 目标点在识别点坐标下的 x 坐标

## rec_off_y

## 识别文件-shelf

## m

## 0

## -99

## 99

## ~latest

## 目标点在识别点坐标下的 y 坐标

## rec_off_angle

## 识别文件-shelf

## °

## 0

## -180

## 180

## ~latest

## 目标点在识别点坐标下的角度

入口点和识别点之间的距离，顶升车可以正向钻入，倒走钻入，也可以侧向钻入，将此距离统称为钻入深度。这个值可以通过识别文件配置。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## detect_direction

## 识别文件-shelf

## x

## x
## y
## -x
## -y

用来指明识别朝向，detect_direction有 x, y, -x, -y 四个选项

## align_depth

## 识别文件-shelf

## m

## 0

## -99

## 99

## ~latest

识别方向为 x 或者 -x，前置 线路为 倒走 时，机器人的钻入深度。最终机器人钻入货架底部后，机器人坐标系 x 轴正方向与货架 x 轴正方向重合。

## anti_align_depth

## 识别文件-shelf

## m

## 0

## -99

## 99

## ~latest

识别方向为 x 或者 -x，前置线路为 正走 时， 机器人的 钻入深度。最终机器人钻入货架底部后，机器人坐标系 x 轴的正方向和货架 x 轴的正方向相差 180 度。

## y_align_depth

## 识别文件-shelf

## °

## 0

## -180

## 180

## ~latest

识别方向为 y 或者 -y，前置线路为 倒走 时， 机器人的 钻入深度。最终机器人钻入货架底部后，机器人坐标系 x 轴正方向与货架 x 轴正方向重合。

## y_anti_align_depth

## 识别文件-shelf

## °

## 0

## -180

## 180

## ~latest

识别方向 y 或者 -y，前置线路为 正走 时， 机器人的 钻入深度。最终机器人钻入货架底部后，机器人坐标系 x 轴的正方向和货架 x 轴的正方向相差 180 度。

机器人识别前，需要调整机器人与目标点之间的距离，此距离可以通过识别文件中的 recDist 来控制。准确来讲，这个参数表示机器人到识别货架之间的推荐识别距离，此距离为当前机器人的外轮廓与目标点之间的距离。下图表示了机器人正向识别导航下的 recDist 距离。
## image.png

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## recDist

## 识别文件-shelf

## m

## 0

## -99

## 99

## ~latest

### 识别前，机器人的外轮廓与目标点之间的距离

## 搬运固定在地货架上的栈板
顶升车可以用于搬运放在货架上的栈板。在这种场景下，需要顶升车具有识别取货功能，如果发现目标点上没有栈板时报错。也需要顶升车具有识别放货功能，如果发现目标点上，有栈板报错。
因此，在这种场景中，我们的任务指令中，要传入两个识别文件，一个识别文件放在 preRecFile 是用于识别栈板，另外一个识别文件放在 recfile 是用于识别货架。
除此之外，由于货架是固定在地面上的，需要勾选 shelf 识别文件中的 shelf_fixed_to_ground 。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

### shelf_fixed_to_ground

## 识别文件-shelf

## false

### 3.4.5

## 货架是否固定在地上

## 货架中心和里程中心不重合
对于货架中心和里程中心在车体x方向不重合的场景，可以将识别文件 中 的 align_depth 和 length/2.0 配置不同即可。 货架中心相对于里程中心 x 方向的偏移量为 align_depth - length/2.0 。
1710772412472-bcb5f896-41f2-49cf-a8ed-b1b5c28ec637.png

## 识别文件配置参考
本应用场景中采用货架腿轮廓形状识别，因而属性配置可参考如下。【basic】和【leg_type】按照栈板实际参数和外观填写，【method_type】选择【by_legshape】。
1710314887888-c98c3fec-68d8-4819-8b76-7856604f9078.png

## 识别参数配置
## 识别前调整朝向
在机器人识别前，有时候需要调整机器人的朝向。可以通过参数配置中的 RecAdjust 控制开启或者关闭。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## RecAdjust

## 参数配置-navigation

## true

## ~latest

识别栈板前是否要调整朝向。 对于识别的 ForkLoad， ForkUnload， ForkHeight 起效。如果动作是 Wait，需要将目标点的执行机构选择为 fork。

## 识别导航偏离目标点
可以将参数配置的 RecOdo 配置为 false，依靠定位导航去识别目标点，并且将 RecShelf_PathSpeed 减小。
对于定位差，激光雷达会被近距离障碍物阻挡的场景，由于激光定位给出的定位不准，因此需要将参数配置的 RecOdo 配置为 true，依靠里程去识别目标点。
## 识别路径在轨迹跟随中出现扭动
对于一些采用 PID 方式跟随曲线的车辆。按识别路径行走时，其Kp采用特殊的参数，为参数配置中的 RecwKp。如果 RecwKp 过大，并且驱动器有延时的话，可能会导致车体扭动，需要减小 RecwKp。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## RecwKp

## 参数配置-navigation

### 2.0

### 0.1

## 100

## ~latest

### 在按照识别路径行走时， PID参数中 Kp的值

## 加快钻入货架的速度
RecBezierCurve ：设置为 true， 采用曲线路径
## RecStopTime ：减小等待时间
RecShelf_PathSpeed ：增大钻货架时的导航速度

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## RecShelf_PathSpeed

## 参数配置-navigation

## m/s

### 0.1

### 0.1

## 1.5

## ~latest

钻货架时的速度。提高此速度可以增加钻货架时的效率，但同时也会降低钻货架时的精度。

给站点配置识别文件。
在库位A(AP1)处目标料架需要使用料架识别方式，因而此处两点需要绑定料架腿识别文件。操作步骤:【地图与控制主界面】——【启用编辑】——选中AP1——右侧属性窗口【执行】——选中识别文件——选中前置点（若有）。
1710384412484-6a020af3-e978-4d81-a668-9e85517e127c.png

## 基于二维码二次调整（二次定位）
机器人在到达目标点后，支持依据地面或者货架上的二维码进行位置二次调整。
1709779873154-13ebee8d-bcca-43fa-bdb0-2f1ff28822ac.png

## 路径导航依据二维码二次调整指令的含义

## 字段名

## 类型

## 描述

## 可缺省

## use_pgv

## bool

### 是否采用上视pgv识别二维码进行位置的二次调整

## 是，默认为false，即采用下视

## pgv_adjust_dist

## number

### 二次调整的范围的最大半径，（用于第3，4种调整方式）

## 是

## pgv_adjust_cx

## number

二次调整范围中心x在二维码坐标系(这个坐标系与当前机器人坐标系平行）下的位置，（用于第4种调整方式）

## 是

## pgv_ajdust_cy

## number

二次调整范围中心y在二维码坐标系(这个坐标系与当前机器人坐标系平行）下的位置，（用于第4种调整方式）

## 是

## pgv_x_adjust

## number

在 PGV 调整模式下，只对小车x方向的误差进行调整，（用于第2种调整方式）

## 是

## use_down_pgv

## bool

### 是否采用下视pgv识别二维码进行位置的二次调整

## 是
如果一个机器人用上下两个PGV相机做二次调整，是 先按照下视 PGV 进行调整，再按照上视PGV进行调整 。
（1）确认在 AGV 的模型文件中，PGV 设置为调整或者识别调整；
（2）确认在 AGV 到达目标点 PGV 时可以看到二维码；
（3）按 PGV 调整；
（4）任务参数中，【use_pgv】表示使用上视 PGV ，【use_down_pgv】表示使用下视PGV；
（5）PGV 识别，进行位置调整的五种方式：如果【use_x_adjust】和 【use_adjust_dist】同时出现，则只响应【use_adjust_dist】，自动忽略【use_x_adjust】。
场景描述中，A点位时上视PGV，此处不用配置，D采用下视PGV进行二次定位，步骤：在【启用编辑】界面，选中站点，在右侧属性界面，勾选【使用下视PGV】。
1710407310800-0a4c4674-a655-4944-ad34-bd605dd87a75.png

## 料架/栈板二维码二次定位
## 业务场景描述：
满物料区域的库位 A 中的料架需要使用料架识别方式进入、且需要在料架底粘贴二维码，通过上视 PGV 实现二次定位。
分析：在库位A处需要配置上视PGV料架二维码二次定位，即“ use_pgv ”参数配置为“true”。

## 地面二维码二次定位
描述：库位 B->D 的移动过程中需要使用二维码导航方式实现，且在 D 点需要粘贴地面二维码，使用下视 二维码实现精确放置料架。
分析：在库位D需要配置下视二维码二次定位。
在地图首页点击【启用编辑】，选中库位D，在右侧属性配置界面。勾选【使用下视pgv】。
1710139200984-7528dd05-8621-4521-9540-eafba4db9371.png

## 任务链中固定路径导航PGV二次定位调整
任务链在【可拖拽标签】的【机器人控制】里有一项【自定义动作】，包含以下高级动作。
1710139025247-702aaa5e-59cf-46b4-af74-88a2c849a42b.png

其中固定路径导航PGV二次定位调整，可用于通过脚本对业务流程进行实现。
## 【id】：目标站点
【pgv_adjust_cx】：二次调整范围中心x在二维码坐标系(这个坐标系与当前机器人坐标系平行）下的位置
【pgv_adjust_cy】：二次调整范围中心y在二维码坐标系(这个坐标系与当前机器人坐标系平行）下的位置
【pgv_adjust_dist】：二次调整的范围的最大半径
【use_pgv】：【true】开启pgv；【false】关闭pgv
## 二次调整参数及命令
## PGV相关的可配置参数

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## onOpenTime

## 模型文件-pgv

## ms

## 2000

## 0

## 9999999999

### 3.2.6.20~latest

## PGV 启动时间

## PGV相关的参数配置

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## PGV_Time

## 参数配置-Navigation

## —

## 5

## 0

## 1000000

### 3.3.4.20~latest

## PGV 看不到二维码报警的次数阈值

## PGV_Speed

## 参数配置-Navigation

### 0.005

### 0.001

### 0.1

### 3.3.4.20~latest

## 按 PGV 进行二次调整时的移动速度

## PGV_Rot

## 参数配置-Navigation

## °/s

### 10.0

### 0.001

### 180.0

### 3.3.4.20~latest

## 按 PGV 进行二次调整时的角速度

## PGV_Method

## 参数配置-Navigation

## —

## 1

## 0

## 3

### 3.3.4.20~latest

PGV 的调整方式。方法0，调整定位基于二维码，只支持第一种调整方式。方法1，agv看到二维码时，定位基于二维码，看不到二维码时基于里程，可以支持所有调整方式。方法2，在方法1的基础上增加了更强的滤波，用于精度要求高，效率不高的场合。在3.3.5.67 版本上，增加了方法3，这种方法去除了方法1的滤波，用于精度要求不高，效率高的场合。

## PGV_ReachDist

## 参数配置-Navigation

## m

### 0.001

### 0.000001

### 0.1

### 3.3.4.20~latest

## PGV 首次调整的位置到点精度

## PGV_ReachAngle

## 参数配置-Navigation

## °

### 0.5

### 0.00001

### 180.0

### 3.3.4.20~latest

## PGV 首次调整的角度到点精度

## PGV_ReachDistTor

## 参数配置-Navigation

## m

### 0.00001

## 0

### 0.1

### 3.3.4.20~latest

## PGV 非首次调整的额外的位置到点精度

## PGV_ReachAngleTor

## 参数配置-Navigation

## °

### 0.0001

## 0

### 180.0

### 3.3.4.20~latest

## PGV 非首次调整的额外的角度到点精度

## PGVError

## 参数配置-Navigation

## —

## True

## —

## —

### 3.3.4.20~latest

### 控制在随动下如果上视pgv看不到二维码就报错

## PGVFilterThreshold

## 参数配置-Navigation

## —

## 2

## 0

## 1000

### 3.3.4.20~latest

## PGV 滤波参数阈值

## PGVAdjustMaxTheta

## 参数配置-Navigation

## °

## 10

## 1

## 90

### 3.3.4.20~latest

按 PGV 二次调整，规划路径时的最大角度。只对于采用限定范围的调整方式生效，即下发任务中包含 pgv_adjust_dist 字段。

## PGV_AverageTime

## 参数配置-Navigation

## s

### 2.5

## 0

### 100.0

### 3.3.5.65~latest

### 当 PGV_Method 为 2 时，均值滤波的平均时间

## PGV_AdjustMaxTime

## 参数配置-Navigation

## 0

## 0

## 100

### 3.3.5.78~latest

进 行二次调整最多次数。如果该值为0，表示没有次数限制。如果该值大于0，当调整次数大于此阈值，会报错 52805

## PGV 调整到点精度的模式
确认在 AGV 的模型文件中，PGV 设置为调整或者识别调整
### 确认在 AGV 到达目标点 PGV 可以看到二维码
## 按 PGV 调整
导航至 AP 点，再勾选 use pgv。此时 AGV 到目标点后，会依据二维码的位置做调整。AGV 的中心的坐标 (x, y, θ) 会调整到二维码的姿态上
任务参数中， use_pgv 表示使用上视 PGV 。 use_down_pgv 表示使用下视PGV。
PGV 识别，进行位置调整的五种方式。如果 pgv_x_adjust 和 pgv_adjust_dist 同时出现，则只响应 pgv_adjus_dist ，自动忽略 pgv_x_adjust .
## 直接行驶到终点
这种调整方式，会存在导致原地旋转。
## {
    "id":"AP*",  //目标 AP 点，实际需要将*号换成实际序号
    "operation": "Wait", //到达终点，没有其余动作
    "recognize": false,  //不启用识别功能
    "use_pgv": true   //采用上视 PGV 进行调整
## }

1677675958783-f3b398c8-d23b-4dc6-b649-1ff8f0599bdc.png 

## 只调整 AGV 坐标系下纵方向的偏差
这种调整方式，不管横向偏差和角度偏差。
## {
    "id":"AP*",  //目标 AP 点，实际需要将*号换成实际序号
    "operation": "Wait", //到达终点，没有其余动作
### "recognize": false, //不启用识别功能
    "use_pgv": true, //采用上视 PGV 进行调整
    "pgv_x_adjust": true  //只对沿着车子方向的偏差进行调整
## }

1677675974331-8368adf7-7786-4224-9178-b011ba1f08a2.png 

### 只调整 AGV 坐标系下纵方向的偏差和到点的角度偏差
这种调整方式，不管横向偏差。
## {
    "id":"AP*",  //目标 AP 点，实际需要将*号换成实际序号
    "operation": "Wait", //到达终点，没有其余动作
### "recognize": false, //不启用识别功能
    "use_pgv": true, //采用上视 PGV 进行调整
    "pgv_x_angle_adjust": true  //沿着车子方向的偏差进行调整，并且到点后调整角度偏差
## }

## 给定最大调整范围半径进行调整
调整范围为 pgv_adjust_dist 。通过前进，后退来调整纵向偏差。可在参数配置中设置 PGVAdjustMaxTheta 来调整 AGV 的最大容许旋转角度，默认为 10 度 。
注意： 这种方式中不能传入 pgv_x_angle_adjust 或者 pgv_x_adjust。
## {
    "id":"AP*",   //目标 AP 点，实际需要将*号换成实际序号
    "operation": "Wait", //到达终点，没有其余动作
    "recognize": false,  //不启用识别功能
    "use_pgv": true,  //采用上视 PGV 进行调整
    "pgv_adjust_dist": 0.3  //最大的调整半径
## }

1677675992446-752e3f4e-7bef-4fa6-b79e-11d015478ab3.png 

注意: 实际调整范围 pgv_ajdust_dist 减去车子旋转半径。如果 pgv_adust_dist 小于车子旋转半径，则可调整半径为 0.04 m。

## 给定最大调整半径和圆心  进行调整
给定最大调整范围 pgv_adjust_dist ， pgv_adjust_cx ， pgv_adjust_cy ，然后通过前进，后退来调整纵向偏差。
可在参数配置中设置 PGVAdjustMaxTheta 来调整 AGV 的最大容许旋转角度，默认为 10 度 。
调整范围的圆心为二维码坐标系下的坐标，用 pgv_adjust_cx , pgv_adjust_cy 表示。
调整范围的半径为 pgv_adjust_dist 。
### pgv_adjust_dist 的配置要比
大。
当机器人看不到二维码时，是基于局部里程定位。因此，当 pgv_adjust_dist 太大的时候，局部里程定位会偏差过大，导致二次调整失败，建议尽可能将 pgv_adjust_dist 配置小一些。
注意： 这种方式中不能传入 pgv_x_angle_adjust 或者 pgv_x_adjust。
// 机器人从LM2到AP1，采用上视pgv进行位置二次调整
## {
  "id": "AP1",
  "source_id": "LM2",
  "task_id": "123456",
  "use_pgv": true,          //采用上视PGV进行调整
  "pgv_adjust_dist": 0.4,   //最大的调整半径
  "pgv_adjust_cx": -0.3,    //调整范围的圆心偏移量
## "pgv_adjust_cy": 0
## }
1677676012857-720eb6ad-9993-4ed7-9b63-69971faf55f3.png

注意: 实际调整范围 pgv_ajdust_dist 减去车子旋转半径。如果 pgv_adust_dist 小于车子旋转半径，则可调整半径为 0.04 m。

## PGV 到点精度
### 在参数配置中，有以下参数用于控制 PGV 调整的到点精度
PGV_ReachAngle 和 PGV_ReachDist 分别为 PGV 调整的 首次 角度精度和到点精度。
PGV_ReachDistTor 和 PGV_ReachAngleTor 分别为 PGV 调整的 非首次 校准容差。非首次的到点精度分别为: PGV_ReachDistTor + PGV_ReachDist 和 PGV_ReachAngle + PGV_ReachAngleTor 。
PGV_Speed 为 PGV 调整过程中的最大线速度。
PGV_Rot 为 PGV 调整过程中的最大角速度。
PGV_Time 为 PGV 连续失联的最大次数，如果连续失联这个次数则会报 54070 的 Warning。

### 通过点位属性，调整agv和二维码相对位置
默认 AGV 依据二维码调整后会与二维码保持平行，并且 PGV 中心和二维码 (0, 0) 对齐。可以通过点位的属性，来修改 AGV 和二维码之间的位置关系。
当采用下视 PGV 时，二维码和 AGV 最后的关系可以通过下面三个参数来调整

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## pgvDx

## 站点属性

## m

## 0

## -1.0

## 1.0

### 调整完成后 pgv 在二维码坐标系下的位置

## pgvDy

## 站点属性

## m

## 0

## -1.0

## 1.0

### 调整完成后 pgv 在二维码坐标系下的位置

## pgvDtheta

## 站点属性

## °

## 0

## -1.0

## 1.0

### 调整完成后 pgv 在二维码坐标系下的位置

当采用上视 PGV 时，二维码和 AGV 最后的关系可以通过下面三个参数来调整

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## upPgvDx

## 站点属性

## m

## 0

## -1.0

## 1.0

### 调整完成后 pgv 在二维码坐标系下的位置

## upPgvDy

## 站点属性

## m

## 0

## -1.0

## 1.0

### 调整完成后 pgv 在二维码坐标系下的位置

## upPgvDtheta

## 站点属性

## °

## 0

## -1.0

## 1.0

### 调整完成后 pgv 在二维码坐标系下的位置

可以通过JSON任务修改PGV偏移属性，任务中参数比点位上的属性有更高的优先级。在3.4.4.8 以上的版本添加此功能。
## {
    "id":"SELF_POSITION",  
    "use_down_pgv":true,   //启动下视pgv进行调整
    "pgvDx":0.01,           //修改PGV的x偏移量为0.01m
    "pgvDy":0.01,           //修改PGV的y偏移量为0.01m
    "pgvDtheta":90,        //修改PGV的角度偏移量为90°
## "operation":"GoPGV"
## }

## 二次调整角度
在有些场景下， 二维码方向和机器人方向会出现180度的情况，这时不需要机器人旋转180度，转到让机器人和二维码0度对齐，而是让机器人就近和二维码180度，调整对齐。这时，需要在任务参数中，加上一个key 叫做 pgv_adjust_180 。
## {
    "id":"AP*",  //目标 AP 点，实际需要将*号换成实际序号
    "operation": "Wait", //到达终点，没有其余动作
    "recognize": false,  //不启用识别功能
    "pgv_adjust_180": true, // 二次调整角度，允许机器人和二维码保持180度
    "use_pgv": true   //采用上视 PGV 进行调整
## }

在有些场景下， 需要转到让机器人和二维码就近的90，-90，0，180对齐即可。这时，需要在任务参数中，加上一个key 叫做 pgv_adjust_90 。
## {
    "id":"AP*",  //目标 AP 点，实际需要将*号换成实际序号
    "operation": "Wait", //到达终点，没有其余动作
    "recognize": false,  //不启用识别功能
    "pgv_adjust_90": true, // 二次调整角度，允许机器人和二维码保持90，-90，0，180度
    "use_pgv": true   //采用上视 PGV 进行调整
## }
## 兼容性问题
机器人更新到 3.3.5.66 及以上版本后，由于增加了 pgv 的滤波参数，因此， 当PGV_Method 为 1 时需要将 PGV_Rot 减小到 2 °/s，来避免由于滤波导致的延时问题。如果项目中，需要保持效率，PGV_Rot不能减小，那么需要将PGV_Method改为 3， 那么就会去除滤波。
对于src 800， 调整的角速度为10°/s时，延时会导致 机器人到点角度偏差 2度左右。
## 二次调整长时间不完成
先检查车体标定是否正常，在检查二维码标定是否正常。如果标定不准会导致二次调整无法完成。
对于 机器人直接行驶到终点，然后原地旋转调整到位的应用场景。 需要 检查车体原地旋转是否有侧向偏差。需要将 PGV_ReachDistTor 改成 和原地旋转侧向偏差同等量级。这是由于机器人原地旋转引入的侧向偏差，在二次调整时无法补充。
### 基于二维码二次调整的多车一致性（多车场景下）
多车一致性，通常指多个车辆到达同一个时，多车的里程中心或者车体对接机构达到同一个范围内。如果多车一致性好，那么多个车子就可以使用同一张地图，这是多车调度的基础。多车一致性，对多车的标定、多车激光安装的俯仰角，地图环境有很高的要求。下面主要介绍基于二维码二次调整实现多车末端机构一致。

激光导航的车子，受到激光精度的影响，即使借助高精度的里程计和陀螺仪，其重复到点精度也只有正负5mm。不同车子之间的到点精度还会大于其重复到点精度。这不仅取决于不同车子之间的机械，传感器的差距，也取决于去往目标点的线路方式。为了消除这些影响，可以通过在目标点附近添加二维码。通过，车子基于二维码二次调整自己位置，实现多车一致性。目前，对于差动车，我们能够实现在车体方向 x 多车重复到点精度1mm以内，角度重复到点精度在 0.5度以内。下面介绍如何调整参数实现多车一致性。
注意此调整方式，只能补偿车子的系统误差，是指不同车子在不同点位都会出现的恒定偏差。如果不同车子在不同点位之间偏差值有较大的波动，那么下面方法就不是试用。如果出现这种情况下，需要检查地面，不同位置的二维码是否有差距。
首先我们需要选一个车子作为标准车，其他车子基于此标准车体标定。车子的参数配置中有三个参数 a2PGVx, a2PGVy, a2PGVtheta，用于标定其他车子的机构和标准车的系统偏差。正确配置好这三个参数后，就能实现多车机构到点一致性。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## a2PGVx

## 参数配置-Navigation

## m

## 0

## -100.0

### 100.0

## ~latest

### 在pgv 坐标下，机构对于标准车的偏差量x

## a2PGVy

## 参数配置-Navigation

## m

## 0

## -100.0

### 100.0

## ~latest

### 在pgv 坐标下，机构对于标准车的偏差量y

## a2PGVtheta

## 参数配置-Navigation

## °

## 0

### 0.001

### 100.0

## ~latest

### 在pgv 坐标下，机构对于标准车的偏差量theta

### 在下面步骤中，我们假设标准车子名称叫做 AMB-01
将 AMB-01 的 a2PGVx，a2PGVy，a2PGVtheta都设置为0。 然后在 AMB-01 导航到某个需要二次调整的点位上，比如叫做 AP1。调整地图中 AP1 的属性 pgvDx， pgvDtheta，让AMB-01的对接机构落在正确位置上。我们记录此时的 pgvDx，pgvDtheta 分别为 pgvDx1 , pgvDtheta1。
选一辆待标定的 AMB-02， 将 AMB-02 的 a2PGVx，a2PGVy，a2PGVtheta都设置为0。然后 AMB-02 也在 AP1 点位上进行机构对准。通过调整点位上的 pgvDx，pgvDtheta，让AMB-02的对接机构也落在正确位置。记录此时的 pgvDx，pgvDtheta 分别为 pgvDx2、pgvDtheta2。
最后将 pgvDx1，0， pgvDtheta1，pgvDx2，0， pgvheta2，录入 a2PGV.exe软件中，得到 
AMB-02 车的 a2PGVx, a2PGVy, a2PGVtheta。将其填入的参数配置中。

## a2PGV.exe

1661938162185-6112830d-cd47-499c-abd8-3c4f33573215.png

同理我们以 AMB-01为标准，处理其他车。
当调整好其他车后，其他车可直接采用AMB-01的地图。
下发二次调整任务中需要将 use_a2pgv 关键字设置为 true。下面是一个任务指令的例子：
## {
    "id":"AP*",  //目标 AP 点，实际需要将*号换成实际序号
    "use_down_pgv": true,   //采用下视 PGV 进行调整
### "use_a2pgv": true  // 末端机构对准
## }
## 如何开启随动功能以及设置特定的货物角度
## 开启随动功能
随动：保持货物在世界坐标系下角度不变。到机器人到达目标点时， 货物的角度和机器人平行或者垂直。
## 有三种方式可以启用随动功能：
（1）站点设置：在 LM 或者 AP 点中设置随动功能，车子运行过程中，到达站点就会开启随动功能。
选中【站点】，在右侧【属性】给没有/已经设置随动属性的站点设置随动属性。
（2）脚本、导航或BINTASK：如果发送参数里面包含 key = “spin”, value="true” ，在起步、运行过程中、到达点位时都会开启随动功能。
## {
  "id":"LM1",
## "spin":true
## }
（3） Roboshop ：在只用 Roboshop 控制的情况下，如果目标点勾选的了随动，AGV 才会随动。此时并不是看 AGV 在当前点是否随动。
当前场景中，需要在取货站点都设置随动，如下所示。
1710406967993-3f6cd099-dca8-4439-b59f-3aae79f4a6dd.png

## 配置随动时角度
场景描述中要求取放货时，在世界坐标中角度保持一致，则需要配置随动时角度，选中【前置路径】如下进行设置：
1710407200408-04e58b67-1475-49a9-912e-83f5b14158d7.png

## 单机使用任务链测试站点功能
在建立完所有的站点和路线后，可以使用 Roboshop 当中的任务链功能进行单机测试，确保前期建立的数据都是正确的，如：站点位置、识别文件参数是否正确等。实际现场执行使用RDS，此处任务链只作为单机测试使用。
任务链新建界面和操作步骤参考如下。
菜单栏点击【任务链】——【新建】——【新建任务】——【添加组】——拖动动作到组中。
1710317751719-e3e8886d-e23a-4ba0-a4e9-5eed4c0a5e5c.png

使用任务链构建动作有两种实现方式，一是用动作组合方式，二是在机构脚本中将上述动作流程实现，在任务链中进行调用。
B(AP2/Loc-2)=》D(AP4/Loc-4)取放货过程中，顶升——导航到D(AP4/Loc-4)——下视二次定位——放货这段流程为例，共分为四个动作组。
## 动作组成方式
因可拖拽标签中部分动作已集成，因而可将顶升——导航到D(AP4/Loc-4)——下视二次定位——放货，拆分成顶升——导航到D(AP4/Loc-4)并二次定位——放货。操作如下：
1710385762097-a2bf1f32-e085-4db7-8a66-4d9f1e344409.png 

其中顶升动作为在B(AP2/Loc-2)处顶升，脚本配置如下：
选中组1【顶升】——配置动作为【顶起】——指定高度——顶升站点LM3——货架腿识别，本站点不使用PGV，无需配置。
1710386376585-06b7a3b3-b1f8-432f-b371-81155ca732d7.png

### 导航到D(AP4/Loc-4)并二次定位配置为：
选中【自定义动作】——选择【固定路径导航PGV二次定位调整】——修改右侧脚本参数id为“AP4”，对应站点D。
1710386522461-028b4d8d-6eb5-4404-8359-45b49b876435.png

放货动作配置同取货，选中组3【顶升】——配置动作为【放下】——指定高度——顶升站点LM4——此处无识别动作，使用下视PGV进行二次定位。
1710386020593-621b6f3d-1ac8-4c20-820f-8de74c3c418a.png

配置完成后，可以【发送勾选的任务】或者【发送全部任务】，完成业务流程验证。
1710386870475-530235b7-5609-4bba-a42c-8bd2b3a37a31.png

## 机构脚本方式
使用前提为已完成机构脚本中，上述完整取放货流程动作的编写，机构脚本的详细使用请参照：机构脚本功能文档

## 任务链操作.mp4
通过机构脚本使用方式均为【添加组】——【自定义动作】——【触发脚本动作】。
在脚本编辑区域修改id、脚本名称和脚本参数。
1710385163181-ad9d3673-434f-43d2-93a5-9be07a678c00.png 

具体脚本实现有两种方式，一是按照上述流程每一个动作分别写机构脚本，通过将不同脚本动作组合的方式，完成整个动作流程。二是将所有动作写在同一个脚本中。
## 如顶升功能：
### if self.opt == "jack_up":

### if self.height is not None:
        ret = self.robot.lift(self.motor, self.height)
       # ret = ret and ModuleTool.check_DI(r, 1)
### self.report_info['ret'] = ret
## else:
        ret = self.robot.lift(self.motor, self.high_height)
## if ret:
        self.status = MoveStatus.FINISHED

### if self.opt == "jack_down":
### if self.height is not None:
        ret = self.robot.lift(self.motor,  self.height)
       # ret = ret and ModuleTool.check_DI(r, 1)
### self.report_info['ret'] = ret
## else:
        ret = self.robot.lift(self.motor, self.low_height)
## if ret:
        self.status = MoveStatus.FINISHED

## 自动充电
充电分为手动充电和自动充电，在充电桩没有固定的情况下，我们可以手动将车推到充电桩上充电。充电点位为 CP 站点，配置使用路径导航进行充电。如果担心所建的站点不准确，可参考以下方法：

1685415055369-33988422-32bd-4f03-ba36-727d848c9a52.gif

如图：默认车在最开始的起点位置为充电桩的真实位置，先手动推着机器人来到充电桩的真实位置后，在不启用地图编辑的情况下，手动在机器人当前的所在位置建立站点。这样，只需微调就可以建立准确的站点位置（该方法同样适用于建立工作 AP 站点，可以帮助我们更精确且快速地对好站点位置）。
## RDS 的系统功能实现
前提：需已安装好RDS软件并授权，详细请参照RDS使用文档。
在调试过程中的任务可以通过任务链实现，但实际应用场景中，涉及到多车重复性作业，通常采用rds实现。
## Core 新增
进入 Roboshop 以后，点击右上角的【添加设备】，输入目标服务器的IP地址，点击确定，并点击页面右上角的蓝色刷新按钮。
1710318852502-ecc17569-1bc1-4861-bebc-9a1c0ebd5653.png

刷新后出现备注为 Core 的模块，点击【开始连接】，即可进入 Core 界面。
1710318872914-a0c721e5-c4d9-43cc-ae5a-eb4ba04a1881.png

## Core 调度界面功能配置
## 添加机器人组
进入 Core 调度界面后，点击【启动编辑】，并点击【新建】，可建立一个新的场景。在【机器人组】上点击鼠标右键，选择添加组，如图所示：
1710318950705-b95d94c4-80e3-4267-8c77-c6a4bdd670bf.png

## 添加设备
选中新建的组，在【机器人组】上点击 “+” ，在弹出的【添加设备】页面中勾选机器人，默认为全部勾选，点击【全部】取消勾选，然后选中要添加的机器人即可（需要是真实机器人），即可添加设备到组内。本应用场景中机器人SW600 IP为：192.168.4.116，则选中此设备添加，灯带下载完成即可。如图所示：
1710319019881-2ac78d93-e46e-4ffe-93cf-45b60e1c988f.png

1710319110726-6f560fd9-c41a-4937-9530-2315db799b54.png

## 添加组内机器人地图到区域
点击【启动编辑】，在机器人组上，如图所示，鼠标移动到“unnamed”分组，点击右键选择【添加/更新地图到区域】，即可显示机器人中的地图列表。选中当前测试车600B对应的地图，确认后即可加载地图。
1710320562065-5ea8fd27-fb3f-4c6e-9f6f-c42992567bda.png

加载完成后【退出编辑】，在弹出的提示框中选择【推送场景】，即可将机器人前面建好的地图推送到rds服务器。
1710320689366-1f731d97-5caa-4a67-9d90-da590434080a.png

## 机器人基本信息
如图选中当前机器人，右边【基本信息】栏显示该机器人的详细信息。在图中编号3的位置，即是设置机器人的电量阈值；
1710321202752-0935cec0-ca19-4aba-9bbc-4b1c3d8bb823.png

ChargeNeed ：当机器人在未充电状态、电量低于此阈值且机器人没有运单时，机器人将前往绑定的 CP 点进行充电；
ChargeOnly ：当机器人在未充电状态、电量低于此阈值时，则机器人在完成当前运单后自动前往绑定的 CP 点进行充电；
ChargedFull ：当机器人充电至此阈值时，机器人自动结束充电并前往 PP 点停靠；
ChargedOk ： 当机器人充电至此阈值时，机器人达到可接运单状态。
注意：当设置的电量阈值为-1时，则不启用该功能。
## 特殊站点属性
CP 点：点击【启动编辑】，选中场景中 CP 点，右边则会显示站点属性，点击【绑定】，勾选机器人名称，值下拉选择为【true】，点击确定即可。绑定后机器人才能去 CP 点充电。如图所示：
1710398257388-75d58144-5084-4047-91c3-ec00b37a5d34.png

PP 点：为停靠点，是调度场景中必须设置的特殊工作站。需要做同样的绑定操作。结束后可点击【退出编辑】并按照提示上传场景。

注意：如果值下拉选择【false】，那么绑定的站点属性会失效即不起作用。
### 库位用于取放货或者执行动作的 bintask 配置操作
使用 Roboshop 打开机器人地图（.smap），【启用编辑】才可以编辑库位。本场景中为平面库搬运，因而每一个站点只绑定一个库位。
选中【库位】，在作业站点A(AP1)、B(AP2)、C(AP3)、D(AP4)分别放置站点【LOC-1】、【LOC-2】、【LOC-3】、【LOC-4】。
1710321771311-1a25d5ec-2010-4539-9314-d7f602eacc96.png

### 点击【LOC-1】，可在界面右方加载出配置界面：
## 鼠标选中库位
每一个库位需要绑定一个站点，即A（AP1）【LOC-1】、B（AP2）【LOC-2】、C（AP3）【LOC-3】、D（AP4）【LOC-4】用于机器人到达站点后执行库位中的动作
库位的名称: 需要唯一，本场景为了便于参照，可对应将【Loc-1】、【Loc-2】、【Loc-3】、【Loc-4】对应修改为A、B、C、D；库区名: 该功能不推荐使用，已在调度服务器编辑界面中进行优化
动作轨迹: 用于复合机器人执行一系列复杂的动作，本场景不涉及。
## 编辑: 用于设置机器人取放货物等动作
1710322091910-c951377a-6ebb-4a31-9dc5-eda51b0a8564.png

## 操作设置
点击库位——【编辑】——【添加】——【添加数据】，进行当前库位任务编辑。
1710322385039-5e4523d3-fe99-413d-ad2f-85a77b14d9a1.png 

### 按照业务需求，库位 A -> 库位 C ：
A(AP1)料架腿识别并路径导航到A(AP1)——上视二次定位——顶升——随动——激光路径导航到C(AP3)放货
## 库位 B->D：
B(AP2)料架腿识别——并路径导航到B(AP2)——顶升——二维码路径导航到D(AP4)——下视二次定位——放货。
在Loc-1(AP1)需要执行识别、二次定位和顶升三个动作；选中库位点Loc-1，点击【编辑】，【添加】
JackLoad，配置为识别货架后，通过货架上的二维码进行二次定位，然后再将货物顶起来。JackLoad为写在RBK中固定路径导航所带的operation，实现过程不支持修改。
1710400050211-742b70ad-8fa7-4c75-80cf-054ab1503218.png

Loc-2(AP2)需要执行识别和顶升两个动作，同Loc-1(AP1)。
Loc-3(AP3)需要执行顶升（放货）1个动作，同Loc-4(AP4)
Loc-4(AP4)需要执行下视二次定位和顶升（放货）两个动作。通过下视pgv进行位置的二次调整，然后货物放下。
1710400650426-23668d0d-016e-485f-a97b-4daf8fc70711.png

## 通过任务链验证库位Bintask任务：

## 库位任务链操作 (2).mp4
## 批量操作（多台车时）
服务器主页，点击【批量操作】，进入可对订单、控制权、任务进行操作。
1710403146095-d132ffed-59f1-4059-83c2-bf157616217c.png

## 操作operation脚本参考
// 机器人通过识别货架到达AP1，接着通过货架上的二维码进行二次定位，然后再将货物顶起来。
## {
"id": "AP1",
"source_id": "LM2",
"task_id": "12344321",
"operation": "JackLoad",
"jack_height": 0.04,
"recognize": true,
## "use_pgv": true
## }
// 机器人到达AP1，接着通过下视pgv进行位置的二次调整，然后货物放下
## {
"id": "AP1",
"source_id": "LM2",
"task_id": "12344321",
"operation": "JackUnload",
### "use_down_pgv": true
## }
注意：进行【JackUnload】的时候，不要进行识别。
## 天风任务设置
首先打开浏览器，如果本机为服务器，就在浏览器地址输入 http://localhost:8080/ ，进入RDS网页端登录界面，输入账号密码，初始默认为用户名：admin,密码：123456 。登录进 RDS后，可在【运行监控】页面中，右击选中【拉取场景】按钮，和 Core 中的场景保持同步，一般来说该页面的场景会自动更新。
1710324005206-f0cf70f1-531e-4776-b506-8eee08c852c6.png 

## 图片.png

## 创建搬运天风任务
进入【天风任务】页面——【定义新任务】——弹出任务创建框——命名为T5——设置为普通任务——确认生成。
1710405087981-efd594b7-71c9-4f13-8794-e63e8811aea4.png

## 运输任务编辑
当前场景中，定义路径为A=》B=》C=》D。
点击 T5 任务右侧的【编辑】按钮，进入任务编辑界面。
1710405238453-09589b81-fae5-4adf-8b6e-b340241d530b.png

如图所示，除【工具栏】外，该界面从左到右分别是：【任务列表】、【任务】和执行动作demo。
## 图片.png

首先选中，删除右侧demo，在左侧【core调度】分类下，找到【选择执行机器人】和 【机器人通用动作】。
## 图片.png

拖出一个【选择执行机器人】块和四个【机器人通用动作】块。此处用于向 Core 声明一个运单，并为此运单获取到机器人。
## 图片.png

删除默认的 demo 输入参数。
## 脚本动作配置
编辑机器人id，目标站点名、脚本名和参数。如在A点，目标站点名：Loc-1，bintask名称jack，启用随动。
此处前提为已在roboshop中完成前述库位bintask编辑设置。参照前述章节中12.2中
## 图片.png

## 运行任务
1）任务编辑界面，可直接点击上方【运行】，进行任务执行。
## 图片.png

2）在任务列表选中任务【T5】点击【运行】按钮，弹出确认界面，也可以提交天风任务。
1710406194937-3e02a794-da6d-4210-a30a-3a197d06783e.png 

## 任务查看和运行
在左侧【任务】列表，可以查看建立的所有任务，可通过选中任务，再次执行。
1710406431965-f5d78c59-4d2d-4248-9be4-df6e2df529b2.png 

在【任务管理】界面，可查看运行的所有过程和运行状态。
1710406507502-1062a412-f28e-4224-881b-e0905a0fab4f.png

## 调度操作过程验证
因测试机器人和场地问题，站点、路径设置与前述有些许不同。在AP21（Loc-1）点取货，在AP22（Loc-2）点放货，在AP23（Loc-4）点取货，在AP24（Loc-3）点放货，每个站点都开启随动功能。实际使用中，按照下述三个步骤，即可实现通过天风任务发布调度命令。
## bintask设置

## bintask设置.mp4
## 天风任务操作

## 天风任务操作.mp4
## 车体执行任务动作

## 天风任务.mp4
