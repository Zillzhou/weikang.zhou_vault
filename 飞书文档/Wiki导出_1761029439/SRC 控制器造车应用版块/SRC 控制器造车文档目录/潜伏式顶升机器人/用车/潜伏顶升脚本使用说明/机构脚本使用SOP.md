# 机构脚本使用SOP 

## 机构脚本使用SOP
## “机构脚本”界面说明及基础操作
## 1.1 界面说明
## image.png

打开RoboShop后，选择“机构脚本”页面，应当首要了解的内容有以下五个部分：
## 【工具栏】文件的基础操作按钮
## 【客户脚本列表】
区别于底层文件，是实现特殊需求的关键。脚本列表中，所有文件的文件名左侧都有一个图标：
### 2.1 文件仅在本地，未上传
### 2.2 文件已上传，但和车载控制器的文件存在不一致
### 2.3 文件已上传，且和车载控制器的文件完全一致
### 2.4 文件仅在车载控制器，本地没有
## image.png

## image.png

### 【脚本编辑页面】使用Python语言编写
### 【程序执行结果】会显示程序的状态以及报错、警告信息
## 【参数键值】可用于跟踪中间变量
## 1.2 脚本拉取
对于仅存在于车载控制器且本地没有的文件，需要通过拉取的方式同步到本地，点击如下图所示的按钮即可实现。
## image.png

## 1.3 脚本导入
将本地的文件导入到Roboshop是使用脚本文件的第一步，导入方法有以下几步：
### STEP 1. 右键客户脚本列表的空白处，点击“导入文件”
## image.png

### STEP 2. 在弹出的页面中选择需要导入的文件即可
## image.png

## 1.4 脚本推送
## 推送指定脚本有两个方法可以推送
### 方案1. 在客户脚本列表中，右键需要被推送的文件，点击推送
## image.png

方案2. 点击“开始”运行脚本，若车载控制器中没有本地文件或与本地文件不一致，会弹出“推送并运行”的按钮，点击即可完成推送。

## “项目管理”界面说明及基础操作
### 2.1 界面说明
## 在完成登录后，点击项目可出现如下界面
## image.png

## 该界面需要重点关注2个部分：
### 【拉取按钮】将保存在服务器上的文件拉取到本地
## 【文件列表】服务器上的所有项目
### 2.2 脚本下载
在文件列表中左键单击需要拉取的项目，然后点击拉取，即可出现如下界面
## image.png

## 该界面需要重点关注3个部分：
## 【所选择的项目中包含的文件列表】
## 【本地的文件列表】
### 【下载按钮】点击下载按钮即可将服务器中的文件下载到本地
## “Json参数”界面说明及基础操作
### 3.1 界面说明
## image.png

### 【搜索】在所有分类中搜索包含指定内容名称的参数
【重新生成】情况json参数文件，重新运行py文件生成新的json参数文件
### 【导入参数】导入json参数文件替换当前文件
### 【导出参数】将当前json参数文件导出到指定路径
【导出脚本】将当前json参数文件对应的py脚本文件导出到指定路径
【翻译】点击后显示【14】弹框，目前支持16种语言，将会翻译【15】部分的参数说明
## 【刷新】刷新当前显示
【图标】仅显示当前json参数文件与控制器中对应的json参数文件是否有差异
### 【重置选中参数】将勾选了的参数值设置为对应默认值
### 【重置所有参数】将全部参数值均设置为对应默认值
### 【拉取】从控制器拉取json参数文件到本地
### 【推送】将当前json参数文件推送到控制器
### 【类别】参数对应类别，无类别默认为other
## 【翻译弹框】支持16种语言翻译
## 【参数说明】对应参数的说明，支持翻译

## 注意：
在可视化某些脚本的Json参数时，会报错找不到包。可以检查是否指到相对路径，参考如下代码：
### import sys  % 导入官方自带的包不需要指定路径
## import os

sys.path.append(os.path.dirname(os.path.abspath(__file__)))
sys.path.append(os.path.dirname(os.path.abspath(__file__)) + "/syspy")

from rbk import BasicModule, ParamServer  % 在导入自定义的包前需要指定路径
### from rbkSim import SimModule
### 3.2 参数修改
在“Json参数”界面中，对需要修改的参数后，修改其值即可完成参数修改。
## 脚本调试
### 4.1 运行代码
## 单击“开始”按钮即可运行当前脚本
## image.png

### 没有控制权，就无法下发指令，需要回到“首页”获取控制权

如果脚本和车载控制器中的脚本不一致，则会提示是否推送，确认推送会覆盖车载控制器中的文件并直接运行当前脚本。
### 4.2 变量监控
在红框所指的位置内，会实时地显示当前脚本执行的状态。左侧是“键”，也就是变量的名称；右侧是“值”，即为变量的值。根据对变量的实时监控可以直观地分析当前运行的情况，对故障的分析大有帮助。
## image.png

如果需要添加更多的变量进行观察，可以使用以下语句，具体的可以和负责某个具体项目的工程师沟通。
self.report_info['key'] = name    % key填RoboShop中显示的名字；name填脚本中的变量名
### 4.3 运行状态与报错
程序执行结果会在红框中显示，脚本状态无论是完成、暂停还是报错都会显示在这个位置。
## image.png

## 任务链和bintask
### 5.1 任务链调试
在任务链中添加自定义动作，输入如下代码。将红框内的脚本文件名称换成实际使用的文件名即可。
## image.png

## {
    "id": "AP1",
    "operation": "Script",
## "script_args": {
    },
    "script_name": "syspy/triggleScript.py"
## }
### 5.2 bintask调试
### 在完成建立库位并绑定站点后，添加任务动作，如下图所示
## image.png

## 各车体标准脚本汇总
