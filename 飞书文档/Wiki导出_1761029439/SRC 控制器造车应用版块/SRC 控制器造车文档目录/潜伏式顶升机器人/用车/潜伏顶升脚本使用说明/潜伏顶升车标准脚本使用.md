# 潜伏顶升车标准脚本使用

## 潜伏顶升车标准脚本使用
## 脚本项目
uuid：b3a6cd3e-eed3-44ec-bde0-cc76eae648aa
## UUID下载脚本步骤：

## 图片.png

### Standard_Jacking_Action.py
脚本调用，其中"script_args"根据功能相关，具体配置配置参照后续章节
## 图片.png

## 修改脚本参数
当第一次运行脚本时，会自动在脚本当前目录下生成param文件夹，并在param文件夹中生成脚本文件同名，后缀为json的参数配置文件。请务必查看全部参数，确认是否跟模型文件以及现场情况符合。
## image.png

## 取货
## 伺服电机（lift）取货
## 脚本调用如下：
## {
    "operation": "Script",
## "script_args": {
        "id": "AP2",                 //ip和识别同时开启时，以识别优先               
        "operation": "JackLoad",          
        "load_sound": false,            //可缺省，是否在顶升取放货时播放音频“load”和“unload”
        "recfile": "shelf/s0002.shelf",          //可缺省，识别文件
        "load_recfile": "shelf/s0001.shelf",      //取货后加载的货架模型，可缺省，有时优先加载，不配置默认加载识别文件
        "recognize": true,
        "robot_spin_angle": 90,            //可缺省，取货前托盘旋转到车体坐标90°
        "use_down_pgv": false,          //可缺省，是否下视二次调整，其他二次调整方式需输入对应参数
        "use_pgv": false,
        "rotation_90"：false          // 是否在识别导航到点后，车体整体旋转到站点方向，与"recognize"搭配使用
    },
    "script_name": "Standard_Jacking_Action.py",
    "script_stage":3,                         //可缺省，默认为2，到点后调用脚本；3 到达前置点后，使用脚本导航；0.先调用脚本再导航
    "recognize": true        // 此"recognize"不会用于结果导航，是保证车体能够在前置点停下来，无此参数会导致车体停止的位置不固定
## }
## do电机取货
## "script_args"配置如下
## {
    "operation": "JackLoadByDo",            //需要在脚本中配置上下do和到位di
    "recfile": "shelf/s0002.shelf",          //可缺省，识别文件
    "load_recfile": "shelf/s0001.shelf",      //可缺省，取货后加载的货架模型，可缺省，有时优先加载，不配置默认加载识别文件
    "recognize": true,                         //可缺省
## }

## 放货
## 伺服电机（lift）放货
## {
    "operation": "Script",
## "script_args": {
        "id": "AP2",
        "operation": "JackUnload",          
        "load_sound": true,            //可缺省，是否在顶升取放货时播放音频“load”和“unload
        "robot_spin_angle": 90,            //可缺省，升降前托盘旋转到车体坐标90°
        "use_down_pgv": false,          //可缺省，是否下视二次调整，其他二次调整方式需输入对应参数
        "use_pgv": false ,
        "adjust_goods_dir":true,         //可缺省，是否通过上视相机调整到终点坐标，使货架和终点对齐
        "step_rec_adjust":true,          //可缺省，是否通过多折线激光识别放货
        "recfile": "shelf/s0002.shelf",        // 可缺省，识别文件，搭配"recognize" 使用
        "recognize": true                       //可缺省 ，是否启用识别取货
    },
    "script_name": "Standard_Jacking_Action.py"
## }
## do电机放货
### 脚本参数"script_args"如下：
## {
    "operation": "JackUnloadByDo",           //需要在脚本中配置上下do和到位di 
## }

## 原地任务-托盘升降

## {
    "operation": "Script",
## "script_args": {
        "operation": "JackHeight",          
        "jack_height": 90           //指定顶升高度
    },
    "script_name": "Standard_Jacking_Action.py"
## }
## 原地任务-托盘旋转
三个参数是不同的坐标系，选择一个即可。
## {
    "operation": "Script",
## "script_args": {
        "operation": "Spin",          
        "robot_spin_angle": 90,            //可缺省，托盘旋转到车体坐标90°
        "increase_spin_angle": 90,            //可缺省，托盘增量旋转到90°
        "global_spin_angle": 90,            //可缺省，托盘旋转到世界坐标90°
    },
    "script_name": "Standard_Jacking_Action.py"
## }
## 归零
## {
    "operation": "Script",
## "script_args": {
        "operation": "Zero"    // 托盘和顶升机构归零
    },
    "script_name": "Standard_Jacking_Action.py"
## }
## 二次调整
## 简单二次调整
## {
    "operation": "Script",
## "script_args": {
        "operation": "Adjust", 
        "use_down_pgv": true,          //可缺省，是否下视二次调整，其他二次调整方式需输入对应参数
## "use_pgv": false

       // 其他调整参数参照"二次调整"https://seer-group.feishu.cn/wiki/MRCHwmA4UiaTV9kkRBPcPuhLnvf

    },
    "script_name": "Standard_Jacking_Action.py"，
    "script_stage":3,                         //可缺省，默认为2，到点后调用脚本；3 到达前置点后，使用脚本导航；0.先调用脚本再导航
    "recognize": true        // 此"recognize"不会用于结果导航，是保证车体能够在前置点停下来，无此参数会导致车体停止的位置不固定
## }
根据输入的精度参数进行二次调整，脚本优先级高于系统全局精度参数
## {
    "operation": "Script",
## "script_args": {
        "PGV_ReachAngle": 0.01,     // 二次调整角度精度
        "PGV_ReachDist": 0.001,    // 二次调整距离精度
        "operation": "Adjust",
        "pgv_adjust_cx": -0.3,
        "pgv_adjust_cy": 0,
        "pgv_adjust_dist": 0.4,
        "use_down_pgv": false,
## "use_pgv": true
    },
    "script_name": "Standard_Jacking_Action.py"
## }

## 根据上/下视精调车体角度（原地任务）

## {
    "operation": "Script",
## "script_args": {
        "operation": "rotation_by_uppgv"             //根据上视pgv读到的角度偏差调整，偏差超过4°报错
    },
    "script_name": "Standard_Jacking_Action.py"
## }

## {
    "operation": "Script",
## "script_args": {
        "operation": "rotation_by_downpgv"             //根据下视pgv读到的角度偏差调整，偏差超过4°报错不调整
    },
    "script_name": "Standard_Jacking_Action.py"
## }

### test（在终点通过上视pgv偏差补偿，使货架和地面对齐）
## 只导航到站点，不执行任何原地动作
## {
    "operation": "Script",
## "script_args": {
        "id": "AP2",
        "operation": "test",          
        "adjust_goods_dir":true,         //可缺省，是否通过上视PGV调整到终点坐标，使货架和终点对齐         
    },
    "script_name": "Standard_Jacking_Action.py"
## }
