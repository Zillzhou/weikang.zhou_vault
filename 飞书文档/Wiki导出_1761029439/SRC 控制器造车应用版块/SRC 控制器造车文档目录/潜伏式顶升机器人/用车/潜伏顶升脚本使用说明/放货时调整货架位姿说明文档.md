# 放货时调整货架位姿说明文档

## 放货时调整货架位姿说明文档

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.7.02

## 初版

## 使用中

### （ 表格功能说明：需要明确文档全生命周期迭代进程 ）
特殊应用场景正向操作 SOP 的目的是为了迅速让客户通过该文档，掌握该类型车体现场的一些特殊场景部署、实施的方法，包括单机功能调试和测试、系统 RDS 的联动和测试。
## SOP 场景及实施说明
针对sop场景和实施相关的说明、机器人开关机、建图、定位导航、任务链、bintask、RDS相关内容参照正向操作 SOP 。针对特殊应用场景“通过脚本实现放货时支持调整货架位姿”，具体脚本使用和说明如下。
## 特殊应用场景描述
### 站点中心、车体中心和货架中心示意图如下：
## 图片.png

普通场景中，导航到位放货为车体中心和目标站点中心重合，但有些场景中货物/货架有偏移等，会导致货物超出或者偏移目标站点。
因此针对此场景，1）在放货时支持通过上视读码相机，识别货架的偏移，纠正放货位置，使最终货架中心和目标站点中心重合，而不是车体中心。2）在放货时支持在放货时，设定托盘调整角度方向
## 标准顶升取放货脚本可参照：

### Standard_Jacking_Action.py
验证功能需要先把脚本下载到本地，然后上传到车体的【机构脚本】中，可在【机构脚本】界面单独测试功能，也可以使用任务链或者“bintask”进行功能使用。
## 放货时使用货架偏移矫正放货点位置
参数为"unload_adjust_byshelf"，“bool”类型，“True”开启，“False”关闭，默认为关闭。用于判断是否调整放货点的中心和货架中心重合。
## 放货时调整托盘方向
主要参数有"adjust_goods_dir"和"robot_spin_angle"。整体逻辑为：
"adjust_goods_dir"字段不包含或者为false时，托盘角度会按照"robot_spin_angle"字段的值来转动，robot_spin_angle=90°，托盘转到90°，robot_spin_angle=0°，托盘转到0°
"adjust_goods_dir"字段为true时，上视pgv识别着二维码，托盘会按照二维码角度旋转
## 任务链使用
使用功能一和功能二可以通过两个“operation”，分别为"JackUnload"和 "JackWait"两个函数实现。
以放货时调整托盘方向为例，演示使用方式。
使用"JackUnload"功能，调整托盘角度在127°。
## 图片.png

## jackunload.mp4

使用"JackWait"功能，调整托盘角度在20°。
## 图片.png

## wait.mp4
使用“Zero”，把托盘、顶升机构、载货状态等全部归零。
## 图片.png

## zero.mp4
## 脚本使用提示
若使用时，出现在导航前，托盘自动归零的情况，请检查系统参数中是否了启用了AutoSpinToZero参数。按照优先级系统参数优先于脚本，因此会导致执行时，以参数配置为准，使用脚本时，修改为关闭即可 。
## 1.png
