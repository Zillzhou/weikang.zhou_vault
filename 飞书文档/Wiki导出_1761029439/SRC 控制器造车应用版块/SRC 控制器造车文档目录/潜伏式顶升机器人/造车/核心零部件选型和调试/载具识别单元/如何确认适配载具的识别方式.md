# 如何确认适配载具的识别方式

## 如何确认适配载具的识别方式

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.7

## 初版

## 使用中

## 载具识别场景说明
潜伏顶升车载具主要为料架（单层或多层），其中包含部分高度适宜的栈板。
激光潜伏顶升车通常通过自带激光雷达采用料架腿识别和反光板进行识别，并在一些场景中结合上视扫码二次定位的方式。具体激光选型可参照如何选择导航的方式 中激光相关部分。
针对纯二维码导航的潜伏顶升车，不具备载具识别功能。
后期基于图像深度识别的载具识别功能完善，可根据具体使用情况补充相关内容。
对于黑色的载具，必须在载具上粘贴反光条才可正常识别。
## 顶升车识别相关说明
## 1280X1280.PNG

图1. (a) 货架坐标系示意图; (b) 机器人坐标系示意图
顶升机器人顶起货架时，机器人里程中心、顶升机构中心、货架中心需要三点重合。
## 货架反光贴识别
## 货架设计说明
## 1.目前执行机构为Jack的顶升机器人，只支持顶升模块中心与机器人里程中心重合的情况（随动顶升机器人、AMB配合顶升模块都是符合这个限制的）。
### 2.货架设计原则（现成货架需要满足的基本要求，不满足则货架需要改造或重新设计）：
(a).原则1：一般情况下，货架是有四条腿，要求四腿形成一个矩形，假设四条腿对角线连接交点为O，如图1(a)货架坐标系示意图所示；其中X轴正方向伸出侧为机器人进入货架底部的那一侧。
(b).原则2：确定机器人钻入的方向，并在此方向的两条腿上贴上5CM宽的3M反光条，反光条的材质推荐使用钻石级（Diamond Grade 4090或者983-10），不要使用在交通应用里使用的反光板，例如3990。其中，贴反光条的两条腿如图标注，我们建立货架坐标系如图1(a)中所示。需要保证两个反光条的中点和货架中点重合，误差要小于顶升对位的需求。
(c).原则3：货架设计的其他部分都要求成轴对称的形式，包含：和顶升机构配合的限位孔、货架腿上支撑的货架部分。
(d.)原则4：货架内侧宽度要比机器人最大宽度宽 20cm ，也就是左右各冗余10cm的钻货架调整空间。
(e).原则5：货架高度要求，根据顶升模块的行程确定。
(f).原则6：货架上在激光雷达的安装高度上下10cm内不应该对激光雷达存在遮挡（除了四条货架腿），无论是不是在被agv顶升的状态下。
(g).原则7：如果存在多货架摆放在一排，需要注意货架腿和货架腿之间的间隙要保证机器人钻入之后加载货架模型以及膨胀模型后不会相互干涉，这个距离至少要保证20cm。
### 3.建议：机器人顶起货架后，要求激光外露，不能看到两条货架腿。
1658739627798-ff133753-2a7b-43f5-b5ce-266f2065c0cc.png

图1. (a) 货架坐标系示意图; (b) 机器人坐标系示意图
顶升机器人顶起货架时，机器人里程中心、顶升机构中心、货架中心需要三点重合。
### 4.货架摆放位置说明。
由于为了减小误识别的情况，使用激光识别料架时要求货架的前面两条腿中心距离和前置识别点的距离小于2m，中心点到识别位置激光的连线和车体的角度偏差小于10°,料架本身的角度和识别时的AGV的角度偏差小于20°.
### 5.识别精度说明。
使用不带反光板识别功能，需要将参数配置useReflector配置为false,使用无反光板识别需要保证货架腿两侧无货架挡板干扰
在使用激光识别货架方法时，可选用带反光板和不带反光板两种，使用反光板的识别精度会高于不带反光板的精度。
带反光板：x,y方向的精度高于±2cm,角度精度高于2°.
不带反光板：x,y方向精度高于±3cm,角度精度高于2.5°.
## 机器人货架描述文件配置说明
## 介绍
因为工厂中可能存在各种各样的满足机器人钻入要求的货架，机器人在不同的任务中，也可能被指定钻入不同的货架，因此我们需要对机器人要钻入的各种货架进行描述，货架描述文件的后缀名为.shelf,存放于 Robokit/resources/objects/shelf/ 目录下。在Roboshop识别文件中货架标签下编辑。
## 配置说明（3.3.17版本之前的 ）
## 识别文件配置说明
打开 Roboshop 软件，点击【识别文件】标签页进入配置界面，选择一个【shelf】文件，在右侧的属性窗进行货架描述文件的参数配置。如下图所示：
1658736941458-d1384b67-deac-4e58-a7c5-ac18667c7cda.png

## 货架描述文件编辑界面
## 其中，【属性窗口】的各个参数释义如下：
设备名：货架型号名，同一个场景中，可能存在不同型号的货架，一般该描述文件名即为设备名，例如： s0002.shelf
注：如需修改设备名，请【另存为】后修改文件名称后，选择【shelf】模块，使用【加载】功能载入修改后的货架描述文件，进行推送即可。
width: 改造后，钻入方向上，两个货架腿的外侧宽度。这里的宽度，是指改造后，两块反光条的最外侧宽度。
length: 垂直于钻入方向的两个货架腿的最外侧宽度。
leg_width: 反光条宽度，若选用标准 3M 汽车反光贴，即为 0.05（米）。
align_depth: 前置线路为“倒走”，也就是机器人钻入货架底部后，机器人坐标系 x 轴正方向与货架 x 轴正方向重合时（参考 图 1 货架坐标系示意图及机器人坐标系示意图），机器人停下的位置和货架前腿之间的距离，开放出来配置，主要是便于实施时候调整。
anti_align_depth: 前置线路为“正走”，也就是机器人钻入货架底部后，机器人坐标系 x 轴正方形和货架 x 轴正方向差 180 度（参考 图 1 货架坐标系示意图及机器人坐标系示意图），机器人停下的位置和货架前腿之间的距离，开放出来配置，主要是便于实施时候调整。
outer_width: 因为存在货架顶部，比货架腿形成的矩形要大的情况，因此有这个参数；这个宽度的方向和参数 width 是同向的。
outer_length: 因为存在货架顶部，比货架腿形成的矩形要大的情况，因此有这个参数；
这个长度的方向和参数 length 是同向的。注意为了防止反光条的噪声，outer_length 至少需要比 length 大 5cm.
### extra_dist: 激光抠出区域的宽度
leg_type: 货架腿类型，方形（cube）和圆柱形（cylinder）可选，暂时不起作用。
其中，识别钻货架相关的参数有 "width", "leg_width", "align_depth", "anti_align_depth". AGV 顶起货物后形状变化的相关的参数有 "outer_width", "outer_length". 扣除激光点的区域相关的参数有 "extra_dist", "leg_width", "width", "length".
货架描述文件的参数与真实货架的关系如图 2, 3 所示。黄色区域 AGV 顶起货架后，形状变化的轮廓，红色为激光扣除区域。
1658736976026-d142283b-e34e-485c-82b0-b71d0625f9e9.png

1658736990238-70a09c5d-cf93-485f-bd20-3953767eff87.png

"align_depth" 和 "anti_align_depth" 的作用是用来校准 AGV 钻入的深度，如图 3 所示，AGV 识别钻入货架的距离由这两个参数确定。
"align_depth" 是 AGV 在倒走时钻入的深度。
"anti_align_depth" 是 AGV 在正走时钻入的深度。
另外还有一个前置距离在配置参数中为 "RecShelf_AheadDist", 钻入深度和前置距离之和为 AGV 钻入货架时直线的行走距离。
1658737625726-bf468dab-df1b-4313-a862-dd7bb920129e.png

## 图 3. AGV 识别后的运动轨迹
## 参数配置说明
## 下面的参数都在参数配置中
RecAdjust是识别前是否要调整顶升车姿态， 目前只对顶升车有效
### RecStopTime是识别货架前的等待时间，默认是1s
RecShelf_PathSpeed是识别后行走的速度，默认是0.1m/s
RecShelf_AheadDist是规划前置距离(m)如图3所示
RecAdjust是识别前是否自动调整朝向，默认是开启的， 目前只对顶升车有效。
### 不同方向转货架的配置说明（3.3.3.17版本之后 ）
对应的coding为 https://seer-group.coding.net/issues?filter=b96b7c3c0464b7347091d31c9dd26638
## 识别文件的配置:
1658737956437-72b3a8fd-f0b5-456b-bc09-7381a19f5c78.png

detect_direction 用来指明识别朝向，detect_direction有x,y,-x,-y四个选项。
align_depth : x或者-x识别下，前置线路为“倒走”，也就是机器人钻入货架底部后，机器人坐标系 x 轴正方向与货架 x 轴正方向重合时（参考 图 1 货架坐标系示意图及机器人坐标系示意图），机器人停下的位置和货架前腿之间的距离，开放出来配置，主要是便于实施时候调整。
anti_align_depth : x或者-x识别下，前置线路为“正走”，也就是机器人钻入货架底部后，机器人坐标系 x 轴正方形和货架 x 轴正方向差 180 度（参考 图 1 货架坐标系示意图及机器人坐标系示意图），机器人停下的位置和货架前腿之间的距离，开放出来配置，主要是便于实施时候调整。
y_align_depth : y或者-y识别下，前置线路为“倒走”，也就是机器人钻入货架底部后，机器人坐标系 x 轴正方向与货架 x 轴正方向重合时（参考 图 1 货架坐标系示意图及机器人坐标系示意图），机器人停下的位置和货架前腿之间的距离，开放出来配置，主要是便于实施时候调整。
y_anti_align_depth : y或者-y识别下，前置线路为“正走”，也就是机器人钻入货架底部后，机器人坐标系 x 轴正方形和货架 x 轴正方向差 180 度（参考 图 1 货架坐标系示意图及机器人坐标系示意图），机器人停下的位置和货架前腿之间的距离，开放出来配置，主要是便于实施时候调整。
下面提供4种情况是，差动模式用车头激光和车尾激光识别，钻货架的配置：
1658738012900-f963da18-e200-4574-b419-a66c82f2632c.png

下面提供4种情况是，全向车在车体右侧或者左侧识别，然后保持车体朝向不变钻货架的配置，其中 hold_dir 要依据车子实际在前置点，识别时的朝向来配置，下面的四种情况的hold_dir只是示例：
1658738031022-db39782e-629e-41b5-b6a2-88009b39a3dc.png

在hold_dir行走的情况下，线路的正走和倒走属性只是用来选取的钻入深度的参数。
如果要实现一个点位上支持多方向识别，则目标点无需配置识别文件。识别文件包含在下发指令中。如下图所示。AP4是货物的点位，从LM3,LM5,LM6,LM7从不同方向识别货架，顶升货物。
1658738058636-eb4abeb4-0418-4448-a670-6b2143656990.png 

## 推送并同步货架描述文件
## 1.配置完货架描述文件后，点击【全部保存】右击该文件，如下图所示：
1658738194666-36bae69a-dcef-407f-afa5-069abd265d2e.png

### 2.右击配置完成的文件，点击【推送 ↑ 】按钮进行推送和同步操作，如下图所示：
1658738212442-12dcad6c-e698-48b5-836e-8c296e984d69.png

### 3.也可点击【全部保存】后，点击【全部推送】进行整个【识别文件】的推送和同步操作，如下图所示。
## Roboshop 任务配置流程
## 预置条件
请构建好地图并上传机器人并重定位正确。
## 标定任务
## 1.将货架摆放到日常工作位置。
### 2.这步中识别和非识别两种模式配置会不同。
(a).识别模式：地图中添加工作站，工作站的位置需要比货架实际可能摆放的位置靠后一点。
(b).非识别模式：通过Robosohp的手控功能W,A,S,D控制机器人钻入货架底部，在该机器人上右键选择【标记工作站】，如下图所示：
1658738237974-99f04754-913e-4d33-ae37-1df88db82657.png

3.配置工作站：识别和非识别的配置内容是相同的。进入【地图编辑】界面，点击刚才标记添加的工作站，查看工作站的类型选为 ActionPoint，执行对象为顶升机构，因此选择 jack,识别的模型文件即为 第三章 节中介绍的.shelf文件，如下图所示：
1658738260991-a74c8356-ae1d-42d8-b230-c3a54ce5f8c5.png

## 配置工作站
4.设置工作站前置点，要求机器人在前置点时，激光距离货架反光条最少0.5米，前置点朝向需要根据实际工况进行设置，原则是机器人在这点进行识别货架并钻货架的任务时，需要激光朝向货架腿。
典型情况是，LM3到AP4为正走时，LM3的朝要和 AP4的朝向一致，如下图所示：
1658738276727-70824f9a-e312-45c9-a7ce-31655d70a966.png

## 从前置站到工作站为正走时的路线
LM3到AP4为倒走时（即为识别完成后，转身180度，再倒退进入货架，LM3的朝向与上一种情况相反），如下图所示，同时该图中，由于机器人钻入货架后，再出来的时候为了避免机器人原地转动，我们把工作点的朝向也改为了机器人倒走时候的车头朝向。
1658738295727-d8d34c62-b287-4386-969b-a3d957db8e31.png

## 从前置站到工作站为倒走时的路线
## 注意事项 ：
## 1. LM3到AP4及AP4到LM3，需要将线路属性中的ObsExpansion设置为0，避免钻货架过程中机器人停障。
### 2.无论机器人正向进入货架，还是倒走进入货架，机器人钻货架任务结束后，激光头都必须露出货架（防止搬送货架过程中激光看到货架腿）。
## 下发任务
## 机器人可能会存在以下几种任务：
Load货架（顶升）。
Unload货架（下降）。
Wait（钻入并等待）。
Height (顶升调节到某个高度，目前只有SeerJack采用这个功能)。
执行任务时，先点击【路径导航】，然后选中【工作点】，选择【执行动作】，若选择【路径导航】，机器人只会根据地图上的线路进行路径导航并到达 AP 点。
1658738350837-3342bd91-a525-431d-94da-27425be274ba.png

## 执行动作到AP点
会跳出对话框，根据机器人的任务不同，我们需要进行不同的勾选和选择：
1658738367366-1177beef-ed0d-4588-9687-f7cf124f90d2.png

## 执行动作的选项界面
## 1.需要识别货架所在位置，并钻入货架顶升起来，需要勾选Recognize，点击Load.
### 2.不需要识别货架所在位置，开环的钻入到一个固定位置上，并顶升起来，不需要勾选Recognize，直接点击Load.
3.需要识别位置上有没有货架，并放置货架，勾选Recognisze，点击Unload，若有货架占用的话，会报错；不需要识别，直接开环放置，不用勾选Recognisze，直接点击Unload.
4.需要点击Wait的情况比较少,若勾选了Recognize，再点击Wait，机器人就会识别货架位置，钻入货架底部，然后结束任务，不会动作顶升模块；若不勾选Recognize，直接点击Wait，机器人就会固定路径导航到工作站，然后结束任务，不会动作顶升。
### 5.总结：
(a).勾选Recognize，会使机器人识别出货架位置，自主规划路径进入货架底部；
(b).不勾选Recognize，机器人直接根据线路，固定路径导航到该AP点；
(c).Load Unload Wait指示的是机器人到点之后的动作，Load指示顶升升起，Unload指示顶升放下，Wait指示不动作。
(d).勾选了 use_pgv，前提是机器人装备了PGV传感器，机器人将钻入货架底部后，根据PGV的识别结果，调整姿态
注：勾选Recognize，却不存在货架，会导致机器人识别不到，停在原地。

## 货架形状识别
## 介绍
目前支持形状识别的传感器为单线激光雷达，目前支持如下图形，命名为Leg_shape。
https://assets.seer-group.com/robokit/wangguan/shape_detection_7.png.png
## TODO：实际安装图
在使用形状识别的时候对货架腿也有一定的要求，请参考 顶升车货架识别-反光贴识别 章节的第一章，货架的设计规则以及钻入货架时两边的间隙以及多货架时摆放的要求。
## 识别文件配置说明
## 介绍
因为工厂中可能存在各种各样的满足机器人识别的形状，机器人在不同的任务中，也可能识别不同的形状，因此我们需要对机器人要识别的各种形状进行描述；
leg_shape 描述文件的后缀名为 .shelf ,存放于 /usr/local/SeerRobotics/rbk/assets/objects/shelf 目录下，默认文件为 s0002.shelf 。
在Roboshop识别文件中形状标签下编辑。
## 识别范围
下图的几个参数表示激光雷达的识别区域，该参数需要根据现场实际环境进行配置，避免在激光雷达识别范围内出现多个形状：
ValidShapeX ：车体坐标系下的最大识别距离，单位为m；
ValidShapeBias ：偏差量；
当 detect_direction 为x的时候， ValidShapeX 为车体坐标系下x方向的最大距离，即： 0<x<ValidShapeX ，y方向识别的范围为：

72113361f1f0f348367e99e48fb41edd.svg
1654917806819-d1020598-db2f-4f87-87be-13d48c43d937.png

当 detect_direction 为-x的时候， ValidShapeX 为车体坐标系下x方向的最大距离，即：  -ValidShapeX<x<0 ，y方向识别的范围为： 

72113361f1f0f348367e99e48fb41edd.svg
1654917825880-8b7e1b74-0420-45eb-9945-3d46b63eec2e.png

当 detect_direction 为y的时候， ValidShapeX 为车体坐标系下y方向的最大距离，即： 0<y<ValidShapeX，x方向识别的范围为： 

40d8a44372afaa2eec2c953513a5eefe.svg
1654917844669-ceb03253-6012-4e6b-bed7-b70593a75c08.png

当 detect_direction 为-y的时候， ValidShapeX 为车体坐标系下y方向的最大距离，即：  -ValidShapeX<y<0 ，x方向识别的范围为：

40d8a44372afaa2eec2c953513a5eefe.svg
1654917863465-3b73c162-5298-4419-b87d-d26e062a4be5.png

注：车体坐标系为右手坐标系，即正前方为X正方向，正左方为Y正方向。

https://assets.seer-group.com/robokit/wangguan/laser/shape_detection_15.png

## 阈值设置

ValidShapeDistanceThreshold ：该值代表着识别算法内部计算出来的BE（第一部分图Leg_shape）直接的距离和实际距离之间的差值，一般不需要修改；

ValidShapeLineThreshold ：该值代表着AB、BC、DE、EF（第一部分图Leg_shape）和实际距离之间的差值，一般不需要修改。

ValidShapeLineSplidThreshold ：该值代表着E到DF线段的距离（第一部分图Leg_shape），需要根据货架腿大小更改。

ValidShapeValidShelfAngle ：该值表示车身与货架最大的倾斜角度，当识别方向为车头和车尾的时候，表示车头和车尾与货架最大的倾斜角度，侧向识别是表示为车身侧边与货架的最大倾斜角度。

ValidShapeDetertorNum ：该值表示连续识别的次数，当连续识别多少次的结果都很接近的时候，认为是识别到了，该参数仅对钻货架有效。

## 配置说明
## 下面的参数在参数配置中
当method_type 选择by_legshape的时候，需要将use Reflector for detecting shelf改到false ：

https://assets.seer-group.com/robokit/wangguan/laser/shape_detection_17.png
https://assets.seer-group.com/robokit/wangguan/laser/shape_detection_18.png
### 其余的参数说明，很重要，请仔细阅读！！！！！

## 参数

## 描述

## 单位

## leftStandardLength

## 表示左边部分水平线段的长度，图中EF段

## m

## leftVerticalLength

## 表示左边部分竖直线段的长度，图中DE段

## m

## leftAngle

## 表示左边部分的夹角，默认90度

## °

## rightStandardLength

## 表示右边部分水平线段的长度，图中AB段

## m

## rightVerticalLength

## 表示右边部分竖直线段的长度，图中BC段

## m

## rightAngle

## 表示右边部分的夹角，默认90度

## °

## distance

### 表示左右两部分之间的距离，这里指BE之间的距离

## m

## detect_direction

## 车体钻货架的方向

## use_optimization

## 默认勾选，代表使用优化

## drill_out_off

该参数只在钻出货架的时候有效，钻出货架和钻入货架有不同的逻辑，在钻出货架的时候不需要太高的精度，一般来说在钻出货架的时候车身会偏向激光雷达一侧，drill_out_off这个参数表示在车声坐标系下（右手坐标系）y方向的设置的偏差

## align_depth

车头或者车尾识别方向，倒走，钻货架的深度，以图中的AF连线为基准

## anti_align_depth

车头或者车尾识别方向，正走，钻货架的深度，以图中的AF连线为基准

## y_align_depth

### 车头侧向识别（y方向）钻货架的深度，以图中的AF连线为基准

## y_anti_align_depth

车尾侧向识别（-y方向）钻货架的深度，以图中的AF连线为基准

## continue_detect

## 持续检测，慎用！！！

## recDist

如果前置点距离货架的位置比较远，可以配置recDist，该值表示距离货架多远的距离开始识别，可以在一定程度上减缓地面不平、激光雷达安装不水平等因素的影响，提高识别精度。
为了保证识别准确度， leftStandardLength & leftVerticalLength & rightStandardLength & rightVerticalLength 均需大于7cm

## 使用说明
## Leg_shape使用说明
在布置 N_shape 形状物体的时候，要保证物体能够被激光雷达完整的观测到，此时在可视化界面应可以完整的看到形状物体的点云；此外，物体的位姿由物体的中心点的位姿表示，对应图中的点D，在安装的时候要尽量保证点D位于工位点的中心处且DE边平行于工位。
Leg_shape 主要安装在货架的腿上，为了更好的识别， leftStandardLength & leftVerticalLength & rightStandardLength & rightVerticalLength 需大于7cm，且 ∠ABC 和 ∠DEF 为90°。

https://assets.seer-group.com/robokit/wangguan/shape_detection_11.png

如上图所示，leg_shape识别需要在货架腿（图上蓝色部分）上安装挡板（图上红色部分）， 挡板的宽度需要宽于货架腿 ，且挡板的安装高度必须保证挡板能被激光雷达（图上黑色园）扫描到。挡板的宽度宽于货架腿是为了保证避免在某些情况下激光雷达扫描到货架腿的外侧对识别造成干扰。

## 挡板材料要求：
机器人的激光雷达无法正确扫描表面呈镜面反射的物体（如镜子、光滑的金属表面）；
机器人的激光雷达无法正确扫描透明后半透明的物体（如玻璃、部分毛玻璃等）；
机器人的激光雷达无法正确扫描黑色的物体，黑色将吸收所有光线，使激光雷达的有效距离降低甚至失效。

### 为了更好的识别，激光雷达的视野内应满足如下条件之一：
可以同时识别到完整的左右两边的形状（最好的情况）；
可以识别到右边完整的形状，左侧只识别到外侧的线段；
可以识别到左侧完整的形状，右侧只识别到外侧的线段；

如果出现一侧完整识别到，另外一侧外侧可以完整识别到，但是内测只识别一部分的情况，会导致识别判断失败，因此在前置点的选择上需要满足上述三个条件之一，最好可以满足条件1.
## 最大、最小识别距离
这里的识别距离代表 激光雷达到货架腿的距离 ，理论上只要激光雷达可以完整的观测到形状物体即可。形状越大，距离可以适当远一些，但是为了保证识别的精度，距离不宜太远，应保证距离 小于2m 。对于Leg_shape，最小距离应保证激光雷达可以完整观测到挡板的外侧，即本章节一中介绍部分N_shape图上的AB和EF部分。对于N_shape，只要保证激光雷达能够完整的观测到全部形状即可。

## 其他说明
在使用形状识别定位之前，首先要标定激光雷达外参，详细操作步骤请参照标定章节；在确保激光雷达外参已经标定准确的前提下要保证当前地图定位的置信度，置信度越高，使用形状识别定位的结果就越准。
https://assets.seer-group.com/robokit/wangguan/shape_detection_3.png.png

## Roboshop 任务配置流程
这部分请参考 2.1章节的 Roboshop 任务配置流程部分。
## 充电桩识别
## 介绍
目前支持形状识别的传感器为单线激光雷达，目前支持如下图形，命名N_shape。
1663059095762-d4f72382-526b-4ce7-8113-85d8a679b2fa.png

N_shape图形中的AB段仅用来安装，不参与算法内部计算，该段不宜过长，不宜超过5cm；默认图片中的D点代表形状的中心，在工位点安装的时候需要注意尽量保证形状的中心点与工位点重合。
## 识别文件配置说明
1663059588672-9688027b-d9b3-48d5-a1be-064979e8fee1.png

 firstLengthx 表示形状的第一条线段，即图中的DE，单位为米，默认为0.4m；
 firstAngle 表示形状的第一个角，即图中的∠CDE，单位为度，默认为150°；
 secondLength 表示形状的第二条线段，即图中的CD，单位为米，默认为0.15m
 secondAngle 表示形状的第二个角，即图中的∠BCD，单位为度，默认为120°；
 thirdLength 表示形状的第三条线段，即图中的BC，，单位为米，默认为0.15m；

## 模型文件配置
货架形状描述文件的后缀名为 .shelf ,存放于 /usr/local/SeerRobotics/rbk/assets/objects/shelf 目录下，默认文件为 s0002.shelf 。
在Roboshop识别文件中形状标签下编辑。
## 图片.png

## 其中，【属性窗口】的各个参数释义如下：
设备名：货架型号名，同一个场景中，可能存在不同型号的货架，一般该描述文件名即为设备名，例如： s0002.shelf
注：如需修改设备名，请【另存为】后修改文件名称后，选择【shelf】模块，使用【加载】功能载入修改后的货架描述文件，进行推送即可。
## 图片.png

以下参数按照现场货架实际尺寸配置。
width: 改造后，钻入方向上，两个货架腿的外侧宽度。这里的宽度，是指改造后，两块反光条的最外侧宽度。
length: 垂直于钻入方向的两个货架腿的最外侧宽度。
leg_width: 反光条宽度，若选用标准 3M 汽车反光贴，即为 0.05（米）。
align_depth: 前置线路为“倒走”，也就是机器人钻入货架底部后，机器人坐标系 x 轴正方向与货架 x 轴正方向重合时（参考 图 1 货架坐标系示意图及机器人坐标系示意图），机器人停下的位置和货架前腿之间的距离，开放出来配置，主要是便于实施时候调整。
anti_align_depth: 前置线路为“正走”，也就是机器人钻入货架底部后，机器人坐标系 x 轴正方形和货架 x 轴正方向差 180 度（参考 图 1 货架坐标系示意图及机器人坐标系示意图），机器人停下的位置和货架前腿之间的距离，开放出来配置，主要是便于实施时候调整。
outer_width: 因为存在货架顶部，比货架腿形成的矩形要大的情况，因此有这个参数；这个宽度的方向和参数 width 是同向的。
outer_length: 因为存在货架顶部，比货架腿形成的矩形要大的情况，因此有这个参数；
这个长度的方向和参数 length 是同向的。注意为了防止反光条的噪声，outer_length 至少需要比 length 大 5cm.
### extra_dist: 激光抠出区域的宽度
leg_type: 货架腿类型，方形（cube）和圆柱形（cylinder）可选，暂时不起作用。
method type：识别方式，可选反光板和形状识别。
其中，识别钻货架相关的参数有 "width", "leg_width", "align_depth", "anti_align_depth". AGV 顶起货物后形状变化的相关的参数有 "outer_width", "outer_length". 扣除激光点的区域相关的参数有 "extra_dist", "leg_width", "width", "length".
货架描述文件的参数与真实货架的关系如下图所示。黄色区域 AGV 顶起货架后，形状变化的轮廓，红色为激光扣除区域。
## 无标题.png

"align_depth" 和 "anti_align_depth" 的作用是用来校准 AGV 钻入的深度，如下图所示，AGV 识别钻入货架的距离由这两个参数确定。
"align_depth" 是 AGV 在倒走时钻入的深度。
"anti_align_depth" 是 AGV 在正走时钻入的深度。
## 1.png

另外还有一个前置距离在配置参数中为 "RecShelf_AheadDist", 钻入深度和前置距离之和为 AGV 钻入货架时直线的行走距离。
AGV 识别后的运动轨迹如下图所示。
### 2.png

## 导航方式和载具注意事项
下视 PGV 和料架识别(反光条/轮廓识别)：如果 AP 点使用二维码导航此时是不能使用料架识别的，因为在使用料架识别时候，这个时候如果料架放歪了之后，AMR 是会报“机器人找不到二维码”的报错，所以对于二维码导航和料架识别的应用场景，AP 点就不能粘贴二维码，二维码只能贴到该 AP 点库位的前置点，前置点和AP 点的导航方式也不能选二维码导航，而应该是 SLAM 自然导航的方式。
