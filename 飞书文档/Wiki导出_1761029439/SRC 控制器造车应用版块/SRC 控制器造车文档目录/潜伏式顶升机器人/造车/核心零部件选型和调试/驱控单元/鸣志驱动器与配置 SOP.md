# 鸣志驱动器与配置 SOP 

## 鸣志驱动器与配置 SOP

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.3.15

## 初版

## 使用中

## V1.1

### 2024.4.9

## 修改编号

## 使用中

## 配置前的准备工作

## 序号

## 准备事项

## 备注

## 1

## 已安装驱动器调试软件的笔记本电脑
## 上位机软件下载链接：

### Luna-Setup-2.2.22.0716.zip
## 上位机软件使用手册：

### Luna - 软件帮助文档_3.20修改.pdf

CANopen UserManual for Servo20211205_CN.pdf

MDX+ Quick Set_up Guide CN202209030(1).pdf

## 2

## 工具：mini-USB 数据传输线

## 3

## 已正确接线和上电的驱动器

## 电机安装模型
潜伏顶升车运动模型为双轮差速包含左右2个行走电机，一个旋转电机和一个顶升电机。该车型所拥有的2个驱动轮必须共轴，且车体坐标系的原点落在两轮中心连线的中点上，车体坐标系的x轴与轮轴垂直，如下图所示：
1652597627254-fb6a67ce-1648-48ae-9bbb-a02525e9f3fd.png

## 当前车型配置示例
此示例选择选用鸣志直流伺服驱动器作为行走电机，其详细使用文档参照 ：

MDX+ Quick Set_up Guide CN202209030(1).pdf
## 驱动器本身参数配置
参照以下内容配置。
### 3.1.1 连接上位机
## 上传当前参数

1677650890736-e2302ff8-fe45-4571-86d0-5bbd6e25e307.png

1677650908336-e4698217-cd94-452b-b785-2f0030dc08ad.png

### 3.1.2 基本参数
修改ID、波特率、配置看门狗触发时间和触发选项。
如果支持拨码配置ID，拨码配置优先级高于软件设置。
1677650929405-5c3c471c-b6c8-474b-9559-b34f2205cdad.png

### 3.1.3 减速停车
“AM值”对应【通用】-【伺服刹车减速度】，如无特殊需求，使用默认值即可；如果需要用到该功能，请根据现场情况合理配置该参数，

1677651026858-f4d9139e-a64f-4be8-abba-a92382ba96a7.png

### 3.1.4 动态刹车
鸣志MDX+提供“动态刹车”功能，启用动态刹车可以使电机更快速停车，以下配置为参考，可以根据现场需求设置

1677651043690-b3dd1a60-a59d-4216-a623-7d58ccacd990.png

### 3.1.5 急停功能
## 配置急停功能
1677651061224-e86fe696-bc12-46ac-994a-fb3add9032bd.png

### 3.1.6 电机转一圈脉冲数（count值）配置
默认10000，模型文件【encoderLine】配置参数是电机转一圈脉冲数除4，如下图encoderLine = 10000/4 = 2500；如果驱动器该处参数修改，模型文件配置参数需要对应修改。

1677651080224-cd5e9dea-6566-41c3-8f6a-10a3a4507490.png

## 模型文件配置
鸣志直流伺服驱动器在潜伏顶升车上，可用于行走、旋转、顶升三种用途。因此需要根据需要配置模型文件。本文以用于行走用途做配置。
模型文件总览：通过模型文件——MOTOR——选中motor0和motor0(为了便于区分，修改电机名称为left和right)，即可在右侧属性窗口配置电机及驱动器相关参数。
1710835103466-0062e029-5bc5-4047-8ae7-4aa41f3c18c4.png 

## 图片.png

## 基础配置
## 图片.png

## 参数名称

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## x

## m

## /

## /

## /

轮回转中心在右手坐标系下的 x 位置，如小车模型中坐标，根据实际距离填写

## y

## m

## /

## /

## /

轮回转中心在右手坐标系下的 y 位置，如小车模型中坐标，根据实际距离填写

## yaw

## °

## /

## /

## /

## 轮安装的朝向，根据实际安装位置填写

## canID

## /

## /

## /

## /

行走轮对应电机驱动器的 canID，根据驱动器上位机配置决定

## inverse

## /

## /

## /

## /

电机是否反向旋转，根据实际需求配置，本示例中right电机因其安装方向，故而勾选。

## encoderLine

## /

## /

## /

## /

## 电机编码器线数，根据电机实际参数填写

## currentFactor

## /

## /

## /

## /

## 电机电流因数，根据实际情况填写

## upLimitDI

## /

## -1

## /

## /

上限位DI，-1代表不启用，如果启用根据上限位传感器DI填写，行走电机配置为-1

## downLimitDI

## /

## -1

## /

## /

下限位DI，-1代表不启用，如果启用根据下限位传感器DI填写，行走电机配置为-1

## zeroDI

## /

## -1

## /

## /

零位DI，-1代表不启用，如果启用根据零位传感器DI填写，行走电机配置为-1

## passive

## /

## /

## /

## /

### 是否为被动电机，不勾选代表不启用，行走电机不勾选

## brake

## /

## /

## /

## /

## 其中encoderLine
## 增量式编码器填：2500
## 绝对值编码器填：16384
1710836571995-92593a15-b096-4848-802f-6ca0daab79c0.png

## 电机电流系数配置
## currentFactor
### 电机电流系数配置方法， currentFactor配 1
1710836548177-1637f5b4-4112-4786-b201-d5180f94f69c.png

## 型号和端口配置
## CAN通信配置（canPort）
本车型详细参数配置如下。
1703761670338-07277b92-61e0-4912-bf4f-819ac1963fdf.png

## 参数名称

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## canPort

## /

## /

## /

## /

port1，表示CAN的通信端口1；port2，表示CAN的通信端口2；请根据实际情况进行选择

## image (2).png

## image (1).png

## image.png

## 1：功能：行走walk
## 图片.png

## 参数名称

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## wheelRadius

## m

## /

## /

## /

### 驱动轮实际轮半径，请根据实际情况进行填写

## reductionRatio

## /

## /

## /

## /

## 驱动轮减速比，请根据实际情况进行填写

## minimumSpeed

## m/s

### 0.05

## /

## /

电机的最小启动速度的上限值，例如电机需要0.01m/s才能启动，则下发值始若小于0.01m/s时会逐渐增加到电机刚好动的值作为启动速度，但不会超过该参数。

## deltaCnt

## count

## -1

针对minimumSpeed的加速系数，系数越大，递增的速度越快，越快达到minimumSpeed上限值。一般情况下无需调节该参数。

## deadDealerK

## /

## /

## /

## /

该值用于特殊情况下，若电机编码器抖动较大时，启用该参数可以解决电机数据判断为非静止的状态。

### reductionRatio:减速比 需要测算
减速比一般是由载荷的特性和运动速度决定的。一般计算公式为：减速比=输出轴转速/输入轴转速，其中输出轴转速根据具体要求设定，输入轴转速则根据电机的额定转速来选择。通常会根据需求和具体情况调整减速比。
1710902020649-e215dee5-3348-485b-972d-5c00dfbf7346.png

## 2：外置编码器配置（若有）
## 图片.png

## 参数名称

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## outEncoderID

## /

## /

## /

## /

## 释义: 外置拉线编码器的can ID
## 说明: 请根据实际情况进行选择

## utEncoderRatio

## 释义: 外置拉线编码器减速比
说明: 使用外置拉线编码器的时候，核算出来的减速比，请根据实际情况进行选择 

## outEncoderLine

## 释义: 外置拉线编码器线数
说明: 使用外置拉线编码器的时候，核算出来的编码器线数，请根据实际情况进行选择 

## outEncoderPort

## port1释义: CAN的通信端口1
## port2释义: CAN的通信端口2
## 说明: 请根据实际情况进行选择

### 3：电机型号：Moons-MDX-SeerCANOpen
## image.png

## 参数名称

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## brand

## /

## /

## /

## /

指所配置的驱动器的型号，请根据实际情况进行勾选，其中我们支持的驱动器品牌请查看链接：motor 

## 功能验证
注意：电机控制验证前之前必须先完成激光配置、电机配置动作。
在整车组装完成未安装外壳前，请再检查一遍接线确保接线正确；
让车体着地，使用 Roboshop 软件操作机器人做运动动作:向前，向后移动固定距离，如果不正常，请检查第四章节 驱动器配置 ；
未拍急停按钮前，推动机器人，无法推动（电机使能），检查 Roboshop 中机器人状态处于“未急停”“驱动器未急停”，如图 1所示；所示拍下急停按钮后，再次机器人，可以推动（电机去使能），检查 Roboshop 中机器人状态处于“已急停”，“驱动器已急停”。
1711003524057-e7201e4f-46f0-4139-9c18-951b040e8712.png 

## 图1 未急停

middle_img_v3_02c1_7ac9d6c2-d401-45d0-a2cb-04731b39fcdg.webp

1711003581375-845014e8-26e0-4181-b98a-90266213baab.png 

## 图2 急停状态
## 验证操作视频：
middle_img_v3_02c7_8ae6aba0-57b5-45bc-8156-afa6214a43dg.webp
