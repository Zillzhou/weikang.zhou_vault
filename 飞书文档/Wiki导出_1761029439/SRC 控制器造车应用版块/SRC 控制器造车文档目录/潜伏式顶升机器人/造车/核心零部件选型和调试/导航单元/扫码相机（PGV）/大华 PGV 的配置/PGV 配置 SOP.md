# PGV 配置 SOP 

## PGV 配置 SOP

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.3.15

## 初版

## 使用中

## 选型说明
本应用示例采用大华读码相机，适用型号R3138MG010，视野距离100mm（± 20mm），建议安装高度在100mm±5mm以内(该值即模型文件中的Z值).
## 内参配置
### 固件烧录及线束定义等详细内容可参照 大华读码相机
## SVStudio使用
SVStudio 启动后，主界面如图所示，①为工具栏，②为设备属性栏，③为
预览区，④为结果输出区。
程序启动后，会在相机连接界面自动发现同网段内的相机设备，并显示在“设备列表”。之后，如果有新的相机接入网络，需要点击“刷新”按钮，刷新设备列表。将鼠标移至要连接的设备上，点击“连接”按钮或者双击列表项，即可连接相机。连接前，要确保设备图标为可连接状态的图标。否则，需要先修改设备 IP （在断开连接状态下才能修改 IP ）。连接成功后，设备列表中相应设备的图标变成连接中。

1677652440504-936170d3-271a-474a-821c-2b3cfcd8623d.png

连接设备后，可预览扫描界面，并进行相应的配置。
1677652462034-f13e8618-79fd-4dd6-8e2a-2dca9f01ce3c.png

## 参数配置
## 恢复出厂设置
1677652478097-bea5cbea-3536-402b-a7e6-3f60bd52bc42.png

## 设备属性
重新连接设备后点击【设备属性】，触发类型选择【 FreeRun 】，频率推荐设置为100，如有特殊需求可按实际配置
1677652660985-d790c6a0-ea61-41f7-996f-9543ffff44b2.png

## 光源控制
展开 LightControl ， LightMode 有三种模式 Off（关闭）， Always（常亮）， Flash(闪烁)。此处配置为闪烁（功耗低）， LightBrightness 可设置内置光源亮度。如图。
1677652680039-7a8a162c-d6af-4810-9ec1-ad033fe870ea.png

## 二维码相关配置
## 4*4 的二维码配置方法与单码不同
## 4*4 二维码配置方法
### 在【AGVEnable】为false情况下才能设置该参数
## a. 设置通讯方式改成【RS485】
## b.二维码类型【P+F】
## c.上报类型【Query】
### d. 【DmLenMM】 是单个码的大小
e. 【DmIntervalLenMM】 是码间隔的宽度，这两个数据 均需要按照实际填写 ，否则读码相机数据会不准，
### f.上报数据精度，x、y、angle设置如下
## g.【OffsetAngle】默认为0
h.【TagSize】按照实际填写，单码是1×1，码阵选择4×4
### 设置后 【AGVEnable】改成【true】 ，如下图

1677652697253-b06457f8-e492-451a-b323-a5eab249beef.png

1677652713837-5fc26021-a57b-401a-8739-66b65ecd9880.png

1677652737239-c578326e-5e99-4d99-a3b1-7c8f7e6ecc2b.png

### 单码配置方法，尺寸推荐，20~30mm（只针对大华）
1677652754776-5d69b7b3-f2ba-4d02-9529-624ab39d168b.png

1677652771782-e00751dd-0d57-4f50-b076-607fa159ac00.png

### SiteID配成0，即使使用两个pgv也保持配0
1699337516274-92a0c280-e84b-4f94-9113-da3a44732c28.png

## 通讯设置
## 波特率115200

1677652789647-74b7605b-41d1-4dc4-a6c5-95a0b0a723f1.png

## 修改曝光
### 打开图像预览窗口，可以观察到识别到二维码的清晰度
1677652808873-66b62c77-ef73-4218-a74c-61d836b9f7fe.png

在修改曝光值前，先关闭图像预览缩放，这样可以看到相机识别到的原图
把 ImageOutputControl 中的 ScaleEnable 改为 False

1677652827374-821518d0-0c7b-4b8f-b1ef-ccc06058bbfe.png

ExposureTime 需要根据现场环境条件进行配置，调节曝光和增益，根据人眼感受，使目标清晰即可，建议优先调整曝光
1677652841885-7f776c28-d56f-49bc-be92-e2ac51aa8cfd.png

相机 过曝和欠曝 ，都会导致相机的识别失败率增加，数据输出端会出现 noread 的字样，此时应该把曝光调到合理范围
1677652973254-8fe75191-d49d-4aa5-8ec3-3437e2ef1dec.png

1677652989372-373a35e6-7ec6-40fb-b086-2c3b81a6c888.png

持续观察 1 分钟，当检测时间稳定，状态无 noread 现象出现时，即可判断曝光调整合理

1677653012458-9f07d498-9521-45b4-9e82-88b11c0635a4.png

### 该参数配置为 true ，可减小数据跳变，提高识别精度
1677653031082-7e900910-c5cf-4284-82f3-1fd190243c8d.png

## 保存参数
保存参数，保存到【用户配置1】，启动配置改成【UserSet1】，保存后重上电设备

1677653161837-b366d790-6502-49e6-9eaf-7502e1dfb3c4.png

在配置完成后需要断开读码相机的上位机连接，否则会出现读码相机数据上报延迟过大的情况
## 模型文件配置
### 1）连接机器——【模型文件】——【PGV】——参数配置
1711013425904-b164a494-3bed-4bf3-bf83-fba0a681beae.png 

## 2）基础信息：
读码相机 的 yaw (r) 角，需要通过将二维码与车子平行，从 读码相机 中读取 angle 角，然后 读码相机 配置中的 yaw 即为 - angle .读取二维码角度值，yaw值填90°
1711014927148-1fecc0af-54ff-4c6d-85d8-ce5166a937b4.png

单位 xUnit 、 yUnit 为 读码相机 配置的坐标值，按照实际配置填写；本文档配置坐标单位为0.1mm，所以填写0.0001m
1711013796037-414ee64e-184e-4f9b-8411-f84ea0454391.png

## 3）功能
1711088245224-9595fa7f-97f9-41e6-b61c-a77f862b3384.png

## 功能分为：调整、定位、调整和定位
一般上视配置为【adjust】,下视配置为【Localization】、【adjustlLocalization】，因本示例场景中既包含二维码导航也包含下视二维码调整需求，因而此处配置为【adjustlLocalization】
## 4）串口名称：
注意事项： SRC-880控制器造车采用485串口通讯，在模型文件配置时请注意：
SRC800和SRC880在模型文件中串口名称不一致，SRC800 在配置时，其“devname” 均为“/dev/ttyUart ”（数字以接口定义中实际使用的485口接线为准） ；SRC880控制器配置时“devname” 变更为“/dev/ttyS ”
1711088173017-085ea216-0292-42d1-ba91-442282904e66.png

## SRC-880造车串口配置：
1710904938476-8880e3f9-ae15-420c-8197-860deca0a6b6.jpeg

### 配置完成后可在【运行状态】-【读码相机】一栏看到读码信息
## PGV状态信息：
1711013694703-21653dbf-893d-45dd-bc4f-72cc7dc26fe6.png

## 读码相机标定
## 读码相机 标定方法详见此文档：
## 《PGV 标定》
## 《PGV-里程计标定》
## 3 功能验证

1）确保相机硬件正常，且接线完整。
2）将车体开到或者推到二维码上方。
1711015359736-9d65af6f-3497-4cda-8454-3f0c7c463811.jpeg 

4）在首页右侧功能列表点击【开始识别】。
1711015280267-fea9c11a-56eb-4074-8813-1b37204d6d65.png

能输出识别结果。
1711015307971-aae92fc5-e9ad-4aa0-bce4-a4136c54dec6.png

## 图片.png
