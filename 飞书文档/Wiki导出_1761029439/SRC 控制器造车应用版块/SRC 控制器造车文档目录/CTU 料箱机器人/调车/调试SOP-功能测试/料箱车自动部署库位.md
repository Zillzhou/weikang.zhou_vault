# 料箱车自动部署库位

## 料箱车自动部署库位

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

## 前提须知
本手册通过简单几步操作，即可自动批量生成库位中的 load 和 unload 动作参数，并通过料箱车实际遍历库位执行一遍识别货架码任务，根据识别结果自动更新库位中的参数。亦可以通过货架库位进行批量的库位自动化测试，让实施工程师无需再一个个库位校验参数，可大量缩短库位部署周期和库位测试周期，并解决因地面不平，货架不规整导致的库位参数不一致的问题。
需要项目实施提前完成扫描地图、创建站点前置工作，根据现场货架层数，批量创建完空库位，无需添加库位动作。
## 硬性要求：
所有料箱码，贴码必须水平居中，贴码高度必须一致。
所有货架码，必须沿货架上表面贴。（或者所有货架码离货架上表面高度必须一致。）
库位命名满足 xxx-aaa-bbb-ccc 格式，一般aaa表示货架序号，bbb表示货架纵列序号，ccc表示货架层数序号， 如 A-002-009-003 表示 A 区2号货架的第9列第3层的库位。
更新最新版本的脚本文件，非必要不更新，已在使用的 json 参数文件无需更新，云端料箱车脚本项目唯一码：72e830d4-4758-43d5-85d5-9e86e4fa71da
Roboshop 版本 Roboshop 2.4.1.192 以上， RBK 版本 3.4.6.2105 以上。
## 创建货架库位
## 货架库位概念
货架库位定义：将地图上多个库位绑定在一起，形成一个逻辑上的货架库位。货架库位中所有的库位应该满足以下要求：
货架库位在原则上应该尽量对应实际项目中的一排货架；
库位层高一致，即货架同一层的库位高度相差不超过 5cm；
库位朝向一致，即所有库位必须位于同一巷道的同一侧；
每一列的层数尽量保持一致；
如果是双深位项目，可将双深库位视作两个货架。
通常可以将同一个巷道同一侧的所有库位设置为一个货架库位，如下图中同一个货架的所有库位可以设置为一个货架库位。
## image.png

## 创建货架库位
### 选中地图上一排库位，点击【设置货架库位】
## image.png

## 添加一个货架，将选中的库位添加到货架中
## image.png

界面中会将所有库位显示出来，双击左下角的示意图可放大查看，可以有助于理解该界面的【列】和【层】的概念。
## image.png

## image.png

## 初始化库位参数
选中全部库位，点击【创建binTask】，输入第一层货架高度、货架层高、取货方向等参数，参数解释参考左下角示意图。
点击【确定】后即可自动生成库位动作参数，该参数即为所有库位的初始化参数。
## image.png

库位可支持选中一列，选中一层，选中全部，也可以按住【Ctrl】键任意选中多个库位，完整操作参考如下操作：

### 2024-11-07_160013792.mp4
此时生成的库位参数，是根据货架第一层高度、货架层高以及取货方向生成的初始参数。
### 企业微信截图_17309657951031.png

## 更新库位参数
## 上传脚本文件
进入机构脚本界面，在【脚本文件】空白处右键，点击【导入文件】，导入后右键点击【推送】，运行一遍【zero】任务。

### 2024-11-07_161227471.mp4
### 修改脚本 load_rec_lift_diff 参数值：
料箱贴码时，该参数值表示料箱码中心到货架平面的距离；
料箱不贴码，使用3D识别时，该参数值表示料箱识别面中心到货架平面的距离。
## image.png

## 自动更新库位参数
选中货架的全部库位，点击【更新库位参数】，点击【确定】后，机器人将自动执行所有库位的识别更新参数任务。
注意：该操作将会使机器人依次移动到所有库位执行识别更新参数的任务，需注意安全。实际部署过程中，应该先选中几个库位进行测试后再执行全部库位的更新操作，可以在地图界面查看库位参数是否被更新。
## image.png

## 检查参数更新
执行【更新库位参数】任务时，可以在脚本界面查看当前正在执行的库位任务。
## image.png

执行完【更新库位参数】任务后，可以在地图界面查看库位参数是否成功被更新。
## image.png

## 手动更新库位参数
可以手动选中需要修改参数的库位，点击【修改binTask】。一般同一层的库位，高度和方向是一致的，可以进行批量修改。
该问题可能会出现在最高层/最低层货架参数上，当自动识别更新的参数超出了机器人最高/最低限位值时，机器人无法正常执行取放货，此时需要手动将最高层/最低层的 lift 参数修改成机器人能达到的值。
另外，减小 load_rec_lift_diff 参数值可以避免以上问题，库位中的 lift 参数值只需要保证相机能识别到二维码即可，不需要非常的精准。执行取货和放货的高度值偏差可以通过设置二次调整高度参数来修正，详情参考下文 5.2 章节内容。
## image.png

## 检验库位参数
## 检查库位
当货架库位上所有的参数都通过识别更新完参数后，可以批量执行库位的 load 和 unload 动作，以此来检查库位参数是否设置合理。
选中货架的全部库位，点击【检查库位】，点击【确定】后，机器人将自动执行所有库位的 load 和 unload 任务， 该操作适用于货架上有箱子的场景。
注意：该操作将会使机器人依次移动到所有库位执行 load 和 unload 任务，需注意安全。实际部署过程中，应该先选中几个库位进行测试后再执行全部库位的检查操作。
## image.png

如果货架上没有箱子，可以在机器人背篓中放一个箱子，并将该背篓设置为有货。
在点击【检查库位】后，点击 load 向下拖即可将 load 和 unload 动作调换顺序，再点击【确定】。该操作将会使机器人依次移动到所有库位执行 unload 和 load 任务，只需一个箱子即可验证所有库位的 unload 和 load 参数。
## image.png

## 修改脚本参数
实际部署过程中，应该先选中一个库位进行检查库位的 load 和 unload 测试。
当执行 load 任务时，由于高度不对导致箱子抓不到料斗中，应调整脚本json文件中以下参数：
## image.png

当执行 unload 任务时，由于高度不对导致箱子撞货架，放不到货架上，应调整脚本json文件中以下参数：
## image.png

## 删除货架库位
## 删除货架中的库位
选中库位，点击【从货架中删除库位】，该操作将删除选中库位的一整列库位。
## image.png

## 删除货架
选中货架，点击【-】，将删除被选中的货架。
## image.png
