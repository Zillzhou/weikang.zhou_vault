# 线性堆栈场景 SOP

## 线性堆栈场景 SOP

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

## 应用场景说明

## 场景要素序号

## 场景要素

## 场景说明

## 备注说明（可以含图示）

## 1

## 场景车辆说明

CBD15 搬运车*1 ，平面式搬运，货叉起升离地高度 205mm
## 车辆配置
叉尖避障：2d 激光，如蓝海激光；
导航激光 free + 避障激光 free；
3D 避障：大疆 mid70；
3D 识别相机：图漾 FM851；

## image.png

## 2

## 场地布局说明

## 放货通道
在长通道上作为搬运车的放货区，需要通过搬运车将货物运送到此区域
## 放货点
通道内的栈板随时被人工取走，没有固定的放货点，需要搬运车根据通道的栈板情况进行放货。即如果是空通道，则放在最里侧的 AP 点，如果有栈板存在，则放货在栈板外侧。
## 载具：蓝色塑料川字托盘

## 3

## 业务场景功能实现说明

## 搬运车取完货后前往线性堆栈区放货
### 如果通道上没有其他栈板，那么搬运车直接前往 AP 点放货
如果通道上有其他栈板，搬运车通过叉尖的 2D 激光判断扫面范围内是否存在物体。
如果激光在 0.5m 范围内检测到物体，且 3s 内没有移除，那么认为该物体是栈板，搬运车就地进行放货，任务完成；
如果 3s 内物体移除，那么认为该物体不是栈板，搬运车继续进行往通道内行走，直到 AP 点放货，任务完成

    否   发送AP点的任务 是 放货 到达AP点 向AP点导航 否 是否遇到障碍物  机器人停下来    是 任务结束 障碍物3s未离开  机器人到达 LM 点
## 开机与联网
CBD15 的开机与联网与正向操作 SOP 相同，请见正向SOP第 2，3 节。
## 建图、站点配置
## slam 扫图
CBD15 的扫图方式请见正向SOP 第 4 节。
## 编辑地图
## 点击启用编辑，进入地图编辑界面
## image.png

## 地图区域设置
## ①点击区域
## ②选择区域
## ③在线性堆栈区画出对应的放货区
## image.png

## 点击图①，在右侧描述处描述此区域
## image.png

## 站点设置
## 放货区前方设置 LM 点
## 在左侧点击①站点
## 选择上方②站点
在对应③处放货点点击，作为 LM 点。
## image.png

设置 LM 点的角度，使车体倒退进入放货区放货，步骤：点击①，在②处设置角度
## image.png

将通道最里侧的放货点标记为 AP 点，具体步骤：点击①，选择②工作站，在对应放货点点击，作为 AP 点。
## image.png

设置 AP 点角度，点击 AP 点 ①，并在 ② 处勾选角度，设置角度
## image.png

### 点击①，选择三阶贝塞尔曲线②，连接 AP 点与 LM 点
## image.png

设置线路方向，点击线路①，设置 LM 至 AP 点为倒走，AP 点到 LM 点为正走
## image.png

## image.png

## 库位配置
### 在编辑地图左侧点击库位，在 AP 点附近画一个库位
## image.png

点击库位 ①，在右侧 ② 处填写绑定的站点名，演示地图为 AP72 。
## image.png

## 保存推送地图
## 点击保存地图
## image.png

## 退出编辑
## image.png

在弹框处选择推送地图，重定位成功。
## image.png

## 脚本配置
## 进入机构脚本页面
## 进入【机构脚本】页面
点击【刷新】；
点击【下载】，从机器人控制器下载脚本最新版本。
1709639325273-d277253a-807a-494c-9c83-eda8b5e9463c.png

## 导入脚本
## 脚本资源下载

## cbd15.py
## 导入脚本
1709639635265-937b522c-0835-4b7e-9c9d-a7039da785bd.png

## 选择对应的脚本文件
## image.png

## 右击脚本文件，点击推送
## image.png

## 脚本图标变绿即推送成功
## image.png

## 使用任务链
## 新建任务链
## 在任务链界面点击①新建
## 点击②新建任务
## 点击③添加组
## 在左侧④处选择自定义动作
## image.png

## 将自定义动作拖拉至组处
## image.png

## 添加脚本动作
双击自定义动作块，在弹框①处选择触发脚本动作，将 json 复制到②处，点击③确认。
## image.png

## 任务链 json：
## {
    "id": "AP72",
    "operation": "Script",
## "script_args": {
### "operation":"linear_unload"
    },
    "script_name": "syspy/triggleScript.py",
## "script_stage": 3
## }
## 设置库位键值
启用编辑地图，点击库位①，在②处点击编辑，③处点击添加。
## image.png

### 键输入 unload，值输入上一步的 json 值，点确定
## image.png

## 继续确定
## image.png

## 保存并推送地图
## 测试
勾选任务①，需要执行的动作组②，点击发送任务③，机器人执行堆放任务
## image.png

### 没有障碍物时，机器人走到 AP72 执行放货动作，任务结束
## 遇到障碍物，机器人立即停止
### 障碍物 3s 没有离开，机器人开始放货，任务结束
## 障碍物 3s 内离开，机器人继续行走
## loop2-4，直至到达 AP 点放货
## 使用 RDS
完成单机测试后，可在 RDS 系统内使用天风任务调用机器人执行库位取放货。
注意：此部分内容需先将机器人添加至调度场景中。
## 新建天风任务
打开 RDS 网页端，并进入天风任务；
点击【定义新任务】；
在弹窗中输入任务名称；
点击【确定】；
完成新建任务后，点击【编辑】，进入任务编辑页面。
1709533824000-8905b9cd-0fc6-4412-bff1-f7c6835cdce1.png

1709533823939-4ed63077-3082-4650-a84a-b49b30861743.png

## 选择执行任务的机器人
## 添加机器人通用动作
点击【机器人调度】；
拖拽【选择执行机器人】至右侧任务窗口；
拖拽【机器人通用动作】至右侧任务窗口；
输入执行任务的机器人名称；
设定关键路径；
输入目标库位，如 Loc-1；
设置指令内容：选择 bintask；
设置指令参数：输入 unload。
1709533796999-3524eaa0-a0b9-47d4-9088-fd86f2fc3073.png

## 图 9.2 编辑天风任务
## 保存并运行天风任务
完成任务编辑后点击【保存】；
点击【运行】；
弹窗中点击【运行】确认下发任务。
机器人接收到调度下发的任务后会自动前往 Loc-1 库位放货。
1709533824043-7b2ac362-5352-4344-a7c2-9cd97d8c974c.png
