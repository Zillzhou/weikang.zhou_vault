# 仙工模块电池配置SOP

## 仙工模块电池配置SOP

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

车体动力单元分电池供电与充电两个部分。本文通过电池选型、电池配置、手动充电、与自动充电三个部分进行配置讲解。
## 电池配置
对电池配置前需要确认电池的规格按电气设计要求接好线，确保电池电量20%以上。
## 电池固件升级
一般电池供应商给出的是刷好固件版本的电池，如果遇到版本问题需要升级，可参考此文档。
## 工具准备
需要准备工具 can卡 x1 ，电池通讯线x1，电池调试上位机x1
## 通讯线制造办法如下：
1698917080670-ac49f127-1100-43cc-8add-39fa14bb2411.png

## 上位机下载链接
## 刷写固件
CAN卡连接电池通讯口， 打开上位机 BMS_CAN_ToolV1.5_C 
1698917181229-011f8e9c-5dca-465c-915a-c9f44bededa6.png

### 设置CAN通道，波特率设置为250K，点击打开CAN
注意：若CAN卡用的是通道1，则对应上位机的通道0；若CAN卡用的是通道2，则对应上位机的通道1；
1698917593138-e3a7f73b-0f9f-4796-9980-1900b38139ae.png

### 正确完成上述步骤后，上位机就能正常显示电池包信息
1698917735162-dc28438f-609b-4a59-9cae-0844aca64be4.png

点击“固件升级”，点击“打开固件”，选择要升级的Bin文件；
1701328491369-dff9de24-47aa-4af6-bf66-d80eee1a62e4.png

## 升级成功，如图显示
1701328530134-e63842c6-05d0-4e23-86c7-1d99a64803dc.png

电池固件升级过程中 电池会自动断电重启，所以车体如需在开机状态下升级，请保持车体是在手动充电或者自动充电状态下，防止出线整车掉电；
## 使用注意事项
开机情况下，主包和从包连接或者从包和从包连接时，请先插供电线，再连接信号线，防止产生火花；因为通讯线连接后，供电口就会有电压；
RBK最低支持版本：SRC2000 RBK3.4.5.22 SRC880&3000 RBK 3.4.5.32；
电池使用过程中建议至少每周满充一次，保证SOC的准确；
多包并联使用时，只有每个电池包电量一致时才能最大电流输出，如果不一致，只有最高电量的电池包可以最大电流输出
## 模型文件配置
在模型文件界面点击左侧电池battery，如图中①，在右侧启用电池设备如图中②，开始配置模型文件。
1710332380350-70282f3b-dac8-44a5-9fec-5cc0fc937d63.png

## can通讯配置
驱控单元时已启用 can2 第二路 can 线，配置波特率为250k。
1710332413192-be9451a8-cc5a-41c6-b5e6-c96704a78724.png

### 回到battery配置，配置对应的CAN port2
1710332346330-3ec05598-51b5-40db-b950-99295e242d6d.png

## 模型文件配置
## 模型文件参数如下图所示
1710332743810-54b8f064-1947-424e-a700-1698e2017caa.png

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## lowVoltage

## 模型文件-battery-basic

## V

## -1

## -1

## 100

### 3.3.4.20~latest

### 用于电池最低电压报警阈值，-1 默认不启用

### temperatureThreshold

## 模型文件-battery-basic

## 摄氏度

## -1

## -1

## 100

### 3.3.4.20~latest

### 温度报警限制，-1 默认不启用，单位摄氏度

## warningPercentage

## 模型文件-battery-basic

## V

## -1

## -1

## 100

### 3.3.4.20~latest

### 电池告警百分比 ， 用于指示电池低电量告警阈值

## errorPercentage

## 模型文件-battery-basic

## V

## -1

## -1

## 100

### 3.3.4.20~latest

### 电池错误百分比， 用于指示电池电量低于多少进行报错

## shutdownPercentage

## 模型文件-battery-basic

## %

## -1

## -1

## 100

### 3.3.4.20~latest

### 剩余电量低于多少百分比，执行关机命令，-1 表示不启用

## timeoutThrowError

## 模型文件-battery-basic

## s

## 3600

## -1

## 9999

### 3.3.4.20~latest

### 电池超时报警多久后会出现报错，-1 表示不报错

## quantityFilter

## 模型文件-battery-basic

## %

## 15

## 0

## 100

### 3.3.4.20~latest

## 电量滤波阈值

## shutdownStillTime

## 模型文件-battery-basic

## s

## 120

## 60

## 99999

### 3.3.4.20~latest

## shutdown 关机前维持的时间值

## 电池穿透脚本配置
在模型文件选择byNet2Can，并在scirptName 填写对应的电池脚本名。
1710333355335-260cfa67-fc82-48a2-af7e-d9745a749554.png

电池通用脚本已内置在src中，通过点击通用脚本界面查看。模块化电池通用脚本名为btCanPass_Greenway2.py
1710333510600-5ad3c46c-c34b-4551-9234-880c70e77f18.png

## 验证
保存推送模型文件后，没有battery timeout报错，且能正确读取电池数据，如下图。
1711014005464-241919d3-4418-4776-a975-2239e5e29478.png
