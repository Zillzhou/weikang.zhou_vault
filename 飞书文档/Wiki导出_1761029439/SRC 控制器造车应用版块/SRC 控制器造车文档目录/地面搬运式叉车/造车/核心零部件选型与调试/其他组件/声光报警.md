# 声光报警

## 声光报警

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

CBD15采用三色灯、蓝光灯、LED氛围灯、喇叭进行声光提示与报警。其中：
三色灯提示机器人的导航状态与错误状态，具体释义见 1. 三色灯；
蓝光灯作为cbd15行走示廓，DCDC供电，无需配置，车体上电后常亮；
LED氛围灯通过不同的颜色、状态提示机器人的运行状态、电量、错误等状态，具体释义请见 2. 氛围灯；
声音提示通过喇叭语音播报方式提示机器人的运行状态、电量、错误等状态，具体释义请见 3. 扬声器
## 三色灯
## 颜色说明
cbd15使用的三色灯对应的颜色为红、黄、绿三种颜色，红色灯亮时蜂鸣器同时蜂鸣。
## 三个颜色的定义为：
红灯亮的条件： 错误，严重错误数量任一大于0，或者低电量（告警码 54211，若勾选 is_except_battery 则忽略低电量情况）或者急停条件（告警码 54004，若勾选 exceptEMC 则忽视急停情况）
## 黄灯亮的条件： 导航状态不在运行中
## 绿灯亮的条件： 导航状态在运行中
注意：三者互斥，不存在同时亮灯的情况。
## 配置三色灯
确认1.1中描述的灯接线定义，填入下图的参数配置中。
1708952817956-1cc38e86-9c8f-48ed-a9c7-dfd0aa6412e8.png

## 三色灯参数定义如下：

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## redLightDO

## 模型文件-indicator-type

## —

## -1

## -1

## 79

## ~latest

红色灯 DO 序号,-1 代表不启用(可直接使用 TE35 P12 报警灯接口，H1.2.10及以后建议使用DO8 DO9)

## redLightFreq

## 模型文件-indicator-type

## s

## —

## 0

## 60

## ~latest

### 红色灯闪烁间隔时间，以秒为单位，最大为 60s

## redLightExceptEMC

## 模型文件-indicator-type

## —

## false

## —

## —

## ~latest

## 红色灯输出是否排除拍下急停情况

### redLightExceptBatteryLowWarn

## 模型文件-indicator-type

## —

## false

## —

## —

## ~latest

## 红色灯输出是否排除电池电量warn报警

## yellowLightDO

## 模型文件-indicator-type

## —

## -1

## -1

## 79

## ~latest

## 黄色灯 DO 序号,-1 代表不启用

## yellowLightFreq

## 模型文件-indicator-type

## s

## —

## 0

## 60

## ~latest

### 黄色灯闪烁间隔时间，以秒为单位，最大为 60s

## greenLightDO

## 模型文件-indicator-type

## —

## -1

## -1

## 79

## ~latest

## 绿色灯 DO 序号,-1 代表不启用

## greenLightFreq

## 模型文件-indicator-type

## s

## —

## 0

## 60

## ~latest

### 绿色灯闪烁间隔时间，以秒为单位，最大为 60s

## 验证
## 进行以下步骤判断功能正常：
## 打开红灯配置do，红灯亮且蜂鸣器蜂鸣
## 打开绿灯配置do，绿地亮
## 打开黄灯配置do，黄灯亮
## led灯带
## 灯带颜色说明
### 如使用仙工默认的灯语逻辑，氛围灯及显示效果为：
（1）机器人出错报警：红色呼吸；
（2）机器人急停：暗红色闪烁；
（3）机器人被阻挡：粉紫色跑马灯；
（4）机器人转向中：橙黄色闪烁（根据实际数量及方向）；
（5）机器人直行中：蓝色呼吸；
（6）机器人充电中：橙黄色呼吸；
（7）机器人低电量模式：暗红色跑马灯；
（8）机器人静止状态：显示电量，从绿色（剩余电量 100% ）至暗红色（剩余电量 10% ）渐变；
（9）电池类型未配置（或电池通讯出错）且机器人静止：彩虹灯带。
## 灯带配置文档参考： DMX512灯带
## 灯带程序烧写
一般灯带厂家发货可进行烧写程序，如需自己操作，可参考 灯带写码操作说明
## 灯带模型配置

1708952828299-02901c0f-450b-411a-8c36-4afb3c8aef26.png

（1）选择模型文件 led 设备，默认状态不启用，需要启用LED设备
1710339628255-49c67c3a-f740-4ea7-a012-b13aef8f6f0f.png

## 设备名称

## 参数位置

## 单位

## 默认值

## 列表

## 支持版本

## led

## 模型文件

## \

## 不启用

## \

### 3.3.4.20~latest

选择led设备。

（2）配置 brand 为 WST-SM16512PS-DMX512 。
1710339643794-20499d94-7481-4c3a-95ca-036e65a6640d.png

## 参数名称

## 参数位置

## 单位

## 默认值

## 列表

## 支持版本

## brand

## 模型文件-led

## \

### WST-SM16512PS-DMX512

WST-SM16512PS-DMX512（DMX512灯带）
## CMD4A2 （CMD4A2数码管）
### ZJ-LED-RGB-CTRL（ZJ-LED灯带）

### 3.3.4.20~latest

选择led设备的brand。

（3）配置灯带测试时的颜色参数：测试时需修改参数 DmxTestFlag 为 true ，正常使用时修改为 false ，且颜色参数可缺省。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## colorRed

## 模型文件-led-brand-
### WST-SM16512PS-DMX512

## \

## 0

## 0

## 255

### 3.3.4.20~latest

## 灯带红色的参数范围

## colorGreen

## 模型文件-led-brand-
### WST-SM16512PS-DMX512

## \

## 0

## 0

## 255

### 3.3.4.20~latest

## 灯带绿色的参数范围

## colorBlue

## 模型文件-led-brand-
### WST-SM16512PS-DMX512

## \

## 0

## 0

## 255

### 3.3.4.20~latest

## 灯带蓝色的参数范围

## colorWhite

## 模型文件-led-brand-
### WST-SM16512PS-DMX512

## \

## 0

## 0

## 255

### 3.3.4.20~latest

## 灯带白色的参数范围

（4）配置参数 showChanging ，勾选表示显示充电效果，不勾选表示不显示。
（5）配置参数 showBattery ，勾选表示显示电池效果，不勾选表示不显示。
（6）配置参数 turnLeftFrontPos ，是指左前转向灯组序号（ 6 灯珠/组）。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## turnLeftFrontPos

## 模型文件-led-brand-
### WST-SM16512PS-DMX512

## \

## 1

## 1

## 20

### 3.3.4.20~latest

左前转向灯组序号（ 6 灯珠/组）。

（7）配置参数 turnLeftFrontNum ，是指左前转向灯组数目（ 6 灯珠/组）。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## turnLeftFrontNum

## 模型文件-led-brand-
### WST-SM16512PS-DMX512

## \

## 0

## 0

## 20

### 3.3.4.20~latest

左前转向灯组数目（ 6 灯珠/组）。

（8）配置参数 turnLeftRearPos ，是指左后转向灯组序号（ 6 灯珠/组）。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## turnLeftRearPos

## 模型文件-led-brand-
### WST-SM16512PS-DMX512

## \

## 1

## 1

## 20

### 3.3.4.20~latest

左后转向灯组序号（ 6 灯珠/组）。

（9）配置参数 turnLeftRearNum ，是指左后转向灯组数目（ 6 灯珠/组）。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## turnLeftRearNum

## 模型文件-led-brand-
### WST-SM16512PS-DMX512

## \

## 0

## 0

## 20

### 3.3.4.20~latest

左后转向灯组数目（ 6 灯珠/组）。

（10）配置参数 turnRightFrontPos ，是指右前转向灯组序号（ 6 灯珠/组）。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## turnRightFrontPos

## 模型文件-led-brand-
### WST-SM16512PS-DMX512

## \

## 1

## 1

## 20

### 3.3.4.20~latest

右前转向灯组序号（ 6 灯珠/组）。

（11）配置参数 turnRightFrontNum ，是指右前转向灯组数目（ 6 灯珠/组）。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## turnRightFrontNum

## 模型文件-led-brand-
### WST-SM16512PS-DMX512

## \

## 0

## 0

## 20

### 3.3.4.20~latest

左前转向灯组序号（ 6 灯珠/组）。

（12）配置参数 turnRightRearPos ，是指右后转向灯组序号（ 6 灯珠/组）。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## turnRightRearPos

## 模型文件-led-brand-
### WST-SM16512PS-DMX512

## \

## 1

## 1

## 20

### 3.3.4.20~latest

右后转向灯组序号（ 6 灯珠/组）。

（13）配置参数 turnRightRearNum ，是指右后转向灯组数目（ 6 灯珠/组）。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## turnRightRearNum

## 模型文件-led-brand-
### WST-SM16512PS-DMX512

## \

## 0

## 0

## 20

### 3.3.4.20~latest

右后转向灯组数目（ 6 灯珠/组）。

（14）配置参数 lightTotalNum ，是指灯珠组数据量（ 6 灯珠/组）。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## lightTotalNum

## 模型文件-led-brand-
### WST-SM16512PS-DMX512

## \

## 0

## 0

## 20

### 3.3.4.20~latest

灯珠组数量（ 6 灯珠/组）。

## （15）配置灯带颜色通道顺序
redChannel ， greenChannel ， blueChannel ， whiteChannel 可以配置灯带通道顺序：
默认通道顺序 RWGB ：参数配置依次为 0 、2 、3 、1。
通道顺序 RGBW ：参数配置依次为 0 、1 、2 、3。
## 验证
## 1.参数 DmxTestFlag 配为 true
1677577486260-4313441d-6646-4242-ad48-1cbfc8ce8b4b.png

## 参数配置

## 现版本名称

## 单位

## 默认

## 解释

## 支持版本

## DmxTestFlag

## ——

## false

## 选择ture，可开启灯带测试

### 2.可以直接修改模型文件中 RGB 参数控制灯带发出对应颜色的光，可以参考网上 RGB 配色表进行调色验证
1677577516312-cd7ff0a4-88c2-4e20-887a-fc475cf6f13e.png

进行2.1的操作，观察每个运动状态对应的灯带表现。
## 扬声器
### cbd扬声器选择扬声器与功放线，型号如下：

## 品牌

## 型号

## 接口

## 推荐程度

## 百为

## BY-102-3W

### 3.5mm音频

## 推荐
默认播放导航中、后退、左转、右转、低电量、被阻挡、发生碰撞、出现错误等情况的语音。
出厂自带默认的语音包，如果需要自定义，可准备.wav格式音频文件。
## 上传音频文件
音频文件管理界面可通过点击①其他，②音频管理打开，如下图。
1710340348800-b0378b37-7091-4fa2-87aa-53b153d8cb44.png

点击"下载"可得到已有音频文件，"打开文件目录"打开已下载音频目录。
点击"上传"上传自定义音频文件，格式需要是.wav文件。
1710340411870-10392178-a0ae-4203-ab68-80fe462df195.png

## 调节音量大小
## 点击下图的①高级配置，弹出高级配置
点击②音频管理。
## 拖动③选择适当的音量
点击④设置保存音量。
1710340122626-3e7e9941-7eea-4de8-bd16-441e9ed2551d.png

## 模型文件
## 模型文件截图如下：
1708952850090-1a48f81d-cdf5-4dff-bcef-0096dbaad5a3.png

选用模型文件中 soundplayer 来配置音频。

## 参数名称

## 参数位置

## 单位

## 列表

## 支持版本

## soundplayer

## 模型文件

## \

## \

### 3.3.4.20~latest

### 用来控制agv在不同的状态播放相应的音频

可支持配置的状态有：开始执行任务、倒车、遇到障碍物、原地旋转、低电池电量、阻挡、错误。
配置 soundplayer 的 navigation ，只需要将文件写入即可，无需加入后缀。

## 参数名称

## 参数位置

## 单位

## 文件名称

## 最小值

## 最大值

## 支持版本

## navigation

## 模型文件-
## soundplayer-basic

## \

## \

## \

### 3.3.4.20~latest

## 表示执行任务时的音频文件

配置 soundplayer 的 navigationAheadTime 。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## navigationAheadTime

## 模型文件-
## soundplayer-basic

## s

## 0

## 0

## 100000

### 3.3.4.20~latest

## 表示执行任务前多长时间开始播放音频

配置 soundplayer 的 navigationLoop ，勾选时表示执行任务过程中是否要循环播放音频。
配置 soundplayer 的 astern ，只需要将文件写入即可。

## 参数名称

## 参数位置

## 单位

## 文件名称

## 最小值

## 最大值

## 支持版本

## astern

## 模型文件-
## soundplayer-basic

## \

## \

## \

### 3.3.4.20~latest

## 表示倒车运行时的音频

配置 soundplayer 的 turnleft ，只需要将文件写入即可。

## 参数名称

## 参数位置

## 单位

## 文件名称

## 最小值

## 最大值

## 支持版本

## turnleft

## 模型文件-
## soundplayer-basic

## \

## \

## \

### 3.3.4.20~latest

## 表示原地左转时的音频

配置 soundplayer 的 turnright ，只需要将文件写入即可。

## 参数名称

## 参数位置

## 单位

## 文件名称

## 最小值

## 最大值

## 支持版本

## turnright

## 模型文件-
## soundplayer-basic

## \

## \

## \

### 3.3.4.20~latest

## 表示原地右转时的音频

配置 soundplayer 的 block ，只需要将文件写入即可。

## 参数名称

## 参数位置

## 单位

## 文件名称

## 最小值

## 最大值

## 支持版本

## block

## 模型文件-
## soundplayer-basic

## \

## \

## \

### 3.3.4.20~latest

## 表示阻挡时的音频

配置 soundplayer 的 lowBattery ，只需要将文件写入即可。

## 参数名称

## 参数位置

## 单位

## 文件名称

## 最小值

## 最大值

## 支持版本

## lowBattery

## 模型文件-
## soundplayer-basic

## \

## \

## \

### 3.3.4.20~latest

## 表示低电量时的音频

配置 soundplayer 的 error ，只需要将文件写入即可。

## 参数名称

## 参数位置

## 单位

## 文件名称

## 最小值

## 最大值

## 支持版本

## error

## 模型文件-
## soundplayer-basic

## \

## \

## \

### 3.3.4.20~latest

## 表示报错时的音频

配置 soundplayer 的 collision ，只需要将文件写入即可。

## 参数名称

## 参数位置

## 单位

## 文件名称

## 最小值

## 最大值

## 支持版本

## collision

## 模型文件-
## soundplayer-basic

## \

## \

## \

### 3.3.4.20~latest

## 表示碰撞条触发时的音频

配置 soundplayer 的 openSound ，勾选时控制是否播放音频。
配置 soundplayer 的 useErrorCode ，勾选时表示在报错时，是否报对应错误码特殊的音频。
## 验证
分别点击① ② ，弹出音频管理界面。
1710340348800-b0378b37-7091-4fa2-87aa-53b153d8cb44.png

## 选中播放的音频，点击播放，正常播放即可
1711020703399-753563ce-cb0f-44de-89a8-7c384a73c97b.png
