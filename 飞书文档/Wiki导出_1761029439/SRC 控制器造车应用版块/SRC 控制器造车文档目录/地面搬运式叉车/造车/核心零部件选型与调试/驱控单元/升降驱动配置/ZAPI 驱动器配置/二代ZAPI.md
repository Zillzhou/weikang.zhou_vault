# 二代ZAPI

## 二代ZAPI

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

## 调试资源
### ZAPI 行走配置按 SOP 配置完成二代ZAPI
## 确保 ZAPI 驱动器如下图完成接线
## image.png

## 调试工具
一般出厂时刷仙工特定程序和参数即可，不需要额外刷，涉及到调试时需要准备以下工具
## image.png

## 上位机配置
### zapi 上位机配置请见ZAPI驱动器-ACECOMBIX
## motor 模型文件配置
### 点开右侧① motor 处，在左侧②配置参数
## image.png

### 在 canPort 启用控制器器上的两路 can
1709806037496-ec05a055-5ba9-4c47-b4c2-ac387588e33b.png

在左侧 CanID 配置 ZAPI 里设置的行走驱动 canID，在 canPort 处配置驱动器所在的控制器 can 线上。
## image.png

在 brand 处选择品牌协议：ZAPI-AceCOMBX-SEER-CBD
## image.png

### 配置驱动器属性参数，如位置、编码器、转速等
### x: 右手坐标系下的 x 位置，如小车模型中坐标
### y: 右手坐标系下的 y 位置，如小车模型中坐标
### z: 右手坐标系下的 z 位置，如小车模型中坐标
### yaw: 右手坐标系下朝向角，右手坐标系下的 x 位置
### maxRPM: 是指电机的最大转速，请根据实际情况进行填写
inverse: 驱动器是否反向，勾选则为反向，不勾选则为正向。请根据实际情况进行勾选
### Func: 根据电机功能选择行走功能 linear
### reductionRatio: 请根据实际情况进行填写
### minimumspeed: 请根据实际情况进行填写
### encoderLine： 请根据升降电机实际情况进行填写
## image.png

## image.png

升降由于是 DO 泵控，不带编码器反馈，所以需要有上下限位，如果接入 zapi 驱动器则不需要配置，如果接入 SRC，上下限位配置如下如下图
## image.png

### 企业微信截图_17191983148226.png

## fork 模型文件配置
在模型文件左侧找到 fork 项，对 fork 参数进行配置
## image.png

## basic 基础参数
## 模型文件如下图所示：
## image.png

## 具体参数含义解释如下：

### forkBlockRegion：货物扣除区域
## 对应的参数区域如下图所示：
当 AGV 叉车抬起货叉的时候，叉车的架子会遮挡一部分激光。需要用扣除区域将这部分激光去除，防止碰撞检测误触发。一般与 block laser 同时使用。因此搬运车无需启用这个参数。
Ps5QbMCV8oOPpHx8xrYcdTEmnnh.webp

## 具体参数含义解释如下：

## forkTailDi: 货叉尖端 DI
在叉车叉货时其货叉尖端传感器可能会被栈板触发，报阻挡，因此导致无法取货。可以在模型文件中配置货叉尖端 DI，可以指定载货，卸货时是否启用，是否自动清楚错误等功能。
如果没有 di 型叉尖传感器，则填"-1"不启用。因此 cbd15 不启用
FHtsbLXBxoqdrOxvG9scWCGfnzh.png

## 具体参数含义解释如下：

forkTailDistanceNode: 货叉尖端测距型传感器
在执行 ForkLoad 任务时可能导致距离传感器会误触发阻挡。通过在模型文件的配置叉尖距离传感器 （distanceNodeId） 的 id 后，在载货的过程中会屏蔽该传感器。
## 截图如下所示
OPEWbvvY6oE5M5xJWZxc8bU3nfd.png

不过，大部分情况下为了依旧有检测障碍物的能力，但是不被栈板误触发，我们不屏蔽距离传感器，但是把载货时的碰撞检测距离缩短，这也可以通过配置模型文件实现。
## 具体参数含义解释如下：

## BackLaser: 后避障激光
参数截图如下图所示，搬运车起升高度有限，一般不在叉齿根部装后避障激光，所以填写"-1"不启用，即可。
NfWwbXSngorJBux5p87c1YZfnlf.png

## weight:超重检测
## 参数截图如下图所示：
当叉车在抬升的过程中如果叉车检测的重量持续一段时间超过最大重量，则报错 52170。
## 参数释义如下：

## type: 货叉类型
## 参数截图如下：
TEgWbOP03owhcTxfshEcDMnInY1.png

cbd15 起升后货叉距离地面高度 0.205m，且上升由是泵控电机执行、下降是阀控制，不带编码器的高度、速度反馈，控制器仅返回到位信号，因此货叉上升下降为开环运动。
为了避免叉车导航过程中，货叉突然下降，导致的危险情况。当货叉到位后，当货叉下降持续时间小于 maxHeightBiasTime，且货叉高度发生变化范围大于maxHeightBias后，会报错 52171。 由于有报错机器人无法导航，或者继续运行。
## 具体参数解释

## 验证
## 控制货叉上升下降，可正常控制
