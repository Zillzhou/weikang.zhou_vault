# 正向操作SOP

## 正向操作SOP

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.6.11

## 初版

## 使用中

## 场景说明
由于是讲述车体的使用操作 SOP， 所以会涉及到什么样场景下的 SOP 实现，我们可以通过 如下表格的关键信息对此场景下的 SOP 实现做一定的说明，具体现场的实施可以参考该篇文档进行实施和部署。
## 应用场景说明

## 序号

## 场景要素

## 场景说明

## 备注说明（可以含图示）

## 1

## 使用车辆说明

## 1.车辆地盘运行模型为 AMB300/AMB150 双轮差速+ 辊筒上装；

## image.png

## 路径设计标准
根据使用条件和现场环境，设计移动机器人的行驶路径，并确定充电系统（充电桩）、外围设备、现场操作站等的位置。应充分考虑车体尺寸、驱动方式、执行机构动作方式及运行环境条件等，确保移动机器人在运行时，与周边的物体无干涉现象发生。在路径设计中应该考虑以下因素： 
a）停靠点（PP）、充点电（CP）、动作点（AP）、途经点（LM）； 
b）操作站台、充电桩、外围设备等； 
c）运行速度； 
d）公共区域、限制区域、危险区域划分。
## 开机
按下开机按钮。
直至绿色开机指示灯常亮，松开开机按钮，完成开机过程。此时氛围灯、激光均点亮。
## 有线连接
完成开机后，需要对机器人进行检查，查看是否一切正常。操作机器人需要使用最新版Roboshop。
使用网线连接机器人，网线一头插在机器人控制器的连接网口上，另一头插在笔记本的以太网口上。连上后将响应以太网 IP 地址更改为 192.168.192.xx （xxx 需大于 200）网段，子网掩码 255.255.255.0，网关可省略。
注意：AMR 默认 IP 地址为 192.168.192.5。
1684983702415-aed69d0c-24b4-4793-908c-8e7f009f8143.png

 连接上机器人后，打开 Roboshop 软件，点击右上角添加服务按钮，输入控制器默认 IP 地址：192.168.192.5 ，进行机器人添加。注意：如机器人内置了第三方网络客户端，所以若需配置无线 IP，需要参考相关文档进行配置。
## image.png

在【首页】的机器人列表中找到 IP 地址为【192.168.192.5】的机器人点击【开始连接】按钮进行连接。

## image.png

等待机器人标签页中显示机器人的“置信度”、“网络延时”、“地图”、“名称”、“备注（若有）”等信息时，表明连接成功。
## image.png

## 建图
确认机器人无异常后，可开始对所需要的作业区域进行扫图。
回到地图主界面点击【2D 建图】, 选择【在线建图】，如现场使用了反光板/反光柱做辅助定位，需勾选反光板选项，并选择辅助定位方式，然后可开始扫图。通过笔记本电脑键盘上的 "W、A、S、D" 来操控车辆行走，并对所需要的作业区域进行闭环式扫图（扫出来的地图和机器人行走的路线一定要形成一个闭环）。
当场景较小时，建议扫图前将手动控制最大速度设置为0.5m/s，方便扫图时控制小车行驶轨迹。
1709622174695-b2332a21-8fb4-4b46-a175-abc09add6b0f.png

## 进入建图操作页面
根据图示步骤执行。
1709620548217-b66644fb-9487-4235-a54c-d0ae56ecff5f.png

## 设置激光建图参数
根据实际需求填写激光建图参数，一般采用默认参数即可。本次场景中采用无反激光slam导航，所以无需勾选反光板。
1709620887223-bf391435-8446-4ea8-9859-5529481e97b2.png

## 建图
完成建图参数配置后，通过笔记本电脑键盘上的 "W、A、S、D" 来操控车辆行走，并对所需要的作业区域进行闭环式扫图。对于较小的场景来说，建图的过程比较随意，只需保证扫出来的地图和机器人行走的路线一定要形成一个闭环即可，如下图所示。
1709622899824-4d1e3cf1-94fe-45a9-9c5d-262c70d2a311.png

当场景比较大的时候，建图的过程就需要一些策略。
控制车辆走“回”字；
1651916711444-c7c8557a-1545-44f6-8ceb-1c0942b7bfa9.png

先整体构建场景轮廓，再逐个房间完善；
1651916358346-a75e1ace-7fb5-4a44-b214-dd975885a665.png

## 保存与推送地图
完成闭环扫图后，对扫描完成的点云地图进行保存，操作步骤如下图所示，可以根据实际需求对地图进行重命名。
1709624146528-bb8cb428-dd01-4daa-a7bf-8d056f15b6b0.png

打开刚刚保存在本地的地图。
1709624481181-8ab6b63a-2603-4343-919b-e77aba32c160.png

将刚刚新建的地图推送至控制器端。
1709624619279-cc016604-a81e-462b-ac3b-ddda500b402c.png

## 重定位
完成新建地图的保存和推送后，需要对机器人在地图中的位置进行确认和重定位。首先对当前机器人位置进行确认，然后需要进行重定位。
1709625015217-0a0d880b-6a57-4f4e-a804-189a07865bbe.png

重定位功能可以按住鼠标左键不放，然后拖动圆圈来选择定位所需要参照的范围大小，也可不选择。重定位完成后需要再次查看当前车辆在地图中位置的置信区间。如果对定位导航精度有要求的场景，一般置信区间大于0.8，说明位置可信度高。若受限于环境，只要能导航即可，置信度可以为0.5——0.8之间。
1709627045839-94720a58-598b-4969-8e26-48e8035fe3a5.png

## 建图过程操作视频

## 建图过程操作视频.mp4
## 路径导航及停障验证
预置条件：地图上至少存在两个站点且其通过贝塞尔曲线进行连接。
机器人在线路上进行路径导航：点击模块工具栏中的【路径导航】，然后点击一个站点，如点击 LM2 点，机器人会进行路径导航沿着线路运行到目标点（LM2 点），且机器人到点的朝向与站点朝向一致，如下图所示。
## image.png

说明：线路存在障碍物，机器人导航过程中会在障碍物前停止，直到障碍物消失之后才会继续运行，且在状态栏中显示阻挡原因。
## image.png

## 机器人充电
AMB出厂电池可使用4-5小时，之后需要进行充电。请使用原装充电器，具体充电步骤如下：
打开手动充电口的红色防护罩。
## image.png

将充电器连接至机器人的手动充电口和电源插座。
## image.png

充电完成大约需3小时，完成后请将防护罩恢复关闭状态。

## 注意
机器人正常使用过程中，每个月至少给电池进行一次满充充电，使SOC进行一次准确度校准。
为避免快速放电和电池耗尽，建议在使用充电器充电时关闭机器人。
如果使用同一个充电器依次为两台机器人充电，请在第一台机器人充电完成后等待一分钟，然后再为第二台机器人充电，以确保充电器能够正确识别第二台机器人。
请使用原装充电器。
## 机构脚本
如叉车需使用机构脚本控制叉臂运动，或其他功能需通过机构脚本实现，参考以下操作。
## 进入机构脚本页面
## 进入【机构脚本】页面
点击【刷新】；
点击【下载】，从机器人控制器下载脚本最新版本。
1709639325273-d277253a-807a-494c-9c83-eda8b5e9463c.png

## 图 10.1 进入机构脚本页面
## 导入/新建
## 导入脚本：
在左侧空白处或指定文件夹，【右键单击】在弹出的操作按钮中选择【导入文件】
在弹窗中选择待导入的 .py 文件，打开完成脚本导入。
1709639635265-937b522c-0835-4b7e-9c9d-a7039da785bd.png

## 图 10.2a 导入脚本
1709639741449-317172e6-cf61-4433-9d4d-8e3f64da84af.png

## 图 10.2b 导入脚本
## 新建脚本
在左侧空白处或指定文件夹，【右键单击】在弹出的操作按钮中选择【新建文件】;
选中新建的脚本，可在窗口中间的空白区域输入脚本内容。
1709639589655-d2a9f184-ea3c-4021-ad6e-a9c51d3321d8.png

## 图 10.3a 新建脚本
1709639869812-42a1a5dc-7020-4978-8775-8d2c22a5be8b.png

## 图 10.3b 新建脚本
## 推送及执行
右键选中脚本；
选择【推送】，将脚本推送至机器人；
点击开始按钮，在弹窗中选择或输入脚本参数，点击【确定】开始执行脚本。
1709639969381-6d83fb14-5cce-447d-a3b2-8e3cff802ee0.png

## 图 10.4a 推送及执行脚本
1709640065638-d8544804-9416-4484-af47-2b8810df54bf.png 
