# 后置激光识别栈板配置

## 后置激光识别栈板配置

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

## 功能介绍
仙工智能不仅可以使用3d相机来识别栈板，实现精准插取，还可以使用后置激光雷达来识别栈板进行定位。如下图所示。
1673250436489-7b1024ec-b6b8-494e-b263-243c71279019.jpeg

## 图 1.1 后置激光
## 使用说明
使用形状识别栈板和3d相机识别栈板共用同一个识别文件，在原先的识别文件的基础上新加部分参数。当选择backLaser之后，系统会通过后激光来进行栈板识别。同时根据rec_sensor_id来选择特定的激光雷达数据，id由模型文件配置得到：
1673250724988-8d077e03-637c-4a75-a55b-414366d2c56d.png

## 图 2.1 后置激光 id
## 下图为pallet的识别文件：
1677058699097-81a7ba71-9703-4835-b37e-7794d1086521.png

## 图 2.2a 识别文件参数说明
1677058679435-1eb9497c-5174-41f7-9391-3f9cf9b8ada0.png

## 图 2.2b 识别文件参数说明
注意：仙工智能提供三种栈板识别方式，分别为3D相机识别、后激光识别和叉尖激光识别，这里需要选择后激光识别的方式，并配置激光雷达IP。
且目前只支持如上图两种类型的栈板，即pocket_spacing不为0，后续会开放支持pocket_spacing为0情况下识别。（已支持）
1677129711324-c5f347ac-2448-400e-b255-9915afbac805.png

## 图 2.3a 选择 backLaser
1677129725366-9381f848-6a5e-4fa4-a71f-79053de64ab2.png

## 图 2.3b 选择 backLaser
识别文件的参数需要按照栈板的尺寸进行配置。
## 注意事项
## 首先要确定激光雷达是否能否扫描到栈板
如下图所示，激光雷达要能够清楚的扫描到栈板前方的三块（目前仅支持川字型栈板和田字型栈板）
1673251287430-075906f9-b3fd-4e24-b745-e536e0d27d4b.png

## 图 3.1 识别位置
1673250888197-03adb57e-fbe1-484b-be06-0af04833a04c.png

## 图 3.2 点云
注意： 一般来说激光安装角度很可能看不到栈板关键点的情况，需要通过叠高激光或者调整激光的安装倾斜角度，确保激光能够清楚扫到栈板前方的3块
### 确定后激光雷达的模型文件中step参数配置
如使用后激光进行识别，需要将该激光的step修改为0.1.
1673250908499-efdd59f6-1138-4d0f-baac-bf8106def070.png

## 图 3.3 修改 step
## 修改识别参数
修改参数：ValidLegRangeThesh，该值确定着激光雷达的识别范围，在车体坐标系下x方向的最远距离。如果车型为CDD14车型，使用后激光进行识别，该值应为负值，具体多少需要根据现场环境确定。
ValidShapeBias，该值一般为默认值0.2，代表着在车体坐标系下激光雷达识别的y范围。
1673252032937-f6895e41-9840-47b5-b5d0-021ccbf70681.png

## 图 3.4 修改识别文件参数
具体数值需要根据现场进行修改。
## 激光外参
由于使用的是后激光，在标定外参的时候不是很方便，可以根据识别结果进行手动调整。一般只需要调整yaw即可。
## 识别结果
识别结果会以图片的方式保存到segmentation目录下。
1673252470183-27acbe29-6fc7-43b9-975f-1633df50fbe1.png

## 图 4.1 识别结果
如上图所示，白色为激光扫描点，绿色为候选点，红色为识别到的目标点，可以根据识别结果图片判断识别是否正确。
