# 驱动器 FAQ

## 驱动器 FAQ

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

## 行走电机问题排查流程
## 前言
文中涉及到的其他详细说明或问题在附录中可以找到跳转链接，如《驱动器行为列表》
## 流程
在检查行走电机问题排查之前， 请先检查驱动器的配置是否正确 ，请参照附录 2《驱动器配置》中相关配置说明

找相关项目经理或者产品经理核实机器人motor的实际参数，按照模型文件配置说明，检查 确认模型文件motor的配置是否正确
## 请参照附录 2 《motor参数说明》
1653882586747-7977e21e-99b5-448e-82e1-763253daa5b7.png

## 1.1 确认x，y配置是否按照机械原理图中标注的参数，如果此参数配置错误会导致机器人运动异常；
## 1.2 确认canID配置是否和驱动器内部设置是否正确，如果此参数配置错误会导致机器人报错：motor timeout；
【注意：叉车类 curtis驱动器系统的模型文件walk motor的canID应当配置为1，steer Motor 的canID应当配置为2，若配置错误，请查找附录1-1】
## 1.3 确认motor的encoderLine （编码器线数）配置是否正确，如果此参数配置错误导致机器人平动数据异常；
## 例子：请查找附录 1-2
## 1.4 确认机器人的wheelRadius、reductionRatio配置是否正确，如果此参数配置错误导致机器人平动数据数据异常；
## 1.5 确认模型文件中的电机品牌以及机器人实际安装的驱动器品牌是否正确，如果此参数配置错误会导致机器人报错“motor timeout；
## 例子：请查找附录 1-3
1653882593871-5f32495a-0725-461b-b8ec-470947fe7c71.png

具体电机品牌和驱动器对照请参照模型文件配置说明。
## 进行平动转动测试
如1检查模型文件配置正确之后， 注意检查roboshop中有无机器人报错，若有报错，请 参照3报错情况分析 一章节所描述进行检查；若无报错，可进行平动转动测试，测试步骤如下：
2.1 机器人在地面上面设置一个参照位置，打开roboshop中平动转动，设置一个平动的距离和平动的速度（在平动距离里面不要有障碍物，注意车辆和人员安全，平动的速度请勿设置太大）。
a. 检查机器人在平动过程中的运动状态是否正常，如果发现行走电机抖动，车辆寸动的现象，请参照附录1-4 的解决办法，若为其他品牌的驱动器可按照4 检查驱动器的标准参数，检查电机的死区速度配置是否太大；
b. 检查机器人在平动过程中电机是否存在异响，如果发现行走电机异响，请参照附录1-5 的解决办法；
c. 检查roboshop上面是否有驱动器报错现场产生，若有请参照4 节所描述的方法解决；
d. 确保机器人在平动过程中自然、无异常情况出现；
e. 平动时车子走歪，删除标定数据后重新标定；
### 2.2 当机器人导航完成之后，用卷尺测量标记位置到机器人导航的距离记录为L；
2.3 如果测量的L值和通过roboshop下发的平动距离相同，则是正常；如果测量的L值和下发的平动距离不相同，请按照 1 中描述检查模型文件中的 encoderLine 、 wheelRadius、reductionRatio配置是否正确，核实清楚之后更新模型文件，进行2.1 、2.2 步骤的操作，验证参数是否正确。
### 3.  确定模型文件配置正确和平动转动测试正确，进行标定
## 标定过程参照附录 2《标定》
### 3.1 若是在标定过程中发生报错，检查控制报错情况，参照4 控制报错相关检查方法。
### 3.2 标定正常之后，可进行重复到位精度测试等流程。
### 4.  控制器报错
### 4.1 检查控制报错情况，如果出现 电机连接超时 ， 请参照附录 1-5 的解决办法 。
如果是与 motor无关的其他报错，请查阅roboshop报错码解析，查找对应解决办法。
### 4.2 若是发现在roboshop上面发现有驱动器相关的报错，应当对应驱动器的品牌找到对应的报错码，针对相应的驱动器报错码分析驱动器报错的原因。
请参照附录 2 驱动器行为列表，对照5 检查驱动相关报错。

### 5.  如上大部分情况均执行正常（ 已正常使用一段时间 ），突然出现如下问题，一般为硬件损坏等原因，不需要找研发确认代码。

### 5.1 电机过流
## 如果发现驱动器报电机过流问题：
（1）  先检查一下行走电机有机械干涉或者地面有障碍物导致电机堵转引起的过流，请相关人员排查现场实际情况，请参照附录 1-8；
（2）  若行走驱动器有抱闸，建议检查控制抱闸的情况，如果是因为抱闸问题导致的过流问题产生，请联系供应商更换抱闸，如驱动器为 curtis-1232E-Ruibote，请参照附录1-12；
### （3）  若无机械干涉、地面障碍物、无抱闸
若是步科类型驱动器，请联系研发同事确认是否因为电机转速和扭矩不匹配导致电机过流，请联系产品经理更换驱动器和电机，请参照附录 1-13；
若是科蒂斯类型驱动器，按照（ 4）检查行走电机编码器是否存在故障
（4）  行走电机编码器存在故障，联系供应商更换编码器，请参照附录 1-11；

### 5.2 心跳包超时
（ 1）如果为步科驱动器-步科转向电机，参照附录1-7 问题解决办法；

### 5.3 电机转子故障
 （ 1）如果为HSL驱动器-HSL轮毂电机（一拖二）则为电机故障，联系售后更换电机，参照附录1-6 ；

### 5.4 驱动器无法解决的报错
（ 1）若驱动器为curtis-1298-Seer，报错0x92，此报错为驱动器供应商无法解决的报错，通过配置Trriger报错时重启驱动器，请参照附录1-9；
（ 2）若驱动器为curtis-1232-Triwin，在充电的时候报错0x52，此报错为驱动器供应商无法解决的报错，告知客户即可，请参照附录1-10；

### 5.5 电机堵转
电机堵转和电机过流这两种问题有很大的关联性，一般情况下是因为行走电机堵转造成过流现象的产生，但是这两种报错在不同的驱动器有不一样的定义，故分析电机堵转的时候，请先分析
（1）  先检查一下行走电机有机械干涉或者地面有障碍物导致电机堵转，请参照附录 1-14
（2）  若行走驱动器有抱闸，建议检查控制抱闸的情况，如果是因为抱闸问题导致电机堵转的问题出现。
### （3）  检查行走电机编码器是否存在故障
若驱动器为 curtis-1298-Seer，报错0x73，此报错是电机刚开始动的时候电流过高，行走电机编码器数据受到干扰或者行走电机编码器损坏导致报错。请参照附录1-11
建议客户更换行走电机编码器。

### 5.6 驱动器电流过大、行走速度反馈异常
如果发现电流过大 【要明白正常行走的情况的电流值，如果没有相关经验可以询问驱动器供应商】 ，但没有报驱动器过流，下发的行走的速度和反馈的行走速度相差很大的情况：
（1）  先检查一下行走电机有机械干涉或者地面有障碍物导致电机堵转
### （2）  检查行走电机编码器接线是否有故障
（3）  检查行走电机 UVW三相线接线是否正确，请参照附录 1-15

## 附录 1
## 出现电机连接超时的解决步骤：
### （1）  检查模型文件中 motor brand的配置
（2）  按照电气原理图检查 motor 的canport的配置
（3）  检查模型文件 can中baudrate 配置是否和驱动器参数中baudrate配置相同。
（4）  按照电气原理图接线检查接线是否正确。
（5）  按照对应的驱动器配置文档，检查相应的驱动器参数是否正确。
如 上之前情况均执行正常（ 已正常使用一段时间 ），突然出现问题 5，一般为硬件损坏等原因，不需要找研发确认代码。
（ 6）请检查上述步骤之后，仍不能恢复，需要检查控制器相应的can口是否正常，联系售后。

## 舵角电机问题排查
## 前言
文中涉及到的其他详细说明或问题在附录中可以找到跳转链接，如《驱动器行为列表》
## 流程
和舵机 供应商 确认舵角 执行范围（正负极限多少，+-120之类） 、转向电机编码器是 增量式 还是 绝对值 类型
舵机 安装机械正前方 是否和 车体正前方 （右手坐标系x正方向）平行且同向（反向的话会和行走的正反向关联在一起比较难理解，建议同向安装）
如果是增量式编码器，检查模型文件steer电机resetMode配置为 byDriver ，控制器上电后不久，转向电机会转至零位、左限位、右限位（可查看附录2《驱动器行为列表》中 标零位置， 该过程称为驱动器标零）
若未有该动作，则检查驱动器相关 标零设置 （见指导书或询问供应商）和 标零位置 的 限位 或者 接近开关 是否误触发（一般接近传感器有灯的变化，误触发的原因可能有限位损坏，安装位置不对等），如果 误触发 也会提前结束标零动作，从而造成标零结果异常。
如果是绝对值编码器，检查模型文件steer电机resetMode配置为 none （和增量式不同的地方时，只需要 第一次 安装时，将转向电机手动转到机械 正前方 （和车体正前方同向）时，通过 驱动器上位机进行编码器清零操作 即可，详细可以咨询供应商）
上述不管是绝对值还是增量式都需要配置steer模型中的 min/maxAngle及offset 偏置，该部分请对照附录2《驱动器行为列表》和附录2《舵角偏置及范围说明》理解后进行填写。
上述配置确认正确后，请按照附录2《单电机调试说明》，对舵角电机进行0度，左极限，右极限角度设置，观察电机 实际转动 的角度是否正确。
若实际转向效果 线性偏小或偏大 （比如发90实际45，发60实际30，线性缩小了两倍），则检查steer模型配置中的 reductionRatio和encorderline 是否正确，
若上述参数确认正确，请截图对应设置角度时 module界面中motorinfo中的编码器值 和 舵轮型号和驱动器型号 联系供应商FAE检验是否正确或者跳转附录1中的《舵角下发与执行呈系数》参考。
若电机 不动 ，则查看roboshop告警记录是否存在 Motor is calibrating 或者 急停拍下 或者 Motor Timeout.... 等字眼
### 如无上述告警记录仍然不动，则需要再次驱动器相关配置
若为HLS LS驱动器，则跳转附录1中《HLS LS舵角不动》
若告警码为 54301 ，则跳转附录1中《舵轮上电后未标零》
若为绝对值编码器的驱动器，则跳转附录1中的《舵角在限位不动》
## 若下发和执行舵角不符
## 始终 固定 差值
若为同毅驱动器，请检查是否在转向电机当前位置在 极限外时上电 ，同时 限位模式 是否和驱动器指导手册中相同，以及编码器线束 是否破损 ， 正负限位开关不在其正负限位的位置偶然或一直触发 ，同毅方之前发生过该现象的bug，若均无问题，则和同毅FAE确认驱动器软件版本为已修复版本，案例看附录1《舵角下发和执行不符》
### 若为科蒂斯叉车驱动器，则跳转附录1中《科蒂斯舵角执行偏差》
## 无固定差值
### 若为舵角震荡摆动，则跳转附录1中《舵轮震荡摆动》或
## 标定，参照附录1 《标定》
## 在标定过程中，驱动器发生报错
若为和利时HLS-DS驱动器，告警码提示 0x170e 查看对应驱动器手册得知为指令超差，则跳转附录1中《HLS DS标定时电机报错》
如上大部分情况均执行正常（ 已正常使用一段时间 ），突然出现如下问题，一般为硬件损坏等原因，不需要找研发确认代码。
## 转向电机过流
若为同毅驱动器 ， 告警码查看提示 0x2000， 则跳转附录1中《同毅驱动器转向电机过流》
## 附录 1
## 科蒂斯舵角执行偏差
下发舵角和实际舵角偏差大于0.5度，查看了一下标定的结果，零位和实际零位相差4.3° （cp文件中的steerOffset值） ，机械零位相差较大，maxAngle和minAngle的数值都是不正常的 （cp文件中的minAngle值、maxAngle值） ，查看模型文件，如果是 rebote-curtis1232E 的方案，此标定结果是不正常的。
1653881217785-b0b9cd2e-0f85-416c-bd3d-bc2fbfccd28f.png

可以多次重新进行叉车标定，观察上述三个值是否仍然异常，如果异常，继续下一步。
请拿1309模块，将curtis的1232E和1220C的cpf文件取出来 ，对比cpf文件发现 ，1232E里面的参数是没有修改过的，请按照如下图大文档中的调整方法来进行调整其中1220C参数， 应按照如下配置 ：
1653881224952-8a7c9903-7777-44b8-83a5-826f42647bd1.png

### Homeing speed 设置为10%
### Homing Timeout 设置为20 second
1653881231446-04fd5035-9154-4834-9730-cf7d1525c28c.png

## position Kp 100%
## velocity Kp 30%
## velocity Ki 6.5%

## 同毅驱动器转向电机过流
### 若编码器线未断（可以拉扯该线观察是否报错）
若驱动器配置按照大文档一致，则需要请同毅驱动器技术支持FAE调节出合适过流参数设置（指导书文档不便给出，因为不同电机的性能不同，找研发也是解决不了）

## HLS DS标定时电机报错
经过log分析，在标定转向电机minAngle的过程中，检测到舵角已不再继续减小之后，下发了返回零度的舵角指令，然而转向电机并未响应这一指令，且发生了如下报错：“[Robokit][error] [Alarm][Error|52135|Motor Error:,motor1-0x170e|1]”
按照文档中的可调参数 ，调整参数SteerRangeWinTime设置过小，容易导致在某个时刻提前判定舵轮已停止运动，导致标定出的可动范围偏小。可以尝试把窗口时间参数SteerRangeWinTime恢复为1，把参数SteerAngularSpeed进一步减小为0.5，把SteerStartBackStep减小为1试一下
最终通过加大模型文件中的舵角范围min/maxRange进行解决

## HLS LS舵角不动
HLS私有协议不支持steer使用，需要联系厂家刷成canopen类型
HLS私有协议不支持steer使用，需要联系厂家刷成canopen类型
HLS私有协议不支持steer使用，需要联系厂家刷成canopen类型
## 使用can卡，进行如下操作
1653881302081-9c07b203-72ec-4bba-b334-4f6ea9e38ee2.png

## 舵轮上电后未标零
查看报错码，存在54301和54004，在标零过程中 拍下急停 会打断标零并提示如下图，为正常现象
1653881311463-9d71d4d2-3ece-44fd-88e4-d9f4a69b9ad4.png

## 舵角不动
该电机使用绝对值编码器，将Steer的轮子手动摆正后，用驱动器上位机进行一次编码器清0操作
因为模型配置和实际不符，导致下发后，超出范围，固定在限位处，steerOffset改-0.2，即可解决。详细请查看附录2中的《舵角偏置及范围说明》
1653881316400-9e422ff4-2555-430d-bad6-b6c211066934.png

检查发现是 左右限位接反 ，导致标零时出问题，更换后问题解决
舵轮就是一直显示在120°，但前进后退，都不动，原因：舵轮模型文件motor的 inverse 选项取反，可能会卡在限位处

## 舵轮震荡摆动
震荡问题已解决，是 小车舵轮为48V，车体电池为24V ，导致舵轮转数达不到3000，引起舵轮震荡，现将机器人模型文件中的转速调节为1100，从而解决问题。

## 舵角下发与执行呈系数
从log分析中，舵角下发和执行都是一致的，但实际 两舵轮舵角均为0°时，车辆运动方向与x轴方向重合；两舵轮舵角均为90°时，车辆运动方向与y轴有偏差。 该车存在舵角反馈值与真实舵角间的比例系数并不为1的缺陷（即反馈舵角变化90°，实际舵角变化不足90°）。
进行横向移动测试，并在测试中观察 实际舵轮朝向 是否与 车辆y轴方向 一致。
最终发现为转向电机的减速比（模型文件 reductionRatio ）大范围偏差，导致发90°但是转动实际角度不对。模型文件里面是236 实际是265.5

## 舵角下发和执行不符

由于舵角范围达到了360度，舵角从180度下发到-180时，固件导致舵角从大圆方向绕的问题。
驱动器位置模式下并不会做“较近距离的转动”，从而和下发预期不符，当前不修改代码逻辑情况下，可将cp文件中标定的舵角范围删除，保留舵角offset，修改模型文件中的舵角范围min为-170，max为170
## 编码器线路产生短暂断连导致角度不准

## 舵角下发和执行相反

此问题一般解决是通过勾选舵轮电机的inverse参数（若已经勾选，可以进行反选），重新推送模型文件，进行测试，通过roboshop发送角度，观察roboshop反馈的角度和 舵轮实际执行的角度（需着重注意）是否一致；
如果不一致，若表现为发送角度和反馈角度一致，但是和执行角度相反，如果驱动器的品牌的curtis1220C的话，请打开1220C的配置CAN Steer Swap Direction，如果原来此参数是ON（或OFF），请改成OFF（或ON），给curtis重新断电，测试通过roboshop发送角度，观察roboshop反馈角度和舵轮实际执行角度是否一致，若不一致，请联系Curtis的供应商；
1653881334536-b8f35ff2-97da-4a29-a639-a915d07762c7.png

如果是其他品牌的驱动器，请联系相应的供应商，询问如何修改使实际执行舵角和反馈舵角相同
