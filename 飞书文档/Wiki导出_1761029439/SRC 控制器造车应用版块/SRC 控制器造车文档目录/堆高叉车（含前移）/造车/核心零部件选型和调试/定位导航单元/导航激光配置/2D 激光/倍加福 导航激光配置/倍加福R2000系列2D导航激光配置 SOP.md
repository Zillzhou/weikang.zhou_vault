# 倍加福R2000系列2D导航激光配置 SOP

### 倍加福R2000系列2D导航激光配置 SOP
## 更新记录：

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

## 文档资源文件清单：

## 文件名

## 资源文件

## 文档内编号

## 常见类型叉车模型文件

## 模型文件.zip

## 模型文件-01
## 上位机配置
配置过程详见倍加福 R2000 激光传感器。
## 模型文件配置
由于叉车类移动机器人的导航定位激光的安装位置较高，一般会在较低的高度再补充多个2D激光用于避障。以下是模型文件配置过程：
## 复制并添加laser
修改设备名称；
启用设备；
1711015812370-c5b31673-ac6a-48d5-aca9-6a7ce1cb20b4.png 

### 图 2.1a 导航激光模型文件配置SOP
1711015914109-f0dba69d-7a7a-4511-87c1-e563333981e6.png

### 图 2.1b 导航激光模型文件配置SOP
修改设备参数：根据实际配置激光雷达id、安装位置；
1703756590299-29cb57f6-2585-4d00-a832-a25bef176f44.png

## 图 2.2 id及安装参数设置
根据实际使用情况配置激光的角分辨率step、角度范围；
选择是否正装，一般车头底部的避障激光雷达为倒装；
勾选用于定位功能useForLocalization；
1703756590299-29cb57f6-2585-4d00-a832-a25bef176f44.png

## 图 2.3 激光使用参数配置
配置通信接口：IP、端口，根据相机实际 IP、端口配置，但要保证不与其他设备 IP 冲突；
1703756540276-1fd6637e-3b89-4264-a30f-dfa9101319e7.png

## 图 2.4 通信接口配置
选择品牌：根据实际选型在品牌下拉框中选择对应的品牌和型号，如倍加福 R2000 雷达则选择 PepperlR2000-HD-TCP。并配置器最小有效距离。。
1703756516636-09da4781-50d2-48e0-afa6-c25fddc3f1d9.png

1703756524155-121912fb-1984-4d2c-bc48-b2b82cecc3ac.png

## 图 2.5 品牌选择
端口，端口一般为ttyUSB0。
1703735859954-2a9b3121-f373-49c8-9c74-6322288ab787.png

## 图 2.6 端口选择
根据实际需要配置扣除区域。
1703756590299-29cb57f6-2585-4d00-a832-a25bef176f44.png

## 图 2.7 配置激光扣除区域
## 配置结果验证
## 上传模型文件
配置完成后点击上传；
确定并推送至机器人控制器；
## image.png

## image.png

## 图 3.1 上传修改后的模型文件
返回地图与控制页面，查看是否有如下图所示的激光数据，且机器人无告警。
1711016013339-bd87572e-2f8c-41b3-8387-2abb7bbd71ca.png

## 图 3.2 查看激光点云数据
## 建图验证
点击【2D建图】，选择【在线建图】；
选择重新建图；
配置建图参数；
选择是否启用反光板；
点击【确定】开始建图，建图过程中使用键盘的WASD键或软件左下角的操作按钮控制机器人在场地内移动，并确保在场地内完成闭环运动，即完成建图时返回建图开始的原点；
完成建图并保存后将地图推送至机器人；
重定位，完成建图验证。
1711016043108-7ff181f7-03ad-4ede-8c14-5ee5c475e374.png 

## 图 3.3a 建图
1711016048182-41e64e0e-0296-45e7-b954-8d6795d68bb6.png 

## 图 3.3b 建图
1711016052128-747bae99-a887-4186-9dc4-24630ab4291e.png

## 图 3.3c 建图
1711019432089-d39820f5-9bb8-4b0a-b93e-2888e70a3c49.png

## 图 3.3d 建图
1711019437472-58bca623-8bfd-4c96-bea1-ffcb7e0faea3.png

## 图 3.3e 建图
1711019442585-d3d4ffa4-ac2e-4408-bca8-6c403c3a5ece.png

## 图 3.3f 建图
1711019448156-4aba2938-aa72-4069-bb3d-21d89caf2968.png

## 图 3.3g 建图
## 参数说明
## 外参配置说明
仙工智能规定激光雷达的正交坐标系遵循右手定理，前方为 x 轴，左方为 y 轴。
1651817670006-a34a7785-6d88-47a0-b1d0-dba7fa429dd8.png

## 图 4.1 右手坐标系
激光雷达扫描到的障碍物的位置是以激光雷达为坐标系中心得到的，需要将这些障碍物的坐标转换到车体的坐标系下，在这种情况下需要知道激光雷达在车体下的安装位置以得到激光雷达坐标系与车体坐标系的相对位置，即激光雷达的外参。
仙工智能通过自动化标定可以得出激光雷达的外参，这部分的原理请参考标定章节。对于单线激光雷达来说，外参只需要知道三个参数即可：

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## x

## 模型文件-laser

## m

## 0

## -99

## 99

### 3.3.4.20~latest

## 激光雷达在车体坐标系下x轴方向的值

## y

## 模型文件-laser

## m

## 0

## -99

## 99

### 3.3.4.20~latest

## 激光雷达在车体坐标系下y轴方向的值

## z

## 模型文件-laser

## m

## 0

## -99

## 99

### 3.3.4.20~latest

### 激光雷达在车体坐标系下z轴方向的值，该值无关紧要

## yaw

## 模型文件-laser

## m

## 0

## -180

## 180

### 3.3.4.20~latest

## 激光雷达在车体坐标系下的角度偏移值

## 定位功能
仙工智能在使用单线激光雷达时，将激光雷达分为两类，一类是避障激光，另一类是导航激光。导航激光兼顾避障、识别和定位，在产品性能上要求更高，如角分辨率、最大测距距离、频率以及抖动等多方面。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## useForLocalization

## 模型文件-laser

## —

## false

## —

## —

### 3.3.4.20~latest

### 是否用作定位的选项（勾选后表示该激光用于导航定位）

## 网口
仙工智能在选用导航激光雷达的时候会选用以太网作为接口，可以实现大量数据实时、高速传输，而且网口不易松动。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## ip

## 模型文件-laser

## —

### 192.168.192.100

## —

## —

### 3.3.4.20~latest

### 激光雷达的ip（一般设置为192.168.192.网段）

## port

## 模型文件-laser

## —

## 2111

## 0

## 9999

### 3.3.4.20~latest

## 端口号

## 串口
对于用作避障的某些激光雷达，如 Sick 的 Tim 系列，会用到串口作为控制器和激光雷达的通信。这类激光雷达通常不需要将点云的原始数据传输到控制器，激光雷达内部可以规划安全区域，当安全区域内存在障碍物的时候，上报存在障碍物的信号即可。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## Com

## 模型文件-laser

## —

## —

## —

## —

### 3.3.4.20~latest

## COM口号；配置某些避障激光

## 点云扣除功能配置说明
仙工智能另外提供了根据角度来扣除点云的功能，在支持该功能的激光雷达的配置列表下，可以看到如下几个参数：

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## useAreaRemove

## 模型文件-laser

## —

## false

## —

## —

### 3.3.5.20~latest

## 判断是否扣除该区域

## areaStartAngle

## 模型文件-laser

## double

## 0

## -180

## 180

### 3.3.5.20~latest

## 区域内的起始角度

## areaEndAngle

## 模型文件-laser

## double

## 0

## -180

## 180

### 3.3.5.20~latest

## 区域内的终止角度
