# 遥控手柄

## 遥控手柄
## 更新记录：

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.4.29

## 更新发布

## 使用中

## 适用范围
## 控制器：SRC全系列
手柄协议要求：支持Xinput协议的手柄;
手柄品牌型号：当前支持微软Xbox、雷神 G20、雷神G25、罗技 F710，其他支持 Xinput 协议的手柄暂未测试。其中，G20手柄为有线连接版本，微软Xbox、雷神G25、罗技F710为无线版本（仍需要将接收器连接在控制器上，手柄和接收器之间无线连接）。
## 安装配置说明
仙工智能控制器产品支持使用XBox协议手柄控制小车，以罗技游戏手柄为例：
## 通讯模式：2.4GHz 无线
## 工作模式： 5 号电池
1700115253491-ddab7dca-cb94-46a7-bdee-662152414d39.png 

## 图 2.1 手柄按键说明
1700115266991-894ed3a1-5e4d-4b53-bbd6-1c4f2df761d2.png

## 图 2.2 手柄接收器延长线
## 手柄连接方式
将 USB 无线接收器插到传输线的 USB 口，传输线的 USB 口接入控制器 USB 口。此时按下手柄相应的按键，机器人便会执行相应的动作；
1700115283166-78e56714-eb06-435f-8866-9d6a2269f61a.png 

1700115279393-4af02f38-3da4-44d9-94a1-a3f125edd7d0.png

## 图 2.3 手柄接收器延长线接线
### （手柄USB线插在SRC控制器USB接口）
1700115293551-3a3ef87a-f7ba-407b-b5fc-345ff41b6cae.png

### 图 2.4 手柄接收器延长线接线-控制器连接
## 版本要求
## RBK：3.4.6.XX
### Roboshop：2.4.1.149及以后版本
## 参数设置
1700115372435-aafc3d2b-025e-45fd-8e8e-affd4df1ec84.png

## 图 2.5 参数设置
## 手柄按键功能配置说明
## 键位介绍
此版本手柄遥控功能仅支持通用按键（LT\LB\RT\RB\A\B\X\Y\左右摇杆\十字键），如您使用的手柄与下图按键位置不符，请确认是否支持XINPUT协议及各按键映射关系。
## image.png

## 图 2.6 键位介绍
## 按键功能配置表

## 按键

## 支持操作

## 是否可自定义配置

## 可使用功能

## LT

## 按下

## 否

## 激活手柄遥控（并抢占控制权）

## LB

## 长按

## 否

## 使能键

## RT

## 按下

## 否

## 关闭手柄遥控（并释放控制权）

## RB

## 单键 按下
## 单键 抬起
## 组合键 按下
## 组合键 抬起

## 是

## 按键的每个单独操作可配置以下任一功能：
## 取消导航
## 暂停/继续导航
## 导航到初始站点
## 导航到上一个站点
## 导航到下一个站点
设置虚拟 DI：此处虚拟di的 id 为以 0 开始，与模型文件中di的id不同，以SRC-2000为例模型文件中 id 为 11 的 di 在此处的 id 为 0 。具体参考控制器手册，查看真实 DI 的数量。

## A

## B

## X

## Y

## 左摇杆按动

## 右摇杆按动

## 左摇杆摇动

## 单键 摇动
## 组合键 摇动

## 是

## 按键的每个单独操作可配置以下任一功能：
## 全向移动/前进后退
## 前进后退左转右转

## 右摇杆摇动

## 单键 摇动
## 组合键 摇动

## 是

## 按键的每个单独操作可配置以下任一功能：
## 全向移动/前进后退
## 前进后退左转右转

## 十字键

## 单键 长按

## 是

## 前进后退左转右转

## 组合键 按下

## 是

## 按键的每个单独操作可配置以下任一功能：
## 前进后退左转右转 （长按）
速度加减：单次按动加减速度，调整精度为线速度±0.1m/s（前＋、后-）、角速度±6°/s（右+、左-）。
## 配置页面
## 配置页面入口
1708418603103-4651a341-bd25-4427-ac12-1eceabb10f42.png

## 图 2.7 配置入口
每个按键的不同操作均设计了独立的功能设置下拉框。
1700737151050-17795003-1b4c-4d66-95db-a87c6e6043b9.png

## 图 2.8 自定义配置页面
可通过下载获取当前机器人手柄按键功能配置；配置完成后通过上传将配置结果同步至机器人。
1700736475295-412f9b4f-ee89-4633-933f-84be741a14af.png

## 图 2.9 上传下载
注意：下载、上传需在机器人控制权无人抢占的情况下操作，如手柄已抢占控制权，请先释放控制权。
## 虚拟DI使用
## 正常使用：作为常规DI使用
触发trigger：在trigger中可执行更多任务，如设置DO、执行脚本等。详见4.7 Trigger 功能说明。
1700734635032-8e075250-c5cd-421d-a24c-85e1b7cd6029.png

### 图 2.10 虚拟 DI+Trigger 使用
## 配置结果验证
## 连接验证：
## image.png

## 图 3.1 手柄未连接
## image.png

## 图 3.2 手柄连接未激活
## image.png

## 图 3.3 手柄连接并激活
## 配置验证：已配置虚拟DI为例
修改配置后点击【上传】生效配置，可在窗口内看到“上传成功”的弹窗；
### 屏幕截图 2024-04-01 153855.png

## 图 3.3 上传成功
## 实操验证：
### 屏幕截图 2024-04-01 155957.png

## 图 3.4 DI状态查看
注意：此处为仿真机器人验证结果，虚拟 DI 的 id 与真实的机器人不同，仿真机器人的 DI 全部为虚拟 DI，即此处的手柄配置的虚拟 DI 的 id 与模型文件一致。
## FAQ
## 罗技 F710 手柄唤醒说明
F710手柄没有开关机，上电自动开启，长时间不用休眠。
唤醒：按A、B、X、Y、LB、RB、BACK、START，以及【按下】摇杆
## 罗技 F710 手柄控制异常
该手柄有两种模式，飞行模式、运动模式，运动模式会将十字键与左摇杆切换映射。
可根据需要调整，3.4.6.xx 及后续版本，建议将模式调为飞行模式，即mode指示灯灭的状态。
### 手柄连接控制器后，若按下手柄十字键，连接无反应
a. 按下MODE切换控制状态；
b. 请打开roboshop查看机器人控制权是否被其他设备抢占。 手柄控制机器人移动，机器人控制权处于无其他设备抢占状态，或控制权被控制器抢占状态；
c. 检查机器人是否处于急停状态，处于急停状态，按下按钮无响应。
1700115870448-dd928585-bdea-4f65-934d-bbbaf694512d.png

## 图 4.1 抢占控制权
1700115874959-8ab6f47f-0829-4468-9952-0d9af5b569be.png

## 图 4.2 查看机器人状态
### 无线接收器已正确安装，但手柄开机后，手柄无法连接控制器
a. 罗技F710：检查模式是否为X模式；
b. 雷神G25：手柄无线接收器安装在新控制器后如无法连接手柄，则需进行配对操作，配对时首先在关机状态下同时按下logo键和Y键，等待指示灯为冰蓝色快闪进入配对模式；然后按下无线接收器配对按键，开始配对；配对完成后手柄会短暂震动，手柄指示灯为冰蓝色常亮；
c. 如使用的是SRC880控制器：确认ARM-PATCH版本是否是0.6.0及以上版本。如不是则需升级驱动，请联系我司工程师，获取SRC-PATCH 0.6.0及以后版本升级包，并在Roboshop中一键升级。
## 手柄遥控建图流程
启动建图后，手柄需抢控制权（激活手柄遥控）才可以遥控机器人，完成建图后必须先释放控制权（关闭手柄遥控），再进行地图保存工作。

插上手柄，摇动摇杆后出现“手柄摇杆回中之后，车体还在运动”的现象
出现该问题首先摇动摇杆，观察是否会出现在一个摇杆位置，车体可以停下，如果存在，则可以判断为是由于摇杆的“零位漂移”导致不能回中。可以通过调整参数“JaystickThreshold”的值（建议调大该值）来避免此情况。

## Trigger功能说明
## source
## DI
## 释义: 触发器所使用的 DI 的序号
## 说明: 略
## EMC
## 释义: 使用EMC为触发来源
## 说明: 略
## externalControl
## 释义: 使用外部模式为触发来源
## 说明: 略
## motorinfo
## 释义: 使用电机信息作为触发来源
## 说明: 略
## motorName
## 释义: 所指的电机名称
## 说明: 略
## useCurrent
## 释义: 是否考虑电流情况
## 说明: 略
## current
## 释义: 电流触发值
## 说明: 略
## userTemp
## 释义: 是否使用温度
## 说明: 略
## temperature
## 释义: 温度触发值
## 说明: 略
## stop
## 释义: 电机是否停止
## 说明: 略
## err
## 释义: 电机是否发生错误
## 说明: 略
## emc
## 释义: 电机是否失能
## 说明: 略
## errCode
### 释义: 错误码触发值，0x开头，十六进制
## 说明: 略

## type

## risingEdge
## 释义: 上升沿触发
## 说明: 略
## fallingEdge
## 释义: 下降沿触发
## 说明: 略

## func

## suspendTask
## 释义: 挂起任务
## 说明: 略
## resumeTask
## 释义: 继续任务
## 说明: 略
## cancelTask
## 释义: 取消任务
## 说明: 略
## releaseControl
## 释义: 释放控制权
## 说明: 略
## recycleControl
## 释义: 回收控制权
## 说明: 略
## powerOffDriver
## 释义: 关闭继电器
## 说明: 略
## powerOnDriver
## 释义: 上电继电器
## 说明: 略
## openDO
## 释义: 打开DO
## 说明: 略
## closeDO
## 释义: 关闭DO
## 说明: 略
## switchToSRCControl
## 释义: 切换到内部控制
## 说明: 略
### switchToExternalControl
## 释义: 切换到外部控制
## 说明: 略
## navToTarget
## 释义: 导航到目标点
## 说明: 略
## resetMotor
## 释义: 标零电机
## 说明: 略
## clearMotorFault
## 释义: 清除电机错误
## 说明: 略
## toggleDO
## 释义: 翻转DO
## 说明: 略
## enableMotor
## 释义: 使能电机
## 说明:
## motorName
## 释义: 电机名称
## 说明: 略
## disableMotor
## 释义: 去使能电机
## 说明: 略
## motorName
## 释义: 电机名称
## 说明: 略
## runScript
## 释义: 运行脚本
## 说明: 略
## name
## 释义:脚本名称
## 说明: xxxx.py
## args
## 释义: 脚本json
## 说明: 略
## repowerDriver
## 释义: 重上电驱动器
## 说明: 略
## delayBeforePowerOff
## 释义: 断电前的延时
## 说明: 略
## delayBeforePowerOn
## 释义: 上电前的延时
## 说明: 略
## reopenDO
## 释义: 重上电DO
## 说明: 略
## DO
## 释义: DO
## 说明: 略
## delayBeforeCloseDO
## 释义: 关闭前的延时
## 说明: 略
## delayBeforeOpenDO
## 释义: 打开前的延时
## 说明: 略
