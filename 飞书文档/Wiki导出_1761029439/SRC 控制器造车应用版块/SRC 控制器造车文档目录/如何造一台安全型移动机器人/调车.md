# 调车

## 调车
## 调车

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.11.29

## 文档从语雀迁移至飞书

## 使用中

安全机器人的非安全部分的调试可参考普通车造车文档中的相关内容，与普通车的主要区别在于安全传感器相关内容的准备及调试，而且测试结果和安全配置强相关，所以该部分将安全配置放置调车板块。
## 一. 工具、安全传感器准备
## 1.1 调试前基本准备工作：

## 序号

## 准备事项

## 用途及来源

## 1

## SICK上位机

## 激光安全区配置
SICK官网-支持-下载和信息-软件-Safety-Designer 

## 2

## 足够开阔的场地

## 不同车速停车距离测定
## 1.2 车辆刹车距离测试
## 1.2.1 车辆运行方向及速度
车辆运动状态可以简单划分为两种情况，一种是直行，一种是旋转 。任何速度可分解为直行和旋转两个分量。
直行包括前进和后退两种情况，对于顶升车，车头前进方向为前进方向，相反方向为后退方向。对于叉车，货叉相反方向为前进方向，沿着货叉方向为后退方向。
沿曲线转弯可以分解为直行方向的速度与左/右旋转的速度。下图以顶升车配置16个安全区的龟甲图示例以上描述的各个速度方向。
## image.png

## 1.2.2 停车（刹车）距离的测定
每个保护区的配置跟停车（刹车）距离有直接关系，因此在画区之前首先要测试各种速度速度状态下的停车距离。
这里的停车距离包括直线停车距离和旋转停车距离。

1、根据现场使用情况，将速度划分为不同的档位，即需要确定percentage 1~percentage5 、Forward Max speed和 Backward Max Speed 的数值，直行方向至少要测试这几个速度下的停车距离。还需要确定 percentage 6~percentage7 和 Turing Maximum Speed_R （一般左右旋转是对称的）速度下的停车距离。
2、percentage 1~percentage5 ，percentage 6~percentage7  的具体值可根据现场场地情况及工作需求综合考虑，以确定具体的数值。可以根据每个方向的区域，将速度从0~Max Speed 均匀设定。也可以在测试停车距离的时候，0~Max Speed之间测试尽量多的速度下的停车距离再结合现场使用情况确定，比如测试0.1,0.2,0.3 .....最大速度下每个速度的停车距离。（具体测试方法可以参考1.2.2.1中的描述）
### 3、测定停车距离的时候，建议同一个速度分别测试空载和最大负载两种工况下的停车距离。
此处的最大负载：标准产品出厂测试以制造商定义的额定最大负载来测，现场使用时建议根据实 际使用场景，工作中预计将会承载的最大负载作为测试停车距离的负载重量。 
### 4、直行停车距离的测试可以参考普通车的车体性能测试中的6.2紧急刹车距离测试车体性能测试
### 5、可以考虑通过脚本的方式寻求停车距离（直行、旋转）的自动测定的方法。
## 1.2.2.1 直行紧急刹车距离测试
1）场地中合适位置划一条测试线，要求是在机器人到达测试线的时候能够稳定达到最高测试速度。
2）Robshop中设置要测试停车距离的速度值。
3）机器人跑到测试线的位置时按下急停。
4）测量测试线到机器人完全停车位置的距离。
5）每个速度测试三次停车距离，取算术平均值作为最终参考的停车距离。

## image.png

## 1.2.2.2 旋转停车距离：
以原地旋转为例，在一个固定的角速度下，①处发急停命令到②处停止，测量转停角度，再根据每个角速度下的转停角度设计保护区的宽度。

## image.png

非原地旋转时的转弯速度（角速度）比较难测量。目前的方案是将直行和原地旋转的保护区叠加设计出转弯保护区图形。
## 1.2.3 坡道直行停车距离
同样的速度在坡道上下坡时候所需的停车距离要大于平地行的停车速度，因此建议下坡速度在规划时不要超过0.7m/s，这样可以在下坡时候调用平地上比这个速度高一档的保护区，不必给坡道情况单独另行设计保护区。
## 1.3 激光雷达切区模板画图示例
## 激光配置前需要了解的基本信息：
根据目前的设计，激光在车体模型中通常按照如下规则设计，表中汇总信息仅为参考，激光配置的时候还需要在Robshop中进行确认避免配错：

## 序号

## 激光

## IP

## UDP

## 在实车中的对应情况

## 1

## Laser1

### 192.168.192.100

## 6060

## 叉车：左前
## 顶升：左前

## 2

## Laser2

### 192.168.192.101

## 6061

## 叉车：右前
## 顶升：右后
激光上位机 Designer safety中配置激光的时候，IP、名称、UDP等信息需要与Robshop车体模型中的保持一致。
## 1.3.1 SICK安全激光基本配置
一台安全型机器人通常配置至少两台安全激光，不超过4台（控制器SRC3000目前最多支持4台安全激光）。每一台安全激光均需单独配置，并根据设计的车体保护区形状分别设计保护区图。
Robshop在设备配置中的Laser选项，选中一个激光，可以查看激光的基本信息，参考下图①②③处。 
4058cb0fef5273f47f9d9fb5eda45d8.png

## 1.3.1.1 使用一组OSSD的激光配置
SICK激光上位机配置具体步骤参考如下（本文档中的操作以激光已经安装到车体，通过车体网线连接到电脑进行配置为例）：
激光上电（AGV开机）后，打开激光配置软件safety Designer。
1）搜索设备，可以发现相关激光会在界面右侧显示，我们可以看到已经配置好的激光显示绿色，未配置的显示黄色。通过拖拽或者双击进入激光的设置界面。

## image.png

img_v3_02ed_1b0ad664-44cc-4aae-8134-e107c97d781g.jpg

## 2）配置IP地址
在网络设置中配置IP地址，IP地址与Robshop中的激光IP（1.3.1中图上③）对应，子网和路由器按照如下图所示设置即可。
 设置完之后，“传输到设备”。
## image.png

Tip：设置IP的时候最好通过下图所示的激光本体的接口进行连接电脑配置。如果直接通过整车网线进行链接电脑配置，车体上的几个激光只能通过序列号识别，比较麻烦，IP与激光的对应关系容易混乱。
其他配置可以通过车体的网线直接连到电脑对每个激光进行分别配置。
## image.png

## 3）识别
此处设置设置激光名称。
在设备名称处设置激光的名称，例如Laser 1，Laser2...，此处的名称需与车体模型中的设备名称保持一致（即1.3.1中图示①处的激光名称）。需要注意区分每台激光在车体上的安装位置。因为整台车保护区域的配置，要综合考虑每个激光的位置设计不同的区域图形从而组成整台车的保护区域图。
*此处建议保持一致是为了避免后续将文件导入Robshop中出现混乱，也可以根据个人喜好命名。
3339cc3bc04eb6816cb7a9f62cde3fe.png

## 2）应用
识别处，根据实际情况和需要设置，①处选动态，语言和显示屏对其根据需要选择。
img_v3_02ed_ea30ac55-66f1-4aea-93bb-d2c94ed221dg.jpg

## 3）区域

注意我们的方案中只用到安全激光的保护区，没有用到警示区和减速区
区域处绘制每个保护区的形状。
## ①增加一个区域组
### ②删除一个区域组/区域，选中要删除的，点②即可删除
③区域组中的区域，也是我们需要绘制的保护区形状，根据目前的设计应用，每个区域组只用到一个区域
④选中要绘制的区域，变成蓝色，如③所示，此处的工具才会可用，否则为灰色不可用
⑤某个区域组中增加一个区域，由于每个区域默认会带一个区域，因此根据目前使用情况，这个按钮用不到
## image.png

绘制的时候，选中多边形/四边形/圆形/扇形后以激光为原点拖拽绘制出需要的图形。 
每个区域组绘制好以后，会在图上重叠同时显示，选中的区域会显示在最上层，如下图中四边形所示，为选中的区域组2中的区域。如果绘制的图形超过扇形虚线区域，会被扇形虚线自动切割，如下图区域组1所绘制的图形所示。
img_v3_02ed_8f355682-381c-4a87-be40-a9cd88a8dc0g.jpg

## 4）输入端和输出端，本地
配置静态控制输入端，可以直接用拖拽实现。根据我们目前的设计，按照16个安全区设计的话，选用CDEF四组接线作为激光的静态输入控制。 
## image.png

## 5）监控事例
在监控事例中设置保护区域。
-所使用的输入端勾选C、D、E、F ，下图① 处。
-输入条件C、D、E、F的设置（0/1）与安全固件配置中激光切区表配置保持一致。SRC-3000 安全固件 2.0 配置说明。下图②处。
-区域编号，下图③处，名称可以修改也可以用默认。需要注意，编号要按照顺序保持连贯，不能跳跃。
-根据目前设计只使用了OSSD 1，在④处对应勾选。
-“区域”中已经画好的图形会在区域组这里直接显示，拖拽到相关事例即可。
## image.png

如果在勾选所使用的的区域段出现×号提醒，可以回到“4）输入端和输出端，本地”这一步骤检查静态端子配置是否有问题。如下图出现的问题为在4）没有给F这对端子配置静态输入。
img_v3_02ed_977c1e2d-08e0-4e18-a864-c2f37d79571g.jpg

## 6）数据输出
此处IP为SRC-3000的IP，按照下图设置即可。
UDP端口，与Robshop（车体模型）中对应激光的端口保持一致。 
img_v3_02ed_2e45ee91-fb54-41cf-93db-8314f883c58g.jpg

如果漏掉这步操作会出现如下两张图所示的提示。
img_v3_02ed_8b13636e-8539-4053-827e-ca3c8dc0364g.jpg

img_v3_02ed_c7acc953-ba4a-4c22-9ed7-07de1c735adg.jpg

## 7）传输
将在上位机Designer Safety中配置好的信息传输到设备中。“传输到设备”后按照提示输入密码即可。

img_v3_02ed_c5e91da6-0213-48eb-8a65-e728a8ce8d3g.jpg

img_v3_02ed_d4fd0598-d120-440c-8e4c-e203184f6f6g.jpg

## 8）导入/导出
将已经配置好的激光信息导出（sgexml格式的文件），后续导入Robshop中的安全模型当中使用。
需要注意的是每个激光分别配置分别导出，注意命名区分，建议以激光名字设置sgexml格式的文件文件名，避免导入Robshop中的时候出现混乱。
img_v3_02ed_090816a6-8983-4dda-8b30-6d040d5e84eg.jpg

到此，一台SICK安全激光的上位机配置已完成。除此以外，几个其他使用小Tips供大家参考。
1）配置激光区域的时候需要结合车型、龟甲图、以及安全模型等综合考虑设计保护区图形。
2）区域设置的时候，默认的激光位于原点，可以选中激光-右键设置激光的安装角度（具体角度也可以在Robshop模型中查看），这样就可以在画图的时候看起来更加直观，参考下列步骤及效果截图。
img_v3_02ed_0840e853-691b-45e0-aa36-70463f17a67g.jpg

img_v3_02ed_1cd8e7f1-da4b-46c5-b7f2-edaf46d5908g.jpg

img_v3_02ed_c595c66b-dd1a-47b6-a2ea-0e4d16e5a43g.jpg

### 3、报告中可以查看激光配置的数据。
img_v3_02ed_59cd4f81-b5bd-4faa-8776-65b8ac6e4deg.jpg

## 1.3.1.2使用两组OSSD的激光配置
通常使用一对OSSD就可以满足基本需求，特殊情况我们也可以使用两对OSSD。比如需要在不同case（如有货无货）下激活不同的OSSD对应的保护区（需要配合muting功能一起用，即有货的时候muting一个OSSD，无货的时候muting另外一个OSSD，muting由RBK上层根据取放货发起）。
使用两对OSSD与使用一对OSSD的大部分设置是相同的步骤，下面重点描述一下设置中不同的地方。
## 1）输入端和输出端，本地
## 无标题.jpg

OSSD对1 和 OSSD2 都要设置好。如果只用一对OSSD，只配置OSSD 对1 就可以使用。
## 2）监控事例
## image.png

在监控事例中，case1 对应勾选OSSD1， case 2 对应勾选OSSD2，这样在不同事例中会触发OSSD1或OSSD2并启用不同保护区。
## 1.3.1.3 复制已经设置好的激光配置
在实际实际应用当中，如果有批量机器人需要配置安全激光，我们在一台车上将所有激光配置好并经过测试验证确认配置有效可用后，可以将已经配置好的信息复制到其他机器人的相同位置的激光上，这样比较快捷有效并保持批量产品的一致性。
例如，有一批十台同样型号的潜伏机器人用在同一个场景当中，每台机器人配备左前Laser1和右后Laser2共两个安全激光。第一台机器人的Laser1和Laser2两个激光都配置好并经过验证安全可靠后，可以将这台机器人的左前Laser1 的配置直接复制到另外九台的左前Laser1激光中。避免了繁琐的再配置。
打开已经保存好的工程文件，连接空白新激光，通过传输到设备即可将已经配好的激光信息传输到新设备。传输玩之后记得需要校验一下，复制过来的配置才能生效使用。
img_v3_02fj_334032a4-60ba-4dde-b194-28944502b02g.jpg

## 1.3.2 安全区长度和宽度计算
保护区域的轮廓形状我们参考SICK激光建议的规则进行设计。保护区的长度和宽度分别按照如下公式进行计算。其中，停车距离是一个标准值，其他参数是根据不同的场景做的一些补偿值，也就是可以根据场景需要选择。关于计算公式的一些名词解释、引用数据等信息如有不清晰的请参考SICK NANOSCAN3的使用手册中的内容，链接内容将引用的信息做了汇总，可直接查看参考SICK NANOSCAN3 信息。 
保护区域长度：SL=SA+TZ +ZR+ZF+ZB=停车距离+565+ZB（mm）
保护区域宽度：SB=FB+2（TZ+ZR+ZF)=车辆宽度+1130 （mm）
## SL：保护区域长度
### SA：停车距离（1.2.2中测定的数值）
TZ：安全激光扫描仪的容差范围，取值65mm（根据SICK安全激光手册查表获得的数值）
ZR：针对反射造成的测量误差的延伸距离，取值350mm（根据SICK安全激光手册查表获得的数值，现场有镜反射的需要考虑这个值，没有镜反射的可以不考虑也就是取值0）
ZF：针对无离地间隙车辆的延伸距离150mm（通常激光离地间隙低于120mm时建议参照这个数值选用，如果要精确，具体对应图参考）
ZB：实现车辆文档中车辆渐减制动力的延伸距离（在本文档中停车距离的测定当中已经包含了这个距离，因此通常ZB取值为0即可）
## SB：保护区域宽度
## FB：车辆宽度
根据SICK的手册以及经验数值，简单的安全区长度计算可以按照下述公式，仅供参考，具体的数值还是要根据上述公式计算比较精确。
## image.png

## 1.3.3 保护区设计
## 1.3.3.1 潜伏式机器人保护区设计
根据顶升车16个保护区给出部分几个画图形状示例，在此示例中，车体、速度、停车距离取值等基本情况如下：
## 直行方向的保护区根据如下公式计算
## image.png

角度方向的保护区根据旋转角度，对应的三角函数计算。
非运行方向按照300mm计算。
下面以左前运行，分解后的速度为直行1.0m/s，角度为40°为例，假设停车角度为45°。

## image.png

## 示例图顺序序号

## 直行速度（m/s）

## 角速度（°）

## 保护区纵深长度（mm）

## 停车角度位移（°）*

## 备注

## 1

## 2

## 0

## 2300

## 0

## 前进直行，2m/s

## 2

## 1.5

## 0

## 1425

## 0

## 前进直行，1.5m/s

## 3

## 1.2

## 0

## 1020

## 0

## 后退直行，1.2m/s

## 4

## 1.0

## 40

## 800

## 45

### 左前转弯，直行速度1.0m/s 角度45°

## 5

## 1.0

## 40

## 800

## 45

### 右前转弯，直行速度1.0m/s 角度45°

## 6

## 1.0

## 40

## 800

## 45

### 左后转弯，直行速度1.0m/s 角度45°

## 7

## 1.0

## 40

## 800

## 45

### 右后转弯，直行速度1.0m/s 角度45°

## 8

## 0

## 55

## 0

## 60

## 原地旋转，角度60°

### *本示例中，角速度的停车角度仅用作举例用
每个区域图序分别为：区域示意图、Laser1（左前激光）图示、Laser2（右后激光）图示

## image.png

## image.png

## image.png

## image.png

## image.png

## image.png

## image.png

## image.png

## image.png

## 1.3.3.2 双编码器叉车保护区设计
双编码器的叉车，目前方案是在车头左右两边各安装一个安全激光，总共安装两个安全激光，后续方案会增加三个安全激光的方案，即在两叉齿中间再增加一个安全激光。
根据下边的龟甲图，分别给出一些区域的画图示例，后续根据实际经验也可以根据现场应用丰富图形。以下图形仅供参考示例。

## image.png

在如下区域示例图中，Laser 2对应左前激光，Laser1对应右前激光。
## 1区：
## image.png

## 6区：
## image.png

## 14区：
## image.png

## 2区：
## image.png

## 4区：
## image.png

## 13区：
## image.png

## 15区：
## image.png

## 1.3.3.3单编码器叉车保护区设计：
 单编码器的叉车是一个过渡类型，因为用安全接近开关无法感知舵角角度，所以用16个切区，有6个（绿框内）是无法切到的。

## image.png

所以，不推荐用16个切区，用8个切区，其中有两个区（2和4）切不到，考虑到叉车原地旋转比较少，可以由5和7兼顾到2和4切区，即左转前进和原地左转合并，右转前进和原地右转合并。
## image.png

### 二. 安全型机器人调试
### 2.1 连接机器人
### 1）确认机器人需要的功能控制器是否正确激活：
## image.png

### 2.2 版本升级
### 2.2.1 安全软件兼容问题

### 2.2.2 安全固件升级
1）安全固件最新版本下载和版本发布说明链接：安全固件发布说明
2）升级前需要确定安全固件是 1.0 版本还是 2.0 版本，确定方法如下：
RoboShopPro 底层固件版本显示 v1.0.x.x 版本是安全固件1.0版本。
RoboShopPro 底层固件版本显示 v2.0.x.x 版本是安全固件2.0版本。
不支持安全固件 2.0 版本回退到 1.0 版本。
## image.png

如上图底层固件版本显示为 v2.0.1.0v6，所以是安全固件 2.0 版本。
3）在安全固件发布说明下载链接中下载最新版本 SRC-3000-SafeModule-app-ver2-2.0.1.0-202408151330-crc.zip，加载文件后，点击开始升级。
## image.png

4）升级完后显示更新完成代表安全固件已升级，此时控制器会软重启，需要等待控制器重启完成；重启完成后可以查看底层固件版本和实际升级的固件包版本是否对应，进一步确定安全固件升级是否成功。
## image.png

5）如果显示”bin:safe crc failed, please check the firmware version!“，需要在安全固件发布说明下载最新固件版本，同时检查是否是 2.0 版本的控制器升级了 1.0 的安全固件；
如果升级安全固件后，底层固件版本显示 ”v “ 或者 ”v0.0.0.0“，请整车重启，重启后底层固件版本仍显示异常版本号请联系开发人员协助处理。
## image.png

### 2.2.3 RBK升级
## 1）Robokit 版本查看方法：
如下图 Robokit 版本为 3.4.6.2103 。
## image.png

2）安全固件1.0 支持 Robokit3.4.5 和 Robokit3.4.6 版本；
3）安全固件2.0 仅支持 Robokit 3.4.6.2103 及以上版本。
### 2.2.4 Roboshop升级
### 1）RoboshopPro版本查看方法：
如下图 RoboshopPro 版本为 2.4.1.186 。
## image.png

2）RoboShop 需要升级到 2.4.1.186 及以上版本。
### 2.3 安全模型配置
安全型机器人需要对安全模型做 一定的配置才能实现相应的安全功能控制。对于一台新车需要逐项配置安全模型的参数，对于同款车型，可以直接导入已经配置好的安全模型文件，就不必重复配置。
### 2.3.1 安全模型的配置
安全模型配置之前，需要先检查相关软件的版本，目前，支持安全模型配置的软件版本要求如下：
### Roboshop 最低版本要求：2.4.186+
### Robokit 最低版本要求：3.4.6.2103+
另外，本部分着重介绍安全型机器人的安全模型配置的相关内容，默认车体非安全相关的标准模型文件已经配置。
对于安全模型的配置及各项的功能解释，详细信息可查阅SRC-3000 安全固件 2.0 配置说明这个文档。
### 2.3.1.1 差速车底盘类型的机器人安全模型配置
Robshop中先进入安全模型界面。
在“设备配置”中找到“安全模型”，点击并输入管理员密码，确认后，进入安全模型界面。
## image.png

## 1）SLS 配置
## image.png

首先在①处点选All，这里能看到所有的安全功能配置模块。
点击②处，在右侧属性窗口即可看到我们在SLS这个模块需要配置的信息。
点击③处，选择车体类型。本章节示例是差速车底盘类型，我们选择Differential。
## image.png

①处对应勾选，意为启用安全编码器。
②处对应勾选的话，意为安全计数方向反向。这里具体是否勾选需要查阅相关设计图纸，比如电气原理图，确认计数反向。（如根据设计图纸做了相应选择，实际运行时候此项报错可查看实际接线是否与设计图纸一致，是否存在接错线的情况）
③处的安全编码器绑定的Motor名称需要与⑥处的保持一致。
④处可以点击选择Auto模式，自动调用在⑥中绑定的电机的减速比。
④处减速比的配置，可以选择manual手动方式，并在⑤处输入减速比，这个主要针对一些特殊的减速机机构（参考造车文档减速机章节4.2.2），具体的减速比需要根据减速机的参数确认。

## 2）SS1 配置
## image.png

这里主要是对安全减速功能的配置，
①处设置希望从运行速度减速到②处目标速度的时间。（不用SS1安全急停的①duration配成0）
③处设置激光抑制绑定 DO，支持绑定 DO4 ~ 15，选择 none 不启用激光抑制功能。（此配置主要是为了兼容安全固件1.0时候的一些配置，安全固件2.0下建议选none，muting的机制有调整）
④处设置功能绑定的 DO 对，支持绑定 DO4 - DO5、DO6 - DO7、DO8 - DO9、DO10 - DO11、DO12 - DO13、DO14 - DO15，选择 none 不启用 STO 功能。
## 3）SSM 配置
## image.png

①处实际使用的安全激光数量，最多支持4个安全激光。配置时候根据实际车体模型的安全激光数量通过下拉菜单的形式选择安全激光数量。每个激光对应的DI接口编号根据车体实际的电气接线，通过下拉菜单的形式选择。 
②处每个激光的实际使用的最大安全区域数量，目前的安全固件最多支持32个安全区域。图示以16区为例。
③处选择 Sick DI 输入对配置，根据电气连接，具体使用了SICK激光的哪些输入对就做对应勾选。
以SICK nanoScan3 HV， 16个安全区为例，通常选择使用SICK的C、D、E、F作为SICK激光的切区输入对，因此需要对应勾选C、D、E、F。
④处为SICK安全区域切区输入端与控制器safety DO的对应关系选择。
首先，在步骤③中勾选了哪些激光的输入对，此处显示对应输入对。
例如，步骤③勾选激光的C、D、E、F，此处显示如下图④中所示C1-C2，D1-D2，E1-E2，F1-F2。
其次，通过电气连接图纸确认SICK的输入对C、D、E、F对应的 控制器的DO接口编号，通过下拉菜单的形式选择。
例如：④处图框中，激光输入对C（C1-C2）在电气设计中连接到控制器的DO6-DO7，我们就通过下拉菜单选择DO6-DO7。

## 注意：
此处激光输入对和控制器的 DO 输出对的对应关系要和电气图上完全一致。
激光输入对逻辑是一对反向的电平，所以电气图上接线要保证逻辑正确。
⑤处为SICK OSSD输入端与控制器的safety DO的对应关系选择。
例如，根据电气设计图纸，SICK安全激光Laser1的OSSD接到控制器的DO12-13，通过下来菜单的形式选择Laser1与safety DO的对应关系。
⑥处，如果要启用安全导航开关，就做勾选，如果不启用，则不用勾选。
配置双安全编码器和 nanoScan3 HV 或 pro 的顶升车型/单舵轮车型通常建议勾选。勾选后导航那边会做速度约束，保证在安全固件超速阈值内。

SSM界面下滑，会看到对应车型的龟甲安全区示意图，下面的数字代表切区掩码和对应的激光实际切区区域的编号在这需要做一个 Mode 的勾选，对于前进后退速度相对对称的车型勾选 mode 1，前进速度较大后退速度较小的车型勾选 mode 2，因此差速底盘车勾选Mode 1， 叉车勾选Mode 2。本部分内容介绍差速底盘的配置，因此如图所示，勾选Mode 1。
## image.png

## 序号

## 说明

## 1

## 横轴代表转向切区和超速阈值

## 2

## 纵轴代表行走切区和超速阈值

## 3

1~16 方框代表激光切区区域，按下显示绿色，同时底盘模型显示对应激光区域

## 4

Mode 1 ~ 2，选择激光区域底盘模型，Mode 1 常用于差速底盘模型，Mode 2 常用于单舵轮底盘模型

## 5

Muting Rotational Speed：配置激光转向时 muting 速度 

## 6

Muting Travel Speed：配置激光直行 muting 速度（最大不可以超过0.3m/s）
## image.png

SSM界面下滑，看到关于激光区域的相关界面。
①处，用于导入激光配置中已经导出的sdxml格式的的激光配置文件，直接点击加载找到文件保存位置加载即可。
②处，会显示已经加载激光配置文件的激光，例如我们加载了Laser1的配置文件，②处会显示Laser1。如果加载了多个激光，并且都做了勾选，几个激光的区域会同时在界面中央显示，如果只勾选某一个激光，那么界面中央的示意图会只显示已经勾选的激光对应的保护区示意图。
③处快捷按钮无需配置，在后续使用中会用到。这两个按钮从左到右依次是复位按钮和自动播放按钮。

## image.png

复位按钮，方便将模型复位到界面初始位置，方便观看。

## image.png

自动播放按钮，会动画形式自动播放激光的所有已配置切区。
播放过程中，可以检查切区顺序、激光安全区域设计和设想是否一致。

### 4）collisionModule 配置
## image.png

如果车体配置了碰撞模块，需要在此部分做相应配置。碰撞模块一般有单 DI 类型的，和OSSD DI（安全 DI）类型的。
①处，根据车体设备配置中的信息填写碰撞模块的名称。
②处，如果需要启用碰撞模块即做勾选，如果不启用碰撞模块就不用勾选。
③处，选择碰撞模块 DI 触发类型方向，如果是上升沿触发则勾选，如果是下降沿触发，则不勾选。具体信息需要参考碰撞模块的类型确定是否勾选。
④处，通过下拉菜单选择enable 或者 disable OSSD。
如碰撞模块连接控制器 OSSD DI（可以理解为安全DI），则选择enable。
如碰撞模块连接控制器的单 DI 类型，选择disable 。
普通的Bumper碰撞条一般是单 DI 类型的。叉车叉尖的碰撞机构一般是OSSD DI 类型的。
⑤处，从上到下三项分别表示碰撞模块 OSSD 信号的脉冲周期，碰撞模块 OSSD 信号的脉冲宽度，碰撞模块 OSSD 信号的监测超时时间。这里根据碰撞模块的具体性能做填写。
⑥处，碰撞模块于控制器 DI 的连接对应关系选择，需要根据电气设计图纸接线等确认具体连接到控制器的哪个DI。
目前，碰撞模块功能绑定 DI， 支持单 DI2 ~ DI23，优先用 DI16~DI23。
支持OSSD DI 对 DI2 - DI3、DI4 - DI5、DI6 - DI7、DI8 - DI9、DI10 - DI11、DI12 - DI13、DI14 - DI15。

### 5）maintenanceMode 配置
设备名称，保持默认即可。
Inverse 维护模式开关 DI 触发类型选择，勾选上升沿触发，否则下降沿触发
binDIn 维护模式开关功能与控制器 DI 的对应关系选择， 支持单 DI2 ~ DI23，优先用 DI16~DI23。
## image.png

目前在差速底盘类产品中暂无 maintenanceMode，因此通常在此项中“启用设备”这一项不做勾选。同时，在左侧会显示红色圆圈标识。单舵轮叉车配置手操器的时候需要开启 maintenanceMode。

## 6）resetButton 设置
resetButton 设置中，设备名称与常规设置中的“设备配置”中的名称保持一致，同时勾选“启用设备”
inverse 选项：复位按钮 DI 触发类型的选择，如果是上升沿触发，就勾选，如果是下降沿触发就不勾选
binDi 选项：复位按钮与控制器 DI 的对应关系选择，目前支持单 DI2~DI23，优先用 DI16~DI23。
## image.png

## 7）导出安全模型
已经配好的安全模型，可以直接导出文件并导入其他同款车中使用。
另存为模型文件即可，如下图所示。
## image.png

### 2.3.1.2 单舵轮底盘车安全模型配置
单舵轮底盘车的安全模型配置，总体与差速车的配置一致，主要区别在SMS和SLS部分的配置。同时，目前对于单舵轮底盘车存在两种配置，一种是车体配置一个安全编码器，另一种是车体配种两个安全编码器。下面将对单舵轮底盘的配置与差速车有差异的地方进行描述。
### 2.3.1.2.1 单舵轮底盘车（双编码器）安全模型配置
## 1）SLS 配置
单舵轮底盘车使用两个安全编码器的安全模型配置，需要注意，SLS配置中行走电机和转向电机的名称要与普通模型文件中的信息对应好。
## image.png

## 2）SMS 配置
对于单舵轮底盘车 SSM 配置中龟甲图的模式选择 mode 2
## image.png

其他信息配置与前述文件相同，不再赘述。

### 2.3.1.2.2 单舵轮底盘车（单安全编码器）安全模型配置
单舵轮底盘车使用一个安全编码器，转向时使用到位开关来监测的，所以需要对到位开关的相关信息进行配置。
## SLS的配置：
## image.png

①处，选择车体底盘类型，单舵轮单安全编码器选择 SwitchSingSteer。
②处，安全编码器绑定的行走电机名称，此处的名称需与“设备与配置”中的 motor 类中，图示⑨处，行走电机的名称一致。
③处，左右到位开关触发形式的选择，如果是上升沿触发，需要勾选，如果是下降沿触发，无需勾选。
④处，选择左右到位开关是否是 OSSD 信号，如果不是 OSSD 信号就通过下拉菜单选择 ossdDisable，如果是OSSD 信号就通过下拉菜单选择 ossdEnable。
选择ossdEnable后，需要对 OSSD 信号的脉冲信息进行设置。OSSD 信号脉冲信息根据具体的器件性能信息参数进行填写即可。
⑤处，对左右到位开关与控制器端口的连接关系进行配置，根据电气设计图，选择正确的控制器端口。
目前，左到位开关绑定的 DI 对，支持 DI2 - DI3、DI4 - DI5、DI6 - DI7、DI8 - DI9、DI10 - DI11、DI12 - DI13、DI14 - DI15、DI16 - DI17、DI18 - DI19、DI20 - DI21、DI22 - DI23。
右到位开关绑定的 DI 对，支持 DI2 - DI3、DI4 - DI5、DI6 - DI7、DI8 - DI9、DI10 - DI11、DI12 - DI13、DI14 - DI15、DI16 - DI17、DI18 - DI19、DI20 - DI21、DI22 - DI23。
⑥处，安全编码器的接线编号选择。根据电气设计图纸，如果使用安全编码器1接口，选择 encoder1，如果使用安全编码器2接口，选择 encoder2。
⑦处，如果行走电机使用的编码器的安装计数方向反向，则勾选，否则不勾选。
⑧处，配置行走电机使用的安全编码器的减速比。与前文相关减速比的配置相同。可以选择自动或者手动模式配置，需要注意的是，根据电气设计图纸确定正确的减速比。
除SLS以外，其他的配置可参考差双编码器型单舵轮底盘车的配置，不再赘述。

### 2.3.1.2 安全模型导入
有多台完全相同的车的时候，我们配置好一台车的安全模型并且经过验证准确可靠后，可以直接导出为安全模型文件，在其他车中直接导入，减少了重复配置，并保证了一致性。
进入安全模型，点击下图②中的加载，找到已经保存好的安全模型文件的存储路径打开即可。

## image.png

### 三. 测试
### 3.1 功能测试（急停 避障 激光触发  有提示 ）
安全机器人的常规性能测试可参考常规车的造车文档中关于调车部分的描述，调车，除此以外，需要对安全型机器人特有的一些功能进行测试，包括所有的安全传感器的功能是否正常。例如，急停、避障、碰撞检测等。
急停：正常行驶过程中，拍下急停，看一下能否及时停车，车体是否报错。
避障：在车体正常行驶路径上摆放障碍物，观察是否能在障碍物前有效停车。
安全激光切区：确认安全激光是否可以有效切区。
安全编码器：安全编码器的传动是否正常，转动方向和增量方向是否匹配。
碰撞检测：接触式碰撞模块的检测，是否能正常触发 DI，有效停车。
以上简单测试，重在观察功能能否正常使用，在使用这些功能的时候是否有针对车体本身配置的一些报错等，此处不对精度做具体要求。
### 3.2 性能测试
性能测试可参考普通车造车文档中关于性能测试的章节进行。
