# 机器视觉库位管理功能场景适用评估工具使用 SOP

### 机器视觉库位管理功能场景适用评估工具使用 SOP

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.8.29

## 初版

## 使用中

## 概述
    在列库库位管理项目的前期评估阶段，方案的可行性分析、库位布局设计、相机安装位置规划、现场风险因素的规避等问题，对项目的顺利实施起着决定性作用。为了帮助前方人员对以上问题做出最正确的决策，在RoboShop中提供一个评估工具，使用方法如下。
## image.png

## 界面总览
## image.png

提示：鼠标右键旋转场景，滚轮按下拖动场景，滑动滚轮放大缩小场景。
## 使用步骤
## A. 选择相机参数
右侧参数设置区下拉框选中支持的相机品牌，下方会显示相机对应的参数。目前仅支持海康监控相机。该部分相机参数为默认值，无需修改。
## image.png

## B. 设置库位信息
## image.png

从上到下依次库位的长、宽、高、排列方式等信息，设置的时候，中间场景绘制区会显示货物的尺寸。
## C. 设置库区信息bin
## image.png

设置一个相机监控下的列库区域，上面参数表示一个相机监控5列库区，每个库区6个库位，每列库区间隔0.5m，每个库位间隔0.2m，这部分信息即为库区布局，需根据实际情况调整。调整同时，中间场景绘制区会显示库区布局。
## D. 设置有效视野
## image.png

有效视野是指能够该视野范围内能够稳定识别的区域。监控相机理论上可以看很远，但是实际情况中离相机越远，目标物体在图像中的尺寸越小，视野范围越容易被阻挡，会造成库位识别的稳定性下降甚至无法识别，所以需要对相机有效视野进行限制。 有效视野与相机的安装位置、地面库位的尺寸等因素相关，需要根据实际情况设置。有效视野可根据经验设定，一般在10*15m范围内有效，特殊情况下需要搭建1:1场景测量。
提示：有效视野是根据相机位置设定的。
## E. 调整相机安装位姿
在列库场景下，当库位布局设定好后，以库区的左下角为原点，建立坐标系，在此坐标系的基础上，调整相机的安装位姿，使得相机观测到整个库位区域。
列库方案的关键在于叉车必须从列库头部进入取放货，取是从头部最近一个货物开始取，放是从离头部最远的一个空库位开始放，相机必须安装在列库头的斜上方，与叉车进入的方向同一侧。
## image.png

### 在以上相机安装参数下，场景绘制区的如下图所示：
## image.png

其中：灰色区域表示相机有效视野，黄色框线表示库位框，蓝色方块表示最大尺寸的货物，浅绿色锥形区域表示相机的视野。
## F. 库位布局、相机安装位置评判
在以上参数设置好后，场景绘制区的右上角会生成一张此安装位姿的相机视角下的图片，点击该图片放大，根据该图片信息，评判库位布局以及相机安装位置是否满足要求，评判依据如下：
库位区域（包含货物）完全在相机视野之下。
相机视野下，货物不遮挡相邻列的库位框。
点击右下角检查按钮，软件会计算当前相机安装位姿和库位布局是否存在遮挡。存在遮挡的列会标红，需要修改相机位置或库位布局，直到没有所有库区符合要求。
## image.png

### 示例分析：在上述参数配置下，生成的相机图片如下图所示：
## image.png

根据上述两条准则，相机视野没有完全覆盖所有货物，且第二列货物遮挡第一列的库位框，第四列的货物遮挡第五列库位框，因此上述库位或相机布局不满足要求。
调整库位布局，或者相机安装位置，使得视野满足要求，如下图所示：
## image.png

## G. 多相机视野评估
目前同一个场景只能评估单个相机视野，多个相机需要再不同视野下分布，添加多个相机，按上述流程依次评估。
## image.png

## 注意事项
### roboshop版本需≥ v2.4.1.183
相机必须安装在列库头方向，既叉车进出取放货方向，既Y轴负方向，斜视库区。
列之间的间隔最好留有余地，不要卡在软件模拟的极限间隔上，防止实际环境下测量及安装误差等情况造成遮挡发生。
