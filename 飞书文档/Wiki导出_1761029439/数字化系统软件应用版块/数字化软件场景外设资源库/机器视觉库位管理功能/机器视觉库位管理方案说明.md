# 机器视觉库位管理方案说明

## 机器视觉库位管理方案说明

## 版本

## 更新日期

## 更新说明

## 文档状态

## 维护责任人

## V1.0

### 2024.9.11

## 初版

## 使用中

## 机器视觉库位管理功能 可实现功能概述
## 机器视觉库位管理功能 列库管理场景说明
## 1. 场景痛点
    目前我们参与的大部分项目都需要进行库位管理，以确保现场的业务流程能高效有序的执行。
目前有较多的库位管理方式，其中成本最低的就是通过人工管理结合调度系统的逻辑管理，但是这种方式对工人的操作要求较高，可能需要工人长时间值守，而且容错率较低。
其次，就是通过光电传感器采集库位信息，并通过 PLC 等设备，将采集到的库位信息传递给上位系统，用以计算库位的占用状态。相对来说，这种方式的技术门槛较低，但是其物理成本较高；而且一旦库位布局改变，又得重新重新部署，库位数量越多，工作量越大。
相比之下，采用机器视觉判断库位状态，不仅能规避“人工管理”的低容错率，还能减少部署光电传感器及配套设备时，产生的大量的人力劳动。
### 2.场景解决方案说明
    通过视觉算法部研发的机器视觉库位管理功能，处理摄像头采集到的包含库位的图像信息，从而识别出目标库位的占用状态。并且可通过指定的网络接口，查询目标库位的状态。实现的大致过程如下。
## 1.相机安装的 3D 示意图如下所示：
注：下方的黄色三角形表示相机。青色区域表示这款相机在指定高度时，可看到的地面区域。灰色的立方体表示被识别物体的尺寸模型，下图展示的是相机在不同安装位置下的可视范围呈现。
1682305248270-232d8863-0314-4c85-87e4-9d3245bdba36.png

## 图：斜装的视场效果图（ 推荐方式 ）

### 2.以相机斜装为例，相机采集到的图像信息如下所示：
注：黄色的表示库位边框，绿色的底色表示"空"库位，红色的底色表示"满"库位。
img_v3_02ef_533f2f5f-b8b8-459d-98e7-ba1fa20cb61g.png

### 机器视觉库位管理功能 库位管理方案的优势
基于深度学习，自动探测库位有无，减少人工成本。
在相机视野内，可动态调整规划库位方案，避免硬件设备的手动重复
部署周期可控，场景改造灵活。
人机共用场景可覆盖，可对人为行为进行检测。
### 方案所需硬件和部署事项以及对应的要求说明

## 事项

## 类型

## 事项要求说明

## 环境条件

## 室内安装条件

必须是 室内 的环境（室外的光照条件不稳定，自动曝光的相机成本太高）。

有稳定且明亮的光照条件，被识别区域内无反光物件。
需要注意被识别区域内，是否会受到太阳光斑的影响。

## 库区、库位

## 类型

只支持 识别 列库 的占用状态；
不支持 立库占用状态的识别；
只支持 库位物料有无得判断；
## 不支持 库位上物料种类的判断

## 库位信息

## 只能识别库位的占用状态
被占用：目标库位被货物占用。
未占用：目标库位上没有货物。
被遮挡：无法判定目标库位的真实状态。

## 布局

## 可支持的库位布局如下：
单个库位。（不推荐，技术实现没有困难，需考虑相机的利用率，成本会变高，推荐一个相机覆盖一排库位的方式）
单列库位。
多列库位呈矩阵排列的库位。

## 库位间隙

对于同一列库的前后两相邻库位而言，只要确保机器人在操作库位上的货物时，不会干扰后面库位上的货物即可。

以叉车为例：叉车顶起第一个库位上的货物之后，插齿的末端不会干扰第二个库位上的货物。
对于相邻列库位而言，列之间需要预留足够的间隙，确保库位放置最大高度的货物时，在相机视野下仍不会遮挡相邻列的库位框。具体到列库之间预留多大间隙，推荐使用工具评估。

## 堆叠

库位上不允许堆叠货物。
### （ 机器人不能在同一个库位上连续取货，或者连续放货！ ）

## 货物体积

货物体积要与库位大小相适应，货物的占地面积需占库位的四分之三以上，货物高度需满足在相机视野下遮挡所在库位边框四分之一以上长度的要求。

例如：空栈板高度太低，当相机安装较高时，无法遮挡库位边框，导致库位状态错误。
当库位面积1m*1m时，在库位里放置一本书，占地面积太小，无法判断库位占用状态。

## 用法

分库区存放空载具和满载具，以提高识别的精确度。

## 部署

允许我们通过涂料、或者胶布，在地面标记库位的边框。
涂料、胶布的颜色与地面颜色得有较大反差。
有相机安装的条件（在指定高度 吊装 或 侧装，同时相机可看到库位区域）

## 载具、货物

## 载具、货物

被识别的物体，或者物体的外包装的颜色需要与地面颜色、库位边框颜色有明显的反差。

被识别的物体表面不能有反光。

## 相机 & 识别

## 识别技术

目前 只支持 2D 相机识别；
不支持 3D 相机的识别。

## 识别原理

在 Roboshop 的相机界面依据库位的实时画面来进行库位绘制并推送到机器视觉库位管理功能；
机器视觉库位管理功能识别到货物会自动绘制标记该货物的矩形框；
机器视觉库位管理功能将该货物的矩形框与绘制的库位进行重合度计算，若重合度超过某个阈值则视为该库位被占用；

## 相机选型

目前只适配一款 海康相机 。SEER 内部料号：RM001020009
型号： 2DE2D40IW-DE3/W/XM(C0)(SMBG)(S6)。

## 安装高度

要求 3m~10m。

## 安装方式

## 客户允许我们安装相机的情况下 ：
### 相机必须是安装在固定位置，无明显抖动，安装姿态如下：
正装，斜视。
相机采用 12V DC POE 供电，为了保证效果最好制作可上下、左右、前后 角度，位置可调的安装支架以固定相机；
确认使用 机器视觉库位管理功能 方案之前可以如下方式进行场景评估，大致得出场景所需要的相机个数，空间布局信息：库位管理功能快速评估工具使用 SOP；
现场进行相机安装时，可参考如下安装操作 SOP:库位管理功能相机安装操作 SOP

## 使用要求

相机和库位之间的空间，不允许任何遮挡。

## 服务器

## 推荐选型

### SEER 内部料号：RM009030055
台式机/ROG魔霸X 2024水冷旗舰/14代酷睿i7-14700KF/32G/1TBSSD+1TBHDD/RTX4080 16G/ROG
## 显卡:英伟达 RTX4080
## 运存：16G
## 网卡：有线无线网卡都需要
## 硬盘内存/运存：1T/32G

## 应用程序

## 软件

### SEER 内部料号：SW004000010
软件安装按照如下 SOP 进行操作：Roboview 的列库库位管理功能实现 SOP

## 操作系统

## 系统

需要使用 Ubuntu 18.04 的操作系统环境，可以按照如下 SOP 进行：
### Roboview 宿主操作系统环境的安装和搭建 SOP

## 网络

## 连接方式

所有 机器视觉库位管理功能 相关的网络设备， 必须有线连接 。

## 带宽

千兆级别。

## 网线规格

## 6 类千兆网线。

## 交换机

5-10 口的千兆交换机。
## 库位管理应用说明

## 编号

## 库位管理区域示意图与描述

## 说明

## 要求

## 1

同侧取货与放货。

机器人只能从库位队列的同一侧取货，或者放货。
1682044174978-753af1f5-3d90-4292-ba3a-aacb8eec5966.jpeg

推荐 采用这种操作方式。
库位管理比较简单。

机器人和工人都按照图中要求的取货和放货方向，依次操作每个库位队列的库位。
### 将相机安装在库位队列的入口处，告知机器人：
最近的可取货的库位；
最远可放货的库位。
对于这种操作方式，人机混用，和机器人专用没有区别。
对于人工和机器同时在栈板列操作的情况，需要保证 人工作业的时候相机的可视范围能够覆盖

## 2

一侧取货，另一侧放货。

机器人从库位队列的一侧放货，从另一侧取货。
1682044301667-6cb17cd9-5297-4f4e-87fd-5c291e5e8ae5.jpeg

可采用 这种操作方式。
部分特殊场景，可以才用这种操作方式，例如两个线体之间的缓存库区。

机器人取货，工人放货。
将相机安装在取货的出口处，告知机器人最近的可取货的库位。
工人取货，机器人放货。
将相机安装在放货的入口处，告知机器人最远的可放货的库位。
对于人工和机器同时在栈板列操作的情况，也需要保证 人工作业的时候相机的可视范围能够覆盖
只有机器人取货或者放货。
## 相机数量有限
为了预防机器人放货时发生碰撞，将相机安装在放货方向的入口处，告知机器人最远的可放货库位。
另外，异常情况下，工人维护库位之后，需要手动更新库位状态。
## 相机数量充足时
分别在放货入口处，与取货入口处安装一个相机相机；告知机器人最近的可取货库位，和最远的可放货库位。
这种情况下，即使工人取走或者放下货物，也不需要再手动更新库位状态了。

## 3

两侧都能取货与放货。

机器人既能从库位队列的一侧取货与放货，还能从另一侧取货和放货。
1682044783990-bfebbf2d-4093-4336-94d6-1902ee449770.jpeg

不推荐 采用这种操作方式， 不考虑 采用此方式。
### 库位管理会非常繁琐！而且取放货的效率比较低下

## 不推荐
尝试将其转化为第一种操作方式，即“同侧取货与放货”。

## FAQ
### 机器视觉库位管理功能 可以推广到海外区域么？
## 问题描述
  由于目前适配的相机品牌在北美市场中被限制和制裁，欧洲由于有工人相关的隐私法案保护，所以一般海外不建议推广 机器视觉库位管理功能。如果一定要用可以考虑本地平替相机。
## 解决办法
## 根据以下要求选择相机：
相机支持 RTSP 流媒体传输协议。
其他参数参考已经适配过的海康相机即可。
研发适配预计一周的时间可完成新型号相机的适配工作。
机器视觉库位管理功能 是否可以和调度系统运行在同一个服务器上？
## 问题描述
   视觉服务器（即运行 机器视觉库位管理功能 的服务器）是否可以同时运行调度系统（RDS+Core），如果可以的话，能降本。
## 解决办法
   机器视觉库位管理功能 主要是通过服务器的 高性能独立显卡 （即 GPU，例如 RTX4060、RTX4070、RTX4080）处理数据的，而调度系统是通过服务器的 CPU 处理数据的。所以：
当调度系统和 机器视觉库位管理功能 的运行负载都不高时，机器视觉库位管理功能 和调度系统就可以部署在同一台视觉服务器上；但是无论如何，机器视觉库位管理功能 都是无法运行在调度服务器（DELL T140/T150）上的。
当调度系统和 机器视觉库位管理功能 其中一个的运行负载较高时，为了确保各自都能稳定运行，建议将两者分别部署在各自的服务器上。
如何判断运行负载：交给对应的研发同事判断。
### 机器视觉库位管理功能 是否可以识别库位上的货物信息？
## 问题描述
  现场的库位上会存放多种类型的货物，机器视觉库位管理功能 是否可以识别库位上存放的货物信息？
## 解决办法
  机器视觉库位管理功能 库位管理方案，只能判断一列库位中，可见的库位是否被托盘、或者货物占用，但是无法识别库位上堆放的到底是什么物件。
可以通过逻辑库位管理，和必要的人工操作，以达到此目的。
机器视觉库位管理功能 管理的库位如果是 AMR 和车共用的情况下，人工取放货有什么要求么？
## 问题描述
   列库区上人员和机器人共用库位的情况下，人工只能沿着列库方向取放物料么？可以从侧面进入么？
## 解决办法
   可以支持，需要 AMR 业务层系统生成任务之后，在列库前进行取放库位内货物的时候需要再次获取 机器视觉库位管理功能 提供的库位的状态，做一次二次确认。
