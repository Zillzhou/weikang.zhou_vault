# 调度采用新算法的说明文档

## 调度采用新算法的说明文档

从 0.2.0.240828 版本开始，RDSCore 将默认使用新算法
随着调度系统的不断迭代，我们计划推出一套全新的调度算法，本文档旨在阐述对新算法进行介绍、并阐述其特点、适用项目、及使用时的注意事项
## 算法简介
新的调度交管算法名称为 R-MAPF，相较于 G-MAPF，新算法存在两大显著提升：
## 更简洁的使用方式
## 无需设置复杂的调度参数
### 无需绘制繁琐的互斥区等高级组（不可避让点的高级组依然支持）
## 更稳定的交管策略
## 更少的死锁
## 更合理的等待/绕路
## 新算法暂不支持的项目场景
### 项目场景中存在多个楼层，并使用电梯进行跨楼层（已支持）
### 需要机器人根据电梯实时拥堵情况选择最优电梯的需求
### 需要在调度层使用机器人自由导航绕行的现场
## 存在外部互斥区的现场
## 含有清洁机器人的项目
### 与机器人沿线路绕行功能相耦合的需求，需要调度团队具体评估
与禁止载货/空载/旋转通行等线路属性耦合的需求，需要调度团队具体评估
### 使用叉车货叉调整策略的现场，需要调度团队具体评估
需要特别明确的跟车距离概念的现场（比如在某块区域限制死跟车距离最小就是1m）需要调度团队具体评估
### 需要使用调度上下班策略的现场，需要调度团队具体评估
## 算法使用方法
## 开启及使用
## 开启请参考：RHCR多车路径规划算法
## 参数配置
RHCRGWindow 与 RHCRHWindow 为小车规划时的视野，该配置较短时，小车视野较短，可能会出现来回绕行或过多绕行甚至规划时间缓慢的问题，若参数过大，会导致算法考虑的距离过长进行无效的规划，拖累系统。一般建议长度为 30  - 40 ，现场可根据实际情况从 20 - 50 之间调整。
RHCRHutongMode 配置主要用于胡同路口（或称为断头路），该路口进出只有一个路口，一旦多辆车进入同一胡同，里面的车要出来时，外面的车需要绕一大圈。顶升车场景下，该配置为 0 时，不建议任务下发时多辆车往同一个点下发，若场景刚需往同一点下发，则需要将该配置改为 1 。料箱车场景下，因货道较长，建议该配置为 0 。
### fixed_priority参数改为True
若希望正在行驶的车绕过正在当前位置执行任务的车，可以开启RHCREnableDetour参数
### 其他配置为特殊场景下的内部逻辑，具体配置请咨询调度团队
## 特殊说明
地图一般建议使用长度大致均匀的路线，避免过长的路线，如果有，建议分割成两个或几个点。
若现场条件允许，地图尽可能绘制成两条单行道作为主干道，主干道间可多设置来回行走的路线。
地图绘制请尽可能按照 “所见即所得” 的原则绘制，即路线、点位之间尽量避免重合，若有重合，在重合点位多画一个点，将线分割成多条路线。
## 问题处理
规划失败时 Core 上会有报错 “planning failed” 字样，此字样后有小车编号，此时需要将该车拍急停后挪到其他远离小车密集区，其他小车会自动恢复。
## 日志分析请参考：RHCR日志结构及分析
