# 拼合单

## 拼合单
## @丁禹伯
## 拼合单是什么
拼合单是基于普通运单的格式，实现的一种更加特殊的运单格式。拼合单在调度中会拆解成一个取货运单和一个放货运单。取货运单和放货运单都是普通运单。只有这两个普通运单都成功完成时，拼合单才会完成。取货运单和放货运单不是连续执行的。多个起点相近的，终点相近的拼合单，可以组织成先在起点处取满货物，然后一起搬运到不同终点放货，这样提高了搬运效率。拼合单适合车上可以负载多个货物的机器人，比如料箱机器人。
拼合单简化了下发运单的格式。
拼合单充分利用了料箱车的车上库位，提高了搬运效率。
1655198042103-ac54415d-dfab-4446-8931-ed57340a8a24.jpeg

拼合单中将取货运单和放货运单的执行顺序原则是完成所有任务所需的路径距离尽可能短。
## 如何定义取货运单和放货运单
在拼合单中，第一个目标点是为取货运单，第二个目标点为放货运单。取货运单的 binTask 和放货运单的 binTask 分别由参数配置中 FromBinTask 和 ToBinTask 设置。
如果一个普通运单中 Block 中的 binTask 与参数配置中的 FromBinTask 相同，我们就指该 Block 为取货 Block。如果该运单只有一个 Block ，那么该运单就是取货运单。
如果一个普通运单中 Block 中的 binTask 与参数配置中的 ToBinTask 相同，我们就指该 Block 为放货 Block。如果该运单只有一个 Block ，那么该运单就是放货运单。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## FromBinTask

## 参数配置-导航

## string

## Load

## ~latest

## 取货运单的 binTask 值

## ToBinTask

## 参数配置-导航

## string

## Unload

## ~latest

## 放货运单的 binTask 值

## 如何处理优先放的库位
在机器人的模型文件中，如果容器名称配置为 999 ， 并且 999 容器里有货物，那么需要优先放 999 容器里的货物，机器人才能继续取放货。
对于料箱机器人，如果料箱机器人的货叉机构里面有货物，那么在执行拼合单的放货任务时，需要优先放货叉机构里面的货物。因此，我们可以在机器人模型文件中配置 容器名称 称为 999 。在料箱车脚本中，将 999 容器名称定义为货叉机构。
## 如何处理拼合单的优先级
## >0.1.9.231215
拼合单的优先级和子订单一致。收到高优先级拼合单时，会寻找距离拼合单起点最近的机器人，
如果最近的机器人当前正在执行订单，且预接了其他订单，那么会“插队”执行高优先级订单，且执行过程中，接到新的低优先级拼合单也无法“插队”，执行顺序为：
机器人正在执行的订单（此处订单表示拼合单的取货/放货任务，而不是整个拼合单）
## 高优先级拼合单的取货任务
## 高优先级拼合单的放货任务
## 机器人之前预接的订单
如果机器人没有执行订单，开始执行，执行过程中，接到新的低优先级拼合单也无法“插队”，执行顺序为：
## 高优先级拼合单的取货任务
## 高优先级拼合单的放货任务
## 其他订单
## 如何连续取放
## >0.1.9.240615
拼合单可以实现连续取放，如下图，给小车发送任务去1取货放置6，去2取货放置5，去3取货放置4，小车接到任务按时间排序为1-6-2-5-3-4，希望小车执行任务按照1-2-3-4-5-6顺序执行，需要修改机器人模型文件 ChooseAgv->consecutiveLoadUnload
