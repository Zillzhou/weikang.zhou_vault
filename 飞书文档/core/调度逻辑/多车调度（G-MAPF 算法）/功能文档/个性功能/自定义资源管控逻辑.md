# 自定义资源管控逻辑

## 自定义资源管控逻辑
## 什么是资源管控
如下图所示，1 2 3 4 5 代表四个点位，红绿黄矩形代表三台机器人，资源管控指的是机器人位于不同位置时，需要占用哪些空间资源（点位、线路等）

## G-MAPF 默认的资源管控逻辑
## 依旧以上图为例阐述：
## 红车：
若机器人在点位 4 做原地任务，那么只占用点位 4 这一个点位资源，此时蓝车可以通过路线1-2-3
若机器人在执行从点位 2 走到 4 的任务，那么在机器人上报这个任务完成前，会占用点位 2 和 4 两个点位资源，此时蓝车不可以通过路线1-2-3，只能停在点位 1；红车上报任务完成后，红车释放点位 2 资源，只占用点位 4 一个点位资源，蓝车此时可以通过路线1-2-3
## 黄车：
占用点位 2 和 5 两个点位资源，蓝车此时无法通过路线1-2-3
## 默认逻辑的缺陷
对于上述逻辑 1-a 的情形，如果此时红车在做识别、二次调整等动作，动作幅度不确定，此时蓝车在路线1-2-3上行走，存在撞车风险
对于上述逻辑 1-b 的情形，如果此时红车只是正常到点动作，不涉及二次调整，那么这个资源的释放速度就有点慢，一方面观感不好，另一方面也会降低效率，甚至造成拥堵
## 允许自定义的资源管控效果
## 对于缺陷 1，希望达到的效果如下图

对于缺陷 2，希望达到的效果是默认快速释放资源，只对涉及二次调整的机器人慢释放资源
## 自定义实施方法
订单报文中增加字段adjustInfo字段用于填写机器人执行此订单时会进行二次调整的位置及范围大小，详见文档创建运单
允许用户直接通过参数G-MAPF-FixOperation设置快速释放资源策略
在订单中使用 adjustInfo 字段实现自定义调整动作范围示例
去目标库位执行任务并指定机器人在特定点位的调整动作范围（圆形范围）
## {
  "id": "task5",                    // 运单 id，需要宇宙唯一
  "vehicle": "AMB-01",              // 指定机器人（选填）
  "blocks": [{                      // 运单动作块
    "blockId": "b1",                // 动作块 id, 需要保证宇宙唯一
    "location": "Loc-01",           // 目标库位 Loc-01
    "operation": "JackLoad",        // 执行 JackLoad 动作
## "adjustInfo": [
      {                             // points 字段支持列表和字符串、支持点位名称和库位名称
        "points": ["AP1", "Loc-01"],// 执行此订单时，机器人在 AP1 和 Loc-01 需要做调整动作
        "range": 0.5                // 在上述位置需要以点位坐标为圆心，半径为 0.5m 的调整范围
      },
      {                             // range 字段支持 int 和 double 类型
        "points": "AP2",            // 在 AP2 需要做调整动作
        "range": 1                  // 调整范围 1m
## }
## ]
  }],
  "complete": true                  // 是否封口
## }
去目标库位执行任务并指定机器人在特定点位的调整动作范围（凸多边形范围）
## {
  "id": "task5",                  // 运单 id，需要宇宙唯一
  "vehicle": "AMB-01",            // 指定机器人（选填）
  "blocks": [{                    // 运单动作块
    "blockId": "b1",              // 动作块 id, 需要保证宇宙唯一
    "location": "Loc-01",         // 目标库位 Loc-01
    "operation": "JackLoad",      // 执行 JackLoad 动作
## "adjustInfo": [
## {
        "points": ["Loc-01"],     // 执行此订单时，机器人在 Loc-01 需要做调整动作
        "region": [               // 在上述位置按下方组内顺序连接构成凸多边形调整范围
          { "x": -1,  "y": 1.5 },
          { "x": 0.5, "y": 0.5 },
          { "x": 0.5, "y": -0.5},
          { "x": -1,  "y": -1.5},
## ]
## }
## ]
  }],
  "complete": true                  // 是否封口
## }
## 上方报文对应的机器人占用范围如下图所示

## 实例
设置紫色机器人在目标点调整范围 4m，效果为橙车在紫车二次调整动作未完成前无法通过主干道

### 2024-10-29_143010366.mp4
