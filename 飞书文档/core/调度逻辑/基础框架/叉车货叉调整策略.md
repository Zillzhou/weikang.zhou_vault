# 叉车货叉调整策略

## 叉车货叉调整策略
## @丁禹伯
### 0.1.9.240112
## 叉车货叉调整策略可选设置方式
叉车货叉调整策略指的是：叉车在执行取货和放货任务或不执行动作时，货叉高度应该在哪里调整，调整至什么高度，调整时是需要停下来还是要保持动作连贯性。
## 目前可以通过三种方式控制这些策略：
禁止使用这种方式 。rbk 模型文件 ( 不推荐这种方式) 对于叉车多层库位
如上图所示，rbk 模型文件中 dispatcherParams 可以设置载货和空载时的货叉安全高度
## 调度机器人组属性：
1705028221276-917215c4-9c5a-46af-a1a4-dbe28896f65f.png

如上图所示，调度机器人组属性中可以设置空载和载货时的货叉安全高度，以及在前置点的调整策略
## 动作块 binTask 触发：
可以为特定点位绑定库位，通过触发库位动作的方式实现指定调整逻辑
需要注意的是：rbk 模型文件和调度机器人组属性两种设置方式只能同时选择一个，不然二者会存在冲突；但是 binTask 触发可以同时与任何策略搭配使用
## 叉车取放货任务及可选控制策略
1705036211682-493c633c-17d8-4cf4-9770-e9c0396bca25.jpeg

如上图所示，PP1 为叉车停靠点，AP6 是一个工作站，绑定了库位 Loc-1，库位内有取货和放货两个动作，我们称 LM5 为库位 AP6 的前置点；假设此场景下叉车载货货叉安全高度为 0.1m、空载货叉安全高度为 0.3m
## 取货时：
叉车位于 PP1，处于空载状态，收到去 AP6 的取货任务。若此时货叉高度不是 0.3m：
如果采用 rbk 模型文件策略：叉车到达 LM2 停下来，调整货叉高度为 0.3m，继续运动
## 如果采用调度机器人组属性策略：
若参数 IdlerStopToAdjustHeight 为 true：叉车到达 LM2 停下来，调整货叉高度为 0.3m，继续运动
若参数 IdlerStopToAdjustHeight 为 false：叉车连续运动不停止，并且从 LM2 开始逐渐边走边调整货叉高度至 0.3m
叉车走到 LM4，处于空载状态，此时货叉高度为 0.3m，而 AP6 的取货动作 start_height 为 0.4m，此时可选择策略有：
如果采用 rbk 模型文件策略：叉车到达 LM5 停下来，调整货叉高度为 0.4m，运动到 AP6，插取货物并抬升货叉至 0.8m
采用调度机器人组属性策略：叉车到达 LM5 停下来，调整货叉高度为 0.4m，运动到 AP6，插取货物并抬升货叉至 0.8m
## 在 AP6 库位设置一个动作：
## "adjustHeight": {
  "operation": "ForkLoad",
  "fork_mid_height": 0.4,
## "end_height": 0.8
## }
叉车到达 LM5 后不停止，并开始边走边抬升货叉至 0.4m，在 AP6 插取货物并抬升至 0.8m
在 LM5 设置一下动作：与 AP6 设置的区别是现场 LM5 与 AP6 之间的距离往往很短，很难抬升到位
## "adjustHeight": {
  "operation": "ForkHeight",
### "fork_mid_height": 0.4
## }
叉车在 LM4 不停止，并开始边走边抬升货叉至 0.4m，在 LM5 时也不停止，直接前往 AP6 插取货物并 抬升至 0.8m
叉车取货完成，处于载货状态，此时货叉高度为 0.8m，此时叉车执行下一个任务即将离开，此时可采取的策略为：
如果采用 rbk 模型文件策略：叉车到达 LM5 停下来，下降货叉至 0.1m（载货货叉安全高度），运动至目标点
## 如果采用调度机器人组属性策略：
若参数 cargoStopToAdjustHeight 为 true：叉车到达 LM5 停下来，调整货叉高度为 0.1m，运动至目标点
若参数 cargoStopToAdjustHeight 为 false：叉车连续运动不停止，并且从 LM5 开始逐渐边走边下降货叉至 0.1m
## 放货时：
### 放货全流程策略与上述取货一致，此处不再赘述
需要注意的是，叉车在走一些曲率较大的曲线、或地面不平整时，如果载货时采用边走边调整货叉的策略，存在货物偏移甚至跌落的风险，现场应根据自身情况及测试结果谨慎选择合适的策略
## 策略设置方法
调度层的叉车货叉调整策略通过机器人组参数进行设置，具体如下：

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## cargoSafeHeight

## 机器人组属性

## m

### 0.2

## 0

## /

### 0.1.9.240112

## 叉车载货货叉安全高度

### cargoStopToAdjustHeight

## 机器人组属性

## bool

## true

## /

## /

### 0.1.9.240112

true：载货时叉车在前置点停下来调整货叉高度；false：载货时叉车从前置点开始边走边调整货叉高度

## idlerSafeHeight

## 机器人组属性

## m

### 0.1

## /

## /

### 0.1.9.240112

## 叉车空载货叉安全高度

### idlerStopToAdjustHeight

## 机器人组属性

## bool

## true

## /

## /

### 0.1.9.240112

true：空载时叉车在前置点停下来调整货叉高度；false：空载时叉车从前置点开始边走边调整货叉高度

## 注意事项
rbk 模型文件和调度机器人组属性两种设置方式只能同时选择一个，不然二者会存在冲突；但是 binTask 触发可以同时与任何策略搭配使用
叉车在走一些曲率较大的曲线、或地面不平整时，如果载货时采用边走边调整货叉的策略，存在货物偏移甚至跌落的风险，现场应根据自身情况及测试结果谨慎选择合适的策略
由于叉车存在正走和倒走两种运动方式，在调整运动方式（原地旋转）时，会打舵角，这个动作会与调整货叉高度同时进行，所以可能会出现机器人设置了边走边调整货叉高度策略，但是由于要原地旋转打舵角，导致感官上产生原地停止调整货叉的现象。
