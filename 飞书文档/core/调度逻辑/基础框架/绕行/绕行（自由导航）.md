# 绕行（自由导航）

## 绕行（自由导航）
## @杨达
在遇到障碍物或者报错机器人时，调度系统会临时允许机器人离开路线，使用自由导航功能绕过障碍物，以提高效率。
## 绕行区域
## 机器人在绕行区域中被阻挡时，才会绕行
## AvoidObsRegion 组
## 绕行逻辑
## 何时绕行
机器人 在执行任务 过程中，遇到障碍物时，机器人通过激光雷达/3D相机检测到障碍物后，会在障碍物前停下，一段时间后，调度开始控制被阻挡的车辆进行绕障
机器人 在执行任务 过程中，被报错的机器人阻挡时，会停在其后，一段时间后，调度开始控制被阻挡的车辆进行绕障
## 机器人不能绕行的情况
## 没有执行任务
## 没有被阻挡足够长的时间
## 没有开启绕过报错车的选项
## 机器人没有直接被报错机器人阻挡时
## 机器人有故障时
## 机器人无法规划出绕行路线时
## 机器人被阻挡时的位置不在绕行区域中
机器人被阻挡时处于绕行区域中，但是不属于绕行区域配置的机器人组
### 机器人在执行动作不是空或者 Wait 的任务
## 机器人在执行需要识别的任务
## 机器人被其他绕行机器人阻挡
## 绕行区域内有其他绕行机器人
## 绕行目标点有故障机器人或者障碍物
## 参数配置

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## AvoidErrorRobot

## 导航

## -

## false

## -

## -

## ~latest

## 绕过故障机器人功能的开关

## AvoidPlanDist

## 导航

## m

## 3

## 1

## 100

## ~latest

### 绕障目标距离当前位置的最小距离（沿路径）

### BlockToAvoidErrorRobotTime

## 导航

## s

## 10

## 0

## 100

## ~latest

## 被故障机器人阻挡多久后开始绕行

## BlockToAvoidTime

## 导航

## s

## 2

## 0

## 100

## ~latest

## 被障碍物阻挡多久后开始绕行

## 报错

## 报错码

## 问题描述

## 解决方法

## 53601

剩余线路不够长。
因为绕过障碍物需要一定空间，但是当前机器人剩余的线路不够长，没有空间绕障。

## 移除障碍物或者报错机器人
### 获取机器人控制权，手动导航到目标点再释放控制权

## 53602

任务有动作，需要去前置点。
因为绕行使用自由导航功能，到点的方向和线路方向可能不一致，绕行之后再执行取放货等任务时，精度无法保证。

## 移除障碍物或者报错机器人
### 获取机器人控制权，手动导航过障碍物再释放控制权

## 53603

绕障空间中有正在移动的机器人。
因为绕障使用自由导航功能，绕障机器人的行动轨迹不固定，可能会阻挡正在移动的机器人。且绕障一般在主干道进行，为了使绕障任务尽量少影响其他机器人，在绕障空间中有其他移动的机器人时，不进行绕障。

## 等待移动机器人离开绕障区域

## 53604

绕障空间中有调度没有控制权的机器人。
调度没有控制权的机器人的运动无法预测，进行绕障会出现危险，所以不进行绕障。

## 挪开调度没有控制权的机器人

## 53605

绕障空间冲突。
多个机器人都需要绕障，但是绕障空间有冲突。因为绕障的运动轨迹不固定，多个机器人同时在相交的空间内绕障可能会发生死锁，所以不进行绕障。

## 等待高优先级的机器人完成绕障

## 53606

绕障目标点有报错机器人。

## 挪开目标点报错机器人
## 挪开障碍物或报错机器人

## 53607

有对向绕障的机器人。
53605的特殊情况。有两个机器人处于相对的方向，且同时需要绕障，并且绕障空间相交，等待的机器人会报此错误。

## 等待高优先级的机器人完成绕障

## 53608

绕障目标有障碍物。
绕障时发现目标点有障碍物，无法完成绕障动作。调度有重试机制，但是次数有限，不能处理所有的情况。

## 挪开绕障目标点的障碍物
## 等待调度重新规划绕障目标

## 53609

所有绕障目标都尝试失败。
绕障时，调度会计算出一组目标，逐个尝试。但是所有的绕障目标点都无法到达，所以不能继续绕障。

## 挪开障碍物或报错机器人

## 53610

不能通过增大绕障空间的方式重试任务。
绕障时，机器人上报了绕障错误，调度的所有其他目标点都无法尝试。

## 挪开障碍物或报错机器人
## 使用方法
在场景中构建绕行区域，并将需要绕行的机器人组添加到绕行区域、
1681290045361-08332438-d92e-4915-b59f-f603700a8881.png

如上图配置，表示 BlockGroup05 中，机器人组 new 里的机器人可以绕行
绕行区域尽量设置在主干道的直路上，且需要保证物理空间足够绕行。对于存在机器人激光看不到的障碍物的区域，使用禁行线来避免机器人在绕障时误入。
配置参数，调度的绕行相关参数参考 参数配置 ，机器人相关的参数配置参考 AvoidObsRegion 组
配置参数时，
注意不要把绕障规划距离 AvoidPlanDist 设置的太小，否则可能无法规划出绕障路线；也不要设的太大，否则会导致难以申请到绕障空间；
注意不要把单机器人的停障距离 ObsStopDist 设置的太小，否则可能无法规划处绕障路线；也不能设的大于绕障规划距离 AvoidPlanDist，否则会导致机器人绕不过障碍物；
