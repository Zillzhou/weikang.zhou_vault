# 重分配运单

## 重分配运单
## @杨达
## 解决的问题
订单分配后，执行过程中，可能发现其他车辆更适合执行该订单，需要让订单换车执行。
机器人执行订单过程中，可能发现其他订单更近，需要让车换订单执行。
## 可以重新分配的必要条件
### 订单在执行时，还没有将第一个取货动作块的终点发送给机器人
### 有距离任务点更近的空闲机器人，且符合执行条件
## 优先被重分配的情况：
### 执行任务时，机器人电量低于chargeOnly
### 机器人在执行任务过程中，被设置为不可接单
## 订单状态的变化
## 重新分配有两个阶段：
## 解除当前分配
## 再次分配
### 订单被解除分配后，下列两个字段发生变化：
state 状态从 RUNNING 变为 TOBEDISPATCHED
## vehicle 字段变为空字符串
### 订单被重新分配后，下列三个字段会发生变化：
state 状态从 TOBEDISPATCHED 变为 RUNNING
## vehicle 从空字符串变为机器人名
## reassignLog 中增加一条记录
## 功能开关
## 在还有订单没有执行完时，不建议开启
在 参数配置中将 Reassign 改为true来开启重分配功能
## 开启后，之前分配的订单也可能会重分配
## 和拼合单的关系
重新分配运单功能开启后，会实时计算最优的接单机器人，调度不再进行预接单，无法使用拼单功能
## 拼合单分拨单

重分配是运单可以重新分配给更适合的车，车也可以重新分配给更适合的运单

## 放货运单不能被重分配
