# 多车充电时的充电桩匹配原则

## 多车充电时的充电桩匹配原则
## @丁禹伯
## 版本：0.1.9.240514
## 背景
如果同时有多台机器人需要充电，则涉及到充电桩的分配问题，目前调度支持两种分配算法
## 基于机器人序号的大小进行分配
## 基于全局加权距离最小进行分配
## 参数

## 名称

## 位置

## 默认值

## 范围

## 含义

## AdvancedAutoOrder

## 参数配置-导航

## false

## (true, false)

## 高级自动任务开关

如不开启此参数，只能使用算法 1 进行分配，打开后可在 1 2 两种算法中进行选择

## MatchChargers

## 参数配置-导航

## false

## (true, false)

## 全局匹配充电桩

如不开启此参数，则采用算法 1 进行匹配，打开后则使用算法 2 进行匹配

## 匹配原则
## 基于序号的匹配
每台机器人在调度中拥有一个编号，当多台车需要充电时，会在一次循环中依次遍历这些机器人，为每台机器人寻找距离最近的充电桩，遍历的先后顺序是按照编号从小到大进行的，由此可见此策略是贪婪的，机器人只考虑自身最优的充电桩，不考虑其他机器人，并不能保证匹配结果全局最优
## 基于全局加权距离最优的匹配
此策略基于最小费用最大流的思想，会在尽可能多的匹配充电桩的情况下，保证匹配结果为代价最小，此代价为机器人当前位置到充电桩的加权距离，目前只对电量进行加权处理，由此不仅可以实现匹配结果的全局最优，还可实现优先为低电量机器人匹配充电桩的效果
需要注意的是，在采用此策略后，调度会每隔一分钟为此一分钟内满足充电条件的机器人匹配充电桩
## 示例
## image.png

以此场景为例，假设 sim_01 sim_02 两台车均绑定了 CP6 CP9 两个充电桩，场景中所有边的长度都是 1，两种匹配的结果分别如下：

## 基于机器人序号的大小进行分配：
### 结果：sim_01-->CP6  sim_02-->CP9

由于 sim_01 序号小于 sim_02，会先为 sim_01 寻找最近的充电桩，结果为 CP6，距离为 3
之后为 sim_02 寻找最近的充电桩，由于 CP6 已经被分配了，故结果为 CP9，距离为 4
## 此匹配总距离为 3 + 4 = 7

## 基于全局加权距离最小进行分配：
### 结果：sim_01-->CP9  sim_02-->CP6

在匹配过程中会考虑多种匹配结果，此匹配结果总距离为 4 + 2 = 6，比第一种距离要小
## 故最终采用此结果
