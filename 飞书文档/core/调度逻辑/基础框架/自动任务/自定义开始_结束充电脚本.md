# 自定义开始/结束充电脚本

## 自定义开始/结束充电脚本

## 最低支持版本：0.1.9.240820
## 简述
默认情况下，我司机器人在到达充电桩时，执行的开始充电指令(operation)固定为 Charge
而在机器人要结束充电并离开充电桩时，我司机器人会自动判断在路径导航前与充电桩通讯断开充电连接
在使用一些非标充电桩或三方充电桩时，可能会需要实现定制的开始和结束充电指令
## 因此开发了定制功能实现此类需求
## 配置方法
### 使用调度模型文件 CustomCharge 实现
## image.png
### 使用模型文件 CustomCharger 自定义充电动作

## 参数

## 位置

## 单位

## 支持输入类型

## chargePoint

## 模型文件

## string

CP1    ["CP1", "CP2"]    ["CP1"]    [CP1 CP2]        推荐使用前两种

## 自定义充电动作的充电点(集合)

## startOperation

## 模型文件

## string

## 单一字符串

开始充电动作，这个动作对应充电点绑定的库位上的 binTask 的 key；详见下方示例

## stopScriptName

## 模型文件

## string

如果脚本名称叫 stop.py，则需要输入 stop.py，而不能是 stop

结束充电执行的脚本名称，注意 .py 后缀不可以省略，详见下方示例

## stopScriptArgs

## 模型文件

## object

## 结束充电脚本的调用指令

### 结束充电时，需要 core 调用结束充电脚本内的指令内容

## 示例
## 案例背景
### 场景中存在 CP1 CP2 CP3 CP4 四台充电桩：
### CP1 和 CP2 需要使用相同的自定义动作
### CP3 需要使用与 CP1 CP2 不同的自定义动作
## CP4 不需要自定义充电动作
## 实施步骤
## 实现 python 脚本
编写 CP1 和 CP2 的脚本，名称为 Charger_1.py，脚本内封装了两个操作：
## StartCharge1：开始充电
## StopCharge1：结束充电
编写 CP3 的脚本，名称为 Charger_2.py，脚本内封装了两个操作：
## StartCharge2：开始充电
## StopCharge2：结束充电
## 修改场景
分别为 CP1 和 CP2 绑定库位，并配置库位动作，如下图：
## image.png
## 为 CP1 绑定库位并编辑库位动作

## image.png
## 为 CP2 绑定库位并编辑库位动作

### 为 CP3 绑定库位，并配置库位动作，见下图：
## image.png
## 为 CP3 绑定库位并编辑库位动作

## 配置模型文件
## 配置 CP1 和 CP2 的自定义充电
## 配置 CP3 的自定义充电
## image.png

## 配置机器人模型文件
需要将机器人模型文件Charge的chargeStartTime同步配置为 0，这样机器人到达充电桩后会执行脚本，否则会报超时导致充电失败
## image.png

## 注意事项及额外说明
如果在模型文件找不到CustomCharger，有可能是因为 roboshop 将模型文件分为了 已启用 已禁用 全部 三个组，并且默认显示 已启用，此时没有启用会找不到，点击 已禁用 或 全部 组后即可显示
如果在模型文件找不到CustomCharge，可能是因为模型文件不是最新的，需要点击拉取模型文件，如果拉取按钮是灰色的，需要从 roboshop 首页重新进入调度页面再次拉取
模型文件支持动态更改，推送模型文件 更改及生效，无需推送场景
## 常见的触发结束充电的情形：
## 充电结束，生成停靠任务
## 充电时接到业务订单
如果模型文件CustomCharger的内容与本文档图示不一致，请更新调度版本（确保调度版本大于此功能最低支持版本）
为什么开始充电只需要填一个指令，结束充电却是一个 json 对象:
这是因为有些自研充电桩结束充电指令较复杂，不仅需要传参operation为脚本内定义的结束充电指令，还需要传入充电桩ip port等信息，一个实例如下：
// 结束充电需要传入 operation chargerIp chargerPort 三个脚本内参数
## "stopScriptArgs": {
  "operation": "StopCharge",
  "chargerIp": "192.168.9.1",
### "chargerPort": "300"
## }
如遇到充电时报错 52202 充电超时，请检查是否正确配置机器人模型文件的startChargeTime为 0
