# 队列停靠（QueuePark）

## 队列停靠（QueuePark）
## @丁禹伯
### 0.1.9.240201
## 高级自动任务支持停车场式布局
## 支持布局分类
## ○：PP 点
## △：CP 点
## □：LM 点
## ☆：AP 点
## 基础布局：
1705978154526-c92235e4-c4fb-4305-aa91-b13a51b2f643.jpeg

## 进阶布局：
1705978097372-c4eb36e5-463b-4e92-9585-ae7a5d2a6565.jpeg

## 普适布局：
1706577364625-aa90fdd1-1d5c-4f73-8fbc-d3092cee1327.jpeg

## 实现功能
## CP 点可选择是否可用于停靠
### 接单时稳定队列头机器人优先（选车模块保证）
### 队列头机器人接单离开后，队列中机器人依次填充
### 队列中机器人需充电，前方机器人依次驶离并寻路返回队列尾
### 停靠队列支持绑定多 CP 点（算法自识别，无需人为指定）
### 队列头机器人离开时，优先走下方路线（布局2，暂不支持）
即使队列中机器人接单，也应保证前方车辆驶离并寻路返回队列尾（次优方案，0.1.9.240911 版本开始支持）
## 使用方法
打开高级自动任务参数 AdvancedAutoOrder（较高版本已删除此参数，默认开启，如发现没有此参数，表明处于打开状态）
## 打开自动停靠参数 AutoPark
打开队列停靠参数 AutoQueuePark    注：上述三个参数默认均是打开的
将队列尾绑定为队列中所有机器人的停靠点，以布局 3 为例，需要将点位 1 绑定为此队列所有车的停靠点，点位 2 3 不强制要求一定要绑定，绑定亦不影响使用
## 为队列中机器人绑定合适的充电点
## 识别停靠队列原理
解析场景时自动识别，如果有单向连接的 PP 点(以前缀 PP 开头的点位)，则将其视为一个停靠队列，以下图为例，会识别为四个停靠队列
## 1-->2-->4-->8-->9
## 1-->2-->4->6-->7
## 1-->2-->4-->5
## 1-->2-->3
布局支持多个出口，如本布局有 3 5 7 9 四个出口；
目前布局只支持单一入口，如本布局仅有 1 一个入口，多入口会导致识别错误；
目前仅支持单向线连接，若采用双向线会导致识别错误；
1706578156110-ee42e4d7-697e-44fa-87f8-8c3c8c076dc9.jpeg

## 停靠队列中机器人的移动原则
### 队列中存在空位时，空位后方机器人应依次向前填充
队列中机器人有任务（0.1.9.240911 前仅支持充电任务）时，任务机器人前方机器人应依次驶离停靠队列并寻路前往队列尾填充
### 当机器人存在多个可移动队列时，遵循下述移动原则：
## 可以直接移动到队列头的优先级最高
### 存在多个可移动至队列头选择时, 取点位数量最少的队列移动
### 没有可移动到队列头的选择时, 取点位最短队列移动
## 视频示例
### 队列头机器人执行任务时，队列中机器人依次向前填充队列

## 队列停靠（QueuePark）.mp4
队列中机器人需要充电时，队列前方机器人依次驶离队列并寻路返回队列尾

### 队列停靠（QueuePark）(1).mp4
## 和 MovablePark 功能的关系
即使不开启 MovablePark，队列中机器人需要出队列时，前方机器人也会让路。
