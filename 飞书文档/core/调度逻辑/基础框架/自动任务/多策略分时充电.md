# 多策略分时充电

## 多策略分时充电
## @丁禹伯
### 0.1.8.221111
通过模型文件实现该功能，可以（在设置的时间范围内）覆盖掉机器人原本的充电参数设置

## 参数名称

## 参数位置

## 默认值

## 支持版本

## SegmentedCharge

## 模型文件

## 不开启

## 20221111~lastest

## 配置多策略分时充电的参数

## 第一步：找到这个模型文件并启用
如果找不到，需要重新进入调度，然后拉取模型文件。
## 如下图：
1667990736444-7578d93b-d33c-4ca3-a1bd-8c1538b30c1c.png

## 第二步：设置捕获参数的范围
## 捕获参数一共有四个，分别为：

## 参数名称

## 参数位置

## 默认值

## 支持版本

## Group

## Range

## 空

## 20221109~lastest

### 机器人组别名，输入后，整个组的机器人都将被这一个策略捕获

## Label

## Range

## 空

## 20221109~lastest

机器人标签名，输入后，所有属于这个标签的机器人会被这一个策略捕获

## Begin

## Range

## 20221109~lastest

策略的起始时间，单位为（时:分），如输入 02:00，则代表从凌晨两点开始执行这一个策略

## Duration

## Range

## 0

## 20221109~lastest

策略的持续时间，单位为（分），如输入 180，则代表，从策略的起始时间开始，连续执行180分钟

## 第三步：设置具体的充电策略参数
### 首先需要切换到充电策略参数面板，如下图：
1667991158986-2aed741a-009f-4554-887a-1e44ed21fe9e.png

## 充电参数一共有五个，分别是：

## 参数名称

## 参数位置

## 默认值

## 支持版本

## ChargeOnly

## Param

## 空

## 20221109~lastest

## 电量低于这个值时，机器人不接单，只充电

## ChargeNeed

## Param

## 空

## 20221109~lastest

## 电量低于这个值时，机器人空闲时自动充电

## ChargeOk

## Param

## 20221109~lastest

### 充电的机器人，电量需要超过这个值，才会开始接单

## ChargeFull

## Param

## 0

## 20221109~lastest

### 电量超过这个值时，正在充电的机器人会自动断开充电

## ChargeSafe

## Param

## 0

### 0.1.8.230511

当机器人电量低于此值，如果所有充电点都被其他机器人占用，会从这些机器人中选出一个相对电量最高的机器人，正在充电的机器人去停靠，此机器人去充电

## 第四步：推送修改好的模型文件
### 第五步：请检查常见问题，确保自己没有出现FAQ中的异常情况
## 此处重点描述容易出错的情况：
同一时间只能启动一个策略，如果多个策略的启动时间相同，那么只会随机启动其中的某一个，而其他同时启动的策略会被覆盖掉，可以参考FAQ的第 5 条。
## 常见问题与解答（FAQ）
## 我可以只写组名或者标签名吗？
答：可以。捕获参数描述的是当前策略的捕获（应用）范围，你写了什么，就捕获什么。

## 捕获的时间为什么是（小时：分钟）？
答：策略是按天计算的，到了每一天的设置时刻，策略就会启动，启动的时间长度由Duration参数指定。

## 可以设置多个策略吗？
### 答：可以，点击策略右边的加号，即可创建新的策略，如下图：
1668046870803-c01ee9ff-3c4e-4c92-9d0d-0d760423cc20.png

### 如果某一个机器人，同时被多个策略捕获，那么会怎么样？
答：首先，尽量不要设置存在重叠的策略；其次，如果出现这一情况，那么启动时间更晚的策略，拥有更高的优先级。

### 策略的启动时间可以重复吗？最多可以创建多少个策略？
答：不可以。策略的启动时间就是这个策略的唯一标识，当前版本不允许存在启动时间相同的策略；综上可知，最多可以创建24*60个策略。如果创建了启动时间相同的策略，那么会随机生效其中一个，别的会失效。

### 如果某个机器人，没有被任何策略捕获时，会怎么样？
答：那么他会使用配置在场景里的原始的四个充电参数。

### 如果我想让不同组的机器人共用同一个策略，怎么办？
答：将他们放在同一个标签里，然后策略的捕获范围写上这一个标签。
## 最佳实践-1（安全充电阈值）
使用 ChargeSafe 参数设置机器人安全充电阈值，防止机器人电量过低时，由于充电桩数量不够或所有充电桩均被其它机器人占用，造成无处可充电最终关机。
最终效果：当机器人电量小于 ChargeSafe（安全阈值）时，如果没有充电桩可用，会在所有正在使用该机器人绑定的充电桩的机器人中，筛选出已经充电最多的一辆，让这辆车停止充电去停靠，此机器人去充电。

## 多策略分时充电.mp4
## 最佳实践-2（校准BMS）

### 此方案使用复杂，推荐使用定期强制充电实现
### 0.1.8.230821
机器人在充电时，电池电量与电池电压是两项关键指标，目前 rbk 与 RDSCore 之间只进行基于电池电量的充电逻辑判断，而不关心电池电压；故在某些现场存在 电池电量已经充满，但是电池电压仍未达到预期值 ，此时就需要这种逻辑： 即使电量已经充满，仍需继续与充电桩保持联系，来校准电压；也即 固定时间 强制充电 固定时长
### 使用多策略分时充电可以实现上述逻辑，具体阐述如下：
机器人电量小于 chargeNeed，前往 CP 点充电；电量大于 chargedFull，调度生成停靠任务，机器人收到任务，与充电桩断开连接，离开 CP 点，返回 PP 点
基于（1）的阐述，只要将 chargedFull 设置为 100，即可在充满电后不生成停靠任务，继续留在 CP 点，即 强制充电； 如果需要无论电量为多少都要去充电，那么可以将 chargeNeed 设置为 99，就可以达到不论机器人电量多少，都去 CP 点充电的效果
### 多策略分时充电可保证 固定时间 固定时长
如需要在此期间机器人不接单，可将 chargeOnly 设置为 99，chargedOK 设置为 100，即可实现无论电量多少都不接单
上述所有充电参数，都是 segmentedcharge 下的充电参数
