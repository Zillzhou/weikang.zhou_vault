# 相机调试工具初版设计

## 相机调试工具初版设计

## 1 引言

## 1.1 编写目的

本说明书目的在于明确软件各功能的实现方式，指导开发者进行编码。本说明书的预期读者为：系统设计者，系统开发员

## 1.2 背景

## 待开发软件的名称：相机调试工具
## 此软件的需求提供者：方案经理
## 此软件的任务开发者：研发中心
## 此软件的任务用户：交付工程师

## 1.3 基线

## 相机调试软件需求分析说明书

## 1.4 特殊名词定义

PTZ：在安防监控应用中是 Pan/Tilt/Zoom 的简写，代表云台全方位（左右/上下）移动及镜头变倍、变焦控制。

## 1.5 参考资料

## 2 总体设计

### 2.1 概述

包括本软件的开发，运行环境，软件的业务层次，关键技术和关键数据结构设计

### 2.2 系统环境描述

### 2.2.1 运行环境

## Liunx: Ubuntu18.04
## Windows: windows 10

### 2.2.2 开发环境

## Liunx: Ubuntu18.04
## Windows: windows 10

### 2.3 系统总体结构设计

### 2.3.1 软件功能层次图
1679903889752-d9d1be9f-130b-405f-a673-cc45ab009033.png

%E5%8A%9F%E8%83%BD%E5%B1%82%E6%AC%A1%E5%9B%BE.png

### 2.3.1 软件流程图
1679903899211-25c90eb5-99fb-42c2-8fe5-351c6d1b8a6b.png

%E8%BD%AF%E4%BB%B6%E8%B0%83%E8%AF%95%E6%B5%81%E7%A8%8B%E5%9B%BE.png 
注意该流程图的激活步骤，该步骤需要单独设置，该过程与后面的相机信息导入并不连续。即相机激活需要每台相机单独设置完毕后，然后在新的网段进行后续的步骤。手动调整PTZ使库区位于视野内，该步骤需要图像已去除畸变。

### 2.3.2 系统架构说明

### 2.3.3 关键技术与算法

## 1.根据绘制的库区角点计算需要调整的pt值
## 1.1 在界面绘制库区的四个角点，通过接口传递坐标数据给PTZ计算类
## 1.2 PTZ计算类计算第一条与水平线之间的夹角
## 1.3 根据夹角计算pan值的偏移值
## 1.4 获取当前的pan值加上偏移值，设置新的pan值

### 2.根据绘制的库区角点判断zoom值是否合理（该算法待定）
### 2.1 库区角点所围成的四边形进行旋转摆正
### 2.2 计算角点与边缘的距离与画面的占比
### 2.3 根据当前占比与设定阈值计算zoom的偏移值
### 2.4 获取当前的zoom值，设定新的zoom值

### 2.3.4 关键数据结构

## 相机类：

## class PTZCamera
## {
    PTZCamera();
    ~PTZCamera();

    string user;
    string pwd;
    string ip_address;

    PTZControl ptz_control;
    CameraControl cam_control;
    FrameCapture pframe;

    GetCameraInfo();
    SetCameraInfo();

## }

## PTZ控制类：

## class PTZControl
## {
    int pan;
    int Tilt;
    int zoom;

    ptzState ptz_state;

    MovePtz();
    getPtz();
## }

## 视频获取类：

## class FrameCapture
## {
    string rstp_adress;
    uint8_t *frame;
## }

## PTZ状态:

## struct ptzState
## {
    int pan;
    int tilt;
    int zoom;
## }

## PTZ计算类：

## struct PTZCalculate
## {
    calculateRotateAngle();
    returnNewPtzStatewithAngle();
    returnNewZoom();
## }

## 相机设置类：

## class HCNet
## {
    activeCamera();
    resetPwd();
## }

## 3 模块接口
1679903935228-041a1360-67f7-40cd-b4df-3e4987a2a164.png

%E6%A8%A1%E5%9D%97%E6%8E%A5%E5%8F%A3.png

## 界面--PTZCamera

## 1.相机信息读取
### 2.相机信息写入
### 3.相机文件信息解析（界面导入文件地址）

## 界面--FrameCapture

## 1.RTSP流地址导入
### 2.RGB图像返回

## 界面--PTZControl

## 1.ptz值传入
### 2.ptz值获取

## 界面--PTZCalculate

## 1.绘制库区坐标点传入
