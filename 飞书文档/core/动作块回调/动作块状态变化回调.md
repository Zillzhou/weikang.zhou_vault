# 动作块状态变化回调

## 动作块状态变化回调
## @杨达
## 功能
动作块状态变化时，向指定的对象发送消息。

## 使用方法
### 在RoboShop中配置Core的模型文件：
1666856057600-0effb3b1-0423-4b0b-b778-4bf84e57f9e3.png

## 选择topic
### 在topic下拉框中选择需要接受的消息类型
对应动作块状态回调的topic为： BlockStateChange
## 设置receiver
目前支持HTTP类型的回调目标。
## 需要配置的参数有

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## ip

### 模型文件-Receiver-receiver-HTTP

## -

### 127.0.0.1

## -

接受回调的IP地址，不包含 http:// 前缀，不支持DNS解析

## port

### 模型文件-Receiver-receiver-HTTP

## -

## 12345

## -

## 接受回调的端口

## path

### 模型文件-Receiver-receiver-HTTP

## -

## /block-state-change

## -

## 接受回调的请求路径

## 报文内容

## 字段名称

## 描述

## 例子

## topic

## topic

## BlockStateChange

## timestamp

## 消息生成的时间戳

### 2022-10-27T08:23:11Z

## content

## json对象，根据topic变化

{"binTask":"","blockId":"16668589915700-b","containerName":"","goodsId":"","group":"","location":"AP15","manuallyFinished":false,"operation":"","operation_args":{},"orderId":"16668589915700","postAction":{},"script_args":{},"script_name":"","state":"RUNNING","vehicle":"sim_02"}
动作块状态变化回调的 content 字段内容和 通过动作块 id 查询动作块状态 接口返回的内容一致， content 字段为json序列化后的字符串。
## 例子
Core和服务器运行在同一台电脑上，本地HTTP服务器监听 http://0.0.0.0:12345 ，Core中的模型文件配置为：
1666856521063-1215e9a7-dfee-4017-a16b-e4e49e19b2e1.png

图中的配置下，在动作块状态变化时，会用 POST 方法，向 http://127.0.0.1:12345/block-state-change 发送消息。
## 动作块的重要状态如下：
## RUNNING: 动作块开始执行
FINISHED: 动作块完成（执行完成或手动完成都是完成）
## STOPPED: 动作块终止
### FAILED: 动作块执行失败，可以重试
### 机器人执行两个动作块，HTTP服务器收到的请求如下：
### /block-state-change POST
## Accept: */*
## Content-Length: 406
Content-Type: application/json
### Host: 127.0.0.1:12345
### REMOTE_ADDR: 127.0.0.1
## REMOTE_PORT: 34500
User-Agent: cpp-httplib/0.10.0
## {
"content": {"binTask":"","blockId":"16668589915700-b","containerName":"","goodsId":"","group":"","location":"AP15","manuallyFinished":false,"operation":"","operation_args":{},"orderId":"16668589915700","postAction":{},"script_args":{},"script_name":"","state":"RUNNING","vehicle":"sim_02"},
"timestamp": "2022-10-27T08:23:11Z",
### "topic": "BlockStateChange"
## }
### /block-state-change POST
## Accept: */*
## Content-Length: 406
Content-Type: application/json
### Host: 127.0.0.1:12345
### REMOTE_ADDR: 127.0.0.1
## REMOTE_PORT: 34420
User-Agent: cpp-httplib/0.10.0
## {
"content": {"binTask":"","blockId":"16668589915700-b","containerName":"","goodsId":"","group":"","location":"AP15","manuallyFinished":false,"operation":"","operation_args":{},"orderId":"16668589915700","postAction":{},"script_args":{},"script_name":"","state":"POSTING","vehicle":"sim_02"},
"timestamp": "2022-10-27T08:23:16Z",
### "topic": "BlockStateChange"
## }
### /block-state-change POST
## Accept: */*
## Content-Length: 406
Content-Type: application/json
### Host: 127.0.0.1:12345
### REMOTE_ADDR: 127.0.0.1
## REMOTE_PORT: 34420
User-Agent: cpp-httplib/0.10.0
## {
"content": {"binTask":"","blockId":"16668589915700-b","containerName":"","goodsId":"","group":"","location":"AP15","manuallyFinished":false,"operation":"","operation_args":{},"orderId":"16668589915700","postAction":{},"script_args":{},"script_name":"","state":"WAITING","vehicle":"sim_02"},
"timestamp": "2022-10-27T08:23:16Z",
### "topic": "BlockStateChange"
## }
### /block-state-change POST
## Accept: */*
## Content-Length: 407
Content-Type: application/json
### Host: 127.0.0.1:12345
### REMOTE_ADDR: 127.0.0.1
## REMOTE_PORT: 34420
User-Agent: cpp-httplib/0.10.0
## {
"content": {"binTask":"","blockId":"16668589915700-b","containerName":"","goodsId":"","group":"","location":"AP15","manuallyFinished":false,"operation":"","operation_args":{},"orderId":"16668589915700","postAction":{},"script_args":{},"script_name":"","state":"FINISHED","vehicle":"sim_02"},
"timestamp": "2022-10-27T08:23:16Z",
### "topic": "BlockStateChange"
## }
### /block-state-change POST
## Accept: */*
## Content-Length: 406
Content-Type: application/json
### Host: 127.0.0.1:12345
### REMOTE_ADDR: 127.0.0.1
## REMOTE_PORT: 34420
User-Agent: cpp-httplib/0.10.0
## {
"content": {"binTask":"","blockId":"16668589915700-c","containerName":"","goodsId":"","group":"","location":"AP16","manuallyFinished":false,"operation":"","operation_args":{},"orderId":"16668589915700","postAction":{},"script_args":{},"script_name":"","state":"RUNNING","vehicle":"sim_02"},
"timestamp": "2022-10-27T08:23:16Z",
### "topic": "BlockStateChange"
## }
### /block-state-change POST
## Accept: */*
## Content-Length: 406
Content-Type: application/json
### Host: 127.0.0.1:12345
### REMOTE_ADDR: 127.0.0.1
## REMOTE_PORT: 34432
User-Agent: cpp-httplib/0.10.0
## {
"content": {"binTask":"","blockId":"16668589915700-c","containerName":"","goodsId":"","group":"","location":"AP16","manuallyFinished":false,"operation":"","operation_args":{},"orderId":"16668589915700","postAction":{},"script_args":{},"script_name":"","state":"POSTING","vehicle":"sim_02"},
"timestamp": "2022-10-27T08:23:22Z",
### "topic": "BlockStateChange"
## }
### /block-state-change POST
## Accept: */*
## Content-Length: 406
Content-Type: application/json
### Host: 127.0.0.1:12345
### REMOTE_ADDR: 127.0.0.1
## REMOTE_PORT: 34432
User-Agent: cpp-httplib/0.10.0
## {
"content": {"binTask":"","blockId":"16668589915700-c","containerName":"","goodsId":"","group":"","location":"AP16","manuallyFinished":false,"operation":"","operation_args":{},"orderId":"16668589915700","postAction":{},"script_args":{},"script_name":"","state":"WAITING","vehicle":"sim_02"},
"timestamp": "2022-10-27T08:23:22Z",
### "topic": "BlockStateChange"
## }
### /block-state-change POST
## Accept: */*
## Content-Length: 407
Content-Type: application/json
### Host: 127.0.0.1:12345
### REMOTE_ADDR: 127.0.0.1
## REMOTE_PORT: 34432
User-Agent: cpp-httplib/0.10.0
## {
"content": {"binTask":"","blockId":"16668589915700-c","containerName":"","goodsId":"","group":"","location":"AP16","manuallyFinished":false,"operation":"","operation_args":{},"orderId":"16668589915700","postAction":{},"script_args":{},"script_name":"","state":"FINISHED","vehicle":"sim_02"},
"timestamp": "2022-10-27T08:23:22Z",
### "topic": "BlockStateChange"
## }
