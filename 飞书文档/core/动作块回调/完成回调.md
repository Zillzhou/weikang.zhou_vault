# 完成回调

## 完成回调
## @杨达
## 任务执行完成上报信息

1677676567096-4ea082b6-7343-4171-aad0-e3323330ecce.png

## 1. 名称

### 2. 请求信息

ip: "127.0.0.1" 或者 " http://www.test.com " 格式的地址
## port: 端口
## path: 请求地址

请求的URL为： {{ip}}:{{port}}{{path}} ，图中配置下，URL为 127.0.0.1:8787/echo

includedFields: 上报信息包括的字段，格式为JSON字符串： ["orderId", "orderState", "blockId", "blockState", "goodsId"]

## 目前支持的所有字段：

## 字段名

## 描述

## orderId

## 订单id

## orderState

## 订单状态

## blockId

## 块id

## blockState

## 块状态

## goodsId

## 料架名称

## location

## 库位/点

## simpleOrderId

## 块所在的拼合单id

## externalId

## 订单外部id

## vehicleId

## 块所在订单的机器人名称

上报信息的HTTP请求为POST, body 中的 JSON包括includedFields中的字段。

additionalJSON: 附加消息，需要是合法JSON对象字符串，手动填写，和 includedFields 中的字段重名时，会被覆盖。

## 图中配置下，请求的JSON为

## {
    "blockId":"51e8379812d44da098a04b47a8782ea6_unload_block",
    "blockState":"FINISHED",
    "goodsId":"51e8379812d44da098a04b47a8782ea6_goodsId",
    "orderId":"51e8379812d44da098a04b47a8782ea6_unload",
    "orderState":"RUNNING",
    "simpleOrderId":"51e8379812d44da098a04b47a8782ea6",
### "type":"LOAD" // 手动填写的部分
## }

## 注意：

includedFields 为一个JSON字符串数组，用中括号 []

additionalJSON 为一个JSON对象，用大括号 {}

可以用RoboShop 其他 菜单下的 JSON格式化 工具校验JSON

### 3. 判断成功的条件

## statusCode: 返回的响应码

### 0 表示不管返回什么码都算成功，哪怕404也算成功。
### 除零之外的数字，比如200，表示返回码为200时算请求成功

### responseBody: 返回的JSON body

### 只有配置项是返回数据的子集时，才算成功。比如图上配置为

{"msg":"success", "code":1000}

## 下面两个JSON都是成功：

{"msg":"success", "code":1000}

{"msg":"success", "code":1000, "answer":42, "question":"?"}

## 为空时表示不管body是什么都算成功

statusCode 和 responseBody都满足时才算请求成功

### 4. 重试

## enabled: 是否重试
## interval: 重试间隔，单位为秒
### maxTimes: 最大重试次数，如果成功，不再重试

### enabled 为真时，耗尽重试次数之后才算上报信息失败

### 5. 失败

failBlock: 上报信息失败时，是否要将block状态改为失败
## 为真时，会将block状态标为失败

## 使用方法
## 动作块
## 在发下单请求时添加如下字段到动作块中：

## {
    "blockId": "B1",
    "location": "AP12",
## "postAction":{
        "configId":"Test" // 模型文件中HttpPost类型的“设备名”
## }
## }

## 目前支持动作块和拼单

## 拼单:
loadPostAction :取货后，即到 fromLoc 执行完动作后上报
unloadPostAction :卸货后，即到 toLoc 执行完动作后上报

## 例子：

## {
  "fromLoc": "AP83",
  "toLoc": "AP95",
  "id": "b805f244b34842a291c2287bfde9d216",
## "loadPostAction": {
    "configId": "LoadReport" // 替换为模型文件中配置的HttpPost名称
  },
### "unloadPostAction": {
    "configId": "UnloadReport" // 替换为模型文件中配置的HttpPost名称
## }
## }
