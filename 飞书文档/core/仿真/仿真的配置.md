# 仿真的配置

## 仿真的配置
## @丁禹伯@黄强盛@高磊
调度系统默认是面向实物的，当我们需要仿真电梯和门时，我们需要通过第一步，修改配置将其适配成仿真。
如果只需要仿真车，不仿真电梯和门时，我们可以跳过第一步。
## 第一步 修改 lua 脚本
注意修改完后，需要重启调度，才能生效。
修改 <rbk.exe所在目录>/lua_scripts/connection/FullFeature.lua
将 RDSSimLift 和 RDSSimDoor 启用。修改后的 FullFeature.lua 如下:
-- This is a Robokit Connection file

-- gNetProtocol = rbk.getPlugin("NetProtocol")
gRDSDispatcher= rbk.getPlugin("RDSDispatcher")
gRDSOrderAdapter = rbk.getPlugin("RDSOrderAdapter")
gRDSRobotAdapter = rbk.getPlugin("RDSRobotAdapter")
gModbusSlave = rbk.getPlugin("RDSModbusSlave")
gRDSProxy = rbk.getPlugin("RDSProxy")
-- gMapParser = rbk.getPlugin("MapParser")
gSim = rbk.getPlugin("RDSSimRobot")
gChargerProxy = rbk.getPlugin("RDSChargerProxy")
gSimLift = rbk.getPlugin("RDSSimLift")
gSimDoor = rbk.getPlugin("RDSSimDoor")
gMail = rbk.getPlugin("MailSender")
gDbCleaner = rbk.getPlugin("RDSDBCleaner")
gRDSTrigger = rbk.getPlugin("RDSTrigger")

## rbk.initModel()

gRDSRobotAdapter.connect(gRDSOrderAdapter, "rbk.protocol.rds.Message_RobotsStatus")
gRDSRobotAdapter.connect(gRDSDispatcher, "rbk.protocol.rds.Message_RobotsStatus")
gRDSDispatcher.connect(gRDSRobotAdapter, "rbk.protocol.rds.Message_RDSCMD")
gRDSOrderAdapter.connect(gRDSRobotAdapter, "rbk.protocol.rds.Message_RDSCMD")
gRDSDispatcher.connect(gRDSOrderAdapter, "rbk.protocol.rds.Message_OrderStatus")
gRDSDispatcher.connect(gRDSOrderAdapter, "rbk.protocol.rds.Message_DispatcherStatus")
gRDSDispatcher.connect(gRDSRobotAdapter, "rbk.protocol.rds.Message_DispatcherStatus")
gRDSDispatcher.connect(gSim, "rbk.protocol.rds.Message_DispatcherStatus")
gRDSDispatcher.connect(gModbusSlave, "rbk.protocol.rds.Message_BlockGroupStatusList")
gRDSRobotAdapter.connect(gRDSTrigger, "rbk.protocol.rds.Message_RobotsStatus")
-- gRDSDispatcher.connect(gRDSOrderAdapter, "rbk.protocol.rds.Message_BlockGroupStatusList")

gSim.connect(gRDSRobotAdapter, "rbk.protocol.rds.Message_RobotsStatus")
gRDSDispatcher.connect(gSim, "rbk.protocol.rds.Message_RDSCMD")

-- gRDSProxy.connect(gRDSOrderAdapter, "rbk.protocol.rds.Message_LiftsStatus")
-- gRDSProxy.connect(gRDSDispatcher, "rbk.protocol.rds.Message_LiftsStatus")
-- gRDSProxy.connect(gRDSOrderAdapter, "rbk.protocol.rds.Message_DoorsStatus")
-- gRDSProxy.connect(gRDSDispatcher, "rbk.protocol.rds.Message_DoorsStatus")
gRDSProxy.connect(gRDSOrderAdapter, "rbk.protocol.rds.Message_TerminalsStatus")
gRDSProxy.connect(gRDSDispatcher, "rbk.protocol.rds.Message_TerminalsStatus")

gSimLift.connect(gRDSDispatcher, "rbk.protocol.rds.Message_LiftsStatus")
gSimLift.connect(gRDSOrderAdapter, "rbk.protocol.rds.Message_LiftsStatus")
gSimDoor.connect(gRDSOrderAdapter, "rbk.protocol.rds.Message_DoorsStatus")
gSimDoor.connect(gRDSDispatcher, "rbk.protocol.rds.Message_DoorsStatus")

### -- gMapParser.start()
### gRDSDispatcher.start()
### gRDSOrderAdapter.start()
### gRDSRobotAdapter.start()

### gModbusSlave.start()
## gRDSProxy.start()

## gSim.start()
### gChargerProxy.start()
## gMail.start()
## gSimLift.start()
## gSimDoor.start()
## gDbCleaner.start()
## gRDSTrigger.start()

## rbk.sleep(2000)
-- if rbkConfig.useNetProtocol then
### -- gNetProtocol.start()
## -- end

---------- 以上内容,禁止修改 ----------

## 第二步 设置仿真机器人
如果场景已经是仿真场景（比如测试用例中的场景），则可以跳过。
注意修改完后，推送场景，才能生效。
如果是实物场景，需要将其转成仿真场景。
将机器人设置为仿真机器人。用户可以在场景中，将实物机器人修改为仿真机器人。
1668078006856-5a7f0b30-45f0-42bf-b714-e945451918f6.png

选中机器人，在 Roboshop 右侧确定其诞生的位置。
1668078093631-aad8a8a8-21de-4f69-9efd-4f9773a96b31.png

更详细的步骤，参加 仿真机器人 。
## 第三步 设置仿真门和电梯
如果场景已经是仿真场景（比如测试用例中的场景），则可以跳过。
注意修改完后，推送场景，才能生效。
如果是实物场景，需要将其转成仿真场景。
选中真实电梯，在 Roboshop 右侧将属性中的 simulation 改成 true。
1668078352334-16e3a0ac-7e48-4b83-a32f-325e49fb3846.png

选中真实门，在 Roboshop 右侧将属性中的 simulation 改成 true。
1668078328414-5a3fac0b-ea32-47ff-b2f0-1f6cd92c61d2.png

## 注意:
## 1. 有关仿真电梯的所有 gSimLift 相关, 要一起配置, 否则core不能正常运行 , 仿真门 gSimDoor也是如此.
