# 机器人

## 机器人
## @丁禹伯
## 解决的问题
## 在没有实体机器人时运行调度
## 创建仿真机器人
## 启动编辑，进入编辑状态
1653296248077-d9df2ea3-4d3c-448e-86f4-8a5186c60cdc.png

### 选择场景中的机器人，勾选“仿真”，创建仿真机器人
1653295187887-03777b64-c525-4ad7-bbb3-9f8dd234a9d3.png

## 添加仿真机器人
1653384945733-71b14005-5dbe-45a8-8a36-43e13c7e0085.png

## 修改仿真机器人静态属性
1653296285216-0e00d534-a643-4358-971d-b91c48cd84f6.png

## 保存，退出编辑，上传场景
1653296309944-bb0c3e01-c720-4bbf-be4b-783ee3093ee5.png

## 仿真机器人属性
## 仿真机器人属性分为两部分：
### 静态属性，建图时输入，修改后需要重新上传地图生效
## 动态属性，运行时修改，立即生效
## 静态属性

## 属性名称

## 类型

## 备注

## dir

## double

## 初始方向

## endPosition

## string

## 初始位置路线终点

## initialArea

## string

## 初始区域

## initialPosition

## string

## 初始位置线路起点/初始点位

## numberOfContainers

## int

## 背篓数量

## percentage

## double

## 初始位置在线路上的百分比
## 初始位置的逻辑：
确认初始区域，如果initialArea属性为空，使用第一个区域
如果initialPosition、endPosition、percentage都不为空，初始位置在线路上；否则如果initialPosition不为空，使用initialPosition表示的点名作为初始位置；否则使用随机点作为初始位置
随机选择初始位置时，参数配置-仿真 中的 PreferLeaf 选项如果为true，则会优先选择叶子节点，即只和一个节点相连的节点。如下图中所示，AP561就是一个叶子节点，它只和LM558相连
1653302460305-f91fd99c-e7e3-40c6-b3c3-489bfb073388.png

## 动态属性
## 修改方法：
## 运行时，通过仿真调试界面修改
1653302839269-8f6c2518-34a6-45d9-8830-0b31cea1c38f.png

## 可修改的动态属性：

## 属性名称

## 类型

## 备注

## add_water_speed

## double

## 清洁机器人加净水速度

## angle

## double

## 机器人朝向，单位rad

## battery_percentage

## double

## 电池电量百分比，0-1

## blocked

## bool

## 是否被阻挡

## charge_speed

## double

## 充电速度，百分比/周期

## charging

## bool

## 是否在充电

### clean_water_percentage

## int

## 清洁机器人净水水量，0-100

## clear_containers

## bool

## 清空料箱车背篓

## connection_status

## int

## 连接状态

### dirty_water_add_speed

## double

## 清洁机器人做任务时污水增加速度

### dirty_water_percentage

## int

## 清洁机器人污水水量，0-100

### disable_charging_while_charge

## bool

## 模拟机器人充电时没有充上电

## disable_di

## int

## 禁用 di

## disable_rotate

## bool

禁用仿真旋转；开启时，仿真机器人不模拟旋转，关闭后，机器人按照配置的rotate_speed模拟原地旋转耗时

## drain_water_speed

## double

## 清洁机器人排放污水速度

## emergency

## bool

## 是否急停

### enable_battery_consumption

## bool

## 是否模拟电量消耗

## enable_di

## int

## 启用 di

### enable_water_consumption

## bool

## 清洁机器人模拟水量变化

## error

## JSON

## 报错码

## fail_current_task

## bool

## 使当前任务失败

## fork_height

## double

## 叉车货叉高度

## fork_speed_m_s

## double

## 叉车货叉速度，m/s

## good_shape

## JSON

## 货物形状

## goods_vehicle_angle

## double

## 货物与车夹角

## ignore_robot

## bool

## 忽略机器人

## jack_height

## double

## 顶升车顶升机构高度

## jack_speed_m_s

## double

## 顶升车顶升速度，m/s

### load_unload_goods_shape

## JSON

## 取放货任务货物形状

## locked

## bool

## 控制权是否被抢占

## map_name

## string

## 地图名称

## nickname

## string

## 占有控制权的系统名称

### no_task_battey_consumption

## double

## 不执行任务时的电量消耗，百分比/周期

## pause_respect_wait

## bool

## 动作前暂停时是否不忽视Wait

### pause_upon_operation

## bool

## 动作前暂停

## position

## JSON

## 物理位置，单位m

## position_by_name

## string

### 点名，可以是label，也可以是instanceName

## position_map

## string

## 点位所处地图名称

## reloc_status

## int

## 重定位状态

## rotate_speed

## double

## 原地旋转速度，单位rad/s

## speed

## double

## 移动速度，单位m/s

### task_battery_consumption

## double

## 执行任务时的电量消耗，百分比/周期

### water_consumption_speed

## double

## 清洁机器人做任务时清水消耗速度
## 控制权
仿真机器人支持模拟控制权抢占。
## 模拟控制权没有被抢占：
## 将 locked 改为false
## 选中需要修改状态的模拟机器人
## 点击发送
1653303695860-537f1eee-690f-4e49-9d88-a9d6c20108e3.png

## 模拟控制权被指定系统抢占：
## 将 locked 改为true
### 将 nickname 改为指定的系统名称
## 选中需要修改状态的模拟机器人
## 点击发送
下图中的例子表示，所有仿真机器人都被名称为 systemV 的系统控制
1653303774591-6a97739c-05e5-4ffc-b97b-f832eb86e7db.png

## 电量
### 开启电量模拟： 0.1.9.231101
将 enable_battery_consumption 改为true
设置 task_battery_consumption 为执行任务的电量消耗， no_task_battery_consumption 为不执行任务的电量消耗，量纲：假设设置为 1，则每周期掉电 1%（满电量为 100%）
## 选择需要修改状态的模拟机器人
## 点击发送
1653304024809-76fd602f-b20f-48a8-9da7-2fc224d0d355.png

## 模拟充电
## 将 charging 改为true
### 将 charge_speed 改为目标充电速度
## 选择需要修改状态的机器人
## 点击发送
1653304109801-1a57b5ab-7f76-48e0-9bba-a7e9a1313a6e.png

## 立刻修改电量
### 将 battery_percentage 改为目标电量
## 选择需要修改状态的机器人
## 点击发送
1653304163242-b3bf894e-6775-426b-935f-208e31075eef.png

## 暂停
在执行下一个不是 Wait 的动作（顶升、叉车取放货等）之前暂停，等待手动继续
### 将 pause_upon_operation 改为true
### 将 pause_respect_wait 改为false
## 选择要修改状态的机器人
## 点击发送
1653304357777-630d0202-363a-4ce4-8851-3d14de3859a8.png

## 继续执行动作
将 pause_upon_operation 改为false
## 选择要修改状态的机器人
## 点击发送
## 在执行下一个动作之前暂停，包括Wait
### 将 pause_upon_operation 改为true
### 将 pause_respect_wait 改为true
## 选择要修改状态的机器人
## 点击发送
## 报错
### 模拟机器人被阻挡（设置后机器人会同步报错 52200）
## 将 blocked 改为true
## 选择要修改状态的机器人
## 点击发送
## 模拟机器人急停
## 将 emergency 改为true
## 选择要修改状态的机器人
## 点击发送
## 其他报错
## 将 error 改为目标报错码列表，如
## ["40", "41"]
## 选择要修改状态的机器人
## 点击发送
1653304724899-0b9ee36d-6a05-42d1-ba1d-48c2364f3945.png

上图的例子表示：仿真机器人 sim_01 报两个错，报错码分别为 40 和 41 ，发送之后，RoboShop会显示报错：
1653304835254-8fa7b2b5-3d24-4421-bd36-94e1d026a9b3.png

报错信息为 Sim Error ，报错码为 40 和 41，在清除之前会持续报错
## 清除其他报错
## 将 error 改为空列表 []
## 选择要修改状态的机器人
## 点击发送
1653304932658-9bdd2eac-e357-4549-8b72-281b674cce4e.png

## 原地旋转
## 禁用原地旋转，仿真机器人不模拟旋转过程
### 将 disable_rotate 改为 true
## 选择要修改状态的机器人
## 点击发送
启用原地旋转，仿真机器人按照配置的 rotate_speed 模拟原地旋转过程
### 将 disable_rotate 改为 false
## 选择要修改状态的机器人
## 点击发送
## 修改原地旋转速度
修改 rotate_speed 选项，单位为 rad/s，弧度每秒
## 选择要修改状态的机器人
## 点击发送
1681371992638-79e8a2f3-d673-4ba3-9eee-705cb6fdc9f1.png

1681372152113-7e8ff123-0a2f-4fd5-839d-d0345b2d35df.png

## 移动
## 移动到指定点位
### 在 position_by_name 中填写点位名称
## 选择要修改状态的机器人
## 点击发送
## 移动到指定坐标
在 position 中填写坐标，格式为 {"x":1,"y":2} ，其中 1 2 为 x y 坐标
## 选择要修改状态的机器人
## 点击发送
## 设置机器人朝向
在 angle 中填写角度（0，±1.57，±3.14 或 其他数值）
## 选择要修改状态的机器人
## 点击发送
1681719625755-0e3d2631-ed11-4290-8dad-2edfc68efe7b.png 

1681719871951-c9df1156-5b38-43cb-8c80-34261a240ae6.png

1681720094892-dfeaa7da-bf1e-4876-b33c-702ad3f726e3.png

## 货物形状
## 设置后会立刻为机器人添加货物
## 设置机器人货物形状
在 goods_shape 中填写货物形状，格式为 [-x, -y, x, y] ，数值为矩形的四个坐标
## 选择要修改状态的机器人
## 点击发送
## 设置货物与机器人夹角
在 goods_vehicle_angle 中填写货物与机器人夹角（0，±1.57， ±3.14 或其他数值）
## 选择要修改状态的机器人
## 点击发送
## 一般与设置货物形状搭配使用
1681720364598-6e78fba3-9f0f-472f-bbb6-98534eddbca0.png

1681720473845-29aae66d-720c-4857-9be5-5412e07ae05e.png

## 取放货订单货物形状
如果一个订单的动作块 operation 设置为 ForkLoad/JackLoad 和 ForkUnload/JackUnload，那么就是一个取放货订单，设置这个动态属性后，机器人在执行取放货订单时，会在取货完成后自动添加货物形状，放货完成后自动清空货物形状，此属性可与 goods_vehicle_angle 搭配使用
## 设置机器人执行取放货订单时的货物形状
在 load_unload_goods_shape 中填写货物形状，格式为 [-x, -y, x, y] ，数值为矩形的四个坐标
## 选择要修改状态的机器人
## 点击发送
可以同时搭配 goods_vehicle_angle 设置货物夹角
1688709234416-99f4b038-1d84-4a3d-8bf6-37367ef11c5a.png

## 清洁机器人
清洁机器人在支持普通机器人的通用仿真属性外，额外增加了下述专用仿真属性：
## 设置净水水量/污水水量
在 clean_water_percentage 设置净水量； dirty_water_percentage 设置污水量
## 选择要修改状态的机器人
## 点击发送
1708569821674-8f45a397-f923-4a80-ae94-3c1db23661df.png

## 模拟执行任务时消耗净水/增加污水
修改 enable_water_consumption 启用模拟水量消耗
在 water_consumption_speed 设置净水消耗速度
在 dirty_water_add_speed 设置污水增加速度
## 选择要修改状态的机器人
## 点击发送
1708570073664-c7deac0b-2dc7-4f8e-91a0-85769cf4182d.png

## 模拟边充电边加净水/排污水
### 在 add_water_speed 设置加净水速度
### 在 drain_water_water 设置排污水速度
## 选择要修改状态的机器人
## 点击发送
1708570209392-de226d57-926f-47a7-81e2-5eed0072bbe9.png

## 模拟机器人到点存在误差
## >=0.1.9.241016
### 目前仅支持模拟到达订单目标点的误差，不对沿途路径处理
## 设置机器人到点误差值
### 在reach_deviation中填写到点误差，单位 m
## 选择要修改状态的机器人
## 点击发送
注：设置后，此后所有任务此机器人到点均会存在误差，如需取消，请修改此参数为 0
## image.png
