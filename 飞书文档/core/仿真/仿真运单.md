# 仿真运单

## 仿真运单
## @丁禹伯
### 0.1.8.230716-0.1.9
## 功能描述：
### 调度可以自动仿真下发以下四种类型的订单：
## 随机选择除原地任务外的点位发送订单
### 随机选择 AP CP PP 点位发送订单
### 指定一个点位集合，随机选取其中的点位发送订单
指定一个关联的取货点位集合和一个放货点位集合，随机选择其中的点位发送取放货订单
其中策略 1 2 对场景中所有机器人起作用，策略 3 4 需要设置机器人标签来指派执行订单的机器人
## 实现方式 ：
### 0.1.9.230803 前的版本：
由参数 TestOrderType 和高级组 TestOrder 实现

## 参数名称

## 参数位置

## 参数默认值

## 参数范围

## 参数含义

## TestOrderType

## 参数配置-->仿真

## -1

## 1 2 3 对应三种模式

## 仿真发单模式选择

## MaxTestOrderNum

## 参数配置-->仿真

## -1

## [-1, 1000]

## 仿真发单最大订单数量

## TestOrder 高级组

## 下辖子属性

## 默认值

## 类型

## 属性含义

## robotLabel

## label

## string

## 执行策略的机器人标签

## direct

## false

## bool

## 直接到达点位

## pickup

## false

## bool

## 取货点位

## unload

## false

## bool

## 放货点位
### 0.1.9.230803 后的版本：
由调度模型文件 TestOrder 和 高级组 TestOrder 实现，并新增可选是否指定机器人接单及发单频率，订单统计功能；
### 高级组含义与此前一致，模型文件详细阐述如下：
1705480797713-535b309e-326b-4f98-a695-ba7c525e650a.png 

## 参数名称

## 参数位置

## 参数默认值

## 参数范围

## 参数含义

## type

## 模型文件TestOrder

## TurnOff

## Random
## PPAPCP
## Direct
## Pickup
## 分别对应1 2 3 4策略

## 仿真发单模式选择

## assign

## 模型文件TestOrder

## true

## bool

## 订单是否直接指定车

## maxOrderNum

## 模型文件TestOrder

## -1

## int

## 订单上限

## timeRhythm

## 模型文件TestOrder

## 0

## float

## 发单频率：间隔时间

## numRhythm

## 模型文件TestOrder

## 0

## float

## 发单频率：发单数量

## openOrderstatistic

## 模型文件TestOrder

## true

## bool

## 打开仿真信息统计

## clearOrderStatistic

## 模型文件TestOrder

## false

## bool

## 清空统计结果
## 模型文件参数含义详解
assign 勾选时，表示订单直接指定机器人，此情形下的仿真订单会指定机器人执行
assign 不勾选时，表示订单不指定机器人，此情形下的的仿真订单 vehicle 字段为空，由选车模块分配
maxOrderNum ：订单上限，已下发仿真订单达到此值后，停止发单；
timeRhythm 和 numRhythm 共同阐述发单频率：每隔 timeRhythm 秒发送 numRhythm 个订单
openOrderstatistic ：开启统计功能，默认每隔 10s 统计一次，收到订单或机器人完成新订单后会额外统计一次，统计项包括：各类型的订单数量，各机器人分别执行了各种类型的订单的数量及时间
clearOrderstatistic ：清空/重置统计结果，即 reset 效果，以此刻为起始点重新统计
## 一个统计图如下：
表示工发送 14 个订单，其中 4 个为取放货订单，AMB-01 执行了其中两个订单，共耗时 46s，sim_01 执行了其中两个订单，共耗时 53s
1705483004455-af46d383-159c-4878-8415-fe36176511ed.png

## 参数对应模式
### 发单模式 -1： 仿真发单功能关闭，不执行任何策略
发单模式 1： 对应功能描述策略 1，对场景中所有机器人起作用，当机器人 调度有控制权、可接单、无订单或订单状态处于终态时，随机选择除自身位置外的任意点位作为目标点发送订单
发单模式 2： 对应功能描述策略 2，对场景中所有机器人起作用，当机器人 调度有控制权、可接单、无订单或订单状态处于终态时，随机选择地图上的 AP PP CP 点位作为目标点发送订单
发单模式 3： 对应功能描述策略 3 和 4，按照配置的 TestOrder 高级组执行下述策略：
direct、pickup、unload 点位是与 robotLabel 机器人标签绑定的
其中 direct 用于执行策略 3，pickup 和 unload 用于执行策略 4
策略 3：对高级组中 robotLabel 标签的机器人起作用，当机器人 调度有控制权、可接单、无订单或订单处于终态时，在与 robotLabel 同处一个高级组的 dircet 点位集合中随机选择一个点位作为目标点发送订单
策略 4：对高级组中 robotLabel 标签的机器人起作用，当机器人 调度有控制权、可接单、无订单或订单处于终态时，在与 robotLabel 同处一个高级组的 pickup 和 unload 点位集合中分别随机选择一个点位作为取货点和放货点发送含有两个动作块的订单
## 注意事项
目前 TestOrderType 只有 1 2 3 是起作用的，设置其他值都等价于关闭仿真发单功能
MaxTestOrderNum 每次更改 TestOrderType 时会重置，订单数量大于这个值，当前策略停止发单，相当于仿真发单功能关闭
在一个 TestOrder 高级组里，direct pickup unload 三个属性只能有一个设置为 True，否则视为无效高级组
在策略 4 中，pickup 和 unload 属性必须同时设置，也就是要用两个 robotLabel 相同的 TestOrder 高级组来设置，如果只设置了一个，那么策略 4 是不起作用的
在使用策略 4 仿真取放货订单时，可以配合仿真调试 load_unload_goods_shape 属性来设置货物形状，实现取放货订单的货物仿真，详见机器人
## 统计信息目前打印在控制台中
