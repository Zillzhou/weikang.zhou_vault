# 更新时，保存订单数据并导入

## 更新时，保存订单数据并导入
<0.1.8.221017 版本的core更新后，可能会出现旧的订单数据丢失的问题，需要手动导入
此外，虽然新版本不再出现数据丢失的问题，仍然建议更新前手动复制，保存数据，以防万一
## 目标
在更新调度场景时，可能导致订单数据丢失。本文档描述一种手动恢复老版本订单数据的方法。
## 步骤
## 保存旧的订单数据
## 更新Core
## 在更新过的Core中导入旧的订单数据
## 注意事项
保存数据之前，确保所有订单已到终态：即，所有的订单已经是 FINISHED 或者 STOPPED 状态
## 确认更新成功之后再进行导入
## 确认旧的数据被删除之后再进行导入
## 工具
### https://sqlitebrowser.org/dl/
## 保存旧的订单数据
## 使用 Robod
通过 一键下载日志 即可下载旧的订单数据。下载的数据中，订单数据在 db 文件夹下，如下图：
1669011539072-841648f2-3a5f-43e3-a605-e026f589d491.png

## 手动拷贝文件
Windows 数据库文件夹 RDS/.data/rdscore/resources/db
Linux 数据库文件夹 /opt/.data/rdscore/resources/db
## 导出到sql文件
使用 DB Browser for SQLite 打开保存的 orders.sqlite 文件，选择 文件 -> 导出 ，如下图设置导出选项：
1669012240260-b6ec1a98-908a-4295-b6e1-1f68fea9e58f.png

## 保存后的文件类似：
BEGIN TRANSACTION;
INSERT INTO "RobotSchedule" ("id","schedule","update_time") VALUES ('SW500-12','{"current_order":{"complete":true,"dist":-1.0,"distribute_order_id":"","empty_container_num":0,"load":true,"order_id":"","published":false,"simple_order_id":"","topoPos":{"eid":-1,"percentage":0.0,"sid":-1}},"future_orders":[],"robot_name":"SW500-12"}',1668999827),
 ('SW500-04','{"current_order":{"complete":true,"dist":-1.0,"distribute_order_id":"","empty_container_num":0,"load":true,"order_id":"","published":false,"simple_order_id":"","topoPos":{"eid":-1,"percentage":0.0,"sid":-1}},"future_orders":[],"robot_name":"SW500-04"}',1669003064);
INSERT INTO "Robot" ("id","name","current_order_id","next_order_id","update_time","dispatchable") VALUES ('SW500-01','SW500-01','71e30d6b-615d-41a4-99da-30fbf6ad1546','71e30d6b-615d-41a4-99da-30fbf6ad1546',1669003941,0),
 ('SW500-02','SW500-02','a1de4cd5-e0a4-4507-9f4e-f97a16309ee4','a1de4cd5-e0a4-4507-9f4e-f97a16309ee4',1669004212,0),
 ('SW500-03','SW500-03','af284812-e3a8-4ea7-b267-8da662f83bd7','af284812-e3a8-4ea7-b267-8da662f83bd7',1669004104,0),
 ('SW500-04','SW500-04','99e76976-1202-4539-a5e5-28c2e47dafb9','99e76976-1202-4539-a5e5-28c2e47dafb9',1669003074,0),
 ('SW500-05','SW500-05','cca15eeb-0b9f-4901-9551-4fb742b95d65','cca15eeb-0b9f-4901-9551-4fb742b95d65',1669004317,0),
 ('SW500-06','SW500-06','38d980b3-2390-40f9-9cb1-ac020c4e2d06','38d980b3-2390-40f9-9cb1-ac020c4e2d06',1669004019,0),
 ('SW500-07','SW500-07','a64c5b82-3cab-4874-9708-543b490a7736','a64c5b82-3cab-4874-9708-543b490a7736',1669004176,0),
 ('SW500-08','SW500-08','15052dd0-4cb4-4966-83d3-bd788aed1c5a','15052dd0-4cb4-4966-83d3-bd788aed1c5a',1669004303,0),
 ('SW500-09','SW500-09','3c5d78aa-b0d9-4ea4-ad5b-2dc9e5c4050c','3c5d78aa-b0d9-4ea4-ad5b-2dc9e5c4050c',1669003232,0),
 ('SW500-10','SW500-10','1b4cec78-0a6d-4692-9899-99d600739c70','1b4cec78-0a6d-4692-9899-99d600739c70',1669004333,0),
 ('SW500-11','SW500-11','655701e2-ea2a-4428-9eaf-da6906aa9d82','655701e2-ea2a-4428-9eaf-da6906aa9d82',1669004100,0),
 ('SW500-12','SW500-12','ebdd1838-6792-4c5e-a159-6aee8f03052d','ebdd1838-6792-4c5e-a159-6aee8f03052d',1669003465,0),
 ('SW500-13','SW500-13','b6820e24-1490-4560-b19d-b01dd0b306d8','b6820e24-1490-4560-b19d-b01dd0b306d8',1669004217,0),
 ('SW500-14','SW500-14','5b4dd916-c0bf-4210-a445-ebae368b516d','5b4dd916-c0bf-4210-a445-ebae368b516d',1669004281,0),
 ('SW500-15','SW500-15','8c44b190-fff6-4601-b4ee-d3d40f4855fb','8c44b190-fff6-4601-b4ee-d3d40f4855fb',1669004308,0),
 ('SW500-16','SW500-16','80dfac59-ead2-4561-8377-9ac6e3cfecd9','80dfac59-ead2-4561-8377-9ac6e3cfecd9',1669004111,0),
 ('SW500-17','SW500-17','9ba450d3-a42c-4e97-9e48-3efc465148b5','9ba450d3-a42c-4e97-9e48-3efc465148b5',1669004056,0),
 ('SW500-18','SW500-18','26949278-2bba-45a6-a009-cf74258c1438','26949278-2bba-45a6-a009-cf74258c1438',1669004208,0),
 ('SW500-19','SW500-19','e2b2a0ce-18e7-4511-9f66-eb7f86ecc85a','e2b2a0ce-18e7-4511-9f66-eb7f86ecc85a',1669004253,0),
 ('SW500-20','SW500-20','23e869d0-731a-4fb8-aa24-e4984ca1f7e0','23e869d0-731a-4fb8-aa24-e4984ca1f7e0',1669004167,0),
 ('SW500-21','SW500-21','edf71eaa-0e0d-4308-8e2b-666ddb1985cf','edf71eaa-0e0d-4308-8e2b-666ddb1985cf',1669004248,0),
 ('SW500-22','SW500-22','3f2ffa6b-df03-4c26-a29d-4a65ae4d4e83','3f2ffa6b-df03-4c26-a29d-4a65ae4d4e83',1669004331,0);
INSERT INTO "Block" ("id","order_id","state","location","operation","script_name","script_args","operation_args","binTask","goodsId","recognize","manually_finished","post_action","container_name","update_time") VALUES ('d39f68f3-ee31-4317-851c-a500767020ba','3a591b50-e18e-40fb-9300-22ed26c5b3d3','RUNNING','PP205','','','null','null','','',-1,0,'null','',1666521106),
 ('2c87b4f0-34e8-466b-a61b-2851d0912959','b349dee4-565d-46b8-ac24-b5ccf327c2c7','CREATED','PP1197','','','null','null','','',-1,0,'null','',1666556011),
 ('c9223d92-ff8b-4139-9c50-438fc2c9c622','6c04c960-e6ad-449a-8244-d1c5b116d605','CREATED','PP210','','','null','null','','',-1,0,'null','',1666596187),
 ('2423d41b-9d80-4566-bbf6-fbcdf569a343','5ac40f67-78fc-4976-ae39-faeafe3d5e1c','CREATED','CP115','Charge','','null','null','','',-1,0,'null','',1666597850);
INSERT INTO "Order" ("id","state","msg","complete","terminate_time","create_time","receive_time","current_block_index","block_id_list","type","vehicle","key_route","group_name","valid_groups","priority","label_name","joinable","error","warning","notice","external_id","execution_time_cost","update_time","start_odo","finish_odo","order_odo","key_task") VALUES ('9ddeafdf-319f-43d0-86a9-26dcf6c1bde7','STOPPED','',1,0,0,1668487830,0,'92b91e95-221e-4eca-b8ed-ea4aac867766',3,'SW500-13','','','',1,'',0,'[]','[]','[]','',0,1668650979,0.0,0.0,0.0,''),
 ('30a0fd12-f6cf-4719-9396-cbf7ec0d8a02','STOPPED','',1,0,0,1668558712,0,'96641e8e-f104-42bb-a0c7-a15a4ec44301',1,'SW500-12','','','',1,'',0,'[]','[]','[]','',0,1668650981,0.0,0.0,0.0,''),
 ('8b3a7fe4-ed14-406b-a4db-a1015214df65','FINISHED','',1,1668582140,1668581009,1668581003,2,'3bab7155-4c2f-48fa-9226-7a30e0549ca2,bb878a37-9e4e-4a9e-aa25-cafd51262ff7',0,'SW500-04','CER1-2-003','','PHILIPS',1,'',0,'[]','[]','[]','2846A4AA34690EA0CDBFEA3C5781B4D1',1131,1668582140,2749385.283,2749615.847,230.564000000246,''),
 ('1c3c534b-32fe-42a2-bda6-52f7695eb86c','FINISHED','',1,1668582261,1668581536,1668581536,1,'ac31ff4d-368e-465e-84ee-271fb2fb9c56',1,'SW500-12','','','',1,'',0,'[]','[]','[]','',725,1668582261,1287822.529,1287852.566,30.0370000000112,''),
 ('e916ec64-8dd3-4a09-844f-03e2d6f69e9e','FINISHED','',1,1668582286,1668581571,1668581571,1,'0c78f831-3fdf-4fa7-a790-acd2e933c126',1,'SW500-14','','','',1,'',0,'[]','[]','[]','',715,1668582286,1598561.454,1598767.996,206.542000000132,'');
COMMIT;
## 导入sql文件到Core的数据库
## 关闭Core，如果有Robod，也关闭
使用 DB Browser for SQLite ，打开数据库文件
Windows RDS/.data/rdscore/resources/db/orders.sqlite
Linux /opt/.data/rdscore/resources/db/orders.sqlite
## 清空数据
### 点击 执行SQL ，输入下面的指令删除所有数据：
delete from `Order`;
delete from `Block`;
delete from `SimpleOrder`;
delete from `DistributeOrder`;
delete from `Robot`;
delete from `RobotSchedule`;
1669015036183-199ee2b9-db42-4bd3-a4d4-762913328e74.png

选择 文件 -> 导入 -> 从SQL文件导入数据库 ，选择上一步骤中导出的sql文件
1669012607380-e6160168-fac0-4f69-babb-ad2d89697f97.png

## 选择 否
## 成功导入后的提示如图：
1669014981693-3cc9c110-f27e-4f5f-9658-76c18fd7e897.png
