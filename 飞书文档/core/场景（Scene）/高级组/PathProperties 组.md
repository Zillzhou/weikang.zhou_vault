# PathProperties 组

## PathProperties 组
## @丁禹伯
### 0.1.8.221221
PathProperties 组是给一组线路赋予一组特定的调度参数。目前，支持的调度参数有planDist planStep noCargoPassing noIdlerPassing noRotate ，PathProperties 里面的参数优先级高于参数配置中的参数。

## 参数名称

## 参数位置

## 单位

## 默认值

## 最小值

## 最大值

## 支持版本

## planStep

## PathProperties

## m

### 0.1

### 0.1

### 10.0

### 0.1.8.221221

规划路径步长。与参数配置中的 PlanStep 含义相同。

## stopSafeDist

## PathProperties

## m

### 0.2

### 0.1

### 10.0

### 0.1.9.240122

跟车安全距离。与参数配置中的 stopSafeDist 含义相同。

## noCargoPassing

## PathProperties

## bool

## false

## /

## /

### 0.1.9.240119

## 禁止载货通行路段

## noIdlerPassing

## PathProperties

## bool

## false

## /

## /

### 0.1.9.240119

## 禁止空载通行路段

## noRotate

## PathProperties

## bool

## false

## /

## /

### 0.1.9.240119

## 禁止旋转路段（只解析路线，不解析点位）

## planDist

## PathProperties

## m

## -1.0

## -1.0

### 1000.0

### 0.1.9.240122

### 规划路线长度，与参数配置中的 planDist 含义相同

## 根据载货状态限制线路选择
当配置了 noCargoPassing 或 noIdlerPassing 后，机器人规划路线时会根据自身载货状态选择合适的路线。
下图紫色为noCargoPassing属性，绿色为noIdlerPassing属性
## image.png

## 版本 0.1.9.240514 前
只会解析高级组内的点位，而不会解析线路，所以实际上是设置的点位不能载货/空载通行
在上图中，机器人载货时，只要路线包含 AP1 AP2 AP3 中的任意点位，都不能通行
由于不解析线路，机器人空载时所有线路都是可以通行的，设置的noIdlerPassing实际上的无效的
## 版本 0.1.9.240514 后
高级组内的点位和线路都会解析，可以只绘制点位，也可以绘制线路，也可以都绘制，实际上是设置的元素不能载货/空载通行
在上图中，机器人载货时，只要路线包含 AP1 AP2 AP3 中的任意点位或 AP1<-->AP2 AP2<-->AP3 AP3<-->LM9 的任意线路，均不能通行
机器人空载时，只要路线包含 AP1<-->LM4 AP2<-->LM5 AP3<-->LM6 的任意线路，均不能通行
## 版本 0.1.9.240625 后
如下图所示，AP162--AP163 禁止载货通行，机器人载货状态下，如果到点 AP163 存在偏差，会导致在拓扑结构上没有可以通行的道路，此时下发订单会报错 cannot find path to xxx
此版本后，允许机器人在到点偏差 5% 范围内可以 “忽视” 线路属性搜到路
也就是说机器人载货时在 AP162--AP163 的 95%--100% 处都可以搜到路
## image.png

## 版本 0.1.9.250108 后
版本 0.1.9.240625 后 所描述的逻辑变更为采用到点距离进行判断，默认接受的最大到点偏差为 5cm，此数值可通过模型文件--pathPlanning--pathPropertyDeviation 动态修改，修改范围为 [0, 0.5m]
## image.png

## 禁止旋转路段
当路线配置了 noRotate 属性后，如果机器人在线路起点旋转角度大于 15° 或线路起点终点角度差大于 15°，那么机器人不会选择此路段通行；
1705376403239-a496be61-b7f4-4cfb-ad5f-f61314d7cf33.png

以上图为例，粉色路段设置为 noRotate 属性，其通行情况见下表：

## 路线

## 是否可通行

## 原因

## PP1--LM3--LM4--LM3

## 否

## 此路线会在 4 掉头，角度为180°

## PP1--LM3--LM8

## 否

### 起始端平滑连接，终止端未平滑连接，角度差大于 15°

## LM3--LM4--LM10

## 是

### 路线起始段和终止端均平滑连接，角度差为 0

## LM5--LM6--LM9

## 否

### 起始端未平滑连接，终止端平滑连接，角度差大于 15°
需要注意的是，如果设置了禁止旋转的路段是到达目标点的唯一路线，那么此属性失效，机器人仍会通行。
## Mapf 下使用此功能
## 最低支持版本：0.1.9.240413
Mapf 下两种情况下的路线需要响应线路属性：非避让直接搜路 和 避让搜路
非避让直接搜路，需要打开参数G-MAPF-CustomizedAStar才能响应线路属性
## 避让路线选择，无需额外打开参数直接支持
