# FireAlarm 组（火警功能）

## FireAlarm 组（火警功能）
### 0.1.8.221207
## @丁禹伯
## 功能：
## 触发消防警报后：
### 位于火警区域外的车辆立即停在原地，任务变为暂停状态
位于火警区域内的车辆会自动驶离火警区域后停下来，任务变为暂停状态。
火警区域内的车只有在有任务的情况下才会主动驶离火警区域，如无任务仍需主动驶离，需打开参数 AdvancedAutoOrder 0.1.9.240104
## 解除消防警报后：
所有车子仍然不会动，因为虽然解除了消防警报，但是车子还是暂停状态，需要点击“继续导航”按钮
### 使用“继续导航”后，所有车子会继续执行消防警报前的任务
0.1.9.240529 后，发送解除消防警报的报文中，如果字段autoResume为 true，则会自动为所有机器人继续任务，无需手动点击“继续导航”按钮，报文示例如下：
## {
### "on": false,    // 解除火警
    "autoResume": true    // 机器人自动继续导航
## }
## 使用前提：
火警区域的设置是为了保证触发火警时位于该区域内的车子必须驶离火警区域，故需保证“ 火警区域内必须存在可以使车子驶离该区域的路线 ”这一前提条件
为确保上述条件的满足，使用方法限制为 火警区域必须在 Mutex 互斥区内 ，且 互斥区域要比火警区域至少大一个点 来保证火警区域内的车可以驶离火警区域，如下图所示：
1671074416574-f4a9815d-9e29-4d6f-80ff-1964738c3ad5.png

## 使用方法：
绘制火警区域：roboshop 页面操作，路径为“高级组”->“FireAlarm”，详见下图
1670916734473-4c58c93e-c098-4b9f-90e3-e1eb73a452dc.png

触发消防警报：通过 API 方式触发，详见下方 API 使用文档
## 获取火警状态
查询火警状态：通过 API 查询，详见下方 API 使用文档
## 与火警交互
解除消防警报：通过 API 方式解除，详见下方 API 使用文档
## 获取火警状态
机器人继续导航：roboshop 页面操作，路径为“批量操作”->“任务”->“继续导航”，详见下图
1670916582413-224d25f4-53c0-44cb-b899-2cac36dbe3c6.png

## 预期效果：
对于火警发生时机器人所处的不同订单状态及所在区域，调度火警功能的策略见下表
策略的基本原则为： 火警发生时，火警区域外的机器人立即原地停止，火警区域内的机器人驶离火警区域后立即原地停止，所有机器人不得以任何理由在火警发生时占据火警区域
in： 在火警区域内；
out： 在火警区域外；
终态： FINISHED 或 STOPPED 或 FAILED
暂停： 暂停机器人任务，火警结束后，点击恢复按钮，机器人继续执行任务
终止订单，机器人驶离火警区域 ：终止机器人订单并在订单内报错，火警结束后，此订单不再自动重新执行

## 订单状态

## RUNNING

## WAITING

## 终态

## 所处位置

## in

## out

## in

## out

## in

## out

## 目标点

## 是否封口

## 调度火警策略

## in

## 是

## 终止订单机器人驶离火警区域

## 暂停

## 终止订单机器人驶离火警区域

## 不处理

### 终态下机器人无目标点，位于火警区域内，机器人驶离火警区域

### 终态下机器人无目标点，位于火警区域外不作处理

## 否

## 终止订单机器人驶离火警区域

## 暂停

## 终止订单机器人驶离火警区域

## 若追加订单，暂停

## out

## 是

## 驶出火警区域立即暂停

## 暂停

## 终止订单机器人驶离火警区域

## 不处理

## 否

## 驶出火警区域立即暂停

## 暂停

## 终止订单机器人驶离火警区域

## 若追加订单，暂停

## 注意事项
火警区域的设置是为了保证触发火警时位于该区域内的车子必须驶离火警区域，故需保证“ 火警区域内必须存在可以使车子驶离该区域的路线 ”这一前提条件
### 火警区域 可以 通过 高级区域 的方式绘制添加
火警区与 可以 通过将所选区域内所有的 点和线全部添加 的方式绘制
火警区域 不可以 通过 只添加点 的方式绘制，以免造成车辆无法驶离火警区域的问题
下图中，蓝色和黄色为 正确 绘制方法，紫色为 错误 绘制的方法
1670917103599-e09b2b2a-44a0-4267-9c5d-1d7f30eab1fd.png
