# OffDutyArea 组（上/下班功能）

### OffDutyArea 组（上/下班功能）
## @丁禹伯
## 高级组

## 名称

## 位置

## 默认值

## 版本

## OffDutyArea

## 调度---高级组

## /

### 0.1.9.240219
### mapf 需要 0.1.9.240306

## 下班区域

## 策略逻辑
调度拥有一个状态量：上/下班状态，可以通过 API 来设置或查询此状态，上班状态及下班状态的对应策略如下：
### 调度启动时，默认处于上班状态，所有车正常执行任务
### 当通过 修改上/下班状态 API 设置下班状态后：
处于 OffDutyArea 区域内的机器人，如果没有订单，设置其为不接单且占用资源状态
处于 OffDutyArea 区域内的机器人，如果正在执行搬运订单，待其完成订单后，前往最近的下班区域后，设置其为不接单且占用资源状态
处于 OffDutyArea 区域外的机器人，如果没有订单，设置其为不接单且占用资源状态，并寻路前往最近的下班区域
处于 OffDutyArea 区域外的机器人，如果正在执行搬运订单，待其订单完成后，设置其为不接单且占用资源状态，并寻路前往最近的下班区域
### 0.1.9.240531 设置下班状态时，新增报文字段 stop 用于选择完成当前任务后的机器人策略，缺省为 false：
### true：完成当前任务后，机器人原地不动
### false：完成当前任务后，机器人前往下班区域
## 示例报文如下：
## {
### "onDuty": false,// 设置下班状态
### "stop": true    // 完成任务后原地不动
## }
### 0.1.9.240814 设置上下班状态时，新增报文字段 forbidCharge 用于选择是否禁止下班状态的机器人去充电，缺省为 false：
## true: 禁止下班状态下机器人去充电
false：允许下班状态机人在低电量时充电，并在充电完成后重新返回下班区域
## {
  "onDuty": false,        // 设置下班状态
  "forbidCharge": true    // 禁止下班机器人充电
## }
### 0.1.9.250814 设置上下班状态时，新增报文字段 chargeAsOffDuty 用于选择是否将处于充电状态的机器人视为下班完成，缺省为 false：
### true: 将充电状态的机器人视为下班完成
### false：将充电状态的机器人视为执行下班中

## {
  "onDuty": false,           // 设置下班状态
  "chargeAsOffDuty": true    // 充电中机器人视为下班完成
## }
### 当通过 修改上/下班状态 API 设置上班状态后：
### 所有不接单且占用资源的机器人设置为可接单状态
### 如果此时有机器人正在前往下班区域，会终止此订单
## 提供 获取上/下班状态 查询 API
## 应用场景1
调度的上/下班功能目前 用于处理机器人和人工搬运车混合运行的场景下的冲突问题
1706777140214-835798cd-9c25-45d8-adc6-a5dd9c95aa81.png

## 以此图为例：
环线上机器人和人工搬运车混合运行，如果不加约束或设置互斥区，均会造成机器人等待拖慢运行节奏；
### 在采用上/下班策略，并设置紫色点位/区域为下班区域后
### 如果人工搬运车需要通过环线，用户可以设置调度为下班状态
此时环线上的机器人在完成当前任务后，会主动前往下班区域并不再接单
### 当人工搬运车不再需要在环线执行任务时，设置调度为上班状态
## 此时所有机器人会继续接单执行任务
用户可以通过设置上/下班状态为人工搬运车让出一个进场作业“空窗期”
## 应用场景2
场景中机器人完成当前任务后不再执行任务，等待推送场景后继续执行任务：
当用户需要推送场景时，此时系统中存在一系列正在执行及待执行的订单
## 用户通过 api 设置系统为 下班状态
所有机器人在完成当前业务订单后变为不接单状态并生成前往下班区域的停靠任务
由于停靠任务不影响推送场景，用户便可以在所有机器人执行完当前业务订单后推送场景
推送成功后，用户设置系统为上班状态，机器人恢复可接单状态，继续执行新的业务订单
设置下班状态时，使用字段 stop 用于控制机器人在完成当前任务后原地不动，这样就不必前往下班区域
## 使用要求
### 需要开启参数 AdvancedAutoOrder
### offDutyArea 内需包含足够数量的点位
