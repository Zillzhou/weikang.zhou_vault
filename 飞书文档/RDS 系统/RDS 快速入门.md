# RDS 快速入门

## RDS 快速入门
## 一、快速入门一：Core 调度场景构建

进入 Roboshop 以后，点击右上角的【添加设备】，输入目标服务器的IP地址，点击确定，并点击页面右上角的蓝色刷新按钮。

1653529666360-f80d979e-8798-4df7-b8b1-55eff0066b0e.png

1653529670873-d834a2e6-9bb2-443a-91d3-1a9f37e74a5a.png

刷新后出现备注为 Core 的模块，点击【开始连接】，即可进入 Core 界面。

## 1.1 Core 调度界面功能简介

## 添加机器人组

进入 Core 调度界面后，点击【启动编辑】，并点击【新建】，可建立一个新的场景。在【机器人组】上点击鼠标右键，选择添加组，如图所示：

1653529677624-24ba4a65-c586-461c-b643-9a10af968f35.png

## 添加设备

选中新建的组，在【机器人组】上点击 “+” ，在弹出的【添加设备】页面中勾选机器人，默认为全部勾选，点击【全部】取消勾选，然后选中要添加的机器人即可（需要是真实机器人），即可添加设备到组内。如图所示：

1653529684203-c17c5d09-3486-4deb-be8f-b1dfa14d9daf.png

## 添加组内机器人地图到区域

点击【启动编辑】，在机器人组上，如图所示，鼠标移动到“T3”分组，点击右键选择【添加组内机器人地图到区域】，即可显示机器人中的地图列表。蓝色框内的小“√”为当前机器人使用的地图。如需要切换地图，可在【添加组内机器人地图到区域】后选择其他地图点击，退出编辑后上传场景即可完成地图的切换。

1653529690063-32081c60-f03f-41ae-b2eb-8ce656e37e03.png

如需添加虚拟机器人（如下图所示），在仿真机器人的更多选项中，选择【添加虚拟机器人】，点击需要添加的机器人数量。需要注意的是，若在添加虚拟机器人之前已经进行了添加地图的操作，则需要在添加虚拟机器人之后再次执行添加地图操作。

1653529695707-c82df232-68d3-42fe-9446-8399501a7d4e.png

在退出编辑以前，还需要选中地图中的 CP 站点，绑定1台或多台机器人，绑定后机器人才能去 CP 点充电。

PP 点作为停靠点，需要做同样的绑定操作。结束后可点击【退出编辑】并按照提示上传场景。

## 互斥组/互斥区域

“互斥”的含义是，对一个物理区域，或者一组站点、路径，在同一时刻，仅允许一台机器人进入运行。

点击【启动编辑】，找到【互斥组】并点击，在互斥组内点击 “+”，可自动添加互斥组 BlockGroup 02。

1653529702190-1209383f-7c95-43ba-abfc-98503754e9f6.png

另外，在互斥组下，点击下图编号为②的按钮，打开【高级区域】，点击 MutexRegion ，将想要设置为互斥区域的部分在地图中圈出，互斥区即可设置成功。退出编辑后，推送场景保存成功。

1653529706762-f88344af-aa5b-4ecb-8436-92426edccb8f.png

需要注意的是：互斥区与 MAPF 功能不可共用。MAPF 功能开启后，当机器人在执行任务的过程中遇到线路拥堵的情况时，会自动选择其他最短路径绕行。MAPF 功能开启方法如下：

进入 Core 调度界面以后，点击【参数配置】，勾选参数名为 MAPF 的一行，将值从 false 改为true 。按照需要选择临时修改或者永久修改。

1653529711834-379eb5cb-e582-4594-81f7-2c193738d81b.png

## 绕障区域

点击【启动编辑】后，点击【互斥组】，点击图中编号②的按钮，打开【高级区域】，点击 AvoidObsRegion ，将想要设置为绕障区域的部分在地图中圈出，绕障区即可设置成功。可在场景中布置绕障区域（ AvoidObsRegion 即为机器人的绕障区域）。

1653529716872-dbf35cd0-47f7-4c88-bec3-c96a31ae370f.png

在【指针】模式下选择区域，选中 AvoidObsRegion 区域，在右侧弹出的页面中点击【绑定】，勾选机器人名称，值下拉选择为【true】来使绕障区域生效。

1653529724507-de34656f-5afa-4956-a0c1-d98af9c7d2fa.png

除了互斥区域，Core 中还可添加互斥路径以及互斥点。

在【互斥组】中点击“+”添加互斥组，在场景中选中站点或路径元素，再右键点击【互斥组】->【添加选中元素至互斥组】，即可将元素添加至互斥组。此时，场景中的 AP 点以及路径颜色都会发生变化。如图所示：

1653529729475-1071e769-78e7-4ee0-8f2b-99e78b29f99a.png

删除区域：点击【启动编辑】，点击下图中编号②的位置，选中要删除的区域并点击【删除】即可。

1653529734008-ebd1a84a-d326-45bd-83e1-f62061dd8f64.png

## 机器人电量阈值

点击【启动编辑】，如图选中一台机器人，右边【基本信息】栏显示该机器人的详细信息。在图中编号④的位置，即是设置机器人的电量阈值；

ChargeNeed ：当机器人在未充电状态、电量低于此阈值且机器人没有运单时，机器人将前往绑定的 CP 点进行充电；

ChargeOnly ：当机器人在未充电状态、电量低于此阈值时，则机器人在完成当前运单后自动前往绑定的 CP 点进行充电；

ChargedFull ：当机器人充电至此阈值时，机器人自动结束充电并前往 PP 点停靠；

ChargedOk ： 当机器人充电至此阈值时，机器人达到可接运单状态。

注意：当设置的电量阈值为-1时，则不启用该功能。

1653529741443-74738054-31a5-4424-b34f-26a504a67db3.png

## 站点属性

CP 点：点击【启动编辑】，选中场景中 CP 点，右边则会显示站点属性，点击【绑定】，勾选机器人名称，值下拉选择为【true】，点击确定即可。如图所示：

1653529746017-c65dac7b-c072-4ad0-9a44-4e3966f24f0b.png

PP 点：点击【启动编辑】，点击场景中 PP 点，右边则会显示该站点属性，点击【绑定】，勾选设备名称，值下拉选择为【true】，点击确定即可。如图所示：

1653529751098-41b35c6d-b270-4de8-af7b-288fe817f24b.png

注意：如果值下拉选择【false】，那么绑定的站点属性会失效即不起作用。

## 库位

用户需使用 Roboshop 打开机器人地图（.smap），才可以编辑库位。

编辑方法详见： Core 库位功能使用说明 。

## 场景另存与加载

使用 Roboshop 连接一个 Core 调度，首页有【打开】与【另存为】，【打开】即为打开本地磁盘中已经存在的场景文件（后缀为 ZIP 的文件）；【另存为】将当前场景保存在本地磁盘。

1653529762165-f2aa0557-1741-45b9-9d29-39c451e62df0.png

## 场景推送与拉取

【推送场景】是将本地场景上传到调度服务器中。【拉取场景】是将调度服务器中的当前场景，拉取到本地。

1653529767077-b21ec9de-d3ac-40af-a9db-b8cccfd358de.png

## 参数配置

AutoCharge ：机器人在电量低于 ChargeOnly 阈值时，将自动去充电。

AutoLock ：机器人控制权处于无人抢占状态时，Core 可自动获取机器人控制权。

AutoPark ：机器人处于无运单状态时，可自行去 PP 点待机。

### 注：若误修改参数，可点击左下角【恢复所有默认值】

1653529771956-5e9853ca-9936-4ef8-8260-340b7c4e3c86.png

## 1.2 异常处理

## 1.2.1 错误信息

【告警】 显示当前调试界面的警告及报错信息。

【服务端告警】 显示 Core 调度服务器中的报错信息。

【机器人告警】 显示机器人的报错信息。

1653529789303-fcc6874f-5e9c-42ac-b778-8a8aa5370a6a.png

在调度服务器中，点击【启用编辑】，点击机器人左边的橙色叹号图标，即可弹出【异常处理】界面。

1653529793634-93d479f7-32a0-4f59-b57a-dbff167703b2.png

## 1.2.2 异常处理说明

## 当前机器人可接单

可接单：表示当前机器人可接单执行任务。
不接单且占用资源：表示当前机器人为不可接单状态，但是可占用场景中的资源（如占用了某 AP 点资源，另一辆车行驶到该 AP 点时，会因交通管制而无法继续行进）。
不接单不占用资源：表示当前机器人为不可接单状态，场景中也不占用任何资源。

## 控制权被抢占

表示 Core 没有获得当前机器人的控制权。点击【获取控制权】即可获得当前机器人的控制权，点击【释放控制权】表示将释放已经获取的控制权。

## 当前机器人的定位是否正确

表示当前机器人的定位是否准确，如果定位准确的话，可点击【确定定位正确】。

## 机器人使用的地图

表示机器人当前使用的地图场景，要想切换其他地图则点击【切换地图】。

## 数据同步

如果 Core 所加载场景的数据，与当前机器人中 smap 的数据不一致，则点击【数据同步】。在弹出的对话框中，可选择【场景地图同步到机器人】或【机器人地图同步到场景】。

1653529801735-d3136b43-3562-4b1e-adca-8e10e696a633.png

## 机器人与服务端的状态

表示当前机器人与RDS Core 的连接状态。

## 机器人的电量

表示当前机器人的电量是否正常。

## 急停按钮

表示当前机器人的急停按钮是否被拍下，如果在 Roboshop 上点击【I/O配置】里的软急停，则也会显示急停被拍下。

## 1.2.3 运单操作

### 【暂停导航】 表示将正在执行的订单任务暂停

### 【继续导航】 表示将继续执行暂停后的订单任务

【清空所有订单任务】 表示将当前的订单任务 TaskID 清空不再执行

【终止订单不再接单】 表示将当前的 TaskID 终止掉，也不再接收新的 TaskID

1653529809624-342a6889-182a-44f5-a832-b53a32f499a8.png

### 二、快速入门二：RDS 天风任务

【天风任务】页面的介绍可以参考 【 RDS 网页端后台管理页面介绍】 。

### 2.1 拉取场景

首先打开浏览器，登录进 RDS。在【运行监控】页面中，右击选中【拉取场景】按钮，和 Core 中的场景保持同步，一般来说该页面的场景会自动更新。

1657872468823-61499153-e424-45e4-b099-eed321a43f4b.png

### 2.2 创建首条天风任务

### 进入【天风任务】页面，其菜单栏包含5个按钮：

定义新任务。
手动“刷新”当前天风任务列表。
“删除”选中的天风任务。
导入任务。
导出任务。
视图切换：可以切换天风任务为文件夹的形式，方便分类。

其中，【定义新任务】和【导入】是创建天风任务的两种方式。

1671522424370-050e16b8-e657-4a16-bd7d-b5b3bb43abb3.png

### 2.3 编辑任务

由于创建任务后存在默认 demo 流程，我们可以删除掉所有 demo 块，实现自定义任务逻辑。如下图，勾选最外层 b1 块，即可勾选 b1 及其所有子块。点击【删除】按钮，删除这些块。勾选块之后，还可以将鼠标移动到块的标题行，等到鼠标光标显示十字形状后，长按拖动该块，移动到其他位置。
1657872538209-25517efc-f4e0-414e-b746-2a56b21181a4.png

注意， rds-F1.9.19-B1.7.32 版本之后省略了该步骤，新建天风任务并点击编辑进入编辑页面后，可以直接开始任务的编辑。

## 调度示例

大多数情况下，我们定制天风任务都是需要机器人执行运输任务的，因此以下示例将从【选择执行机器人】开始入手，创建一个两点运输任务。

## 设置输入参数

首先，设置输入参数。点击【工具栏】的"任务输入参数"，删除默认的 demo 输入参数，输入我们运输的起点和终点，点击完成。

1653529990988-5ce4b37e-bc87-45e0-ac21-41457cbc9219.png

## 添加块

拖出一个【选择执行机器人】块，然后将【机器人通用动作】块拖动到前者的子块区域内。

1657872548802-4d912b79-de36-4d93-aeb7-d757557740df.png

## 编辑块

注意此时，可用参数列表（如下图所示），会自动添加三个参数，输入参数 "起点" 和 "终点"，输出参数 "选出机器人"。

块的参数输入框 ，仅有两种类型，分为“简单值”和“表达式”两种类型。简单值类型，将在系统解析时，通过块的参数类型，直接做推断。表达式类型，将被系统推断表达式的输出结果。可用参数列表中的参数均是表达式类型。

1657872556571-247b633d-62c0-43b9-8548-272d6a4de6d0.png

块参数 是在设计一个块时，就定义好的，支持多种类型，常见的有字符串，整型，浮点类型，布尔值，JSON 对象和数组等。

编辑“机器人通用动作”块，分别将"机器人ID"，"站点"，"动作"填入，机器人ID在【机器人】页面中可以选择。点击①【 机器人ID】，再点击 ②【绿色等号】，表达式类型参数将会自动填入 ③【参数输入框】 处。并编辑“选择执行机器人”块，填入关键路径（不填入指定机器人时，填入关键路径则可以让系统在任务中选择机器人时，选择距离“关键路径”较近的一辆 AGV） 。图中带红色*号的输入框为必填。指定机器人可以选填。如下图：

1657872567744-7619fe15-bffe-4c05-9c3b-65da763190b3.png

若任务需要“机器人在到达起点和终点时，均原地等待2秒”，需要为参数输入固定值，可以将 延迟块 拖动至【机器人通用动作】之下，并通过简单值的方式手动输入，如下图：

1657872575375-e3e9770f-d752-416a-a695-9c37d00b1d9e.png

编辑完起点和终点后，点击左上角"保存"任务。

### 2.4 确认机器人状态

可在机器人页面中看到机器人的状态。并可通过上排的按钮对当前机器人进行设置。

1657872589484-24676675-0ffc-4c43-92fd-423861f5e745.png

机器人页面，包含机器人操作按钮和机器人信息列表。机器人列表中，列出了机器人的名称、IP地址、组别、状态、IO、电量、置信度、控制权、定位状态和地图。其中：IO 表示机器人车体的数字输入/输出状态。
在勾选对应的机器人后，用户可以选择上方工具栏的按钮，对机器人的行为或状态进行设定。
选中一台机器人后，页面右侧将展示机器人的详细数据。包括：该机器人的模型号、设备ID、IP地址、备注、Robokit 版本号、地图名、固件版本号、累计行驶里程、今日累计行驶里程、累计运行时间、本次运行时间、是否被阻挡、实际速度、当前站点、地图、抱闸、电压、电池电流、重定位状态、急停、软急停、置信度、电量和（是否）充电。这其中：
Robokit 为机器人内置软件，机器人的一切功能，包括定位、导航、执行动作等，都由 Robokit 来处理。
机器人位置，注明了机器人的全局二维坐标和朝向角度。
机器人实际速度，展示了机器人在自身坐标系下的矢量速度。
软急停和急停都可导致机器人进入急停状态。区别仅为，一个是软件触发，一个是通过机器人本体上的按钮触发。

### 2.5 运行任务

## 任务发起的方式有三种：

在任务编辑界面，或者任务列表，或者任务按钮界面，通过按钮发起。
被插入其他任务，作为子任务运行。
在 JavaScript 脚本代码中，用后台提供的接口方法生成任务。

本文仅介绍第一种。

在任务编辑界面，保存了 5.3 中的任务以后，点击【运行】按钮，就可以运行天风任务。运行时填入输入参数【起点】和【终点】，系统将创建任务实例，运行任务逻辑。

1657872599373-d2aa266e-0e6d-47b3-9036-0ad17c74d9a4.png

回到【天风任务】页面，任务列表中，点击对应任务操作中的【运行】按钮（如下图），也可以发起任务。

1657872608146-45aca1b6-d9aa-48cd-85aa-1fe3d03c41c1.png

### 三、快速入门三：脚本构建

在【在线脚本】页面中，点击工具栏的新增，点击新增按钮，增加一个 ” boot.js “ 文件。

1657872620655-77346cab-c4db-4889-8afd-03b548808756.png

在页面中输入脚本代码，点击【保存】并启动。

1657872632354-a7ee5757-ded0-4ed1-8295-e7823df597f7.png

具体操作可以参考 【脚本开发实战教程】 和 【脚本方法字典】 文件。可在页面左侧下拉，找到【脚本方法】和【脚本实战教程】点击后，在页面中显示。

1657872645594-1b75d178-e9e5-4ded-82b1-063b493a34e9.png

1657872657306-8d05b4fb-2e02-4991-a6f5-b5d1d79d252b.png

## 附录

## RDS 用户手册.pdf
