# RDS 调度系统技术协议

## RDS 调度系统技术协议
### RDS 系统机器人调度功能简介.docx
## 1 RDS调度系统
## 1.1 接口协议
## 1.1.1 通过 Core API 使用调度系统
### RDS  调度系统提供 Core API，其主要功能包括：
创建、终止和查询运单。
查询机器人的运行信息，更改机器人的参数等。
与设备交互：查询库位状态、与终端、门、提升机交互等。
## 1.1.2 RDS 标准接口协议列表
1）RDS  标准版调度系统不支持自定义业务逻辑调度，而是点对点的运单执行。
### 2 ） Core 标准 接口 协议见在线链接：HTTP API
## 1 .2 系统功能
## 1 .2.1 定义场景模型
Roboshop Pro 配置有场景编辑器。该编辑器可导入 SRC 主控器所使用的地图文件（.smap），并以此为基础，通过可拖拽式的场景部署方式，自由组合及编辑场景模型所需的元素。
在RDS 库位页面可一键同步机器人地图中的库位信息，库位可设置占用状态和货物，支持锁定管理。支持光电传感器自动同步状态。
支持在场景中为每个库位配置个性化的动作序列和动作参数。通过下发指定库位的运单，即可调用该库位配置的动作参数。
## 1 .2.2 任务下单
## 1.  创建运单
通过 Core API 接口，可以快速创建运单。
可将运单分配至指定机器人、指定机器人组或者指定标签的机器人，不指定则由RDS 调度系统根据运行情况自动选择合适的机器人派单。
可设置运单优先级，数字越大代表优先级越高。
可为运单指定多个动作块，动作块包含目的地名称和动作/脚本。
### 2.  终止运单
## 通过 Core API 接口：
以运单ID 为标识，来终止运单执行。
以执行运单的机器人名称为标识，来终止运单执行。
对于正在执行运单的机器人，在终止其运单时，可以指定其继续接单，还是不可接单。
### 3.  查询运单
### 通过 Core API 的查询运单接口：
可以查询运单状态：已创建、待分配、正在执行、完成、失败、终止、无法执行、等待。
通过该接口获取当前运单状态后，上位业务系统可以在运单的关键节点：1）进行运输任务以外的操作；2）或者通过对场上形势进行逻辑判断，灵活选取下一个阶段的运输任务。
### 4.  拼合单
对多储位机器人，支持通过 Core API 下发拼 合 单，系统依据当前指定机器人组内各机器人的空闲位置和指定任务的起终点，按总体路径最优的方式，将新的拼单指令新加入到合适机器人的任务队列中。
## 1 .2.3 机器人管理
机器人管理：支持查看机器人在线状态、机器人列表、机器人详情，可控制机器人是否接单与资源占用状态。
异常处理：完善的异常处理机制，能够支持机器人突然掉线，机器人拍急停被人推走，机器人特定报错自动恢复等功能。
智能调度管理：依据运单目标点自动选派机器人；支持机器人自动充电；自动去停靠点。
机器人更换：当机器人遇到故障无法继续执行，该功能支持更换机器人接力完成任务。选择合适车型后即可交接任务。
## 1 .2.4 路线规划与交通管制
RDS 可为每条运单规划机器人的行进路线，并且在执行过程中，在机器人之间进行交通管制。
路径搜索：RDS 基于有向图，多智能体协作规划（MAPF）进行最短路径搜索。
交通管制：在系统运行过程中，RDS 考虑机器人物理坐标系、机器人的形状尺寸，通过 MAPF 预防和解除死锁，对机器人进行以资源分配为基础的交通管制。
全区占用的区域交通管制：针对只能单台机器人进入和工作的区域，可以设置互斥区避免其他机器人进入区域。
第三方机器人的交通管制：第三方调度系统对于自家机器人是否在交通管制区域的状态更新有延迟，为了避免这种延迟导致交通管制区域存在多家厂商的车的情况，开发此功能，便于现场人员准确更新第三方机器人在交通管制区域的存在/离开状态，更好地实现精准的交通管制。
## 1 .2.5 库位管理
RDS支持设置库位的排、列、层、深维度，可管理库位的占用、锁定状态，可设置库位内容。除物料库位之外，还可根据需要添加逻辑库位。可配置库位光电，支持视觉识别，实时同步库位状态，库位状态可同步至高仿真可视化显示大屏。
## 1.2.6 运行监控
监控机器人位置及行进路线：通过RDS 运行监控页面，用户可监控整场机器人的位置、路线及运输阶段。
查看库位、站点、机器人、自动门等图元和设备的属性。

## 1 .2. 7  统计
1.  RDS 会 针对机器人、任务和运单进行跟踪统计， 并通过报表，或者折线、直方图来展现给用户 。 支持导出数据供，支持自定义增加删除统计卡片，以下是统计维度：
机器人 ： 状态 /任务执行时间/空闲时间/总运行路程/故障时间/故障次数/接单数量，分析机器人执行效率、执行效率趋势。
1701677890676-2021b2ea-8802-4dba-91ac-267074320605.png

任务：当日创建任务数量和趋势 /完成任务数量和趋势/异常任务数量/天风任务平均完成时间/完成情况对比/近期任务滞留统计。
1701677901155-6636ed0d-3648-4ee5-b98f-3ff0bb427fb1.png

运单：当日创建运单数量和趋势 /完成运单数量和趋势/终止运单数量和趋势/完成情况对比/滞留运单统计。
1701677908926-3442d3ba-76cd-474b-9122-58418520e645.png

### 2.  RDS统计内容还包括机器人运行记录、运单详情、故障记录。
## 1 .2. 8  告警
显示机器人告警和系统告警，排查问题，一目了然。
1701677920432-312ca98b-7f01-40f4-90bd-3cb4fb2d8853.png

## 1.2.9 外围设备交互
RDS 可在机器人运行过程中回调外围设备提供的接口（需实现仙工智能提供的接口规范），因此可具有以下外围设备交互功能。
自动门控制：通过PLC 以及远程无线 IO 设备，以及仙工智能提供的门控服务器程序，RDS 可实现对自动门的控制。
电梯控制：通过电梯改造模块，以及仙工智能提供的全局电梯控制服务器程序，RDS 可实现对机器人自动乘电梯的控制。
呼叫器：支持在界面上配置呼叫器，用户可通过呼叫器按钮触发和取消任务。
人机交通管制区域：通过PLC、三色警示灯、行人按钮以及远程无线 IO 设备，以及仙工智能提供的人机交管服务器程序，RDS 可以在场景中添加人机交通管制区，保证工作人员安全通过这些区域。
用户回调及过程同步：RDS 支持运单回调，用户可在运单中注册回调信息，使机器人在工作站进行操作期间，能和上位机系统进行接口交互，在关键节点实现过程同步。
## 1.3 天风任务——低代码流程编排引擎 （RDS专业版功能）
## 1.3.1 组合天风任务块进行任务搭建
RDS 可提供标准或者定制化的功能组件，且具备二次开发、与系统间整合的能力，为客户快速搭建应用场景、定制天风任务提供高效方案。在页面中预设了业务流程中常用的代码块，可通过界面拖拽、组合，即可搭建出多种类资源参与、同步异步结合的业务流程。
1701677950836-d440c97a-452a-452b-861e-b0d3afde4862.png

## 1.3.2 任务过程可视化
在 RDS 任务管理界面，用户可实时观测到任务的 输入变量、任务变量、输出变量 ， 左侧查看块列表，右侧查看块日志，右侧块日志可跳转到左侧相应块的内容。任务监控支持用户查看 相关设备正在执行哪个动作、正在申请哪些资源、或触发哪些故障或异常等细节情况。用户既掌握全局节奏，也可针对具体任务快速定位问题。
1701677972297-abce39cf-b255-4252-9233-415d80ce0ff5.png

## 1.4 在线脚本 （RDS 专业版功能）
在非典型的场景中，用户自身业务具有特殊性，此时用户可以使用 “在线脚本”功能，对部分内容进行配置，以此灵活实现需求，开发适合身场景的业务流程。
1701677981219-621a4677-e915-4234-a073-607940351dd0.png

## 1.5 接口配置 （RDS 专业版功能）
通过拖拽的方式自定义接口逻辑，快速完成接口开发，实现系统间交互，大幅提升开发效率。配备接口管理功能，监控接口情况。
1701678011491-03c00952-6e2d-4f59-b2a4-17308e104b18.png

## 1.6 图形化功能配置 （RDS 专业版功能）
无需编写代码，只需拖拽组件、填写属性，即可完成手持端样式配置。
1701678019550-a3538019-303d-461c-892f-41a83e1a6f38.png

## 1.7 手持端 （RDS 专业版功能）
## 1 . 7 .1 创建手持端快速任务
在实际的业务场景中，用户需要通过手持端快速下单。在 参数配置或者功能配置中 完成配置以后，会在手持端首页出现多个任务快速下单的入口。操作者可以通过快速下单入口发起简单 的运输 任务。
1701678031658-8ec0491f-0bf3-4cfc-87cb-25aa990fce5d.png

## 1 . 7 .2 需求单
通过配置，可以实现让不同库区的工人实现信息的传递。如当线边工作区需要物料时，发料区的操作者可以在 PAD 页面看到对应线边的物料需求情况，以此进行对应补料。
1701678039932-6bc07b1b-88e6-499e-8992-4c0e2f2972e2.png 

1701678044988-d2b377de-4355-4c37-bbeb-08ddcd430d00.png

## 1 . 7 .3 数据单
自定义查询数据表，并且在手持端以表格或卡片的形式展示。
1701678052490-735c5f6e-9b33-4826-a22a-d78b27196dd3.png 

1701678055661-7edeb8bc-7e1e-48c5-a349-eee12d4fc46f.png

## 1.7.4 机器人
与 RDS 后台的功能类似 ， 手持端同样具有对机器人状态的管理，包括：对控制权的抢占和释放、接单状态的更改、机器人继续执行或暂停导航 等 。
1701678061198-fdd45964-0bb3-4693-a801-2471ff4f8151.png 

1701678064272-7c0529f4-8cf2-41a3-ae29-751a5cc4fb39.png

## 1 . 7 .4 库位
在手持端中可以简单的实现对场景中的库位加锁、解锁和设置货物的功能。
1701678069478-d151d53c-69d0-4991-925f-eed1d88ec5a0.png 

1701678072512-3b636b2c-1efc-4aaf-a028-b590ae1e8f36.png

## 1 . 7 .5 查看任务运行情况
RDS 手持端同样可以查看任务的运行情况，如任务是否正常运行结束、运行和创建的时间、任务 ID 和输入参数等。同时支持在手持端中终止任务。
1701678079228-4e11c867-d0de-4458-b9dd-96d7b92d2d7b.png 

1701678082330-a3690b18-c83e-438f-a177-a9b86080554f.png

## 1 . 7 .6 地图场景监控
在手持端的地图页面，可以快速查看整个地图场景，例如所有库位的库位状态（以不同颜色表示）、 AMR 的运行轨迹，并且可以在页面中对地图进行放大或缩小，方便观察重点区域。
1701678087243-f16254bf-cb71-4530-b8a5-cc84be7087d4.png

## 1 . 7 . 7  基础设置
手持端可以设置岗位工位来显示不同的任务按钮，可对不同机器人设置操作权限。支持中、英、日、繁体四种语言，可设置响铃、震动，自定义提示音乐。
1701678091923-ce95615a-aeb9-4e3c-8d3e-db3423d35c16.png

## 1.7.8 链接外部页面
手持端中可链接外部页面，如仙工官网。
1701678097049-e1471a1b-f47d-418e-840d-ad112de9a605.png

## 1.8 语言
目前支持中文(简体)、中文(繁体)、英语、日语、俄语、德语、法语、意大利语、波兰语、西班牙语、葡萄牙语、韩语、越南语、泰语、印地语、印度尼西亚语
