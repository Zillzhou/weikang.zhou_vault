# RDS 功能案例

## RDS 功能案例
## 一、通过调用自定义的接口创建一个调度任务
如下图所示，创建一个天风任务，将任务命名为 "DemoWindTask" 
1706168038012-4ad8f960-dd32-401a-b642-c4f36eb9b56c.png

### 2. 设置一个输入参数 destination，字符串类型，并将该参数填入【机器人通用动作】块的【目标站点名】内。
1657160024212-a8f45db4-d021-40cc-9ff1-fe2cecb0453d.png

1706150543066-99059092-3875-4cf7-ae8f-9be876de1079.png

### 3.打开【接口配置】,并点击【添加】,输入对应的值后点击【保存】
1706150976461-ac4bcb21-4dd8-4819-8ce5-3afd5c584c86.png

## 保存后点击【编辑】
1706151092216-d37b0409-c50c-43e4-83cf-ed364be9ae4c.png

进入编辑页面后，点击【接口输入参数】，设置一个输入参数destination，字符串类型，并将它写入到【天风任务】块的【起始点】内。
1706151468791-aacc6fa8-db50-4a47-9b69-c10908435618.png

1706151674761-387f4a1a-37da-4834-8eef-60930b37836e.png

加入【打印】块和【设置接口的响应】块，并填入对应值后点击【保存 
1710396994566-b7e553ae-9ea0-485c-bfbb-52aad5483515.png

## 使用 Postman 工具，发送请求：
POST  http://127.0.0.1:8080/handle/register/postTask

请求体是 JSON 格式，将 destination 参数赋值为 “AP200”，如图所示： 
1706152796547-9afde6d9-a70f-4099-9526-317977187e5e.png

若在接口配置中添加了【设置接口的响应】块，可在发送请求后，获得该响应信息：
1706152908482-3d909c23-7574-4a46-9cd0-33220efc5caa.png

同时在【任务管理】界面中，生成一个 DemoWindTask 的实例。
1706152979027-65eef181-b29e-4eb1-b726-a0294bfe2c01.png

### 二、通过协议管理的Modbus配置来监听modbus的期望值自动创建任务
打开【协议管理】下的【Modbus配置】页面，新增一个modbus配置，根据实际情况和业务需求填写下列对应的值后点击【确定】。
1706153554819-ca3df7fb-ebf6-4263-865c-785d9f201a26.png

1706153566583-72195efd-ce7c-4393-b922-226fdd0fe631.png

## 点击【测试连接】来确认可以连接（可选）
1706154367341-4b7c39e8-efa7-4b2d-a615-ac497c2ecbee.png

当符合预期值后会自动创建天风任务，且不会重复创建天风任务。
### 三、通过天风任务的定时任务来读取modbus信号创建任务实例
在【天风任务】页面创建一个定时任务,点击【定义新任务】，选择【定时任务】
1706165375900-369333e9-1b97-4805-8c63-a5c77557fb20.png

## 点击编辑后，依次加入下图的流程块
1706604879343-136bd79e-d6f4-4949-9fa7-c17e4435e54a.png

### 可以在【任务基本设置】中设置定时参数的配置
1706165571189-c3b0266c-48c0-4874-9c75-831bc4f9adc9.png

### 保存定时任务后，点击【启动】即可开启定时任务
1706166434069-d5025582-9804-4d45-b8f9-9b9682d4734c.png

1706166443272-5b6e0934-a770-494e-aed7-389658f0019b.png

## 天风任务的定时任务.zip
### 四、通过手持端和接口配置完成简单的搬运任务
## 在【接口配置】创建接口，如下图所示：
1706757282496-a32e355a-548a-4501-b35c-a53c58318533.png

## 配置接口输入参数
1706767721570-ff9e6aad-6f39-459b-b4ba-af2bda2322e6.png

## 天风任务的创建
 将任务命名为 example 。为其设置两个输入参数 from(取货点) ， to(放货点) ，字符串类型。将第一个参数 from 填入【关键路径】内。
并将这两个参数，分别填入两个【机器人通用动作】块的【目标站点名】内。

1657160260694-17a37ca6-2064-42f9-812d-409dd99cb3e1.png 

1706764797580-8a687cef-def5-4acf-b44b-4507ab56af9b.png

打开【设置】界面， 点击任务的加号，新建一个菜单按钮，命名为简单运输任务。
1692265657661-a2fd8189-3d7e-4252-b1f5-715d560fa5c7.png

展开任务菜单，点击简单运输任务，进入任务菜单编辑界面。
1692265717205-13009002-3f10-4528-a40c-b0aad4a65d6c.png

点击屏幕中间预览页的简单运输任务按钮，右侧会弹出其属性。
1692265746025-029b8c61-00db-41df-9216-ceac566ae01d.png

展开简单运输任务按钮，进入详情页，编辑详情页的显示信息。
1692265774027-96ade9df-d762-4379-bd0f-bf858da113bf.png

我们可以根据需要将组件拖入详情页中，然后配置其属性。
1692265798094-1a070ef0-3ab9-436e-b4d0-2f7bbcb2176f.png

这里我们拖入两个单行输入组件，然后点击单行输入组件，在右侧编辑属性
from和to 分别对应【接口配置】的【接口输入参数】的from和to 
1706763958494-949693f5-8bfa-4735-b87d-a841688fd0af.png

1692265848714-d597e8b0-080c-40f1-aecd-390f1ac67491.png

点击【下单】按钮，配置其属性：路由就是下单按钮的响应方法（POST）路由，该方法在开始的接口配置已经写好了，二次确认提示文本是下单后的提示信息，点击【保存】按钮 
1706767921685-6926a938-2e12-44bf-b309-6fc7f1012b1b.png

## 在手持端发起搬运任务
## 下单任务页面
1706764953525-321555ef-5087-405c-84a7-9f7a79df4677.png

1706767946713-18e3fdbe-f2d9-4310-91fd-95383b080e80.png

## 【接口管理】页面
1706767968916-70a2c52b-afd7-409d-b914-af5096403304.png

## 【任务管理】页面
1706768006638-b17e8da8-a1a7-4101-9738-38cc69f751c5.png

## 天风任务和接口任务.zip
### 五、通过事件配置来注册事件处理器
事件配置是用来在完成一些特定的任务（如天风任务的完成、终止、失败；机器人动作的失败等）后来执行的一些公共逻辑（将任务中的信号复位，缓存数据复位等）
### 点击【事件配置】来再点击【定义新事件】来注册一个事件
1710136759347-3aa338dc-2e35-486e-ad03-3d2b8c542913.png

## 选择需要注册的事件
1710137959554-7e73e1ac-3c41-4e66-ba09-a6385619d2e8.png

### 创建完成之后，点击【编辑】来自定义事件执行动作
1710138197837-1d012ceb-03c1-41ce-a3a3-211607777bb0.png

### 编辑任务块后，点击【保存】后再点击【启动】
1710138172305-7f41da5a-0bdd-4e8e-a388-775912182a60.png

## 效果图：
## 发起了一个天风任务，并且执行结束
1710138408933-caf88882-fed5-4a93-b343-f683fa7abacc.png

## 结束后，在【事件管理】查看事件
1710138474245-66ac970a-f104-4463-98a3-a472f66c3693.png

### 六、通过功能配置和定时任务实现OPC通信并发起任务。
设置opc配置需要先安装kepserver作为服务器。
## 1.打开设置->系统配置->opc配置。
### 1711503244473.png

按照下图设置opc配置，服务地址为kepserver中OPC UA设置的地址。
### 1711505026458.png

再次打开显示连接成功。
### 1711504116023.png

### 2.创建定时天风任务并保存。
1710406808257-6bddc394-bc1d-417a-a192-18319e12caa1.png

### 1711504369187.jpg

### 3.点击启动开启定时任务。
1710407203190-bb0d45b4-a684-4741-be28-5486bfcfa019.png

### 4.在任务监控查看运行结果和opc地址的值。

1710407130830-10777528-3a6a-457e-ba7f-1af4af9dad8f.png

### 5.写入opc地址只需要将读取opc值换为写入opc值即可。
1710407432466-a8bec304-a379-460d-897e-c5a14ee020da.png

### 七、通过天风任务实现ModbusTCP通信读取和写入Modbus值
## 1.创建定时任务
1710408851910-a2d82bf7-168d-44e5-a82a-b4274a44b5b3.png

### 2.天风任务中加入通用读取Modbus和写入Modbus块。
1710730918986-b112abde-02a3-4cb5-8013-92e1785f61e9.png

在modbus中根据天风任务块设置。
### 1711506312413.png

### 1711506403335.png

启动定时任务。 
1710731038754-f05e45f4-2d1c-41ad-812d-f09698be0e5f.png

### 3.运行结束在任务监控查看Modbus值。
1710409425903-d0007011-95c8-4e3c-965e-e1083d436c05.png

### 八、通过页面配置手持端静态下拉菜单和静态二级下拉菜单
## 创建一个任务
1710472342140-289d7464-d501-4da3-977a-354b50dacec3.png

## 输入任务参数
1710472462670-5f71431e-3dc7-4a46-a021-2f029a35801f.png

## 创建之后，选择【组件】
1710472627912-65728f76-7e8b-4e0c-868c-ac849cc437b4.png

## 拖动下拉框到对话框内
1710472721654-6da1857f-c9a2-4630-abb6-9e39876581e8.png

## 1.配置静态下拉菜单
## 为每个下拉菜单设置值
1710472889783-602ab2be-ed6b-46f2-a92c-947c4a747a3f.png

1710473165184-5d132d93-d8e7-468e-8ecf-60988691508f.png

1710473196885-ab764236-e68c-4e60-92a0-bce1181928ef.png

### 2.配置静态二级下拉菜单
## 添加两个下拉菜单
1710474996065-66c67b71-4adc-468d-bc03-eb6e1bfa6ea3.png

## 起点和终点的名称
1710475037577-e3759432-0d1a-4f72-b925-229b9a6f96b5.png 

1710475046477-287d75bc-d10e-427f-b309-a8943550821b.png

## 在终点的选项里添加【二级联动】
1710475148116-612e6a79-aabf-4ae9-a695-95c9f0c7b056.png 

1710475167010-66354514-d6f8-4d2e-a81b-567a37d573f4.png

上图效果为：当起点选择【起点1】时，终点只能选择【终点2】.选择【起点2】时，只能选择【终点1】
1710475279000-99333cba-cf73-4ea4-a8e0-57360e452c36.png

1710475285436-5d837867-6edc-419f-97a1-01085ea65913.png

### 3.配置动态下拉菜单
### 在【动态下拉菜单方法】输入在线脚本中注册的方法名
1710475707807-5a30553c-c5b5-41e2-88d1-843eda7b510e.png

## 在线脚本中编写脚本
## function boot() {
     // /script-api/operator/ 为固定字符串，getForkSiteList与上文的1中dynamicOptionsSource参数的值保持一致
    jj.registerHandler("POST", "/script-api/operator/getForkSiteList", "getForkSiteList", false);
## }
//与第三行中的getForkSiteList对应，代表着该接口真正的处理逻辑
function getForkSiteList(params) {
   // 动态下拉菜单的返回值数据结构一定为数组对象，如下案例'list'
## var list = [{
            value: "option1",
## label: "选项一"
        },
## {
            value: "option2",
## label: "选项二"
        },
## {
            value: "option3",
## label: "选项三"
        },
## {
            value: "option4",
## label: "选项四"
        },
## {
            value: "option5",
## label: "选项五"
        }];
    return { code: 200, body: JSON.stringify(list) };
## }
### 九、通过页面配置和脚本实现MQTT协议
在设置配置前需要先下载安装MQTT客户端软件搭建一个本地MQTT服务器，打开EMQX官网下载压缩包，并启动MQTTX服务器，具体可以参考https://blog.csdn.net/weixin_41542513/article/details/134328627?ops_request_misc=&request_id=&biz_id=102&utm_term=windows%E4%B8%8BEMQX&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-6-134328627.142^v100^pc_search_result_base7&spm=1018.2226.3001.4187
## 1.根据上述步骤启动MQTT服务器和安装MQTTX后，打开http://localhost:18083/按下图操作
## image.png

## image.png

创建两个用户RDS和TEST和一个测试用户test，密码都是123456，且都为"超级管理员"
## image.png

## image.png

## image.png

### 2.打开RDS页面配置，按下图操作和设置,开启MQTT配置，保存重启RDS
## image.png

## image.png

## 打两个下载的MQTTX，分别新建连接
## image.png

## image.png

分别创建一个RDS连接和TEST连接，如下图，创建好后点击连接。
## image.png

## image.png

点击保存后重启RDS后再次打开http://localhost:18083/，看到有两个客户端连接
## image.png

### 3.通过脚本测试，打开一个新的MQTTX，新建连接，创建一个test连接
按照图中设置新建连接，用户名对应上面建立的test测试用户，test用户的名称和Client ID可自行设置，设置好后点击连接。
## image.png

## image.png

在test中订阅RDS发布的主题，点击添加订阅，输入在RDS配置的pubconfig中的主题。
## image.png

## image.png

## image.png

在test测试中发送了点击发送信息后,在之前创建的RDS和TEST中点击连接会出现重连，需要删除这两个连接
## image.png

进入http://localhost:18083/查看总连接数，可以看到有三个连接，test是MQTTX的连接，其他两个为RDS页面的连接，RDS为pubconfig，TEST为subconfig。
## image.png

## image.png

写入下面脚本，点击保存并启动，在MQTTX的test端发送信息，RDS可获取MQTTX发送的消息,test也可收到RDS端发布的信息。
## image.png

## image.png
