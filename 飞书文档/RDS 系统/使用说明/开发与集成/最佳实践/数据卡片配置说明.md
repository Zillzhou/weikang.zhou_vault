# 数据卡片配置说明

## 数据卡片配置说明
在 RDS 设置菜单下，点击数据卡片，右侧开启数据卡片功能。
1705385789775-f52f13d5-2128-4b1c-b7d9-43df480c1a6a.png

点击加号，填入以下配置信息，可以按需填写，数据卡片支持两种形式：表单和文本。路由与脚本方法中的路径保持一致（下文有代码）。填写完毕，点击确定。
1705389109920-af585a7c-9b56-4c83-a2c6-a6621745db0a.png

文字类型的数据卡片添加形式同表单。
1705389135912-6e2281ea-9109-4440-b70b-e30b6b354961.png

添加完毕以后，点击卡片名称，中间可以看到表格预览，右侧可以看到卡片的所有属性。可设置文字和背景颜色，可绑定岗位工位。
1705389158685-4fbe6ffd-93f9-488b-815b-3694d098e7d9.png

所有的配置完，必须点击保存按钮。
1705389185603-7f5fcd27-0f67-4f47-96ab-bf97ee9f1657.png

在线脚本中添加以下代码（按需改动脚本，如区域名），保存，启动：
## function boot() {
## //首页卡片表格数据注册的路由
  jj.registerHandler("POST", "/script-api/showData", "showData", false);
## //首页卡片表格文字注册的路由
  jj.registerHandler("POST", "/script-api/showText", "showText", false);
## }
### function showText(params){
  var res = { code: 200, msg: "成功" ,data:"这是显示手持端卡片的文字信息" };
  return { code: 200, body: JSON.stringify(res) };
## }

### function showData(params){
## let condition = {
### "area": "new", //区域名
## }
  let result = jj.findAvailableSitesByCondition(JSON.stringify(condition),"DESC")
  let resultJson = JSON.parse(result)
## var data = [
### {"head": ["库位id","占用","锁定"]}
## ]

  for(let i=0; i<resultJson.length; i++){
    let locked = resultJson[i]["locked"] == 0 ? "未锁定":"锁定"
    let filled = resultJson[i]["filled"] == 0 ? "未占用":"占用"
    let siteId = resultJson[i]["siteId"]
    let row = {"row" : [siteId,filled,locked]}
## data.push(row)
## }
  var resultMsg = {"code": 200,msg:"查询成功","data": data}
  return {"code":200, "body":JSON.stringify(resultMsg)}
## }
## 登录手持端查看数据卡片：
1705386466780-78baa8c2-c8d9-4d09-aca1-6a299eeca690.png

## 数据卡片样例显示：
1705386455794-bb94dc54-c6c5-493f-89d1-8acb507fa435.png

样例 2，可在脚本中修改 return 的内容，修改后保存启动得到自定义的表单：
return  { code: 200, body: JSON.stringify({ code: 200, msg: "成功" ,data:[
                    {"head":["表头1","表头2","表头3"]},
                    {"row":["行1","行2","行3"]},
                    {"row":["行21","行22","行23"]},
                    {"row":["行31","行32","行33"]},
### {"row":["行41","行42","行43"]}
## ]
## })
      };
1705387218375-f7b4ce7b-e692-4d4a-ab8d-857d53093404.png
