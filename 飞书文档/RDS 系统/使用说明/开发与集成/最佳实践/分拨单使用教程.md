# 分拨单使用教程

## 分拨单使用教程
## 一、软件更新
需要将 RDS 更新到 F-1.9.76 B-1.8.28 及以上，Core 更新到 0.1.9.231225(x86_64) 及以上。手持端更新到 V2.14.54 及以上。
### 二、参数配置中打开分拨单功能
### 进入 RDS 页面，切换到【设置】页面，点击参数配置
1704854231631-8f5e91ea-c937-4c40-a323-20f51cb5d941.png

在配置页面输入以下内容并保存，注意保存后需要重启 RDS ： 
## distribute :
## enable : true
1704854259452-000a8e4d-2954-4e46-8604-6c2439ebf8fc.png

此时打开手持端，手持端出现了分拨单页面。
1704854274638-49182817-5abf-4c01-a67a-d03e3ae24845.png

### 三、任务背景
工厂内存在 BP 库区、DYT&ZZX 库区和 ZC 库区这3个库区，BP 区负责补货，DYT&ZZX 库区为线边库区，ZC 为返空库区。AGV 从 BP 区装载放置着多个零件的满料车送到 DYT&ZZX 库区，依次进行分拨。AGV 全程不放下料车，到达线边以后由人工自行从料车上拿取对应的零件，分拨结束后 AGV 将空料箱送回到 ZC 区域。
人工在 PDA 上发起分拨单，AGV 从 BP 库区取上料车以后，依次经过分拨点，到达分拨点以后等待人工在 PDA 上点击放行按钮或在分拨点停留 30s 以后自动离开，并将料车送回到 ZC 库区。

### 四、创建天风任务
在天风任务中创建一个新任务，名为【分拨单任务测试用例】，该任务的起点、分拨点均由手持端传入，终点需要系统自动查询空库位以后获取并暂时锁定占用 。首先点击按钮栏的【任务输入参数】，设置任务的输入参数。由于分拨点一般有多个点，因此分拨点的类型为 JSON 数组。起点为字符串。在该例子中终点由系统查询获得，因此任务输入参数中可以不填写终点。如果是通过接口传入时则需要在这里定义终点的任务输入参数。
1704854294426-6cba4e7c-f282-41c6-8e06-a0f9e4718fa8.png

找到分拨单块，将其拖入到天风任务的编辑区域。并补充起点、分拨点和终点。终点需要优先查询库区里是否由空库位，如果满足条件则将该库位锁定，如果不满足条件则需要通知手持端。离开起点库位的时候需要将起点库位置空。到达终点库位的时候需要设置该库位的占用状态为空库位。任务明细如下：
1704854308048-867f2506-03d7-4f24-a5ee-c4ddcff8d21e.png

### 五、接口配置
### 在接口配置中新增一个接口，填入以下内容：
1704854321159-266b6179-924c-4210-b9cc-2a7bf4b103df.png

点击行末的编辑，并同样的设置起点和分拨点的接口输入参数，找到【遍历数组】块、子任务【天风任务 - 分拨单任务测试用例】块和【设置接口的相应】块，并如图完成接口的编辑：
1704854341112-263c8a2e-cf04-4730-a68c-66df11f4429c.png

### 六、手持端配置
在 RDS 的【设置】页面，点击【任务】后面的加号，新增一条分拨单：
1704854349375-71ba6eae-88ec-4236-8878-e425a368157e.png

双击【发起分拨单】，在组件中拖入 2 个库位下拉菜单，并分别配置下拉菜单的属性：
1704854356348-36cb632f-07c7-4b3f-8f14-8f3ee3a50156.png

1704854405559-c6ad2ff9-2218-4589-ac67-eb95ef243cd1.png

点击【下单】按钮，配置路由为 PDA3test，并开启自定义接口：
1704854431814-30c27fc3-31a3-4eb0-bf75-88305def547d.png

### 路由的内容为接口配置中 register 后面的内容：
1704854452098-a9d76a69-6aad-4218-bffd-46bd294220f7.png

保存该设置并重启。

### 七、发起与放行分拨单
### 7.1 发起分拨单
打开手持端，切换到【发起任务】页面，点击【发起分拨单】，选择需要运输的起点库位和需要进行分拨的库位（支持多选），并点击下单：
1704854463763-daeeb902-e193-4668-89ef-93f2a7b91d29.png

1704854472710-4fccd213-5cc1-46b9-91ef-b19200d62600.png

下单完成则开始运输。若暂存区没有空库位则会下单失败并提醒“暂存区 没有空库位”，需要清理后重新发起。
### 7.2 放行分拨单
下单完成后，在手持端的分拨单页面会出现一个分拨单，正在运行中的分拨单可以在该页面直接点击挂起（表示暂时不执行，稍后人工点击继续以后再执行）。当AGV到达某一个分拨点以后也可以在该页面进行放行。也可以整单终止。
一个分拨单运单中涉及到多个分拨点，可以点击【详情】查看并分别操作。
1704854487472-443da1a1-117e-4dfd-a47b-d8c88468ce69.png

1704854505747-099c7aeb-891e-4bb9-8164-a726aab68f09.png

例如，目前AGV已经到达 Loc-100，为等待放行状态。Loc-103还没有轮到，因此是待分拨状态。Loc-106 这里暂时不想执行，因此点击了挂起以后状态为挂起，如需继续可以点击了【继续】的按钮。
1704854518998-7fad747f-f36b-4b74-83c7-6988db4e944d.png

当AGV在 Loc-100 完成了分拨以后，到达了Loc-103，此时 Loc-100 的状态为完成。Loc-103 的状态为等待放行，可以点击放行或者等待 30s 以后 AGV 自动离开。
1704854535392-f57d3412-6df5-4176-81cf-cb949528155c.png

### 7.3 关于定时放行的设置
可以在 Core 的参数配置里调整。
点击【参数配置】——【显示更多】——输入 DistributionUnloadTaskReleaseTimeout
——【搜索】——【值改为 30 】（单位为毫秒）——【永久修改】
1704854545607-9a9f6b40-c736-43fd-8bd1-a0eebe2310f2.png

## 分拨单
