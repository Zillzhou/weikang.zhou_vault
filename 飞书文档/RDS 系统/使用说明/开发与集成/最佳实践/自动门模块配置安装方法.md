# 自动门模块配置安装方法

## 自动门模块配置安装方法
## RdsCore 系统配置门控系统说明

## 一，准备工作

## 1.1 确认Roboshop 版本不低于 2.3.2.6 ；

## 1.2 确认RdsCore 版本不低于0.0.18.1；

## 1.3  安装并将门控模块与 Rdscore接入同一网络 (配置方法详见附录一) ；

### 二、 RdsCore 中配置门控模块

### 2.1 Roboshop -  RdsCore - 进入编辑模式；

### 2.2 如下图所示，选择自动门，点击 + ，添加一个自动门；

### 2.3 鼠标左键点击场景中的路径；

### 2.4 鼠标右键添加的自动门，点击【添加元素到自动门】；

1677665939515-467a0033-65fe-45d5-bb2e-d873293f9ae4.png

### 2.5 单击上一步骤中生成的Door-01,在右侧的属性框中配置门控相关参数；

1677665957937-654a474b-d36a-484b-833a-1ad9083eb8b3.png

【 type 】  : 实际运用选择 proxy ，仿真则下拉选择simulate;

【close】：在里面填写address，addressType，以及 value 信息，address是指寄存器地址，addressType是地址类型，value是往address这个寄存器写的value值；

【inplace 】 :  inplace指的是门到位的意思，后面的value值是读取inplace这个寄存器的地址的值等于value值时，认为是门到位；

【 open 】 ：address 是指控制开门的寄存器地址，addressType 是指地址的类型，相当于功能码，value 是往 address 这个寄存器写入值 value 时，认为是开门信号；

【proxyname】：要与rdscore中的机器人模型文件配置相对应；

### 2.5.1 配置 proxy

1677665972649-15d566e2-0b08-4721-b87f-abd368b1e312.png

【ip】：该设备的IP地址；

【port】：该设备的端口；

注 ：slave与timeout在无特殊情况下采用默认值；

自动门中的proxyname要与rdscore机器人模型文件的proxyname相同

### 2.6 根据实际需要修改 OpenDoorDist 参数；（当机器人距离门 OpenDoorDist 的距离时，RdsCore 对门控模块发出开门请求）

1677665986924-decf4819-cf7a-4083-9dc6-3225d6593a67.png

注意：此参数需要根据具体实际进行修改，默认为10m，即当机器人距离门 10m  时，RdsCore 对门控模块发出开门请求；

### 2.7 当 门 开口到位（触发上方的到位DI），机器人正常通过此大门后，大门自动关闭；

1677666001662-9e406a04-926d-4f29-95b6-6ea5e3964553.png

### 2.8 通讯流程

开门信号流动方向：RdsCore—>门控设备—>门控；

关门信号流动方向：门控—>门控设备—>RdsCore；

### 2.9 配置说明

在roboshop编辑门控时，添加门控以后，出现以下所示的页面。

{"address":16,"addressType":5,"value":0}，在 close，open，inplace 里要填写address，addressType，以及 value 信息。以 open(开门配置项)举例，address 是指控制开门的寄存器地址，addressType 是指地址的类型，相当于功能码，value 是往 address 这个寄存写入值 value 时，认为是开门信号，close 与此类似，inplace 是门到位的意思，后面的 value 是读取 inplace 这个寄存器的地址的值等于 value 时，认为是门到位。proxyName 里面要和设备挂钩起来。这里填入门控的 IP 以及端口。

1677666022027-9a23bb92-778e-46d7-b92a-37726a320c52.png

### 2.9.1 使用举例

例如现在在roboshop配置门控，首先点击编辑，添加自动门，假设close，inplace，open配置项如下；

1677666037796-e855146b-91cf-41bd-8c62-5e092049a053.png

 当小车控制关门时，向地址位 16，写入 0，即为关门，由于地址类型是 5，所以是写单线圈，其它配置依次类推。而后在机器人模型当中添加一个 proxy，proxyName 项则填入 proxy 设备的名称，以上图片当中 proxy 设备的名称为proxy，这个名称可以自己进行更改，这个时候 proxy 设备便通过这个名称进行了绑定，最后填入 ip 和 port，slaver 和 timeout 无特殊情况采用默认值即可。具体运行时，小车根据 inplace 项的信息(相当于 DI)，判断门是否打开，例如读取到地址位 17 的值为 1 时(根据上面的配置项)认为门打开到位，如果读取到的是其它值那么就认为门是关闭的，此时小车继续运行。具体的流程是小车来到自动门前，如果此时连接正常，那么小车就会发送开门的信号，直到门打开，如果门没有动作，就会一直发送这个开门信号，如果门打开了，并且门打开到位了，小车此时会通过自动门，达到下一个点位时，小车会发送关门信号。

## 附录一：WISE电控柜使用说明

## A.  内部构造说明

1677666054231-ad423602-de3c-424a-86ad-2ce367812b3e.png

AC-DC模块；
WISE-4050模块；
电源接通指示灯；
空开；
接线端子排；

## B. 设备安装

### 将天线和天线罩壳取出安装到 WISE-4050 上：

1677666070250-6fef0dd6-87ac-4d0a-a9c0-a6da8c9be8ea.png

### 2.使用自攻螺丝将箱体安装在现场指定位置，固定螺丝穿过图中红圈中的孔，固定在墙上。

1677666085602-8a040374-5744-4cb4-9ebb-67f1f937b31b.png

### 2.3 将220V交流电供电线连接至空开下方的输入口，注意L与N的位置区别；

1677666101741-6e0db9d7-9210-4f21-896d-eb40a1ab75f2.png

### 2.4 将需要被控制的开关接入到接线端子排上，门到位传感器接到 Di 端口，开门动作控制接到 Do 输出端口，分布如下图

1677666115750-cccd147f-83cb-47ac-a75c-7dcdd661a452.png

## DI分布：

DI0:12号，DI1:3号，DI2:13号，DI3:4号，DICom:14号；

## DO分布:

DO0:15号，DO1:16号，DO2:17号，DO3:18号；

使用 Do 时，需要一个 Do 配合一个 Dcom 使用，其中 6、7、8、9 为 Dcom 口;

### 2.5 现场DI连线

若现场的 Di 信号为干信号，需要将 WISE 背面的 SW2 开关的 P1 和 P2 均拨到 on，
将传感器信号接入到任意一个 Di 和 Dicom。
若现场的 Di 信号为湿信号，需要将 WISE 背面的 SW2 开关的 P1 和 P2 均拨到 off，
正常给传感器供电，将传感器的信号线接入到任意一个 Di。视传感器是NPN 或者 PNP 类型，将电源地或电源正接入到 Dcom。
## 以下为接线方法：

1677666131276-9a272c77-9386-4ecd-9f4e-1a9f14b66f2b.png

### 2.6  现场DO连线

模块中的DO内部电路为通断型，可以直接将干节点接入到DO和对应的Dcom

1677666145681-a5837a30-46d8-41d2-b76b-f4b73a36d087.png

## C. 门控联网

### 3.1 使用螺丝刀将WISE模块拆下，将SW1开关组中的P1开关，拨到”off“档，先不要将WISE模块恢复安装，拨动空气开关给电控柜上电。

### 3.2 使用电脑搜索”WISE-4050“开头的第一个SSID，点击连接。

### 3.3 在浏览器中输入”192.168.1.1“，进入设备设置后台

1677666159906-162f32aa-a7c1-4199-842f-836e853e5b9f.png

### 3.4 用户名为”root“，密码为”00000000“，进入配置界面；

3.5 依次点击“Configuration->Wireless->WLAN Mode 的下拉菜单，选择Infrastructure Mode->设置现场需要接入的 SSID 和密码”如果现场有备用网络，可以填写在“Secondary AP Settings”中，若首选网络连接不上，WISE 会自动尝试连接备用网络。现场网络必须为 2.4G 网络

1677666173555-ef931346-9aec-49ce-9ced-6e0ab3368aa9.png

### 3.6 在此页面下，向下滚动，在页面底部，设置“静态/DHCP”；

1677666187380-223c194f-2de6-4487-be4b-47b796ba7412.png

### 3.7 所有设置完成后，点击页面最底部的“Submit“保存设置；

1677666200362-bdec36ab-2c07-4255-b398-14492092a0d6.png

### 3.8  将电控柜断电，将 SW1 的 P1 拨回至“on”，使用螺丝刀将模块安装到导轨上，重新上电。设备联网后，WISE 外壳上的信号灯应该亮起；

1677666216568-94423992-8731-4009-8df6-6f78edbdd956.png

## D. 设备测试

### 4.1 将测试用的笔记本或其他可联网设备连接至现场网络，在浏览器中填写之前分配给 WISE 模块的 IP，重复第三章第 4 步；

### 4.2 点击“I/O Status”，可以查看 Di 状态和手动控制 Do 动作；

1677666230741-e53e0c8b-55e7-4e65-9b5c-bb6a9b5669d9.png
