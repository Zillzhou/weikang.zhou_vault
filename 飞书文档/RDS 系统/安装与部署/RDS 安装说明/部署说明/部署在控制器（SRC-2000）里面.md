# éƒ¨ç½²åœ¨æ§åˆ¶å™¨ï¼ˆSRC-2000ï¼‰é‡Œé¢

## éƒ¨ç½²åœ¨æ§åˆ¶å™¨ï¼ˆSRC-2000ï¼‰é‡Œé¢
æ­¤ç‰ˆæœ¬ä¼šåŸºäº Docker å°† RDS å’Œ Core å®‰è£…åˆ° SRC-2000 å†…ï¼Œé€‚ç”¨äºé€šè¿‡å‰è½¦ APP ç›´æ¥æ§åˆ¶æœºå™¨äººè€Œæ— éœ€æŠŠ RDS å’Œ Core å®‰è£…åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚
## å¿…è¦æ¡ä»¶
## SRC éœ€è¦å®‰è£…çš„å·¥å…·/è½¯ä»¶ï¼š
### rinetdï¼šç”¨äºé‡å®šå‘ TCP ç«¯å£æµé‡çš„å·¥å…·
Dockerï¼šç”¨æ¥è§£å†³ Core å’Œ SRC ç¨‹åºç«¯å£å†²çªé—®é¢˜
### RDS + Core çš„ Docker é•œåƒ
### SRC è¿œç¨‹è¿æ¥çš„ SSH å¯†é’¥ï¼ˆå‘ @è‹å›½åº† è·å–ï¼‰

## è¿œç¨‹ç™»å½•æ§åˆ¶å™¨
ä½¿ç”¨ä»»ä½•ä¸€ä¸ªè¿œç¨‹å·¥å…·ï¼Œé…ç½®è·å–åˆ°çš„ SSH å¯†é’¥è¿›å…¥ SRC æ§åˆ¶å™¨çš„å‘½ä»¤è¡Œç•Œé¢ã€‚
## å®‰è£… rinetd
ç®¡ç† Robokit çš„ç«¯å£æ˜ å°„ï¼Œç¡®ä¿åœ¨æœºå™¨äººå…¥ç½‘ä¹‹åï¼Œå…¶ä»–ç½‘ç»œè®¾å¤‡ï¼Œå¯ä»¥é€šè¿‡æ— çº¿ç½‘ç»œè®¿é—®æœºå™¨äººã€‚
## åœ¨çº¿å®‰è£…
## åœ¨æ§åˆ¶å™¨ç»ˆç«¯æ‰§è¡Œï¼š
## sudo apt-get update
### sudo apt-get install rinetd
echo "0.0.0.0 8080 192.168.193.15 8080" | sudo tee -a /etc/rinetd.conf
echo "0.0.0.0 8088 192.168.193.15 8088" | sudo tee -a /etc/rinetd.conf
echo "0.0.0.0 7600 192.168.193.15 7600" | sudo tee -a /etc/rinetd.conf
### sudo systemctl restart rinetd
## ç¦»çº¿å®‰è£…
ä¸‹è½½ç¦»çº¿å®‰è£…åŒ… ğŸ“rinetd_0.62.1sam-1_amd64.zip ï¼Œ
è§£å‹å‹ç¼©åŒ…ï¼Œå¹¶å°†è§£å‹åå¾—åˆ°çš„å®‰è£…åŒ… rinetd_0.62.1sam-1_amd64.deb ä¸Šä¼ åˆ°æ§åˆ¶å™¨ã€‚
## åœ¨å®‰è£…åŒ…æ‰€åœ¨è·¯å¾„ä¸‹ï¼Œæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š
sudo dpkg -i rinetd_0.62.1sam-1_amd64.deb

echo "0.0.0.0 8080 192.168.193.15 8080" | sudo tee -a /etc/rinetd.conf
echo "0.0.0.0 8088 192.168.193.15 8088" | sudo tee -a /etc/rinetd.conf
echo "0.0.0.0 7600 192.168.193.15 7600" | sudo tee -a /etc/rinetd.conf
### sudo systemctl restart rinetd
## åˆ›å»º Docker æ–‡ä»¶å¤¹
## åœ¨æ§åˆ¶å™¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
## cd /opt/
### sudo mkdir docker-volume
ä¸‹è½½ é™„ä»¶ ä¸­çš„ä¸‰ä¸ªæ–‡ä»¶ï¼Œæ”¾äºä¸Šé¢åˆ›å»ºçš„æ–‡ä»¶å¤¹ docker-volume ä¸‹ï¼Œç„¶åæ‰§è¡Œï¼š
### sudo chown root:root my.cnf
### sudo chmod 644 my.cnf
é™„ä»¶ä¸­ application.yml å’Œ application-biz.yml æ˜¯ RDS ç¤ºä¾‹æ–‡ä»¶ï¼ŒæŒ‰éœ€æ›´æ”¹é…ç½®ã€‚
## éƒ¨ç½²
## å®‰è£…
### ä¸‹è½½ Docker é“¾æ¥ ğŸ‘‰ ï¼š Docker å®‰è£…åŒ…
### è§£å‹ä¸‹è½½åçš„å‹ç¼©åŒ…ï¼Œåœ¨ SRC æ§åˆ¶å™¨çš„ç»ˆç«¯è¾“å…¥å‘½ä»¤ï¼š
sudo dpkg -i containerd.io_1.4.9-1_amd64.deb docker-ce_20.10.9_3-0_ubuntu-bionic_amd64.deb docker-ce-cli_20.10.9_3-0_ubuntu-bionic_amd64.deb

ä¸‹è½½ RDS å’Œ Core çš„é•œåƒåŒ…ï¼Œé“¾æ¥ ğŸ‘‰ ï¼š RDS Docker é•œåƒ ï¼Œä¸Šä¼ åˆ° SRC æ§åˆ¶å™¨ï¼Œè¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼Œå›è½¦åç­‰å¾…ä¸€æ®µæ—¶é—´ä¹‹åå¯¼å…¥é•œåƒå®Œæˆï¼š
sudo docker load -i docker-rds.F1.9.70-B1.8.21-robod-4.4.5-core-0.1.8.230922-0.1.9.tar.gz

ä¸‹è½½è·¯å¾„ï¼š MariaDB 10.7 Docker é•œåƒ ä¸‹è½½åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°† MariaDB é•œåƒå¯¼å…¥æœåŠ¡å™¨ï¼š
sudo tar zxvf docker-mariadb-10.7.tar.gz
sudo docker load -i mariadb-10.7.tar
1692090695658-f0d02a31-ed32-49bb-a78d-0d84171ed4ce.png

åœ¨ SRC æ§åˆ¶å™¨æ§åˆ¶å°åˆ›å»ºè‡ªå®šä¹‰ RDS Docker ç½‘ç»œï¼Œè¾“å…¥æŒ‡ä»¤ï¼š
sudo docker network create -d macvlan --subnet=192.168.193.0/24 --gateway=192.168.193.1 -o parent=eth0 ethnet

### åœ¨ SRC æ§åˆ¶å™¨ç»ˆç«¯è¾“å…¥å‘½ä»¤åˆ›å»º macvlan æ¥å£ï¼š
### sudo vim /etc/startup
## è¿›å…¥é¡µé¢ä¹‹åå•å‡»ié”®è¿›å…¥ç¼–è¾‘æ¨¡å¼
å°†ä»¥ä¸‹æŒ‡ä»¤ç²˜è´´è¿›starté¡¹ï¼š /bin/bash -c "ip link add ethnet link eth0 type macvlan mode bridge && ip addr add 192.168.193.5/24 dev ethnet && ip link set ethnet up"
1700041152017-574c7048-1d73-4073-b334-b5580ecc1e2e.png

ä¹‹å ESC é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œè¾“å…¥ :wq ä¿å­˜å¹¶é€€å‡ºã€‚
æ³¨æ„ ï¼šæ­¤æ—¶ï¼Œä¸ºäº†æ–¹ä¾¿åé¢çš„æ“ä½œï¼Œéœ€è¦å°†ç¬”è®°æœ¬ä»¥å¤ªç½‘çš„ IP åœ°å€æ”¹ä¸º 192.168.193.66ï¼Œå¦åˆ™å°†æ— æ³•é€šè¿‡ Roboshop Pro éƒ¨ç½² Core çš„åœºæ™¯ã€‚ Roboshop Pro å¯ä»¥ï¼š
é€šè¿‡ 192.168.193.5 è¿æ¥åˆ° Robokitï¼Œå¹¶è¿›è¡Œå¿…è¦çš„æ“ä½œï¼›
é€šè¿‡ 192.168.193.15 è¿æ¥åˆ° Coreï¼Œå¹¶è¿›è¡Œå¿…è¦çš„æ“ä½œã€‚

åˆ›å»ºæ•°æ®åº“ï¼ˆMariaDBï¼‰ç›¸å…³ Docker å®¹å™¨ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š
sudo docker run -itd --restart always -e MYSQL_ROOT_PASSWORD=mysql --privileged --name mariadb -v /opt/docker-volume/my.cnf:/etc/mysql/conf.d/my.cnf -v /opt/docker-volume/mariadb/log:/var/log/mysql -v /opt/docker-volume/mariadb/data:/var/lib/mysql --net=ethnet --ip 192.168.193.16 mariadb:10.7
ç¦»çº¿çŠ¶æ€ä¸‹ï¼Œéœ€è¦å…ˆå°† MariaDB 10.7 çš„ Docker é•œåƒå¯¼å…¥åˆ° Dockerï¼Œå¦åˆ™æ— æ³•åˆ›å»º MariaDB çš„å®¹å™¨ï¼
å¯¼å…¥ MariaDB é•œåƒçš„æ“ä½œï¼Œè¯¦è§ï¼š éƒ¨ç½²è¯´æ˜ > Docker > æ•°æ®åº“é•œåƒ ã€‚

### åˆ›å»º RDS ç›¸å…³çš„ Docker å®¹å™¨ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š
## ç¡®å®šæ˜¯å¦éœ€è¦å¼€å¯åè®®ç½‘å…³ï¼
### ã€æ¨èã€‘  å¦‚æœ éœ€è¦  æ·»åŠ åè®®ç½‘å…³æœåŠ¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:
sudo docker run -itd --restart always --privileged --name rds -v /opt/.data:/opt/.data -v /opt/docker-volume/application-biz.yml:/opt/data/rds/script/application-biz.yml -v /opt/docker-volume/application.yml:/opt/data/rds/app/application.yml --net=ethnet --ip 192.168.193.15 rds:F1.9.70-B1.8.21-robod-4.4.5-core-0.1.8.230922-0.1.9 /init.sh gw
### ã€ä¸æ¨èã€‘ å¦‚æœ ä¸éœ€è¦  æ·»åŠ åè®®ç½‘å…³æœåŠ¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:
sudo docker run -itd --restart always --privileged --name rds -v /opt/.data:/opt/.data -v /opt/docker-volume/application-biz.yml:/opt/data/rds/script/application-biz.yml -v /opt/docker-volume/application.yml:/opt/data/rds/app/application.yml --net=ethnet --ip 192.168.193.15 rds:F1.9.70-B1.8.21-robod-4.4.5-core-0.1.8.230922-0.1.9 /init.sh

å°†æ§åˆ¶å™¨æ–­ç”µé‡å¯ä¹‹åï¼Œä½¿ç”¨Roboshopç½‘çº¿è¿æ¥æœºå™¨äººè¾“å…¥IPï¼š192.168.193.15 ä¹‹åå¯ä»¥çœ‹åˆ°å·²ç»æ·»åŠ  Core åˆ° Roboshop ä¸­ã€‚
ç”¨ Roboshop æ“ä½œåœºæ™¯æ—¶ï¼Œè¯·æ›´æ–° RDS å’Œ Core çš„ç‰ˆæœ¬åˆ°æœ€æ–°ç‰ˆï¼Œå…¶ä¸­å¿…é¡»é€‰æ‹©æ ‡è®°äº† 0.1.9 ç‰ˆæœ¬çš„ Coreï¼Œä»¥å…æ— æ³•æ­£å¸¸æ“ä½œåœºæ™¯ã€‚

## å…³é—­å’Œé‡å¯ RDS å’Œ Core
å¦‚æœéœ€è¦å…³é—­åº”ç”¨ç¨‹åºï¼Œéœ€è¦åœ¨æ§åˆ¶å™¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼ŒRDS + Core éƒ½ä¼šå…³é—­ï¼š
### sudo docker stop rds
## å¯åŠ¨å‘½ä»¤ä¸ºï¼š
### sudo docker start rds
é…ç½®å¥½ä¹‹å RDS å’Œ Core æ˜¯å¼€æœºè‡ªå¯åŠ¨çš„ï¼Œé‡å¯ AGV ä¸éœ€è¦å•ç‹¬æ‰§è¡Œä»¥ä¸Šå¯åŠ¨å‘½ä»¤ã€‚

å¦‚æœä¸éœ€è¦å¼€æœºè‡ªå¯åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å…³é—­ Docker å¼€æœºè‡ªå¯ï¼š
sudo systemctl disable docker.service

### å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¼€å¯ Docker å¼€æœºè‡ªå¯ï¼š
sudo systemctl enable docker.service

## ä½¿ç”¨
éƒ¨ç½²æœ‰ä¹‹åå°±å¯ä»¥é€šè¿‡å‰è½¦ APP ä½¿ç”¨ å‰è½¦çš„å±€åŸŸç½‘ IP åœ°å€ è®¿é—® RDS äº†ã€‚

## é™„ä»¶
## ğŸ“application.yml
### ğŸ“application-biz.yml
## ğŸ“my.cnf

## å‚è€ƒæ–‡æ¡£ï¼š å¦‚ä½•åœ¨æ§åˆ¶å™¨ä¸­å®‰è£…Core
