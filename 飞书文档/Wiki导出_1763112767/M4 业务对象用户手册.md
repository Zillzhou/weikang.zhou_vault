# M4 业务对象用户手册

## M4 业务对象用户手册
## 业务对象首页
## M4 系统“业务对象”首页有哪些功能？
顶部是按钮区。顶部按钮区显示：添加业务对象、刷新、修复、导出、导入、重置按钮。
添加业务对象：输入必须是英文和数字，且不能重复。添加实体弹窗页面显示：数量关系默认为：多值、流水号默认是：4。
重置：即让系统恢复出厂设置。点击“重置”后，用户新添加的业务对象会删除，修改的内建业务对象会恢复默认。
SoJBbClznoORNpxHOuNcNaCbn7b.jpg

IWbgbf9gsoYdSFxttTxc9o0vnKh.png

### 目前 M4 系统上对不同的“业务对象”是如何划分的？
业务对象首页支持关键字筛选，最近使用的业务对象会被记录，方便查找。且下方列出所有业务对象。目前业务对象有两种：内建对象和项目扩展对象。
内建业务对象：系统内置的标准的业务对象，用户可以需要增减字段。内建的就是系统内自带的业务对象（蓝色显示）。
项目扩展对象就是根据项目需求新增的业务对象（橘色显示）。
禁用的业务对象：属于暂时停用的业务对象。需要时，可以重新启用。禁用的业务对象会显示删除线。
X60obscOko03HSxEkIrcAQhJnob.png

DYDrbYameoVyFYx0mkLcXkC2nHP.png

### 目前 M4 系统内建“业务对象”是用来做什么的？
系统内建业务对象通俗来说，就是标准业务框架的各个组成部分。目前主要是由：MainData（基础数据） 、Test（组件和实体） 、user（用户）、Warehouse（仓库标准业务） 、Core（调度） 、Falcon（猎鹰任务） 、GW（光通讯） 、WCS（仓库控制系统）八部分组成。
MainData l测试实体。
user 主要包含有：部门、组织、用户设置。
Warehouse 主要包含有： 叫空容器、新容器上架单、盘点结果执行、入库单、入库单行、库存明细、出库单、出库单行、库存变更、分拣单、分拣单行、装货单、装货单行。
Core 主要包含有：代理账户、配置项、实体修改记录、实体评论、实体同步记录、用户会话、编号规则、定制界面、列表查询方案、单据流转记录、资源锁、脚本鲁棒执行、运行一次、脚本运行一次、监控节点、用户通知。
Falcon 主要包含有：猎鹰任务字块 ID 、猎鹰任务块记录、猎鹰自定义组件、猎鹰任务日志、猎鹰任务记录。
GW 主要包含有：网关简单运单。
WCS 主要包含有：容器搬运单、直接运单、海康资源包、移动机器人运行记录、移动机器人系统配置、PLC 设备配置、机器人通讯点、通用运单、通用运单步骤、机器人任务日志。
ODAdbuM05oELy8xsuDbcfXBxnVh.png

QfdmbJlZNogr6SxA47OcErtcnDb.png

### 目前 M4 系统上禁用的业务对象是用来做什么的？
禁用的业务对象是属于暂时停用的业务对象。需要时，可以重新启用。目前主要是在：Core 、 MainData 组内有禁用的业务对象。
Core 主要包含有：监控节点。
MainData 主要包含有：产线、物料批次、物料单位。
EMcmbCr8yoVfH3xpnVZcbGHynZd.png

## 业务对象详情
## 如何配置业务对象的基础（信息）？
基本配置：实体名、显示名、分组、摘要字段、数量关系（多值、层级数据、单例）。
## 配置好基础配置后，菜单页面效果如下图：
ToikblQvWoFjVOxCKgEcSQ77n5f.png

禁用配置：有停用/禁用功能、禁用创建、禁用更新、禁用批量更新、禁用删除、禁用导出、禁用导入。
## 勾选禁用相关配置，配置效果如下图：
TcJRbQeaOo2SdBxul6tcMp8LnJg.png

WoD6boLrEovMaUxR46CctJswnUf.png

编号及排序规则配置：启用自动编号、编号前缀、流水号位数；默认排序。
### 启用自动编号以及排序后，配置效果如下图：
LaaFbWevLoJ4D0xeM99cTXyanFc.png

SFNeblufXo9289xFzyZclMOdnHw.png

其他配置：启用回收站、记录历史版本、追踪修改、启用评论、替换详情页、详情页打开方式：对话框、页面。
## 勾选其他配置后，配置效果如下：
IvD1b82rfoF8ERxZWC0cLMI3nRg.png

CYX0bzNJoouPE2xrWa4cUHYTndd.png

## 如何配置业务对象的摘要？
业务对象的摘要，指需要用简短文字描述业务对象特性或状态时的描述文字。每个业务对象，默认显示为业务对象的 ID（如容器编号）。
## 以“容器”业务对象为例：
配置步骤：如果修改要展示的字段。可以指明多个字段，有竖线分隔。如果还要定制，可以通过一段前端脚本代码。
TlB9buWJloq0QdxxXDEcOoWOnCh.png

场景描述：要通过引用选择一个容器在下拉列表里，有时仅通过编号不能区别业务对象的。需要多个字段。如物料编号、名称、规格、型号。此外，还可能需要显示一些状态信息。录入选择容器时，希望能提示容器是否是有货状态。
NyEpb9spgoOAByxAeLycUZ45nge.png

## 如何配置系统通知？
在桌面端业务对象配置详情页-基本配置页面，配置通知事件和通知人。当其他人更新、评论业务对象后，会给配置的通知人发消息。比如：当仓库主管修改了仓库经理创建的“仓库”后，系统会给仓库经理发消息。
GQnNbjOD2ob6lexMuqyc1D5wnec.jpg

FgpqbnJ8OovPhFxBGMOcrdJZnJc.jpg

## 如何扩展表格样式和逻辑？
在桌面端业务对象配置详情页-基本配置页面，填写扩展代码脚本，可以实现表格样式和逻辑的扩展。扩展代码属于高级功能，可以联系技术支持获取服务。
QJe8b39RuoecUOx5zpRcnLG6nZd.jpg

## 如何配置业务对象的字段？
在桌面端业务对象配置详情页-字段配置页面，点击工具栏中的“添加字段”，填写字段名。只能填写字母和数字，并且必须以字母开头。
XckebXnKgoG9dxxbTlncfFbknYb.jpg

VstDbDX1EoiBZAxpYl4c7AvknWg.jpg

选中字段，填写字段的具体属性。
显示名：操作页面显示的字段名，也叫字段标签。可以使用中文、英文等。
类型：即字段的数据类型，与输入方式有关。
当类型选择文本、整数、浮点数、布尔、日期、时间、图片、文件，不需要手动选择“输入方式”，系统会自动匹配合适的“输入方式”。
当类型选择组件，要勾选“多值”，“引用实体”选择单行实体名称。当字段类型是组件时，在 PC 端就会以表格形式呈现。不管是不是多值。
当类型选择“引用”，“引用实体”选择所引用的实体名称。
DCUcbHtLCobeacxH0IUcHs1mnKp.jpg

多值：表示字段值是一个数组，可以录入多个值。
当“类型”选择图片时，勾选“多值”后，新建或编辑页面可以上传多个图片。
当“类型”选择文本时，勾选“多值”后，新建货编辑页面可以添加多个文本录入框。
当“类型”选择引用时，勾选“多值”后，新建货编辑页面选项变为多选。
类型可以与“列表最少多少项”“列表最多多少项”来搭配使用，限制值的数量。比如 单据实体中 btLines 字段配置“列表最少多少项”的值为 1，表示单据至少有一个单行。如果单据没有添加单行，保存或提交时，系统给与报错。
UhgAbrPsKoKX8yxf0RfcUbBPnub.jpg

当“类型”选择布尔时，支持定制布尔类型字段的显示。首先，如果不定制，在列表表格界面，true 会显示为“是”， false/null/undefined 会显示为空。可以定制 true/false 情况下，更高显示文字，用图标显示，或添加 CSS 样式。
Qd7DbY6qIoizfGx6ke0cPZYAnee.png

YJJDbLyZaopinNx7tahcAbiInlb.png

选项清单：单据状态等字段可以通过“选项清单”配置，配置后，新建或编辑页面以下拉的方式填写字段值。
默认值：如果需要在新建时显示值，通过“默认值”配置。
停用：如果需要临停用字段，勾选“停用”。
模糊筛选：如果要在列表界面的快速查询时，匹配该字段的值，勾选“模糊筛选”。
必填：勾选后，新建或编辑页面，字段必填。
小数位数：当类型是浮点数时，必须设置“小数位数”，默认为 3 。
引用字段：本业务对象检测字段与引用字段：取值路径配合使用。比如采购单详情页，如果想选择物料后自动带出物料名称，可以在采购单单行业务对象-物料名称字段的“引用字段：本业务对象检测字段”中选择“物料”，在“引用字段：取值路径”中填写“name”。
RFFPbDXDGoxuMcxMgHmc6id7nce.jpg

汇总单行字段：用于单头汇总计算。比如在采购单头业务对象-采购数量字段的“汇总单行字段”中，填写采购单单行的“采购数量”字段，系统会自采购单单行的采购数量汇总，显示在采购单单头的“采购数量”中。
Q6AvbHKrCoK6o4xEAAucSkOGnLe.jpg

计算公式：通过填写计算公式，可以基于现有字段做公式计算。比如采购单单行中的-采购金额字段，可以通过采购单单行的“采购价格”和“采购数量”进行计算。
OcKBbFT13oktvwxNuiNcxQhInCc.jpg

K9gVb1CTWo9n2TxDkCAc2hmWnkd.jpg

输入方式：新增或编辑界面，字段的录入方式。
特殊输入：这是高级操作。填写“特殊输入”后，可以调取前端特殊的组件实现输入。
查看、新建、编辑：可以配置字段在这三种界面的输入控制，有不显示、只读、可编辑三种。红框内是 3 种常用组合，点击可快速录入。
LBaJbLiK8oklRvxYwi1csitqnTf.jpg

字段显示顺序：通过填写序号，可以手工编辑字段顺序。这里的顺序与列表页字段顺序、单头字段顺序、单行列表字段顺序一致。
宽显示：字段在详情界面默认采用多列布局。勾选“宽显示”后，字段在详情界面将占据整行宽度。
NBWDbmidjo7XJjxQCVrczROKn5d.jpg

组件表格列宽度：控制单行业务对象的字段在单行表格的列宽，单位是 px 。比如将采购单单行业务对象-采购数量字段的“组件表格列宽度”设置为 200 px。
FMyvbiViLohHVOxCCcMcsWSxnBe.jpg

GpsWb4Lw9oNX5mx5LRScRsoRnwg.jpg

列表表格禁用：控制单头业务对象的字段是否显示在列表表格中。勾选后，字段不显示在列表表格中。
PmcebWKYJolZh8xQakhceCXLn7e.jpg

列表表格宽度：控制单头业务对象的字段在列表表格的宽度。
列表表格对齐：控制单头业务对象的字段在列表表格的对齐方式。
SQL 数据库：目前需要填写字段的数据类型和最多字符，整数、长整数、浮点数需要填写数字位数，浮点数需要填写小数位数。
FN7ObI9bPoE3iCxxQibcEHApn7f.png

引用筛选：如果字段引用了实体，可以通过对实体中的字段进行筛选，实现过滤的效果。比如，下图过滤出“原料缓存区 L2”的库位。
FITlbFPMsoDzq2xTtmhcB0Wlnle.jpg

## M4 如何实现“多组单行”的功能？
一个业务对象支持多个多值组件子组件。即多组单行支持。
桌面端和移动端均支持多组单行的功能。
## 以“门店叫货单”为例，配置如下：
在业务对象-字段配置页面：首先对于单据，创建完主单（单头），接下来需要创建单行业务对象。现在可以从主单处触发。点击：“创建组件业务对象”按钮，即可自动创建单行业务对象。关键是类型选择:组件、多值（ ☑️ ）、业务对象（选单行业务对象）。
对于单行业务对象（如入库单行），关键字段是所属订单和行号。可以通过“添加常用字段”添加。注意所属订单关联业务对象要填对：填主单业务对象。
Y6dabhR0aoZgY3xJo8ScX8FDnpg.png

DZKybWkndoHWUcxBSZccko4znYe.png

## 多组单行配置效果如下图：
Wm8JbUupqoMVc7xCpa6ctQVWndg.png

### 为什么要配置业务对象列表界面批量操作功能？
有时需要对多个业务对象进行批量操作，如很常用的：批量解锁、批量标记为取消等等。对于布尔类型的字段和有选项清单的字段，可以配置“列表界面批量按钮”。现在已经对直接运单、库存明细、库位、容器添加了这类按钮。
## 以“库存明细”为例：
## 配置操作如下：
### 在字段配置界面-列表界面批量按钮，点击“添加”按钮：
“按钮文字”输入：解锁，“值”不勾选，按钮类型下拉选择：警告，点击“保存”业务对象。
O4e2bhNwgoLCmext33gctPQMnNg.png

## 配置实现效果如下：
TZ9IbZN9foeVi6xRI9ecMoPbnkd.png

## 如何在字段改变后触发扩展代码？
功能：当录入一个字段后，根据这个字段的值，自动查询外部，自动填充相关字段。
示例：耗材上架单行，在录入物料后，要根据物料查询此物料在仓库内存放的位置，如果有，要作为”建议库位“，并且如果”存储库位“用户此前未填，作为默认值。
配置方法：在耗材上架单行业务对象，找到物料字段（当此字段改变后触发），填入扩展代码。
## {
## // 查库存此物料存储库位
const oldBin = await ctx.utils.getStoreBinIdOfMaterial(ctx.newFv)
// 实际上架库位，如果已录入（非空），则按用户录入的，否则按建议的
const storeBin = ctx.ev["storeBin"] || oldBin
return { suggestBin: oldBin,  storeBin: storeBin }
## }
OhWeb40l5o6tQmxEJ5Sc923Inre.jpg

界面效果：拉取入库单，或者手工添加单行选择物料，如果物料有库存，将当前存储位填充到建议存储库位、存储库位。
LbuabhC2LooQRIx3AUjcFOjAnJd.jpg

## 如何配置移动端的卡片？
业务对象可以配置它的卡片视图。在移动端等需要展示业务对象时，以卡片的形式展示。
## 以“仓库”业务对象为例,配置说明如下：
添加卡片第一行：字段筛选为：仓库名称；类型选择：简单；前缀、后缀为空。
添加卡片第二行：字段筛选为：停用；类型选择：根据值；前缀、后缀为空。
添加条件：比较运算符：等于；值填写：true；替换显示内容：已停用，不勾选作为标签使用；不显示、文字颜色、背景颜色、CSS样式、靠右显示均不配置。
添加条件：比较运算符：其他；值为空；勾选：不显示；替换显示内容、作为标签显示、文字颜色、背景颜色、CSS 样式、 CSS 类名、靠右显示均不配置。
SIkGb7EsAo5IRxxzFI0cXKStnTh.png

## 卡片配置效果如下图：
QPVcbUrbVoqcGUx1eUIcWKwDnte.jpg

图片字段配置：只有含有图片类型的字段才显示：图片，如：物料。状态字段：只有业务单据才显示状态字段，如：入库单。
Lo76bP3zHosNt8xPZtYcJ8HinUd.png

TIl8bjfkyoWOrrxLnGYcJ68wnHc.png

P8wCbWKJnokAG3xjF8qcMkWyniU.png

ZcO3bQpM6o031Nxh9wQc3AYWn1b.png

## 单据业务对象配置
## 如何配置单据中数量字段的逻辑？
在单据配置页面，启用单据。
单行：本次发生数量字段，单选，比如上架单中的“上架数量”。提交上架后，按照本次填写的“上架数量”，增加库存。
单行：已发生数量字段，多选，比如上架单中的“已上架数量”。一个入库单可能分多个上架单上架，通过“已上架数量”提示用户前面的上架单已经上架了多少数量。
单行：计划总数量字段，单选，比如入库单中的“入库数量”是上架单中的“计划入库数量”，通过“计划入库数量”提示用户总共需要上架多少数量。
QQs3bdrvJoWwW0xG5JbcKOEOnOg.jpg

## 如何配置单据状态？
在桌面端业务对象配置详情页-字段页面，通过“添加常用字段”添加“单据状态”。
DfpxbUesvooxdhxpTurc5Xtxnyh.jpg

在桌面端业务对象配置详情页-单据状态页面，可看到已添加的“单据状态”，逐个设置每个单据状态能做的操作。
可修改单据：默认不勾选，勾选后，单据在此状态下仍然可以修改，即在单据详情页/列表操作列显示“编辑”按钮。
终态：默认不勾选，勾选后，此状态将作为单据的最终状态，即单据业务流完成时的状态。一个单据可以有多个状态，比如入库单的终态可以有已完成、已取消。
添加后续状态：如果此状态不是终态，可以选择此状态后面是什么状态，以及触发状态变化的按钮。具体操作：点击“添加后续状态”，后续状态配置列表出现一个空白行，可以选择“后续状态”、“按钮显示文字”、“按钮种类”、“录入说明”。
后续状态：单选。
按钮显示文字：根据需求填写，填写后作为按钮标签。
按钮种类：即按钮的样式，根据业务需求选择。
录入说明：如果勾选，点击按钮后，操作界面弹出“录入说明”的弹窗，填写录入说明后，状态才进行切换。
IfL5bFWZNoh7NFxXDg8cO4ntnxg.jpg

### 以耗材入库单为例，介绍单据状态如何配置？
在桌面端业务对象配置详情页-字段页面，通过“添加常用字段”添加“单据状态”。
K1ePb3D4Yozg1TxJXKrcBGuunYc.jpg

在桌面端业务对象配置详情页-单据状态页面，可看到已添加的“单据状态”，逐个设置每个单据状态能做的操作。
## 未提交状态配置如下：
勾选“可修改单据”。
添加后续状态。后续状态：已提交。按钮显示文字：提交。按钮种类设置为：主要。
## 已提交状态配置如下：
添加后续状态。后续状态：已完成。按钮显示文字：完成。按钮种类设置为：主要。
## 已完成状态配置如下：
## 勾选“终态”
LB2JbK8t4osLKZxDTLvc3sjinUh.jpg

NQbzbYLyuoW6ibxq9KzcMLfWn3c.jpg

## 配置效果如下：
CvbUb23Hbo4Z0QxO9M5cdVAPnOc.jpg

G2gYbNYgJogRSxxvr7pcqavwnFd.jpg

RrChbfwvFoXQNyxuoLOcRh2gnqf.jpg

K9M1brCdboc4CUxy1i6cZ9iknnm.jpg

## 如何配置上游单据？
一个单据可以配置零个、一个、多个上游单据。比如上架单可以配置原料入库单、成品入库单等多种入库单作为上游单据。配置上游单据后，在新增或编辑页面，可以拉取上游单据的信息。
## 具体配置方式如下：
在下游单据的业务对象配置详情-单据页面，配置“单行：本次发生数量字段列表”、“单行：已发生数量字段（可选多个）”、“单行：计划总数量字段”。
YTrbbNgD1oyd6SxNJmSclTfdncc.jpg

在下游单据的业务对象配置详情-上游单据页面，点击“添加上游单据”，出现一个配置区块。并根据需要配置一下内容：
上游单据：单选，选择需要拉取信息的上游单据，对应的单头业务对象名。
上游单据状态筛选：多选，选择后据此过滤可拉取的上游单据，只有满足此状态的上游单据才可以被拉取，如已提交的入库单。
下游单据反写时的状态：多选，选择后据此过滤可反写的下游单据，只有满足此状态的下游单据才可以被会写，如已完成的上架单。
添加单头字段映射：可以添加多对，每对包括上游单据的单头字段，以及拉取后对应的下游单据的单头字段。
添加单行字段映射：可以添加多对，每对包括上游单据的单行字段，以及拉取后对应的下游单据的单行字段。
添加反写映射：可以添加多对，每对包括下游单据的单头字段，以及反写后对应的上游单据的单行字段。
YIigbINiXoMy7DxPI6TcMNQPngb.jpg

## 如何定制列表统计逻辑？
在桌面端业务对象配置详情页-列表统计页面，由操作、停用（是否）、标签、类型、筛选、合计字段、计算脚本、文字颜色等进行定制实现。填写扩展脚本，可以实现列表统计逻辑的扩展。定制统计逻辑属于高级功能，可以联系技术支持获取服务。
列表统计功能。可以低代码构造列表统计项。通过此功能，可以突出实现一些关键异常，并进行直接筛选。
如果一个统计项是通过筛选方式统计的（下文解释），点击一个统计项，可以对列表执行这个筛选。即，点击“故障”，下面列表只显示故障的任务；点击“今日新增”，下面列表只显示今日新增的任务。 
目前支持三种统计方式：计数、字段合计、脚本。计数就是统计业务对象的个数；字段合计，需要选择对哪个字段进行合计，例如合计所有入库单的入库数量。脚本，则可以通过 js 代码构造复杂的统计项，进行加减乘除，或加载额外的数据。
对于“计数”和“字段合计”，通过点击筛选，构造筛选条件。如“今日新增”的筛选条件。
WujjbCK8no3f4mxm3BQcxF7dnPe.png

CxPubzZvxo1ppixcSI1cSI2vnqd.png

H8ppbec99oG8WyxbnZ0c4Qeynhg.png

MefUb4ljMo3R7gxNirIcKkBtnzd.png

示例：猎鹰任务。统计：故障数、暂停数、今日新增数、今日失败取消数等等。
NrZGbzBLzoevXvxO1gQclWOanDf.png

UlVKbYumFo2b4UxSp26c0zeenIg.png

## 列表统计默认配置了部分字段是为了什么？
增设几个常用业务对象的列表统计：容器、库位、网关简单运单、直接运单，主要是了更好的显示出问题。 
### 以“容器”为例：业务对象-列表统计界面，配置如图：
Pt9fbTA5Gom4GcxLkfmcoFc5nsf.png

## 配置效果如图：
Kokbbd1gboW4l9xMpwmcqSUwn3f.png

## 通过定制按钮能做哪些事儿？
### 客户希望定制界面按钮的行为有很多，下面是一些例子：
点击按钮，根据采购单号，加载 ERP 采购单，转换为入库单填入当前界面。
点击按钮，打印标签。
点击按钮，一键填充数量，一键数量清零。
点击按钮，提交，但定制提交前的检查逻辑，如要求实际数量不能超过计划数量。
点击按钮，提交，定制提交后的行为，如触发搬运，或回调第三方。
点击按钮，弹出对话框，显示库存。
根据单据状态，如完成前，显示人工完成按钮。
根据单据类型，如自动单据，可以呼叫机器人。
## 如何定制界面按钮？
界面按钮分为三种类型：标准、扩展和特殊扩展。标准按钮就是新增、编辑、查看等标准按钮。特殊扩展内部使用，不提。这里主要讲下扩展按钮。扩展按钮可以出现在三类界面：列表、新增编辑和查看。
## 按钮通用的配置是：
标签：即显示在按钮中的文字。
按钮级别：简单说就是颜色。如警告是红色。
前方添加分隔：勾选后，与前方按钮加大距离，用于分组。
确认消息：如果填了，点击按钮会弹出确认对话框，显示确认消息。确认后再执行。
调用超时：用于调用后端函数和猎鹰任务。单位毫秒。
PPQybdo3uoefTixNHY9cBb01nuh.png

在新增编辑查看界面，还可以控制按钮显示的时机，根据业务对象值的情况。例如仅在单据状态为未提交时显示。
Xc0XbskfroUjT8x0bIXctzDxnqg.png

## 可以通过三种方式定制按钮的行为：
前端扩展代码：编写一段前端代码。
后端脚本函数：填一个后端脚本函数名，并在脚本里定义。
猎鹰任务：选一个猎鹰任务。
对于列表和查看界面。只能填写：前端扩展代码、后端脚本函数、猎鹰任务。只能填一个，如果填了多个，优先按上述顺序只执行一个。例如如果填了前端扩展代码和后端脚本函数，只执行前端扩展代码。
NbetbiiRGofpCExnUr2ce9x0nCc.png

## 对于新增和编辑界面，按钮常用于做两类：
处理当前页面，点击后待在当前页面，如点击按钮加载额外的数据。
触发保存、提交等操作，然后关闭页面。
因此，对于新增和编辑界面，三种方式又多出两种配置：保存前和保存后。用于触发保存操作。
IxkNbKphEonsMHxnGDncOkkinUg.png

## 以后端脚本函数为例：
后端脚本函数名 （不触发保存） ：点击按钮，执行一个后端脚本函数。例如，输入 ERP 采购单号后，点击加载，加载 ERP 的单据详情，转换为我们的入库单。
保存前：执行一个后端脚本，如果报错，则显示，否则触发标准保存动作。可以用于检查输入是否正确。
保存后：标准保存成功后，执行一个后端脚本。例如，触发额外的搬运任务，通知第三方等。
### 保存前和保存后的操作，允许同时定义，执行顺序是：
如果有定义，执行“保存前的前端扩展代码”。如果报错，显示在界面，终止。
如果有定义，执行“保存前的后端脚本函数”。如果报错，显示在界面，终止。
如果有定义，执行“保存前的猎鹰任务”。如果报错，显示在界面，终止。
执行标准保存逻辑。如果报错，显示在界面，终止。
如果有定义，执行“保存后的前端扩展代码”。异步执行，不报错。
如果有定义，执行“保存后的后端脚本函数”。异步执行，不报错。
如果有定义，执行“保存后的猎鹰任务”。异步执行，不报错。
### 所有保存前和保存后的操作，允许杂糅。例如：
定义一个“保存前的前端扩展代码”，检查输入是否有效。
定义一个“保存后的猎鹰任务”，触发搬运。
## 具体的示例，请参考《开发手册》
### 以“仓库”为例，介绍基础资料类业务对象如何配置？
在【业务对象】菜单页面，点击“添加业务对象”输入：“FbWarehouse” 并点击“确定”按钮，进入【编辑业务对象】弹窗页面。
编辑仓库的基础信息：业务对象名：FbWarehouse ；显示名：仓库； 组：MainData ；不勾选 “停用”；摘要：name ；数量关系：多值；勾选 “有停用/禁用功能”；默认排序: id 。
MBSEbw2Pqo9XqXx6GCRcckXcn9f.png

编辑仓库的字段信息：左侧显示的字段是通过：添加的字段或添加常用字段显示的：仓库编号、仓库名称、备注、显示顺序、地址、位置经度、位置纬度、容积、默认库位、联系人、联系电话、面积、创建人、创建时间、最后修改人、最后修改时间、停用。字段配置详见字段是如何配置的。
SreRbSmrWo6c3ux0oNpcSKcdnHc.png

编辑仓库的卡片信息：添加行后且每一行允许添加多个段（字段）。如仓库第一行显示的字段是：仓库名称、第二行显示的字段是：仓库编号、停用。
GvtRbvh4PofQe8xzbZLcblP3nmb.png

## 配置效果如下：
YX73btb8uorlVDxCk8dctFAknaf.png

### 以“入库单”为例，介绍单据类业务对象如何配置？
在【业务对象】菜单页面，点击“添加业务对象”输入：“FbInboundOrder” 并点击“确定”按钮，进入【编辑业务对象】弹窗。
编辑入库单的基础信息：业务对象名：FbInboundOrder；显示名：入库单； 组：Warehouse；不勾选 “停用”；摘要：name；数量关系：多值；勾选 “有停用/禁用功能”；默认排序: _id；勾选启用修改记录；勾选启用自动编号，编号前缀设置：IO；流水号位数：5。
DtxhbXli0ovNcMxgxnKcF4IPngf.png

编辑入库单的字段信息：左侧显示的字段是通过：添加的字段或添加常用字段显示的：单号、类型、状态、状态说明、备注、已叫空容器、创建人、单行（有物料单行的就启用）等字段。
VDmvb4JYGot4HGxOLyNc8GCJnTc.png

NS8YbOOC7oi6XyxjHXXcUcEynTg.png

编辑入库单的卡片信息：添加行后且每一行允许添加多个段（字段）。如仓库第一行显示的字段是：单号、第二行显示的字段是：类型、创建人、创建时间。
BdLQbR5eSo7QRJxKgAbcm4ixnEc.png

编辑入库单的单据信息前提是：首先需要先添加一个名叫“入库单行”的新的业务对象。
在单据配置页面勾选“启用”单行业务对象，下拉选择：“入库单行”。单行：本次发生数量字段列表下拉选：入库数量；单行：已发生数量字段选（可选多个）下拉选：之前入库数量；单行：计划总数量字段下拉选：收货数量。勾选“入库：创建库存”；入库：创建库存时的单据状态（可选多个）下拉选：已提交；入库：库存初始状态：存储中。
添加业务对象“入库单行”的基础信息：业务对象名：FbInboundOrderLine 、显示名：入库单行、组：Warehouse、摘要为空、数量关系：多值；入库单行的字段必有信息：ID 所属入库单（单据）关联业务对象为：入库单；卡片信息为：第一行字段显示为：物料名称，第二行字段显示为：物料编号、物料型号、物料规格，第三行字段显示为：入库数量。
Jid5by0UUo5b6axx3OacewH5n3g.png

UBswbK3IcoytUHxZXpbcn32Hnfe.png

编辑入库单的单据类型：到字段配置页面类型字段字段的选项清单进行配置为：勾选启用，添加项：采购入库、产成品入库、其他入库。
FgzibJEX9oHwR2x8KZwcDFg9n5g.png

编辑入库单的单据状态的前提是：在入库单字段配置里添加了常用字段：状态（state）后单据状态页面配置功能才会启用。未提交时：勾选可修改单据，颜色设置：#777 ，添加后续状态下拉选择：已提交，按钮显示文字：提交，按钮种类设置下拉选：主要；已提交状态时：勾选：终态，颜色设置： #4AC774 。
WbtqbcCq7o3fbLx3mkNcjt3FnpR.png

### 以“门店叫货单”为例，介绍多单行单据类业务对象如何配置？
### 桌面端和移动端均支持，多单行单据，效果见下图：
P9LdbEkysolHPSx1OclctgLBnkb.png

## 配置方法：
在单头业务对象配置时，单行字段不再使用“btlines”，而是自己添加。添加时，类型选择“组件”、勾选“多值”、关联“单行业务对象”。
在单行业务对象配置时，每个单页业务对象的所属订单，都要关联单头业务对象。
OwPxbQW4fooDDLxvq9pcFtXwnIb.png

RMOwb6xhpoQXGRxxus1cIXVKnMb.png

Uk1rbaWI2otgJlxCNJJcXx7tnLh.png

### 业务对象配置省事 tips ？（开发和实施用的比较多）
创建新单据类型（业务对象）：强烈不建议从头创建！请在 M4Demo 里找最接近的单据复制！
尽量使用“添加常用字段” ：当需要添加常用字段时，尽量使用“添加常用字段”功能。
EkazbT1Tlo2yYwxXGW2ci3KtnIb.png

## 业务对象的命名规范是怎样的？
业务对象名和字段名均采用驼峰命名法。
每个单词首字母大写。不使用连字符。如不要使用 “Inbound_Order”。
业务对象第一个单词首字母也要大写，如 “MaterialCategory”。字段第一个单词首字母要小写，其余单词保持大写。如 “sourceOrder”。可以使用缩写，但缩写也仅第一个首字母大写，不要全大写。如要 “HcInbound”，不要 “HCInbound”。不要使用一个字母的单词或缩写，例如不要查询 “WInbound”。
单据以 Order 结尾，例如入库单“InboundOrder”。
不同类型的单据以缩写放在开头。缩写可以使用中文拼音或英文，以好识别为标准。如原料入库单 “MatInboundOrder” ，成品入库单 “FpInboundOrder” ，耗材入库单 “HcInboundOrder”。
## 新增业务对象后需要修复？
新增业务对象时，字段的 SQL 数据库类型、最多字符等配置容易漏填，以及 ID、创建人、创建时间等字段容易漏添加。因此，建议新增业务对象后，在业务对象列表页，点击“修复”，M4 会自动为你补缺。
## 更改业务对象后需要更新数据库结构？
对 SQL 类数据库，更改业务对象（新增、添加字段、改类型等），必须先创建、修改表结构，才能正常读写。
非现场，修改业务对象后，需要在业务对象列表页，点击“更新数据库结构”。
现场，推荐重启服务。
