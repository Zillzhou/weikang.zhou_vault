# 光通讯使用手册

## 光通讯使用手册
## 准备光通讯场景
按照部署手册安装配置好服务器端的 M4，浏览器访问 M4 的地址 http://ip:5800，ip 换成 M4 服务器的 IP 地址。
此版本光通讯需要在 Core 上先初始化所有机器人和场景信息，初始化完毕后导出 Core 场景。
新建组，添加机器人，推送场景；
## image.png

## image.png
## 添加机器人

## image.png
## 推送场景

导出 Core 场景；
## image.png

打开 M4《调度场景》-> 《编辑》-> 《导入 RDS CORE 场景》

## image.png

导入成功后，确定以下圈出来的参数配置全部为“是”，如果是 “否” 则修改成 “是”，保存；
## image.png

修改机器人连接类型，点击场景中的《机器人》卡片，再依次点击所有机器人的《连接类型》，切换为《网关上报》，保存；

## image.png
## 点击机器人

## image.png
## 切换连接方式

点击《返回》查看场景上机器人的位置，如果没有在线机器人，重新检查以上步骤；

## image.png

## image.png

点击菜单《移动机器人运行记录》，勾选所有机器人，点击《批量编辑》，勾选《扩展任务状态》，选择《空闲》并《保存》，查看保存后的机器人扩展状态为空闲；

## image.png

## image.png

## image.png

发任务测试，项目包内置了猎鹰任务，菜单《猎鹰任务记录》->《模板》->《光通讯测试》，点击任务旁边的运行按钮，输入机器人名称和一个存在的点位，点击《运行》；

## image.png

## image.png

观察实车和 M4《调度场景》中的运行情况，还可以在《系统监控》->《Old》菜单中看到目标车当前占用的所有点位资源；

## image.png

## image.png

## image.png

此外，如果是定制项目则还需要根据需求增加 M4 其他菜单以及定制脚本逻辑。
## M4 光通讯项目包使用及配置
M4Light.zip 脚本中预写了一些基础功能，可以直接用，也可以参考现场业务修改，包括：
## 定时器-监控机器人占用的点位资源
## 定时器-充电停靠
## 定时器-提交容器搬运单
## 解锁小车占用的点位资源

## 使用前请配置：
修改 M4Light/config/config.json（可选）

## {
## "db":{
        "type":"MySQL",
        "host":"127.0.0.1",
        "port":"3306",
        "username":"root",
        "password":"mysql",
## "dbName":"m4"
    },
## "port":5800
## }
修改 M4Light/scripts-py/constants.py
## 配置下基础信息

## # 机器人名称
ROBOT_NAMES = ["AMB-01","AMB-02","sim_001","sim_002","sim_003"]
## # 场景名称
## SCENE_NAME = "GW"
## # 停靠点
PARK_POINT = ["PP38","PP33","PP34"]
## # 充电点
CHATGE_POINT = ["CP39","CP28"]
## """
## 机器人充电阈值的配置
- 当前电量 > ENERGY_LEVEL_GOOD 时，空闲时可接单，或返回指定的停靠点。
- ENERGY_LEVEL_BAD < 当前电量 <= ENERGY_LEVEL_GOOD 时，空闲时可接单，或去指定的充电位置充电。
- 当前电量 <= ENERGY_LEVEL_BAD 时，完成正在执行的任务之后，不再接单，并返回充电位置充电。
要求：ENERGY_LEVEL_GOOD > ENERGY_LEVEL_BAD
## """
### ENERGY_LEVEL_GOOD = 0.6
### ENERGY_LEVEL_BAD = 0.3
## 修改“选择机器人”业务对象
## image.png

### 修改“移动机器人运行记录”把扩展状态改为空闲
